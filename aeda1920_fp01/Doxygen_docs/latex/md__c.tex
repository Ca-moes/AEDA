\hypertarget{md__c_autotoc_md1}{}\doxysection{Contributor License Agreements}\label{md__c_autotoc_md1}
We\textquotesingle{}d love to accept your patches! Before we can take them, we have to jump a couple of legal hurdles.

Please fill out either the individual or corporate Contributor License Agreement (C\+LA).


\begin{DoxyItemize}
\item If you are an individual writing original source code and you\textquotesingle{}re sure you own the intellectual property, then you\textquotesingle{}ll need to sign an \href{https://developers.google.com/open-source/cla/individual}{\texttt{ individual C\+LA}}.
\item If you work for a company that wants to allow you to contribute your work, then you\textquotesingle{}ll need to sign a \href{https://developers.google.com/open-source/cla/corporate}{\texttt{ corporate C\+LA}}.
\end{DoxyItemize}

Follow either of the two links above to access the appropriate C\+LA and instructions for how to sign and return it. Once we receive it, we\textquotesingle{}ll be able to accept your pull requests.\hypertarget{md__c_autotoc_md2}{}\doxysection{Are you a Googler?}\label{md__c_autotoc_md2}
If you are a Googler, please make an attempt to submit an internal change rather than a Git\+Hub Pull Request. If you are not able to submit an internal change a PR is acceptable as an alternative.\hypertarget{md__c_autotoc_md3}{}\doxysection{Contributing A Patch}\label{md__c_autotoc_md3}

\begin{DoxyEnumerate}
\item Submit an issue describing your proposed change to the \href{https://github.com/google/googletest}{\texttt{ issue tracker}}.
\item Please don\textquotesingle{}t mix more than one logical change per submittal, because it makes the history hard to follow. If you want to make a change that doesn\textquotesingle{}t have a corresponding issue in the issue tracker, please create one.
\item Also, coordinate with team members that are listed on the issue in question. This ensures that work isn\textquotesingle{}t being duplicated and communicating your plan early also generally leads to better patches.
\item If your proposed change is accepted, and you haven\textquotesingle{}t already done so, sign a Contributor License Agreement (see details above).
\item Fork the desired repo, develop and test your code changes.
\item Ensure that your code adheres to the existing style in the sample to which you are contributing.
\item Ensure that your code has an appropriate set of unit tests which all pass.
\item Submit a pull request.
\end{DoxyEnumerate}\hypertarget{md__c_autotoc_md4}{}\doxysection{The Google Test and Google Mock Communities}\label{md__c_autotoc_md4}
The Google Test community exists primarily through the \href{http://groups.google.com/group/googletestframework}{\texttt{ discussion group}} and the Git\+Hub repository. Likewise, the Google \mbox{\hyperlink{class_mock}{Mock}} community exists primarily through their own \href{http://groups.google.com/group/googlemock}{\texttt{ discussion group}}. You are definitely encouraged to contribute to the discussion and you can also help us to keep the effectiveness of the group high by following and promoting the guidelines listed here.\hypertarget{md__c_autotoc_md5}{}\doxysubsection{Please Be Friendly}\label{md__c_autotoc_md5}
Showing courtesy and respect to others is a vital part of the Google culture, and we strongly encourage everyone participating in Google Test development to join us in accepting nothing less. Of course, being courteous is not the same as failing to constructively disagree with each other, but it does mean that we should be respectful of each other when enumerating the 42 technical reasons that a particular proposal may not be the best choice. There\textquotesingle{}s never a reason to be antagonistic or dismissive toward anyone who is sincerely trying to contribute to a discussion.

Sure, C++ testing is serious business and all that, but it\textquotesingle{}s also a lot of fun. Let\textquotesingle{}s keep it that way. Let\textquotesingle{}s strive to be one of the friendliest communities in all of open source.

As always, discuss Google Test in the official Google\+Test discussion group. You don\textquotesingle{}t have to actually submit code in order to sign up. Your participation itself is a valuable contribution.\hypertarget{md__c_autotoc_md6}{}\doxysection{Style}\label{md__c_autotoc_md6}
To keep the source consistent, readable, diffable and easy to merge, we use a fairly rigid coding style, as defined by the \href{https://github.com/google/styleguide}{\texttt{ google-\/styleguide}} project. All patches will be expected to conform to the style outlined \href{https://google.github.io/styleguide/cppguide.html}{\texttt{ here}}. Use \href{https://github.com/google/googletest/blob/master/.clang-format}{\texttt{ .clang-\/format}} to check your formatting\hypertarget{md__c_autotoc_md7}{}\doxysection{Requirements for Contributors}\label{md__c_autotoc_md7}
If you plan to contribute a patch, you need to build Google Test, Google \mbox{\hyperlink{class_mock}{Mock}}, and their own tests from a git checkout, which has further requirements\+:


\begin{DoxyItemize}
\item \href{https://www.python.org/}{\texttt{ Python}} v2.\+3 or newer (for running some of the tests and re-\/generating certain source files from templates)
\item \href{https://cmake.org/}{\texttt{ C\+Make}} v2.\+6.\+4 or newer
\item \href{https://en.wikipedia.org/wiki/GNU_Build_System}{\texttt{ G\+NU Build System}} including automake ($>$= 1.\+9), autoconf ($>$= 2.\+59), and libtool / libtoolize.
\end{DoxyItemize}\hypertarget{md__c_autotoc_md8}{}\doxysection{Developing Google Test}\label{md__c_autotoc_md8}
This section discusses how to make your own changes to Google Test.\hypertarget{md__c_autotoc_md9}{}\doxysubsection{Testing Google Test Itself}\label{md__c_autotoc_md9}
To make sure your changes work as intended and don\textquotesingle{}t break existing functionality, you\textquotesingle{}ll want to compile and run Google Test\textquotesingle{}s own tests. For that you can use C\+Make\+: \begin{DoxyVerb}mkdir mybuild
cd mybuild
cmake -Dgtest_build_tests=ON ${GTEST_DIR}
\end{DoxyVerb}


Make sure you have Python installed, as some of Google Test\textquotesingle{}s tests are written in Python. If the cmake command complains about not being able to find Python ({\ttfamily Could N\+OT find Python\+Interp (missing\+: P\+Y\+T\+H\+O\+N\+\_\+\+E\+X\+E\+C\+U\+T\+A\+B\+LE)}), try telling it explicitly where your Python executable can be found\+: \begin{DoxyVerb}cmake -DPYTHON_EXECUTABLE=path/to/python -Dgtest_build_tests=ON ${GTEST_DIR}
\end{DoxyVerb}


Next, you can build Google Test and all of its own tests. On $\ast$nix, this is usually done by \textquotesingle{}make\textquotesingle{}. To run the tests, do \begin{DoxyVerb}make test
\end{DoxyVerb}


All tests should pass.\hypertarget{md__c_autotoc_md10}{}\doxysubsection{Regenerating Source Files}\label{md__c_autotoc_md10}
Some of Google Test\textquotesingle{}s source files are generated from templates (not in the C++ sense) using a script. For example, the file include/gtest/internal/gtest-\/type-\/util.\+h.\+pump is used to generate \mbox{\hyperlink{gtest-type-util_8h_source}{gtest-\/type-\/util.\+h}} in the same directory.

You don\textquotesingle{}t need to worry about regenerating the source files unless you need to modify them. You would then modify the corresponding {\ttfamily .pump} files and run the \textquotesingle{}\href{googletest/scripts/pump.py}{\texttt{ pump.\+py}}\textquotesingle{} generator script. See the Pump Manual.\hypertarget{md__c_autotoc_md11}{}\doxysection{Developing Google Mock}\label{md__c_autotoc_md11}
This section discusses how to make your own changes to Google \mbox{\hyperlink{class_mock}{Mock}}.\hypertarget{md__c_autotoc_md12}{}\doxysubsubsection{Testing Google Mock Itself}\label{md__c_autotoc_md12}
To make sure your changes work as intended and don\textquotesingle{}t break existing functionality, you\textquotesingle{}ll want to compile and run Google Test\textquotesingle{}s own tests. For that you\textquotesingle{}ll need Autotools. First, make sure you have followed the instructions above to configure Google \mbox{\hyperlink{class_mock}{Mock}}. Then, create a build output directory and enter it. Next, \begin{DoxyVerb}${GMOCK_DIR}/configure  # try --help for more info
\end{DoxyVerb}


Once you have successfully configured Google \mbox{\hyperlink{class_mock}{Mock}}, the build steps are standard for G\+N\+U-\/style O\+SS packages. \begin{DoxyVerb}make        # Standard makefile following GNU conventions
make check  # Builds and runs all tests - all should pass.
\end{DoxyVerb}


Note that when building your project against Google \mbox{\hyperlink{class_mock}{Mock}}, you are building against Google Test as well. There is no need to configure Google Test separately.\hypertarget{md__c_autotoc_md14}{}\doxysubsection{Defining a Mock Class}\label{md__c_autotoc_md14}
\hypertarget{md__c_MockClass}{}\doxysubsubsection{Mocking a Normal Class}\label{md__c_MockClass}
Given


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~Foo();}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} GetSize() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{string} Describe(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* name) = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{string} Describe(\textcolor{keywordtype}{int} type) = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} Process(Bar elem, \textcolor{keywordtype}{int} count) = 0;}
\DoxyCodeLine{\};}
\end{DoxyCode}


(note that {\ttfamily $\sim$\+Foo()} {\bfseries{must}} be virtual) we can define its mock as


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "gmock/gmock.h"}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, GetSize, (), (\textcolor{keyword}{const}, \textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{string}, Describe, (\textcolor{keyword}{const} \textcolor{keywordtype}{char}* name), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{string}, Describe, (\textcolor{keywordtype}{int} type), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, Process, (Bar elem, \textcolor{keywordtype}{int} count), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}


To create a \char`\"{}nice\char`\"{} mock, which ignores all uninteresting calls, a \char`\"{}naggy\char`\"{} mock, which warns on all uninteresting calls, or a \char`\"{}strict\char`\"{} mock, which treats them as failures\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::NiceMock;}
\DoxyCodeLine{using ::testing::NaggyMock;}
\DoxyCodeLine{using ::testing::StrictMock;}
\DoxyCodeLine{}
\DoxyCodeLine{NiceMock<MockFoo> nice\_foo;      \textcolor{comment}{// The type is a subclass of MockFoo.}}
\DoxyCodeLine{NaggyMock<MockFoo> naggy\_foo;    \textcolor{comment}{// The type is a subclass of MockFoo.}}
\DoxyCodeLine{StrictMock<MockFoo> strict\_foo;  \textcolor{comment}{// The type is a subclass of MockFoo.}}
\end{DoxyCode}


{\bfseries{Note\+:}} A mock object is currently naggy by default. We may make it nice by default in the future.\hypertarget{md__c_MockTemplate}{}\doxysubsubsection{Mocking a Class Template}\label{md__c_MockTemplate}
Class templates can be mocked just like any class.

To mock


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} Elem>}
\DoxyCodeLine{\textcolor{keyword}{class }StackInterface \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~StackInterface();}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} GetSize() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Push(\textcolor{keyword}{const} Elem\& x) = 0;}
\DoxyCodeLine{\};}
\end{DoxyCode}


(note that all member functions that are mocked, including {\ttfamily $\sim$\+Stack\+Interface()} {\bfseries{must}} be virtual).


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} Elem>}
\DoxyCodeLine{\textcolor{keyword}{class }MockStack : \textcolor{keyword}{public} StackInterface<Elem> \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, GetSize, (), (\textcolor{keyword}{const}, \textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Push, (\textcolor{keyword}{const} Elem\& x), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md15}{}\doxysubsubsection{Specifying Calling Conventions for Mock Functions}\label{md__c_autotoc_md15}
If your mock function doesn\textquotesingle{}t use the default calling convention, you can specify it by adding {\ttfamily Calltype(convention)} to {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD}\textquotesingle{}s 4th parameter. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{MOCK\_METHOD(\textcolor{keywordtype}{bool}, Foo, (\textcolor{keywordtype}{int} n), (Calltype(STDMETHODCALLTYPE)));}
\DoxyCodeLine{MOCK\_METHOD(\textcolor{keywordtype}{int}, Bar, (\textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y),}
\DoxyCodeLine{            (\textcolor{keyword}{const}, Calltype(STDMETHODCALLTYPE)));}
\end{DoxyCode}


where {\ttfamily S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+PE} is defined by {\ttfamily $<$objbase.\+h$>$} on Windows.\hypertarget{md__c_UsingMocks}{}\doxysubsection{Using Mocks in Tests}\label{md__c_UsingMocks}
The typical work flow is\+:


\begin{DoxyEnumerate}
\item Import the g\+Mock names you need to use. All g\+Mock symbols are in the {\ttfamily testing} namespace unless they are macros or otherwise noted.
\item Create the mock objects.
\item Optionally, set the default actions of the mock objects.
\item Set your expectations on the mock objects (How will they be called? What will they do?).
\item Exercise code that uses the mock objects; if necessary, check the result using googletest assertions.
\item When a mock object is destructed, g\+Mock automatically verifies that all expectations on it have been satisfied.
\end{DoxyEnumerate}

Here\textquotesingle{}s an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Return;                          \textcolor{comment}{// \#1}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(BarTest, DoesThis) \{}
\DoxyCodeLine{  MockFoo foo;                                    \textcolor{comment}{// \#2}}
\DoxyCodeLine{}
\DoxyCodeLine{  ON\_CALL(foo, GetSize())                         \textcolor{comment}{// \#3}}
\DoxyCodeLine{      .WillByDefault(Return(1));}
\DoxyCodeLine{  \textcolor{comment}{// ... other default actions ...}}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(foo, Describe(5))                   \textcolor{comment}{// \#4}}
\DoxyCodeLine{      .Times(3)}
\DoxyCodeLine{      .WillRepeatedly(Return(\textcolor{stringliteral}{"Category 5"}));}
\DoxyCodeLine{  \textcolor{comment}{// ... other expectations ...}}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_EQ(\textcolor{stringliteral}{"good"}, MyProductionFunction(\&foo));  \textcolor{comment}{// \#5}}
\DoxyCodeLine{\}                                                 \textcolor{comment}{// \#6}}
\end{DoxyCode}
\hypertarget{md__c_OnCall}{}\doxysubsection{Setting Default Actions}\label{md__c_OnCall}
g\+Mock has a {\bfseries{built-\/in default action}} for any function that returns {\ttfamily void}, {\ttfamily bool}, a numeric value, or a pointer. In C++11, it will additionally returns the default-\/constructed value, if one exists for the given type.

To customize the default action for functions with return type $\ast${\ttfamily T}$\ast$\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::DefaultValue;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Sets the default value to be returned. T must be CopyConstructible.}}
\DoxyCodeLine{DefaultValue<T>::Set(value);}
\DoxyCodeLine{\textcolor{comment}{// Sets a factory. Will be invoked on demand. T must be MoveConstructible.}}
\DoxyCodeLine{\textcolor{comment}{//  T MakeT();}}
\DoxyCodeLine{DefaultValue<T>::SetFactory(\&MakeT);}
\DoxyCodeLine{\textcolor{comment}{// ... use the mocks ...}}
\DoxyCodeLine{\textcolor{comment}{// Resets the default value.}}
\DoxyCodeLine{DefaultValue<T>::Clear();}
\end{DoxyCode}


Example usage\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Sets the default action for return type std::unique\_ptr<Buzz> to}}
\DoxyCodeLine{\textcolor{comment}{// creating a new Buzz every time.}}
\DoxyCodeLine{DefaultValue<std::unique\_ptr<Buzz>>::SetFactory(}
\DoxyCodeLine{    [] \{ \textcolor{keywordflow}{return} MakeUnique<Buzz>(AccessLevel::kInternal); \});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// When this fires, the default action of MakeBuzz() will run, which}}
\DoxyCodeLine{\textcolor{comment}{// will return a new Buzz object.}}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, MakeBuzz(\textcolor{stringliteral}{"hello"})).Times(AnyNumber());}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto} buzz1 = mock\_buzzer\_.MakeBuzz(\textcolor{stringliteral}{"hello"});}
\DoxyCodeLine{\textcolor{keyword}{auto} buzz2 = mock\_buzzer\_.MakeBuzz(\textcolor{stringliteral}{"hello"});}
\DoxyCodeLine{EXPECT\_NE(\textcolor{keyword}{nullptr}, buzz1);}
\DoxyCodeLine{EXPECT\_NE(\textcolor{keyword}{nullptr}, buzz2);}
\DoxyCodeLine{EXPECT\_NE(buzz1, buzz2);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Resets the default action for return type std::unique\_ptr<Buzz>,}}
\DoxyCodeLine{\textcolor{comment}{// to avoid interfere with other tests.}}
\DoxyCodeLine{DefaultValue<std::unique\_ptr<Buzz>>::Clear();}
\end{DoxyCode}


To customize the default action for a particular method of a specific mock object, use {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()}. {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} has a similar syntax to {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}, but it is used for setting default behaviors (when you do not require that the mock method is called). See \href{cook_book.md\#UseOnCall}{\texttt{ here}} for a more detailed discussion.


\begin{DoxyCode}{0}
\DoxyCodeLine{ON\_CALL(mock-\/\textcolor{keywordtype}{object}, method(matchers))}
\DoxyCodeLine{    .With(multi-\/argument-\/matcher)   ?}
\DoxyCodeLine{    .WillByDefault(action);}
\end{DoxyCode}
\hypertarget{md__c_ExpectCall}{}\doxysubsection{Setting Expectations}\label{md__c_ExpectCall}
{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} sets {\bfseries{expectations}} on a mock method (How will it be called? What will it do?)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(mock-\/\textcolor{keywordtype}{object}, method (matchers)?)}
\DoxyCodeLine{     .With(multi-\/argument-\/matcher)  ?}
\DoxyCodeLine{     .Times(cardinality)            ?}
\DoxyCodeLine{     .InSequence(sequences)         *}
\DoxyCodeLine{     .After(expectations)           *}
\DoxyCodeLine{     .WillOnce(action)              *}
\DoxyCodeLine{     .WillRepeatedly(action)        ?}
\DoxyCodeLine{     .RetiresOnSaturation();        ?}
\end{DoxyCode}


If {\ttfamily (matchers)} is omitted, the expectation is the same as if the matchers were set to anything matchers (for example, {\ttfamily (\+\_\+, \+\_\+, \+\_\+, \+\_\+)} for a four-\/arg method).

If {\ttfamily Times()} is omitted, the cardinality is assumed to be\+:


\begin{DoxyItemize}
\item {\ttfamily Times(1)} when there is neither {\ttfamily Will\+Once()} nor {\ttfamily Will\+Repeatedly()};
\item {\ttfamily Times(n)} when there are {\ttfamily n} {\ttfamily Will\+Once()}s but no {\ttfamily Will\+Repeatedly()}, where {\ttfamily n} $>$= 1; or
\item {\ttfamily Times(\+At\+Least(n))} when there are {\ttfamily n} {\ttfamily Will\+Once()}s and a {\ttfamily Will\+Repeatedly()}, where {\ttfamily n} $>$= 0.
\end{DoxyItemize}

A method with no {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} is free to be invoked {\itshape any number of times}, and the default action will be taken each time.\hypertarget{md__c_MatcherList}{}\doxysubsection{Matchers}\label{md__c_MatcherList}
A {\bfseries{matcher}} matches a {\itshape single} argument. You can use it inside {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} or {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}, or use it to validate a value directly\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T(actual\+\_\+value, matcher)}  &Asserts that {\ttfamily actual\+\_\+value} matches {\ttfamily matcher}.   \\\cline{1-2}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+H\+A\+T(actual\+\_\+value, matcher)}  &The same as {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T(actual\+\_\+value, matcher)}, except that it generates a {\bfseries{fatal}} failure.   \\\cline{1-2}
\end{longtabu}


Built-\/in matchers (where {\ttfamily argument} is the function argument) are divided into several categories\+:\hypertarget{md__c_autotoc_md16}{}\doxysubsubsection{Wildcard}\label{md__c_autotoc_md16}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily \+\_\+}  &{\ttfamily argument} can be any value of the correct type.   \\\cline{1-2}
{\ttfamily A$<$type$>$()} or {\ttfamily An$<$type$>$()}  &{\ttfamily argument} can be any value of type {\ttfamily type}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md17}{}\doxysubsubsection{Generic Comparison}\label{md__c_autotoc_md17}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Eq(value)} or {\ttfamily value}  &{\ttfamily argument == value}   \\\cline{1-2}
{\ttfamily Ge(value)}  &{\ttfamily argument $>$= value}   \\\cline{1-2}
{\ttfamily Gt(value)}  &{\ttfamily argument $>$ value}   \\\cline{1-2}
{\ttfamily Le(value)}  &{\ttfamily argument $<$= value}   \\\cline{1-2}
{\ttfamily Lt(value)}  &{\ttfamily argument $<$ value}   \\\cline{1-2}
{\ttfamily Ne(value)}  &{\ttfamily argument != value}   \\\cline{1-2}
{\ttfamily Is\+Null()}  &{\ttfamily argument} is a {\ttfamily N\+U\+LL} pointer (raw or smart).   \\\cline{1-2}
{\ttfamily Not\+Null()}  &{\ttfamily argument} is a non-\/null pointer (raw or smart).   \\\cline{1-2}
{\ttfamily Optional(m)}  &{\ttfamily argument} is {\ttfamily optional$<$$>$} that contains a value matching {\ttfamily m}.   \\\cline{1-2}
{\ttfamily Variant\+With$<$T$>$(m)}  &{\ttfamily argument} is {\ttfamily variant$<$$>$} that holds the alternative of type T with a value matching {\ttfamily m}.   \\\cline{1-2}
{\ttfamily Ref(variable)}  &{\ttfamily argument} is a reference to {\ttfamily variable}.   \\\cline{1-2}
{\ttfamily Typed\+Eq$<$type$>$(value)}  &{\ttfamily argument} has type {\ttfamily type} and is equal to {\ttfamily value}. You may need to use this instead of {\ttfamily Eq(value)} when the mock function is overloaded.   \\\cline{1-2}
\end{longtabu}


Except {\ttfamily Ref()}, these matchers make a {\itshape copy} of {\ttfamily value} in case it\textquotesingle{}s modified or destructed later. If the compiler complains that {\ttfamily value} doesn\textquotesingle{}t have a public copy constructor, try wrap it in {\ttfamily By\+Ref()}, e.\+g. {\ttfamily Eq(\+By\+Ref(non\+\_\+copyable\+\_\+value))}. If you do that, make sure {\ttfamily non\+\_\+copyable\+\_\+value} is not changed afterwards, or the meaning of your matcher will be changed.\hypertarget{md__c_FpMatchers}{}\doxysubsubsection{Floating-\/\+Point Matchers}\label{md__c_FpMatchers}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Double\+Eq(a\+\_\+double)}  &{\ttfamily argument} is a {\ttfamily double} value approximately equal to {\ttfamily a\+\_\+double}, treating two Na\+Ns as unequal.   \\\cline{1-2}
{\ttfamily Float\+Eq(a\+\_\+float)}  &{\ttfamily argument} is a {\ttfamily float} value approximately equal to {\ttfamily a\+\_\+float}, treating two Na\+Ns as unequal.   \\\cline{1-2}
{\ttfamily Nan\+Sensitive\+Double\+Eq(a\+\_\+double)}  &{\ttfamily argument} is a {\ttfamily double} value approximately equal to {\ttfamily a\+\_\+double}, treating two Na\+Ns as equal.   \\\cline{1-2}
{\ttfamily Nan\+Sensitive\+Float\+Eq(a\+\_\+float)}  &{\ttfamily argument} is a {\ttfamily float} value approximately equal to {\ttfamily a\+\_\+float}, treating two Na\+Ns as equal.   \\\cline{1-2}
\end{longtabu}


The above matchers use U\+L\+P-\/based comparison (the same as used in googletest). They automatically pick a reasonable error bound based on the absolute value of the expected value. {\ttfamily Double\+Eq()} and {\ttfamily Float\+Eq()} conform to the I\+E\+EE standard, which requires comparing two Na\+Ns for equality to return false. The {\ttfamily Nan\+Sensitive$\ast$} version instead treats two Na\+Ns as equal, which is often what a user wants.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Double\+Near(a\+\_\+double, max\+\_\+abs\+\_\+error)}  &{\ttfamily argument} is a {\ttfamily double} value close to {\ttfamily a\+\_\+double} (absolute error $<$= {\ttfamily max\+\_\+abs\+\_\+error}), treating two Na\+Ns as unequal.   \\\cline{1-2}
{\ttfamily Float\+Near(a\+\_\+float, max\+\_\+abs\+\_\+error)}  &{\ttfamily argument} is a {\ttfamily float} value close to {\ttfamily a\+\_\+float} (absolute error $<$= {\ttfamily max\+\_\+abs\+\_\+error}), treating two Na\+Ns as unequal.   \\\cline{1-2}
{\ttfamily Nan\+Sensitive\+Double\+Near(a\+\_\+double, max\+\_\+abs\+\_\+error)}  &{\ttfamily argument} is a {\ttfamily double} value close to {\ttfamily a\+\_\+double} (absolute error $<$= {\ttfamily max\+\_\+abs\+\_\+error}), treating two Na\+Ns as equal.   \\\cline{1-2}
{\ttfamily Nan\+Sensitive\+Float\+Near(a\+\_\+float, max\+\_\+abs\+\_\+error)}  &{\ttfamily argument} is a {\ttfamily float} value close to {\ttfamily a\+\_\+float} (absolute error $<$= {\ttfamily max\+\_\+abs\+\_\+error}), treating two Na\+Ns as equal.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md18}{}\doxysubsubsection{String Matchers}\label{md__c_autotoc_md18}
The {\ttfamily argument} can be either a C string or a C++ string object\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Contains\+Regex(string)}  &{\ttfamily argument} matches the given regular expression.   \\\cline{1-2}
{\ttfamily Ends\+With(suffix)}  &{\ttfamily argument} ends with string {\ttfamily suffix}.   \\\cline{1-2}
{\ttfamily Has\+Substr(string)}  &{\ttfamily argument} contains {\ttfamily string} as a sub-\/string.   \\\cline{1-2}
{\ttfamily Matches\+Regex(string)}  &{\ttfamily argument} matches the given regular expression with the match starting at the first character and ending at the last character.   \\\cline{1-2}
{\ttfamily Starts\+With(prefix)}  &{\ttfamily argument} starts with string {\ttfamily prefix}.   \\\cline{1-2}
{\ttfamily Str\+Case\+Eq(string)}  &{\ttfamily argument} is equal to {\ttfamily string}, ignoring case.   \\\cline{1-2}
{\ttfamily Str\+Case\+Ne(string)}  &{\ttfamily argument} is not equal to {\ttfamily string}, ignoring case.   \\\cline{1-2}
{\ttfamily Str\+Eq(string)}  &{\ttfamily argument} is equal to {\ttfamily string}.   \\\cline{1-2}
{\ttfamily Str\+Ne(string)}  &{\ttfamily argument} is not equal to {\ttfamily string}.   \\\cline{1-2}
\end{longtabu}


{\ttfamily Contains\+Regex()} and {\ttfamily Matches\+Regex()} take ownership of the {\ttfamily RE} object. They use the regular expression syntax defined \href{../../googletest/docs/advanced.md\#regular-expression-syntax}{\texttt{ here}}. {\ttfamily Str\+Case\+Eq()}, {\ttfamily Str\+Case\+Ne()}, {\ttfamily Str\+Eq()}, and {\ttfamily Str\+Ne()} work for wide strings as well.\hypertarget{md__c_autotoc_md19}{}\doxysubsubsection{Container Matchers}\label{md__c_autotoc_md19}
Most S\+T\+L-\/style containers support {\ttfamily ==}, so you can use {\ttfamily Eq(expected\+\_\+container)} or simply {\ttfamily expected\+\_\+container} to match a container exactly. If you want to write the elements in-\/line, match them more flexibly, or get more informative messages, you can use\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Begin\+End\+Distance\+Is(m)}  &{\ttfamily argument} is a container whose {\ttfamily begin()} and {\ttfamily end()} iterators are separated by a number of increments matching {\ttfamily m}. E.\+g. {\ttfamily Begin\+End\+Distance\+Is(2)} or {\ttfamily Begin\+End\+Distance\+Is(\+Lt(2))}. For containers that define a {\ttfamily size()} method, {\ttfamily Size\+Is(m)} may be more efficient.   \\\cline{1-2}
{\ttfamily Container\+Eq(container)}  &The same as {\ttfamily Eq(container)} except that the failure message also includes which elements are in one container but not the other.   \\\cline{1-2}
{\ttfamily Contains(e)}  &{\ttfamily argument} contains an element that matches {\ttfamily e}, which can be either a value or a matcher.   \\\cline{1-2}
{\ttfamily Each(e)}  &{\ttfamily argument} is a container where {\itshape every} element matches {\ttfamily e}, which can be either a value or a matcher.   \\\cline{1-2}
{\ttfamily Elements\+Are(e0, e1, ..., en)}  &{\ttfamily argument} has {\ttfamily n + 1} elements, where the {\itshape i}-\/th element matches {\ttfamily ei}, which can be a value or a matcher.   \\\cline{1-2}
{\ttfamily Elements\+Are\+Array(\{e0, e1, ..., en\})}, {\ttfamily Elements\+Are\+Array(a\+\_\+container)}, {\ttfamily Elements\+Are\+Array(begin, end)}, {\ttfamily Elements\+Are\+Array(array)}, or {\ttfamily Elements\+Are\+Array(array, count)}  &The same as {\ttfamily Elements\+Are()} except that the expected element values/matchers come from an initializer list, S\+T\+L-\/style container, iterator range, or C-\/style array.   \\\cline{1-2}
{\ttfamily Is\+Empty()}  &{\ttfamily argument} is an empty container ({\ttfamily container.\+empty()}).   \\\cline{1-2}
{\ttfamily Is\+False()}  &{\ttfamily argument} evaluates to {\ttfamily false} in a Boolean context.   \\\cline{1-2}
{\ttfamily Is\+Subset\+Of(\{e0, e1, ..., en\})}, {\ttfamily Is\+Subset\+Of(a\+\_\+container)}, {\ttfamily Is\+Subset\+Of(begin, end)}, {\ttfamily Is\+Subset\+Of(array)}, or {\ttfamily Is\+Subset\+Of(array, count)}  &{\ttfamily argument} matches {\ttfamily Unordered\+Elements\+Are(x0, x1, ..., xk)} for some subset {\ttfamily \{x0, x1, ..., xk\}} of the expected matchers.   \\\cline{1-2}
{\ttfamily Is\+Superset\+Of(\{e0, e1, ..., en\})}, {\ttfamily Is\+Superset\+Of(a\+\_\+container)}, {\ttfamily Is\+Superset\+Of(begin, end)}, {\ttfamily Is\+Superset\+Of(array)}, or {\ttfamily Is\+Superset\+Of(array, count)}  &Some subset of {\ttfamily argument} matches {\ttfamily Unordered\+Elements\+Are(}expected matchers{\ttfamily )}.   \\\cline{1-2}
{\ttfamily Is\+True()}  &{\ttfamily argument} evaluates to {\ttfamily true} in a Boolean context.   \\\cline{1-2}
{\ttfamily Pointwise(m, container)}, {\ttfamily Pointwise(m, \{e0, e1, ..., en\})}  &{\ttfamily argument} contains the same number of elements as in {\ttfamily container}, and for all i, (the i-\/th element in {\ttfamily argument}, the i-\/th element in {\ttfamily container}) match {\ttfamily m}, which is a matcher on 2-\/tuples. E.\+g. {\ttfamily Pointwise(\+Le(), upper\+\_\+bounds)} verifies that each element in {\ttfamily argument} doesn\textquotesingle{}t exceed the corresponding element in {\ttfamily upper\+\_\+bounds}. See more detail below.   \\\cline{1-2}
{\ttfamily Size\+Is(m)}  &{\ttfamily argument} is a container whose size matches {\ttfamily m}. E.\+g. {\ttfamily Size\+Is(2)} or {\ttfamily Size\+Is(\+Lt(2))}.   \\\cline{1-2}
{\ttfamily Unordered\+Elements\+Are(e0, e1, ..., en)}  &{\ttfamily argument} has {\ttfamily n + 1} elements, and under {\itshape some} permutation of the elements, each element matches an {\ttfamily ei} (for a different {\ttfamily i}), which can be a value or a matcher.   \\\cline{1-2}
{\ttfamily Unordered\+Elements\+Are\+Array(\{e0, e1, ..., en\})}, {\ttfamily Unordered\+Elements\+Are\+Array(a\+\_\+container)}, {\ttfamily Unordered\+Elements\+Are\+Array(begin, end)}, {\ttfamily Unordered\+Elements\+Are\+Array(array)}, or {\ttfamily Unordered\+Elements\+Are\+Array(array, count)}  &The same as {\ttfamily Unordered\+Elements\+Are()} except that the expected element values/matchers come from an initializer list, S\+T\+L-\/style container, iterator range, or C-\/style array.   \\\cline{1-2}
{\ttfamily Unordered\+Pointwise(m, container)}, {\ttfamily Unordered\+Pointwise(m, \{e0, e1, ..., en\})}  &Like {\ttfamily Pointwise(m, container)}, but ignores the order of elements.   \\\cline{1-2}
{\ttfamily When\+Sorted(m)}  &When {\ttfamily argument} is sorted using the {\ttfamily $<$} operator, it matches container matcher {\ttfamily m}. E.\+g. {\ttfamily When\+Sorted(\+Elements\+Are(1, 2, 3))} verifies that {\ttfamily argument} contains elements 1, 2, and 3, ignoring order.   \\\cline{1-2}
{\ttfamily When\+Sorted\+By(comparator, m)}  &The same as {\ttfamily When\+Sorted(m)}, except that the given comparator instead of {\ttfamily $<$} is used to sort {\ttfamily argument}. E.\+g. {\ttfamily When\+Sorted\+By(std\+::greater(), Elements\+Are(3, 2, 1))}.   \\\cline{1-2}
\end{longtabu}


{\bfseries{Notes\+:}}


\begin{DoxyItemize}
\item These matchers can also match\+:
\begin{DoxyEnumerate}
\item a native array passed by reference (e.\+g. in {\ttfamily Foo(const int (\&a)\mbox{[}5\mbox{]})}), and
\item an array passed as a pointer and a count (e.\+g. in {\ttfamily Bar(const T$\ast$ buffer, int len)} -- see \href{\#MultiArgMatchers}{\texttt{ Multi-\/argument Matchers}}).
\end{DoxyEnumerate}
\item The array being matched may be multi-\/dimensional (i.\+e. its elements can be arrays).
\item {\ttfamily m} in {\ttfamily Pointwise(m, ...)} should be a matcher for {\ttfamily \+::std\+::tuple$<$T, U$>$} where {\ttfamily T} and {\ttfamily U} are the element type of the actual container and the expected container, respectively. For example, to compare two {\ttfamily Foo} containers where {\ttfamily Foo} doesn\textquotesingle{}t support {\ttfamily operator==}, one might write\+:

\`{}\`{}\`{}cpp using \+::std\+::get; M\+A\+T\+C\+H\+ER(Foo\+Eq, \char`\"{}\char`\"{}) \{ return std\+::get$<$0$>$(arg).Equals(std\+::get$<$1$>$(arg)); \} ... E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+AT(actual\+\_\+foos, Pointwise(\+Foo\+Eq(), expected\+\_\+foos)); \`{}\`{}\`{}
\end{DoxyItemize}\hypertarget{md__c_autotoc_md20}{}\doxysubsubsection{Member Matchers}\label{md__c_autotoc_md20}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Field(\&class\+::field, m)}  &{\ttfamily argument.\+field} (or {\ttfamily argument-\/$>$field} when {\ttfamily argument} is a plain pointer) matches matcher {\ttfamily m}, where {\ttfamily argument} is an object of type {\itshape class}.   \\\cline{1-2}
{\ttfamily Key(e)}  &{\ttfamily argument.\+first} matches {\ttfamily e}, which can be either a value or a matcher. E.\+g. {\ttfamily Contains(Key(\+Le(5)))} can verify that a {\ttfamily map} contains a key {\ttfamily $<$= 5}.   \\\cline{1-2}
{\ttfamily Pair(m1, m2)}  &{\ttfamily argument} is an {\ttfamily std\+::pair} whose {\ttfamily first} field matches {\ttfamily m1} and {\ttfamily second} field matches {\ttfamily m2}.   \\\cline{1-2}
{\ttfamily Property(\&class\+::property, m)}  &{\ttfamily argument.\+property()} (or {\ttfamily argument-\/$>$property()} when {\ttfamily argument} is a plain pointer) matches matcher {\ttfamily m}, where {\ttfamily argument} is an object of type {\itshape class}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md21}{}\doxysubsubsection{Matching the Result of a Function, Functor, or Callback}\label{md__c_autotoc_md21}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Result\+Of(f, m)}  &{\ttfamily f(argument)} matches matcher {\ttfamily m}, where {\ttfamily f} is a function or functor.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md22}{}\doxysubsubsection{Pointer Matchers}\label{md__c_autotoc_md22}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Pointee(m)}  &{\ttfamily argument} (either a smart pointer or a raw pointer) points to a value that matches matcher {\ttfamily m}.   \\\cline{1-2}
{\ttfamily When\+Dynamic\+Cast\+To$<$T$>$(m)}  &when {\ttfamily argument} is passed through {\ttfamily dynamic\+\_\+cast$<$T$>$()}, it matches matcher {\ttfamily m}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_MultiArgMatchers}{}\doxysubsubsection{Multi-\/argument Matchers}\label{md__c_MultiArgMatchers}
Technically, all matchers match a {\itshape single} value. A \char`\"{}multi-\/argument\char`\"{} matcher is just one that matches a {\itshape tuple}. The following matchers can be used to match a tuple {\ttfamily (x, y)}\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Eq()}  &{\ttfamily x == y}   \\\cline{1-2}
{\ttfamily Ge()}  &{\ttfamily x $>$= y}   \\\cline{1-2}
{\ttfamily Gt()}  &{\ttfamily x $>$ y}   \\\cline{1-2}
{\ttfamily Le()}  &{\ttfamily x $<$= y}   \\\cline{1-2}
{\ttfamily Lt()}  &{\ttfamily x $<$ y}   \\\cline{1-2}
{\ttfamily Ne()}  &{\ttfamily x != y}   \\\cline{1-2}
\end{longtabu}


You can use the following selectors to pick a subset of the arguments (or reorder them) to participate in the matching\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily All\+Args(m)}  &Equivalent to {\ttfamily m}. Useful as syntactic sugar in {\ttfamily .With(\+All\+Args(m))}.   \\\cline{1-2}
{\ttfamily Args$<$N1, N2, ..., Nk$>$(m)}  &The tuple of the {\ttfamily k} selected (using 0-\/based indices) arguments matches {\ttfamily m}, e.\+g. {\ttfamily Args$<$1, 2$>$(Eq())}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md23}{}\doxysubsubsection{Composite Matchers}\label{md__c_autotoc_md23}
You can make a matcher from one or more other matchers\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily All\+Of(m1, m2, ..., mn)}  &{\ttfamily argument} matches all of the matchers {\ttfamily m1} to {\ttfamily mn}.   \\\cline{1-2}
{\ttfamily All\+Of\+Array(\{m0, m1, ..., mn\})}, {\ttfamily All\+Of\+Array(a\+\_\+container)}, {\ttfamily All\+Of\+Array(begin, end)}, {\ttfamily All\+Of\+Array(array)}, or {\ttfamily All\+Of\+Array(array, count)}  &The same as {\ttfamily All\+Of()} except that the matchers come from an initializer list, S\+T\+L-\/style container, iterator range, or C-\/style array.   \\\cline{1-2}
{\ttfamily Any\+Of(m1, m2, ..., mn)}  &{\ttfamily argument} matches at least one of the matchers {\ttfamily m1} to {\ttfamily mn}.   \\\cline{1-2}
{\ttfamily Any\+Of\+Array(\{m0, m1, ..., mn\})}, {\ttfamily Any\+Of\+Array(a\+\_\+container)}, {\ttfamily Any\+Of\+Array(begin, end)}, {\ttfamily Any\+Of\+Array(array)}, or {\ttfamily Any\+Of\+Array(array, count)}  &The same as {\ttfamily Any\+Of()} except that the matchers come from an initializer list, S\+T\+L-\/style container, iterator range, or C-\/style array.   \\\cline{1-2}
{\ttfamily Not(m)}  &{\ttfamily argument} doesn\textquotesingle{}t match matcher {\ttfamily m}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md24}{}\doxysubsubsection{Adapters for Matchers}\label{md__c_autotoc_md24}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Matcher\+Cast$<$T$>$(m)}  &casts matcher {\ttfamily m} to type {\ttfamily Matcher$<$T$>$}.   \\\cline{1-2}
{\ttfamily Safe\+Matcher\+Cast$<$T$>$(m)}  &\href{cook_book.md\#casting-matchers}{\texttt{ safely casts}} matcher {\ttfamily m} to type {\ttfamily Matcher$<$T$>$}.   \\\cline{1-2}
{\ttfamily Truly(predicate)}  &{\ttfamily predicate(argument)} returns something considered by C++ to be true, where {\ttfamily predicate} is a function or functor.   \\\cline{1-2}
\end{longtabu}


{\ttfamily Address\+Satisfies(callback)} and {\ttfamily Truly(callback)} take ownership of {\ttfamily callback}, which must be a permanent callback.\hypertarget{md__c_MatchersAsPredicatesCheat}{}\doxysubsubsection{Using Matchers as Predicates}\label{md__c_MatchersAsPredicatesCheat}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Matches(m)(value)}  &evaluates to {\ttfamily true} if {\ttfamily value} matches {\ttfamily m}. You can use {\ttfamily Matches(m)} alone as a unary functor.   \\\cline{1-2}
{\ttfamily Explain\+Match\+Result(m, value, result\+\_\+listener)}  &evaluates to {\ttfamily true} if {\ttfamily value} matches {\ttfamily m}, explaining the result to {\ttfamily result\+\_\+listener}.   \\\cline{1-2}
{\ttfamily Value(value, m)}  &evaluates to {\ttfamily true} if {\ttfamily value} matches {\ttfamily m}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md25}{}\doxysubsubsection{Defining Matchers}\label{md__c_autotoc_md25}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily M\+A\+T\+C\+H\+ER(Is\+Even, \char`\"{}\char`\"{}) \{ return (arg \% 2) == 0; \}}  &Defines a matcher {\ttfamily Is\+Even()} to match an even number.   \\\cline{1-2}
{\ttfamily M\+A\+T\+C\+H\+E\+R\+\_\+P(Is\+Divisible\+By, n, \char`\"{}\char`\"{}) \{ $\ast$result\+\_\+listener $<$$<$ \char`\"{}where the remainder is \char`\"{} $<$$<$ (arg \% n); return (arg \% n) == 0; \}}  &Defines a macher {\ttfamily Is\+Divisible\+By(n)} to match a number divisible by {\ttfamily n}.   \\\cline{1-2}
{\ttfamily M\+A\+T\+C\+H\+E\+R\+\_\+\+P2(Is\+Between, a, b, std\+::string(negation ? \char`\"{}isn\textquotesingle{}t\char`\"{} \+: \char`\"{}is\char`\"{}) + \char`\"{} between \char`\"{} + Print\+To\+String(a) + \char`\"{} and \char`\"{} + Print\+To\+String(b)) \{ return a $<$= arg \&\& arg $<$= b; \}}  &Defines a matcher {\ttfamily Is\+Between(a, b)} to match a value in the range \mbox{[}{\ttfamily a}, {\ttfamily b}\mbox{]}.   \\\cline{1-2}
\end{longtabu}


{\bfseries{Notes\+:}}


\begin{DoxyEnumerate}
\item The {\ttfamily M\+A\+T\+C\+H\+E\+R$\ast$} macros cannot be used inside a function or class.
\item The matcher body must be {\itshape purely functional} (i.\+e. it cannot have any side effect, and the result must not depend on anything other than the value being matched and the matcher parameters).
\item You can use {\ttfamily Print\+To\+String(x)} to convert a value {\ttfamily x} of any type to a string.
\end{DoxyEnumerate}\hypertarget{md__c_ActionList}{}\doxysubsection{Actions}\label{md__c_ActionList}
{\bfseries{Actions}} specify what a mock function should do when invoked.\hypertarget{md__c_autotoc_md26}{}\doxysubsubsection{Returning a Value}\label{md__c_autotoc_md26}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endhead
{\ttfamily Return()}  &Return from a {\ttfamily void} mock function.   \\\cline{1-2}
{\ttfamily Return(value)}  &Return {\ttfamily value}. If the type of {\ttfamily value} is different to the mock function\textquotesingle{}s return type, {\ttfamily value} is converted to the latter type {\itshape at the time the expectation is set}, not when the action is executed.   \\\cline{1-2}
{\ttfamily Return\+Arg$<$N$>$()}  &Return the {\ttfamily N}-\/th (0-\/based) argument.   \\\cline{1-2}
{\ttfamily Return\+New$<$T$>$(a1, ..., ak)}  &Return {\ttfamily new T(a1, ..., ak)}; a different object is created each time.   \\\cline{1-2}
{\ttfamily Return\+Null()}  &Return a null pointer.   \\\cline{1-2}
{\ttfamily Return\+Pointee(ptr)}  &Return the value pointed to by {\ttfamily ptr}.   \\\cline{1-2}
{\ttfamily Return\+Ref(variable)}  &Return a reference to {\ttfamily variable}.   \\\cline{1-2}
{\ttfamily Return\+Ref\+Of\+Copy(value)}  &Return a reference to a copy of {\ttfamily value}; the copy lives as long as the action.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md27}{}\doxysubsubsection{Side Effects}\label{md__c_autotoc_md27}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endhead
{\ttfamily Assign(\&variable, value)}  &Assign {\ttfamily value} to variable.   \\\cline{1-2}
{\ttfamily Delete\+Arg$<$N$>$()}  &Delete the {\ttfamily N}-\/th (0-\/based) argument, which must be a pointer.   \\\cline{1-2}
{\ttfamily Save\+Arg$<$N$>$(pointer)}  &Save the {\ttfamily N}-\/th (0-\/based) argument to {\ttfamily $\ast$pointer}.   \\\cline{1-2}
{\ttfamily Save\+Arg\+Pointee$<$N$>$(pointer)}  &Save the value pointed to by the {\ttfamily N}-\/th (0-\/based) argument to {\ttfamily $\ast$pointer}.   \\\cline{1-2}
{\ttfamily Set\+Arg\+Referee$<$N$>$(value)}  &Assign value to the variable referenced by the {\ttfamily N}-\/th (0-\/based) argument.   \\\cline{1-2}
{\ttfamily Set\+Arg\+Pointee$<$N$>$(value)}  &Assign {\ttfamily value} to the variable pointed by the {\ttfamily N}-\/th (0-\/based) argument.   \\\cline{1-2}
{\ttfamily Set\+Argument\+Pointee$<$N$>$(value)}  &Same as {\ttfamily Set\+Arg\+Pointee$<$N$>$(value)}. Deprecated. Will be removed in v1.\+7.\+0.   \\\cline{1-2}
{\ttfamily Set\+Array\+Argument$<$N$>$(first, last)}  &Copies the elements in source range \mbox{[}{\ttfamily first}, {\ttfamily last}) to the array pointed to by the {\ttfamily N}-\/th (0-\/based) argument, which can be either a pointer or an iterator. The action does not take ownership of the elements in the source range.   \\\cline{1-2}
{\ttfamily Set\+Errno\+And\+Return(error, value)}  &Set {\ttfamily errno} to {\ttfamily error} and return {\ttfamily value}.   \\\cline{1-2}
{\ttfamily Throw(exception)}  &Throws the given exception, which can be any copyable value. Available since v1.\+1.\+0.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md28}{}\doxysubsubsection{Using a Function, Functor, or Lambda as an Action}\label{md__c_autotoc_md28}
In the following, by \char`\"{}callable\char`\"{} we mean a free function, {\ttfamily std\+::function}, functor, or lambda.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endhead
{\ttfamily f}  &Invoke f with the arguments passed to the mock function, where f is a callable.   \\\cline{1-2}
{\ttfamily Invoke(f)}  &Invoke {\ttfamily f} with the arguments passed to the mock function, where {\ttfamily f} can be a global/static function or a functor.   \\\cline{1-2}
{\ttfamily Invoke(object\+\_\+pointer, \&class\+::method)}  &Invoke the method on the object with the arguments passed to the mock function.   \\\cline{1-2}
{\ttfamily Invoke\+Without\+Args(f)}  &Invoke {\ttfamily f}, which can be a global/static function or a functor. {\ttfamily f} must take no arguments.   \\\cline{1-2}
{\ttfamily Invoke\+Without\+Args(object\+\_\+pointer, \&class\+::method)}  &Invoke the method on the object, which takes no arguments.   \\\cline{1-2}
{\ttfamily Invoke\+Argument$<$N$>$(arg1, arg2, ..., argk)}  &Invoke the mock function\textquotesingle{}s {\ttfamily N}-\/th (0-\/based) argument, which must be a function or a functor, with the {\ttfamily k} arguments.   \\\cline{1-2}
\end{longtabu}


The return value of the invoked function is used as the return value of the action.

When defining a callable to be used with {\ttfamily Invoke$\ast$()}, you can declare any unused parameters as {\ttfamily Unused}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{\textcolor{keywordtype}{double} Distance(Unused, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y) \{ \textcolor{keywordflow}{return} sqrt(x*x + y*y); \}}
\DoxyCodeLine{...}
\DoxyCodeLine{EXPECT\_CALL(mock, Foo(\textcolor{stringliteral}{"Hi"}, \_, \_)).WillOnce(Invoke(Distance));}
\end{DoxyCode}


{\ttfamily Invoke(callback)} and {\ttfamily Invoke\+Without\+Args(callback)} take ownership of {\ttfamily callback}, which must be permanent. The type of {\ttfamily callback} must be a base callback type instead of a derived one, e.\+g.


\begin{DoxyCode}{0}
\DoxyCodeLine{BlockingClosure* done = \textcolor{keyword}{new} BlockingClosure;}
\DoxyCodeLine{... Invoke(done) ...;  \textcolor{comment}{// This won't compile!}}
\DoxyCodeLine{}
\DoxyCodeLine{Closure* done2 = \textcolor{keyword}{new} BlockingClosure;}
\DoxyCodeLine{... Invoke(done2) ...;  \textcolor{comment}{// This works.}}
\end{DoxyCode}


In {\ttfamily Invoke\+Argument$<$N$>$(...)}, if an argument needs to be passed by reference, wrap it inside {\ttfamily By\+Ref()}. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ByRef;}
\DoxyCodeLine{using ::testing::InvokeArgument;}
\DoxyCodeLine{...}
\DoxyCodeLine{InvokeArgument<2>(5, string(\textcolor{stringliteral}{"Hi"}), ByRef(foo))}
\end{DoxyCode}


calls the mock function\textquotesingle{}s \#2 argument, passing to it {\ttfamily 5} and {\ttfamily string(\char`\"{}\+Hi\char`\"{})} by value, and {\ttfamily foo} by reference.\hypertarget{md__c_autotoc_md29}{}\doxysubsubsection{Default Action}\label{md__c_autotoc_md29}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Matcher  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Do\+Default()}  &Do the default action (specified by {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} or the built-\/in one).   \\\cline{1-2}
\end{longtabu}


{\bfseries{Note\+:}} due to technical reasons, {\ttfamily Do\+Default()} cannot be used inside a composite action -\/ trying to do so will result in a run-\/time error.\hypertarget{md__c_autotoc_md30}{}\doxysubsubsection{Composite Actions}\label{md__c_autotoc_md30}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endhead
{\ttfamily Do\+All(a1, a2, ..., an)}  &Do all actions {\ttfamily a1} to {\ttfamily an} and return the result of {\ttfamily an} in each invocation. The first {\ttfamily n -\/ 1} sub-\/actions must return void.   \\\cline{1-2}
{\ttfamily Ignore\+Result(a)}  &Perform action {\ttfamily a} and ignore its result. {\ttfamily a} must not return void.   \\\cline{1-2}
{\ttfamily With\+Arg$<$N$>$(a)}  &Pass the {\ttfamily N}-\/th (0-\/based) argument of the mock function to action {\ttfamily a} and perform it.   \\\cline{1-2}
{\ttfamily With\+Args$<$N1, N2, ..., Nk$>$(a)}  &Pass the selected (0-\/based) arguments of the mock function to action {\ttfamily a} and perform it.   \\\cline{1-2}
{\ttfamily Without\+Args(a)}  &Perform action {\ttfamily a} without any arguments.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md31}{}\doxysubsubsection{Defining Actions}\label{md__c_autotoc_md31}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
{\ttfamily struct Sum\+Action \{} ~\newline
 \quad{}{\ttfamily template $<$typename T$>$} ~\newline
 \quad{}{\ttfamily T operator()(\+T x, Ty) \{ return x + y; \}} ~\newline
 {\ttfamily \};}  &Defines a generic functor that can be used as an action summing its arguments.   \\\cline{1-2}
\\\cline{1-2}
\end{longtabu}


\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endhead
{\ttfamily A\+C\+T\+I\+O\+N(\+Sum) \{ return arg0 + arg1; \}}  &Defines an action {\ttfamily Sum()} to return the sum of the mock function\textquotesingle{}s argument \#0 and \#1.   \\\cline{1-2}
{\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P(\+Plus, n) \{ return arg0 + n; \}}  &Defines an action {\ttfamily Plus(n)} to return the sum of the mock function\textquotesingle{}s argument \#0 and {\ttfamily n}.   \\\cline{1-2}
{\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+Pk(\+Foo, p1, ..., pk) \{ statements; \}}  &Defines a parameterized action {\ttfamily Foo(p1, ..., pk)} to execute the given {\ttfamily statements}.   \\\cline{1-2}
\end{longtabu}


The {\ttfamily A\+C\+T\+I\+O\+N$\ast$} macros cannot be used inside a function or class.\hypertarget{md__c_CardinalityList}{}\doxysubsection{Cardinalities}\label{md__c_CardinalityList}
These are used in {\ttfamily Times()} to specify how many times a mock function will be called\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ }&\cellcolor{\tableheadbgcolor}\textbf{ }\\\cline{1-2}
\endhead
{\ttfamily Any\+Number()}  &The function can be called any number of times.   \\\cline{1-2}
{\ttfamily At\+Least(n)}  &The call is expected at least {\ttfamily n} times.   \\\cline{1-2}
{\ttfamily At\+Most(n)}  &The call is expected at most {\ttfamily n} times.   \\\cline{1-2}
{\ttfamily Between(m, n)}  &The call is expected between {\ttfamily m} and {\ttfamily n} (inclusive) times.   \\\cline{1-2}
{\ttfamily Exactly(n) or n}  &The call is expected exactly {\ttfamily n} times. In particular, the call should never happen when {\ttfamily n} is 0.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md32}{}\doxysubsection{Expectation Order}\label{md__c_autotoc_md32}
By default, the expectations can be matched in {\itshape any} order. If some or all expectations must be matched in a given order, there are two ways to specify it. They can be used either independently or together.\hypertarget{md__c_AfterClause}{}\doxysubsubsection{The After Clause}\label{md__c_AfterClause}

\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Expectation;}
\DoxyCodeLine{...}
\DoxyCodeLine{Expectation init\_x = EXPECT\_CALL(foo, InitX());}
\DoxyCodeLine{Expectation init\_y = EXPECT\_CALL(foo, InitY());}
\DoxyCodeLine{EXPECT\_CALL(foo, Bar())}
\DoxyCodeLine{     .After(init\_x, init\_y);}
\end{DoxyCode}


says that {\ttfamily Bar()} can be called only after both {\ttfamily Init\+X()} and {\ttfamily Init\+Y()} have been called.

If you don\textquotesingle{}t know how many pre-\/requisites an expectation has when you write it, you can use an {\ttfamily Expectation\+Set} to collect them\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ExpectationSet;}
\DoxyCodeLine{...}
\DoxyCodeLine{ExpectationSet all\_inits;}
\DoxyCodeLine{\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < element\_count; i++) \{}
\DoxyCodeLine{  all\_inits += EXPECT\_CALL(foo, InitElement(i));}
\DoxyCodeLine{\}}
\DoxyCodeLine{EXPECT\_CALL(foo, Bar())}
\DoxyCodeLine{     .After(all\_inits);}
\end{DoxyCode}


says that {\ttfamily Bar()} can be called only after all elements have been initialized (but we don\textquotesingle{}t care about which elements get initialized before the others).

Modifying an {\ttfamily Expectation\+Set} after using it in an {\ttfamily .After()} doesn\textquotesingle{}t affect the meaning of the {\ttfamily .After()}.\hypertarget{md__c_UsingSequences}{}\doxysubsubsection{Sequences}\label{md__c_UsingSequences}
When you have a long chain of sequential expectations, it\textquotesingle{}s easier to specify the order using {\bfseries{sequences}}, which don\textquotesingle{}t require you to given each expectation in the chain a different name. {\itshape All expected calls} in the same sequence must occur in the order they are specified.


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{using ::testing::Sequence;}
\DoxyCodeLine{Sequence s1, s2;}
\DoxyCodeLine{...}
\DoxyCodeLine{EXPECT\_CALL(foo, Reset())}
\DoxyCodeLine{    .InSequence(s1, s2)}
\DoxyCodeLine{    .WillOnce(Return(\textcolor{keyword}{true}));}
\DoxyCodeLine{EXPECT\_CALL(foo, GetSize())}
\DoxyCodeLine{    .InSequence(s1)}
\DoxyCodeLine{    .WillOnce(Return(1));}
\DoxyCodeLine{EXPECT\_CALL(foo, Describe(A<const char*>()))}
\DoxyCodeLine{    .InSequence(s2)}
\DoxyCodeLine{    .WillOnce(Return(\textcolor{stringliteral}{"dummy"}));}
\end{DoxyCode}


says that {\ttfamily Reset()} must be called before {\itshape both} {\ttfamily Get\+Size()} {\itshape and} {\ttfamily Describe()}, and the latter two can occur in any order.

To put many expectations in a sequence conveniently\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::InSequence;}
\DoxyCodeLine{\{}
\DoxyCodeLine{  InSequence seq;}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(...)...;}
\DoxyCodeLine{  EXPECT\_CALL(...)...;}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  EXPECT\_CALL(...)...;}
\DoxyCodeLine{\}}
\end{DoxyCode}


says that all expected calls in the scope of {\ttfamily seq} must occur in strict order. The name {\ttfamily seq} is irrelevant.\hypertarget{md__c_autotoc_md33}{}\doxysubsection{Verifying and Resetting a Mock}\label{md__c_autotoc_md33}
g\+Mock will verify the expectations on a mock object when it is destructed, or you can do it earlier\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Mock;}
\DoxyCodeLine{...}
\DoxyCodeLine{\textcolor{comment}{// Verifies and removes the expectations on mock\_obj;}}
\DoxyCodeLine{\textcolor{comment}{// returns true if successful.}}
\DoxyCodeLine{Mock::VerifyAndClearExpectations(\&mock\_obj);}
\DoxyCodeLine{...}
\DoxyCodeLine{\textcolor{comment}{// Verifies and removes the expectations on mock\_obj;}}
\DoxyCodeLine{\textcolor{comment}{// also removes the default actions set by ON\_CALL();}}
\DoxyCodeLine{\textcolor{comment}{// returns true if successful.}}
\DoxyCodeLine{Mock::VerifyAndClear(\&mock\_obj);}
\end{DoxyCode}


You can also tell g\+Mock that a mock object can be leaked and doesn\textquotesingle{}t need to be verified\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Mock::AllowLeak(\&mock\_obj);}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md34}{}\doxysubsection{Mock Classes}\label{md__c_autotoc_md34}
g\+Mock defines a convenient mock class template


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFunction<R(A1, ..., An)> \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(R, Call, (A1, ..., An));}
\DoxyCodeLine{\};}
\end{DoxyCode}


See this \href{cook_book.md\#using-check-points}{\texttt{ recipe}} for one application of it.\hypertarget{md__c_autotoc_md35}{}\doxysubsection{Flags}\label{md__c_autotoc_md35}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Flag  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Flag  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily -\/-\/gmock\+\_\+catch\+\_\+leaked\+\_\+mocks=0}  &Don\textquotesingle{}t report leaked mock objects as failures.   \\\cline{1-2}
{\ttfamily -\/-\/gmock\+\_\+verbose=L\+E\+V\+EL}  &Sets the default verbosity level ({\ttfamily info}, {\ttfamily warning}, or {\ttfamily error}) of Google \mbox{\hyperlink{class_mock}{Mock}} messages.   \\\cline{1-2}
\end{longtabu}


You can find recipes for using g\+Mock here. If you haven\textquotesingle{}t yet, please read this first to make sure you understand the basics.

{\bfseries{Note\+:}} g\+Mock lives in the {\ttfamily testing} name space. For readability, it is recommended to write {\ttfamily using \+::testing\+::\+Foo;} once in your file before using the name {\ttfamily Foo} defined by g\+Mock. We omit such {\ttfamily using} statements in this section for brevity, but you should do it in your own code.\hypertarget{md__c_autotoc_md37}{}\doxysubsection{Creating Mock Classes}\label{md__c_autotoc_md37}
\mbox{\hyperlink{class_mock}{Mock}} classes are defined as normal classes, using the {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} macro to generate mocked methods. The macro gets 3 or 4 parameters\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MyMock \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(ReturnType, MethodName, (Args...));}
\DoxyCodeLine{  MOCK\_METHOD(ReturnType, MethodName, (Args...), (Specs...));}
\DoxyCodeLine{\};}
\end{DoxyCode}


The first 3 parameters are simply the method declaration, split into 3 parts. The 4th parameter accepts a closed list of qualifiers, which affect the generated method\+:


\begin{DoxyItemize}
\item $\ast$$\ast${\ttfamily const}$\ast$$\ast$ -\/ Makes the mocked method a {\ttfamily const} method. Required if overriding a {\ttfamily const} method.
\item $\ast$$\ast${\ttfamily override}$\ast$$\ast$ -\/ Marks the method with {\ttfamily override}. Recommended if overriding a {\ttfamily virtual} method.
\item $\ast$$\ast${\ttfamily noexcept}$\ast$$\ast$ -\/ Marks the method with {\ttfamily noexcept}. Required if overriding a {\ttfamily noexcept} method.
\item $\ast$$\ast${\ttfamily Calltype(...)}$\ast$$\ast$ -\/ Sets the call type for the method (e.\+g. to {\ttfamily S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+PE}), useful in Windows.
\end{DoxyItemize}\hypertarget{md__c_autotoc_md38}{}\doxysubsubsection{Dealing with unprotected commas}\label{md__c_autotoc_md38}
Unprotected commas, i.\+e. commas which are not surrounded by parentheses, prevent {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} from parsing its arguments correctly\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(std::pair<bool, int>, GetPair, ());  \textcolor{comment}{// Won't compile!}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, CheckMap, (std::map<int, double>, \textcolor{keywordtype}{bool}));  \textcolor{comment}{// Won't compile!}}
\DoxyCodeLine{\};}
\end{DoxyCode}


Solution 1 -\/ wrap with parentheses\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD((std::pair<bool, int>), GetPair, ());}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, CheckMap, ((std::map<int, double>), \textcolor{keywordtype}{bool}));}
\DoxyCodeLine{\};}
\end{DoxyCode}


Note that wrapping a return or argument type with parentheses is, in general, invalid C++. {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} removes the parentheses.

Solution 2 -\/ define an alias\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{using} BoolAndInt = std::pair<bool, int>;}
\DoxyCodeLine{  MOCK\_METHOD(BoolAndInt, GetPair, ());}
\DoxyCodeLine{  \textcolor{keyword}{using} MapIntDouble = std::map<int, double>;}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, CheckMap, (MapIntDouble, \textcolor{keywordtype}{bool}));}
\DoxyCodeLine{\};}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md39}{}\doxysubsubsection{Mocking Private or Protected Methods}\label{md__c_autotoc_md39}
You must always put a mock method definition ({\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD}) in a {\ttfamily public\+:} section of the mock class, regardless of the method being mocked being {\ttfamily public}, {\ttfamily protected}, or {\ttfamily private} in the base class. This allows {\ttfamily O\+N\+\_\+\+C\+A\+LL} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} to reference the mock function from outside of the mock class. (Yes, C++ allows a subclass to change the access level of a virtual function in the base class.) Example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} Transform(Gadget* g) = 0;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{keyword}{protected}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Resume();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{keyword}{private}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} GetTimeOut();}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, Transform, (Gadget* g), (\textcolor{keyword}{override}));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// The following must be in the public section, even though the}}
\DoxyCodeLine{  \textcolor{comment}{// methods are protected or private in the base class.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Resume, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, GetTimeOut, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md40}{}\doxysubsubsection{Mocking Overloaded Methods}\label{md__c_autotoc_md40}
You can mock overloaded functions as usual. No special attention is required\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Must be virtual as we'll inherit from Foo.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~Foo();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Overloaded on the types and/or numbers of arguments.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} Add(Element x);}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} Add(\textcolor{keywordtype}{int} times, Element x);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Overloaded on the const-\/ness of this object.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} Bar\& GetBar();}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keyword}{const} Bar\& GetBar() \textcolor{keyword}{const};}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, Add, (Element x), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, Add, (\textcolor{keywordtype}{int} times, Element x), (\textcolor{keyword}{override}));}
\DoxyCodeLine{}
\DoxyCodeLine{  MOCK\_METHOD(Bar\&, GetBar, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keyword}{const} Bar\&, GetBar, (), (\textcolor{keyword}{const}, \textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}


{\bfseries{Note\+:}} if you don\textquotesingle{}t mock all versions of the overloaded method, the compiler will give you a warning about some methods in the base class being hidden. To fix that, use {\ttfamily using} to bring them in scope\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{using} Foo::Add;}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, Add, (Element x), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  \textcolor{comment}{// We don't want to mock int Add(int times, Element x);}}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md41}{}\doxysubsubsection{Mocking Class Templates}\label{md__c_autotoc_md41}
You can mock class templates just like any class.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} Elem>}
\DoxyCodeLine{\textcolor{keyword}{class }StackInterface \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{comment}{// Must be virtual as we'll inherit from StackInterface.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~StackInterface();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} GetSize() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Push(\textcolor{keyword}{const} Elem\& x) = 0;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} Elem>}
\DoxyCodeLine{\textcolor{keyword}{class }MockStack : \textcolor{keyword}{public} StackInterface<Elem> \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, GetSize, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Push, (\textcolor{keyword}{const} Elem\& x), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}
\hypertarget{md__c_MockingNonVirtualMethods}{}\doxysubsubsection{Mocking Non-\/virtual Methods}\label{md__c_MockingNonVirtualMethods}
g\+Mock can mock non-\/virtual functions to be used in Hi-\/perf dependency injection.

In this case, instead of sharing a common base class with the real class, your mock class will be {\itshape unrelated} to the real class, but contain methods with the same signatures. The syntax for mocking non-\/virtual methods is the {\itshape same} as mocking virtual methods (just don\textquotesingle{}t add {\ttfamily override})\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// A simple packet stream class.  None of its members is virtual.}}
\DoxyCodeLine{\textcolor{keyword}{class }ConcretePacketStream \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{void} AppendPacket(Packet* new\_packet);}
\DoxyCodeLine{  \textcolor{keyword}{const} Packet* GetPacket(\textcolor{keywordtype}{size\_t} packet\_number) \textcolor{keyword}{const};}
\DoxyCodeLine{  \textcolor{keywordtype}{size\_t} NumberOfPackets() \textcolor{keyword}{const};}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// A mock packet stream class.  It inherits from no other, but defines}}
\DoxyCodeLine{\textcolor{comment}{// GetPacket() and NumberOfPackets().}}
\DoxyCodeLine{\textcolor{keyword}{class }MockPacketStream \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keyword}{const} Packet*, GetPacket, (\textcolor{keywordtype}{size\_t} packet\_number), (\textcolor{keyword}{const}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{size\_t}, NumberOfPackets, (), (\textcolor{keyword}{const}));}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


Note that the mock class doesn\textquotesingle{}t define {\ttfamily Append\+Packet()}, unlike the real class. That\textquotesingle{}s fine as long as the test doesn\textquotesingle{}t need to call it.

Next, you need a way to say that you want to use {\ttfamily Concrete\+Packet\+Stream} in production code, and use {\ttfamily Mock\+Packet\+Stream} in tests. Since the functions are not virtual and the two classes are unrelated, you must specify your choice at {\itshape compile time} (as opposed to run time).

One way to do it is to templatize your code that needs to use a packet stream. More specifically, you will give your code a template type argument for the type of the packet stream. In production, you will instantiate your template with {\ttfamily Concrete\+Packet\+Stream} as the type argument. In tests, you will instantiate the same template with {\ttfamily Mock\+Packet\+Stream}. For example, you may write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{class} PacketStream>}
\DoxyCodeLine{\textcolor{keywordtype}{void} CreateConnection(PacketStream* stream) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{class} PacketStream>}
\DoxyCodeLine{\textcolor{keyword}{class }PacketReader \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{void} ReadPackets(PacketStream* stream, \textcolor{keywordtype}{size\_t} packet\_num);}
\DoxyCodeLine{\};}
\end{DoxyCode}


Then you can use {\ttfamily Create\+Connection$<$Concrete\+Packet\+Stream$>$()} and {\ttfamily Packet\+Reader$<$Concrete\+Packet\+Stream$>$} in production code, and use {\ttfamily Create\+Connection$<$Mock\+Packet\+Stream$>$()} and {\ttfamily Packet\+Reader$<$Mock\+Packet\+Stream$>$} in tests.


\begin{DoxyCode}{0}
\DoxyCodeLine{MockPacketStream mock\_stream;}
\DoxyCodeLine{EXPECT\_CALL(mock\_stream, ...)...;}
\DoxyCodeLine{.. set more expectations on mock\_stream ...}
\DoxyCodeLine{PacketReader<MockPacketStream> reader(\&mock\_stream);}
\DoxyCodeLine{... exercise reader ...}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md42}{}\doxysubsubsection{Mocking Free Functions}\label{md__c_autotoc_md42}
It\textquotesingle{}s possible to use g\+Mock to mock a free function (i.\+e. a C-\/style function or a static method). You just need to rewrite your code to use an interface (abstract class).

Instead of calling a free function (say, {\ttfamily Open\+File}) directly, introduce an interface for it and have a concrete subclass that calls the free function\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }FileInterface \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} Open(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* path, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* mode) = 0;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }File : \textcolor{keyword}{public} FileInterface \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} Open(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* path, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* mode) \{}
\DoxyCodeLine{     \textcolor{keywordflow}{return} OpenFile(path, mode);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


Your code should talk to {\ttfamily File\+Interface} to open a file. Now it\textquotesingle{}s easy to mock out the function.

This may seem like a lot of hassle, but in practice you often have multiple related functions that you can put in the same interface, so the per-\/function syntactic overhead will be much lower.

If you are concerned about the performance overhead incurred by virtual functions, and profiling confirms your concern, you can combine this with the recipe for \href{\#MockingNonVirtualMethods}{\texttt{ mocking non-\/virtual methods}}.\hypertarget{md__c_autotoc_md43}{}\doxysubsubsection{Old-\/\+Style $<$tt$>$\+M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+Dn$<$/tt$>$ Macros}\label{md__c_autotoc_md43}
Before the generic {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} macro was introduced, mocks where created using a family of macros collectively called {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+Dn}. These macros are still supported, though migration to the new {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} is recommended.

The macros in the {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+Dn} family differ from {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD}\+:


\begin{DoxyItemize}
\item The general structure is {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+Dn(\+Method\+Name, Return\+Type(\+Args))}, instead of {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D(\+Return\+Type, Method\+Name, (\+Args))}.
\item The number {\ttfamily n} must equal the number of arguments.
\item When mocking a const method, one must use {\ttfamily M\+O\+C\+K\+\_\+\+C\+O\+N\+S\+T\+\_\+\+M\+E\+T\+H\+O\+Dn}.
\item When mocking a class template, the macro name must be suffixed with {\ttfamily \+\_\+T}.
\item In order to specify the call type, the macro name must be suffixed with {\ttfamily \+\_\+\+W\+I\+T\+H\+\_\+\+C\+A\+L\+L\+T\+Y\+PE}, and the call type is the first macro argument.
\end{DoxyItemize}

Old macros and their new equivalents\+:

\label{_table99}%
 \tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Simple  }}\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Simple  }}\\\cline{1-2}
\endhead
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D1(\+Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D(bool, Foo, (int))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Const Method  }}\\\cline{1-2}
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+C\+O\+N\+S\+T\+\_\+\+M\+E\+T\+H\+O\+D1(\+Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD(bool, Foo, (int), (const))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Method in a Class Template  }}\\\cline{1-2}
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D1\+\_\+\+T(\+Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D(bool, Foo, (int))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Const Method in a Class Template  }}\\\cline{1-2}
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+C\+O\+N\+S\+T\+\_\+\+M\+E\+T\+H\+O\+D1\+\_\+\+T(\+Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD(bool, Foo, (int), (const))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Method with Call Type  }}\\\cline{1-2}
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D1\+\_\+\+W\+I\+T\+H\+\_\+\+C\+A\+L\+L\+T\+Y\+P\+E(\+S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+P\+E, Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD(bool, Foo, (int), (Calltype(\+S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+P\+E)))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Const Method with Call Type  }}\\\cline{1-2}
Old &{\ttfamily M\+O\+C\+K\+\_\+\+C\+O\+N\+S\+T\+\_\+\+M\+E\+T\+H\+O\+D1\+\_\+\+W\+I\+T\+H\+\_\+\+C\+A\+L\+L\+T\+Y\+P\+E(\+S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+P\+E, Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD(bool, Foo, (int), (const, Calltype(\+S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+P\+E)))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Method with Call Type in a Class Template  }}\\\cline{1-2}
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+O\+D1\+\_\+\+T\+\_\+\+W\+I\+T\+H\+\_\+\+C\+A\+L\+L\+T\+Y\+PE(S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+PE, Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD(bool, Foo, (int), (Calltype(\+S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+P\+E)))}  

\\\cline{1-2}
\multicolumn{2}{|l|}{\cellcolor{\tableheadbgcolor}\textbf{ Const Method with Call Type in a Class Template  }}\\\cline{1-2}
Old  &{\ttfamily M\+O\+C\+K\+\_\+\+C\+O\+N\+S\+T\+\_\+\+M\+E\+T\+H\+O\+D1\+\_\+\+T\+\_\+\+W\+I\+T\+H\+\_\+\+C\+A\+L\+L\+T\+Y\+PE(S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+PE, Foo, bool(int))}   \\\cline{1-2}
New  &{\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD(bool, Foo, (int), (const, Calltype(\+S\+T\+D\+M\+E\+T\+H\+O\+D\+C\+A\+L\+L\+T\+Y\+P\+E)))}  

\\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_NiceStrictNaggy}{}\doxysubsubsection{The Nice, the Strict, and the Naggy}\label{md__c_NiceStrictNaggy}
If a mock method has no {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} spec but is called, we say that it\textquotesingle{}s an \char`\"{}uninteresting call\char`\"{}, and the default action (which can be specified using {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()}) of the method will be taken. Currently, an uninteresting call will also by default cause g\+Mock to print a warning. (In the future, we might remove this warning by default.)

However, sometimes you may want to ignore these uninteresting calls, and sometimes you may want to treat them as errors. g\+Mock lets you make the decision on a per-\/mock-\/object basis.

Suppose your test uses a mock class {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{TEST(...) \{}
\DoxyCodeLine{  MockFoo mock\_foo;}
\DoxyCodeLine{  EXPECT\_CALL(mock\_foo, DoThis());}
\DoxyCodeLine{  ... code that uses mock\_foo ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


If a method of {\ttfamily mock\+\_\+foo} other than {\ttfamily Do\+This()} is called, you will get a warning. However, if you rewrite your test to use {\ttfamily Nice\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} instead, you can suppress the warning\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::NiceMock;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(...) \{}
\DoxyCodeLine{  NiceMock<MockFoo> mock\_foo;}
\DoxyCodeLine{  EXPECT\_CALL(mock\_foo, DoThis());}
\DoxyCodeLine{  ... code that uses mock\_foo ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


{\ttfamily Nice\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} is a subclass of {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}}, so it can be used wherever {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}} is accepted.

It also works if {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}}\textquotesingle{}s constructor takes some arguments, as {\ttfamily Nice\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} \char`\"{}inherits\char`\"{} {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}}\textquotesingle{}s constructors\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::NiceMock;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(...) \{}
\DoxyCodeLine{  NiceMock<MockFoo> mock\_foo(5, \textcolor{stringliteral}{"hi"});  \textcolor{comment}{// Calls MockFoo(5, "hi").}}
\DoxyCodeLine{  EXPECT\_CALL(mock\_foo, DoThis());}
\DoxyCodeLine{  ... code that uses mock\_foo ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


The usage of {\ttfamily Strict\+Mock} is similar, except that it makes all uninteresting calls failures\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::StrictMock;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(...) \{}
\DoxyCodeLine{  StrictMock<MockFoo> mock\_foo;}
\DoxyCodeLine{  EXPECT\_CALL(mock\_foo, DoThis());}
\DoxyCodeLine{  ... code that uses mock\_foo ...}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// The test will fail if a method of mock\_foo other than DoThis()}}
\DoxyCodeLine{  \textcolor{comment}{// is called.}}
\DoxyCodeLine{\}}
\end{DoxyCode}


N\+O\+TE\+: {\ttfamily Nice\+Mock} and {\ttfamily Strict\+Mock} only affects {\itshape uninteresting} calls (calls of {\itshape methods} with no expectations); they do not affect {\itshape unexpected} calls (calls of methods with expectations, but they don\textquotesingle{}t match). See \href{\#uninteresting-vs-unexpected}{\texttt{ Understanding Uninteresting vs Unexpected Calls}}.

There are some caveats though (I dislike them just as much as the next guy, but sadly they are side effects of C++\textquotesingle{}s limitations)\+:


\begin{DoxyEnumerate}
\item {\ttfamily Nice\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} and {\ttfamily Strict\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} only work for mock methods defined using the {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} macro {\bfseries{directly}} in the {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}} class. If a mock method is defined in a {\bfseries{base class}} of {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}}, the \char`\"{}nice\char`\"{} or \char`\"{}strict\char`\"{} modifier may not affect it, depending on the compiler. In particular, nesting {\ttfamily Nice\+Mock} and {\ttfamily Strict\+Mock} (e.\+g. {\ttfamily Nice\+Mock$<$Strict\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$ $>$}) is {\bfseries{not}} supported.
\item {\ttfamily Nice\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} and {\ttfamily Strict\+Mock$<$\mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}$>$} may not work correctly if the destructor of {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}} is not virtual. We would like to fix this, but it requires cleaning up existing tests. \href{http://b/28934720}{\texttt{ http\+://b/28934720}} tracks the issue.
\item During the constructor or destructor of {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}}, the mock object is {\itshape not} nice or strict. This may cause surprises if the constructor or destructor calls a mock method on {\ttfamily this} object. (This behavior, however, is consistent with C++\textquotesingle{}s general rule\+: if a constructor or destructor calls a virtual method of {\ttfamily this} object, that method is treated as non-\/virtual. In other words, to the base class\textquotesingle{}s constructor or destructor, {\ttfamily this} object behaves like an instance of the base class, not the derived class. This rule is required for safety. Otherwise a base constructor may use members of a derived class before they are initialized, or a base destructor may use members of a derived class after they have been destroyed.)
\end{DoxyEnumerate}

Finally, you should be {\bfseries{very cautious}} about when to use naggy or strict mocks, as they tend to make tests more brittle and harder to maintain. When you refactor your code without changing its externally visible behavior, ideally you shouldn\textquotesingle{}t need to update any tests. If your code interacts with a naggy mock, however, you may start to get spammed with warnings as the result of your change. Worse, if your code interacts with a strict mock, your tests may start to fail and you\textquotesingle{}ll be forced to fix them. Our general recommendation is to use nice mocks (not yet the default) most of the time, use naggy mocks (the current default) when developing or debugging tests, and use strict mocks only as the last resort.\hypertarget{md__c_SimplerInterfaces}{}\doxysubsubsection{Simplifying the Interface without Breaking Existing Code}\label{md__c_SimplerInterfaces}
Sometimes a method has a long list of arguments that is mostly uninteresting. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }LogSink \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} send(LogSeverity severity, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* full\_filename,}
\DoxyCodeLine{                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* base\_filename, \textcolor{keywordtype}{int} line,}
\DoxyCodeLine{                    \textcolor{keyword}{const} \textcolor{keyword}{struct} tm* tm\_time,}
\DoxyCodeLine{                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* message, \textcolor{keywordtype}{size\_t} message\_len) = 0;}
\DoxyCodeLine{\};}
\end{DoxyCode}


This method\textquotesingle{}s argument list is lengthy and hard to work with (the {\ttfamily message} argument is not even 0-\/terminated). If we mock it as is, using the mock will be awkward. If, however, we try to simplify this interface, we\textquotesingle{}ll need to fix all clients depending on it, which is often infeasible.

The trick is to redispatch the method in the mock class\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }ScopedMockLog : \textcolor{keyword}{public} LogSink \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} send(LogSeverity severity, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* full\_filename,}
\DoxyCodeLine{                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* base\_filename, \textcolor{keywordtype}{int} line, \textcolor{keyword}{const} tm* tm\_time,}
\DoxyCodeLine{                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* message, \textcolor{keywordtype}{size\_t} message\_len) \{}
\DoxyCodeLine{    \textcolor{comment}{// We are only interested in the log severity, full file name, and}}
\DoxyCodeLine{    \textcolor{comment}{// log message.}}
\DoxyCodeLine{    Log(severity, full\_filename, std::string(message, message\_len));}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Implements the mock method:}}
\DoxyCodeLine{  \textcolor{comment}{//}}
\DoxyCodeLine{  \textcolor{comment}{//   void Log(LogSeverity severity,}}
\DoxyCodeLine{  \textcolor{comment}{//            const string\& file\_path,}}
\DoxyCodeLine{  \textcolor{comment}{//            const string\& message);}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Log,}
\DoxyCodeLine{              (LogSeverity severity, \textcolor{keyword}{const} \textcolor{keywordtype}{string}\& file\_path,}
\DoxyCodeLine{               \textcolor{keyword}{const} \textcolor{keywordtype}{string}\& message));}
\DoxyCodeLine{\};}
\end{DoxyCode}


By defining a new mock method with a trimmed argument list, we make the mock class more user-\/friendly.

This technique may also be applied to make overloaded methods more amenable to mocking. For example, when overloads have been used to implement default arguments\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockTurtleFactory : \textcolor{keyword}{public} TurtleFactory \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  Turtle* MakeTurtle(\textcolor{keywordtype}{int} length, \textcolor{keywordtype}{int} weight)\textcolor{keyword}{ override }\{ ... \}}
\DoxyCodeLine{  Turtle* MakeTurtle(\textcolor{keywordtype}{int} length, \textcolor{keywordtype}{int} weight, \textcolor{keywordtype}{int} speed)\textcolor{keyword}{ override }\{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// the above methods delegate to this one:}}
\DoxyCodeLine{  MOCK\_METHOD(Turtle*, DoMakeTurtle, ());}
\DoxyCodeLine{\};}
\end{DoxyCode}


This allows tests that don\textquotesingle{}t care which overload was invoked to avoid specifying argument matchers\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ON\_CALL(factory, DoMakeTurtle)}
\DoxyCodeLine{    .WillByDefault(MakeMockTurtle());}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md44}{}\doxysubsubsection{Alternative to Mocking Concrete Classes}\label{md__c_autotoc_md44}
Often you may find yourself using classes that don\textquotesingle{}t implement interfaces. In order to test your code that uses such a class (let\textquotesingle{}s call it {\ttfamily Concrete}), you may be tempted to make the methods of {\ttfamily Concrete} virtual and then mock it.

Try not to do that.

Making a non-\/virtual function virtual is a big decision. It creates an extension point where subclasses can tweak your class\textquotesingle{} behavior. This weakens your control on the class because now it\textquotesingle{}s harder to maintain the class invariants. You should make a function virtual only when there is a valid reason for a subclass to override it.

Mocking concrete classes directly is problematic as it creates a tight coupling between the class and the tests -\/ any small change in the class may invalidate your tests and make test maintenance a pain.

To avoid such problems, many programmers have been practicing \char`\"{}coding to
interfaces\char`\"{}\+: instead of talking to the {\ttfamily Concrete} class, your code would define an interface and talk to it. Then you implement that interface as an adaptor on top of {\ttfamily Concrete}. In tests, you can easily mock that interface to observe how your code is doing.

This technique incurs some overhead\+:


\begin{DoxyItemize}
\item You pay the cost of virtual function calls (usually not a problem).
\item There is more abstraction for the programmers to learn.
\end{DoxyItemize}

However, it can also bring significant benefits in addition to better testability\+:


\begin{DoxyItemize}
\item {\ttfamily Concrete}\textquotesingle{}s A\+PI may not fit your problem domain very well, as you may not be the only client it tries to serve. By designing your own interface, you have a chance to tailor it to your need -\/ you may add higher-\/level functionalities, rename stuff, etc instead of just trimming the class. This allows you to write your code (user of the interface) in a more natural way, which means it will be more readable, more maintainable, and you\textquotesingle{}ll be more productive.
\item If {\ttfamily Concrete}\textquotesingle{}s implementation ever has to change, you don\textquotesingle{}t have to rewrite everywhere it is used. Instead, you can absorb the change in your implementation of the interface, and your other code and tests will be insulated from this change.
\end{DoxyItemize}

Some people worry that if everyone is practicing this technique, they will end up writing lots of redundant code. This concern is totally understandable. However, there are two reasons why it may not be the case\+:


\begin{DoxyItemize}
\item Different projects may need to use {\ttfamily Concrete} in different ways, so the best interfaces for them will be different. Therefore, each of them will have its own domain-\/specific interface on top of {\ttfamily Concrete}, and they will not be the same code.
\item If enough projects want to use the same interface, they can always share it, just like they have been sharing {\ttfamily Concrete}. You can check in the interface and the adaptor somewhere near {\ttfamily Concrete} (perhaps in a {\ttfamily contrib} sub-\/directory) and let many projects use it.
\end{DoxyItemize}

You need to weigh the pros and cons carefully for your particular problem, but I\textquotesingle{}d like to assure you that the Java community has been practicing this for a long time and it\textquotesingle{}s a proven effective technique applicable in a wide variety of situations. \+:-\/)\hypertarget{md__c_DelegatingToFake}{}\doxysubsubsection{Delegating Calls to a Fake}\label{md__c_DelegatingToFake}
Some times you have a non-\/trivial fake implementation of an interface. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~Foo() \{\}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{char} DoThis(\textcolor{keywordtype}{int} n) = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} DoThat(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* s, \textcolor{keywordtype}{int}* p) = 0;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }FakeFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{char} DoThis(\textcolor{keywordtype}{int} n)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} (n > 0) ? \textcolor{charliteral}{'+'} :}
\DoxyCodeLine{           (n < 0) ? \textcolor{charliteral}{'-\/'} : \textcolor{charliteral}{'0'};}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DoThat(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* s, \textcolor{keywordtype}{int}* p)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{    *p = strlen(s);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


Now you want to mock this interface such that you can set expectations on it. However, you also want to use {\ttfamily Fake\+Foo} for the default behavior, as duplicating it in the mock object is, well, a lot of work.

When you define the mock class using g\+Mock, you can have it delegate its default action to a fake class you already have, using this pattern\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{comment}{// Normal mock method definitions using gMock.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{char}, DoThis, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, DoThat, (\textcolor{keyword}{const} \textcolor{keywordtype}{char}* s, \textcolor{keywordtype}{int}* p), (\textcolor{keyword}{override}));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Delegates the default actions of the methods to a FakeFoo object.}}
\DoxyCodeLine{  \textcolor{comment}{// This must be called *before* the custom ON\_CALL() statements.}}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DelegateToFake() \{}
\DoxyCodeLine{    ON\_CALL(*\textcolor{keyword}{this}, DoThis).WillByDefault([\textcolor{keyword}{this}](\textcolor{keywordtype}{int} n) \{}
\DoxyCodeLine{      \textcolor{keywordflow}{return} fake\_.DoThis(n);}
\DoxyCodeLine{    \});}
\DoxyCodeLine{    ON\_CALL(*\textcolor{keyword}{this}, DoThat).WillByDefault([\textcolor{keyword}{this}](\textcolor{keyword}{const} \textcolor{keywordtype}{char}* s, \textcolor{keywordtype}{int}* p) \{}
\DoxyCodeLine{      fake\_.DoThat(s, p);}
\DoxyCodeLine{    \});}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{keyword}{private}:}
\DoxyCodeLine{  FakeFoo fake\_;  \textcolor{comment}{// Keeps an instance of the fake in the mock.}}
\DoxyCodeLine{\};}
\end{DoxyCode}


With that, you can use {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}} in your tests as usual. Just remember that if you don\textquotesingle{}t explicitly set an action in an {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} or {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}, the fake will be called upon to do it.\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(AbcTest, Xyz) \{}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{}
\DoxyCodeLine{  foo.DelegateToFake();  \textcolor{comment}{// Enables the fake for delegation.}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Put your ON\_CALL(foo, ...)s here, if any.}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// No action specified, meaning to use the default action.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(5));}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThat(\_, \_));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{int} n = 0;}
\DoxyCodeLine{  EXPECT\_EQ(\textcolor{charliteral}{'+'}, foo.DoThis(5));  \textcolor{comment}{// FakeFoo::DoThis() is invoked.}}
\DoxyCodeLine{  foo.DoThat(\textcolor{stringliteral}{"Hi"}, \&n);  \textcolor{comment}{// FakeFoo::DoThat() is invoked.}}
\DoxyCodeLine{  EXPECT\_EQ(2, n);}
\DoxyCodeLine{\}}
\end{DoxyCode}


{\bfseries{Some tips\+:}}


\begin{DoxyItemize}
\item If you want, you can still override the default action by providing your own {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} or using {\ttfamily .Will\+Once()} / {\ttfamily .Will\+Repeatedly()} in {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}.
\item In {\ttfamily Delegate\+To\+Fake()}, you only need to delegate the methods whose fake implementation you intend to use.
\item The general technique discussed here works for overloaded methods, but you\textquotesingle{}ll need to tell the compiler which version you mean. To disambiguate a mock function (the one you specify inside the parentheses of {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()}), use \href{\#SelectOverload}{\texttt{ this technique}}; to disambiguate a fake function (the one you place inside {\ttfamily Invoke()}), use a {\ttfamily static\+\_\+cast} to specify the function\textquotesingle{}s type. For instance, if class {\ttfamily Foo} has methods {\ttfamily char Do\+This(int n)} and {\ttfamily bool Do\+This(double x) const}, and you want to invoke the latter, you need to write {\ttfamily Invoke(\&fake\+\_\+, static\+\_\+cast$<$bool (Fake\+Foo\+:\+:$\ast$)(double) const$>$(\&Fake\+Foo\+::\+Do\+This))} instead of {\ttfamily Invoke(\&fake\+\_\+, \&\+Fake\+Foo\+::\+Do\+This)} (The strange-\/looking thing inside the angled brackets of {\ttfamily static\+\_\+cast} is the type of a function pointer to the second {\ttfamily Do\+This()} method.).
\item Having to mix a mock and a fake is often a sign of something gone wrong. Perhaps you haven\textquotesingle{}t got used to the interaction-\/based way of testing yet. Or perhaps your interface is taking on too many roles and should be split up. Therefore, {\bfseries{don\textquotesingle{}t abuse this}}. We would only recommend to do it as an intermediate step when you are refactoring your code.
\end{DoxyItemize}

Regarding the tip on mixing a mock and a fake, here\textquotesingle{}s an example on why it may be a bad sign\+: Suppose you have a class {\ttfamily System} for low-\/level system operations. In particular, it does file and I/O operations. And suppose you want to test how your code uses {\ttfamily System} to do I/O, and you just want the file operations to work normally. If you mock out the entire {\ttfamily System} class, you\textquotesingle{}ll have to provide a fake implementation for the file operation part, which suggests that {\ttfamily System} is taking on too many roles.

Instead, you can define a {\ttfamily File\+Ops} interface and an {\ttfamily I\+O\+Ops} interface and split {\ttfamily System}\textquotesingle{}s functionalities into the two. Then you can mock {\ttfamily I\+O\+Ops} without mocking {\ttfamily File\+Ops}.\hypertarget{md__c_autotoc_md45}{}\doxysubsubsection{Delegating Calls to a Real Object}\label{md__c_autotoc_md45}
When using testing doubles (mocks, fakes, stubs, and etc), sometimes their behaviors will differ from those of the real objects. This difference could be either intentional (as in simulating an error such that you can test the error handling code) or unintentional. If your mocks have different behaviors than the real objects by mistake, you could end up with code that passes the tests but fails in production.

You can use the {\itshape delegating-\/to-\/real} technique to ensure that your mock has the same behavior as the real object while retaining the ability to validate calls. This technique is very similar to the \href{\#DelegatingToFake}{\texttt{ delegating-\/to-\/fake}} technique, the difference being that we use a real object instead of a fake. Here\textquotesingle{}s an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::AtLeast;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MockFoo() \{}
\DoxyCodeLine{    \textcolor{comment}{// By default, all calls are delegated to the real object.}}
\DoxyCodeLine{    ON\_CALL(*\textcolor{keyword}{this}, DoThis).WillByDefault([\textcolor{keyword}{this}](\textcolor{keywordtype}{int} n) \{}
\DoxyCodeLine{      \textcolor{keywordflow}{return} real\_.DoThis(n);}
\DoxyCodeLine{    \});}
\DoxyCodeLine{    ON\_CALL(*\textcolor{keyword}{this}, DoThat).WillByDefault([\textcolor{keyword}{this}](\textcolor{keyword}{const} \textcolor{keywordtype}{char}* s, \textcolor{keywordtype}{int}* p) \{}
\DoxyCodeLine{      real\_.DoThat(s, p);}
\DoxyCodeLine{    \});}
\DoxyCodeLine{    ...}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{char}, DoThis, ...);}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, DoThat, ...);}
\DoxyCodeLine{  ...}
\DoxyCodeLine{ \textcolor{keyword}{private}:}
\DoxyCodeLine{  Foo real\_;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo mock;}
\DoxyCodeLine{  EXPECT\_CALL(mock, DoThis())}
\DoxyCodeLine{      .Times(3);}
\DoxyCodeLine{  EXPECT\_CALL(mock, DoThat(\textcolor{stringliteral}{"Hi"}))}
\DoxyCodeLine{      .Times(AtLeast(1));}
\DoxyCodeLine{  ... use mock in test ...}
\end{DoxyCode}


With this, g\+Mock will verify that your code made the right calls (with the right arguments, in the right order, called the right number of times, etc), and a real object will answer the calls (so the behavior will be the same as in production). This gives you the best of both worlds.\hypertarget{md__c_autotoc_md46}{}\doxysubsubsection{Delegating Calls to a Parent Class}\label{md__c_autotoc_md46}
Ideally, you should code to interfaces, whose methods are all pure virtual. In reality, sometimes you do need to mock a virtual method that is not pure (i.\+e, it already has an implementation). For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~Foo();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Pure(\textcolor{keywordtype}{int} n) = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{int} Concrete(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str) \{ ... \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{comment}{// Mocking a pure method.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Pure, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  \textcolor{comment}{// Mocking a concrete method.  Foo::Concrete() is shadowed.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, Concrete, (\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}


Sometimes you may want to call {\ttfamily Foo\+::\+Concrete()} instead of {\ttfamily Mock\+Foo\+::\+Concrete()}. Perhaps you want to do it as part of a stub action, or perhaps your test doesn\textquotesingle{}t need to mock {\ttfamily Concrete()} at all (but it would be oh-\/so painful to have to define a new mock class whenever you don\textquotesingle{}t need to mock one of its methods).

The trick is to leave a back door in your mock class for accessing the real methods in the base class\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{comment}{// Mocking a pure method.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Pure, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  \textcolor{comment}{// Mocking a concrete method.  Foo::Concrete() is shadowed.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, Concrete, (\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str), (\textcolor{keyword}{override}));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Use this to call Concrete() defined in Foo.}}
\DoxyCodeLine{  \textcolor{keywordtype}{int} FooConcrete(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str) \{ \textcolor{keywordflow}{return} Foo::Concrete(str); \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


Now, you can call {\ttfamily Foo\+::\+Concrete()} inside an action by\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Concrete).WillOnce([\&foo](\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str) \{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} foo.FooConcrete(str);}
\DoxyCodeLine{  \});}
\end{DoxyCode}


or tell the mock object that you don\textquotesingle{}t want to mock {\ttfamily Concrete()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{...}
\DoxyCodeLine{  ON\_CALL(foo, Concrete).WillByDefault([\&foo](\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str) \{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} foo.FooConcrete(str);}
\DoxyCodeLine{  \});}
\end{DoxyCode}


(Why don\textquotesingle{}t we just write {\ttfamily \{ return foo.\+Concrete(str); \}}? If you do that, {\ttfamily Mock\+Foo\+::\+Concrete()} will be called (and cause an infinite recursion) since {\ttfamily Foo\+::\+Concrete()} is virtual. That\textquotesingle{}s just how C++ works.)\hypertarget{md__c_autotoc_md47}{}\doxysubsection{Using Matchers}\label{md__c_autotoc_md47}
\hypertarget{md__c_autotoc_md48}{}\doxysubsubsection{Matching Argument Values Exactly}\label{md__c_autotoc_md48}
You can specify exactly which arguments a mock method is expecting\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(5))}
\DoxyCodeLine{      .WillOnce(Return(\textcolor{charliteral}{'a'}));}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThat(\textcolor{stringliteral}{"Hello"}, bar));}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md49}{}\doxysubsubsection{Using Simple Matchers}\label{md__c_autotoc_md49}
You can use matchers to match arguments that have a certain property\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::NotNull;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(Ge(5)))  \textcolor{comment}{// The argument must be >= 5.}}
\DoxyCodeLine{      .WillOnce(Return(\textcolor{charliteral}{'a'}));}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThat(\textcolor{stringliteral}{"Hello"}, NotNull()));}
\DoxyCodeLine{      \textcolor{comment}{// The second argument must not be NULL.}}
\end{DoxyCode}


A frequently used matcher is {\ttfamily \+\_\+}, which matches anything\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(foo, DoThat(\_, NotNull()));}
\end{DoxyCode}
\hypertarget{md__c_CombiningMatchers}{}\doxysubsubsection{Combining Matchers}\label{md__c_CombiningMatchers}
You can build complex matchers from existing ones using {\ttfamily All\+Of()}, {\ttfamily All\+Of\+Array()}, {\ttfamily Any\+Of()}, {\ttfamily Any\+Of\+Array()} and {\ttfamily Not()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::AllOf;}
\DoxyCodeLine{using ::testing::Gt;}
\DoxyCodeLine{using ::testing::HasSubstr;}
\DoxyCodeLine{using ::testing::Ne;}
\DoxyCodeLine{using ::testing::Not;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{comment}{// The argument must be > 5 and != 10.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(AllOf(Gt(5),}
\DoxyCodeLine{                                Ne(10))));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// The first argument must not contain sub-\/string "blah".}}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThat(Not(HasSubstr(\textcolor{stringliteral}{"blah"})),}
\DoxyCodeLine{                          NULL));}
\end{DoxyCode}
\hypertarget{md__c_SafeMatcherCast}{}\doxysubsubsection{Casting Matchers}\label{md__c_SafeMatcherCast}
g\+Mock matchers are statically typed, meaning that the compiler can catch your mistake if you use a matcher of the wrong type (for example, if you use {\ttfamily Eq(5)} to match a {\ttfamily string} argument). Good for you!

Sometimes, however, you know what you\textquotesingle{}re doing and want the compiler to give you some slack. One example is that you have a matcher for {\ttfamily long} and the argument you want to match is {\ttfamily int}. While the two types aren\textquotesingle{}t exactly the same, there is nothing really wrong with using a {\ttfamily Matcher$<$long$>$} to match an {\ttfamily int} -\/ after all, we can first convert the {\ttfamily int} argument to a {\ttfamily long} losslessly before giving it to the matcher.

To support this need, g\+Mock gives you the {\ttfamily Safe\+Matcher\+Cast$<$T$>$(m)} function. It casts a matcher {\ttfamily m} to type {\ttfamily Matcher$<$T$>$}. To ensure safety, g\+Mock checks that (let {\ttfamily U} be the type {\ttfamily m} accepts \+:


\begin{DoxyEnumerate}
\item Type {\ttfamily T} can be {\itshape implicitly} cast to type {\ttfamily U};
\item When both {\ttfamily T} and {\ttfamily U} are built-\/in arithmetic types ({\ttfamily bool}, integers, and floating-\/point numbers), the conversion from {\ttfamily T} to {\ttfamily U} is not lossy (in other words, any value representable by {\ttfamily T} can also be represented by {\ttfamily U}); and
\item When {\ttfamily U} is a reference, {\ttfamily T} must also be a reference (as the underlying matcher may be interested in the address of the {\ttfamily U} value).
\end{DoxyEnumerate}

The code won\textquotesingle{}t compile if any of these conditions isn\textquotesingle{}t met.

Here\textquotesingle{}s one example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::SafeMatcherCast;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// A base class and a child class.}}
\DoxyCodeLine{\textcolor{keyword}{class }Base \{ ... \};}
\DoxyCodeLine{\textcolor{keyword}{class }Derived : \textcolor{keyword}{public} Base \{ ... \};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, DoThis, (Derived* derived), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  \textcolor{comment}{// m is a Matcher<Base*> we got from somewhere.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(SafeMatcherCast<Derived*>(m)));}
\end{DoxyCode}


If you find {\ttfamily Safe\+Matcher\+Cast$<$T$>$(m)} too limiting, you can use a similar function {\ttfamily Matcher\+Cast$<$T$>$(m)}. The difference is that {\ttfamily Matcher\+Cast} works as long as you can {\ttfamily static\+\_\+cast} type {\ttfamily T} to type {\ttfamily U}.

{\ttfamily Matcher\+Cast} essentially lets you bypass C++\textquotesingle{}s type system ({\ttfamily static\+\_\+cast} isn\textquotesingle{}t always safe as it could throw away information, for example), so be careful not to misuse/abuse it.\hypertarget{md__c_SelectOverload}{}\doxysubsubsection{Selecting Between Overloaded Functions}\label{md__c_SelectOverload}
If you expect an overloaded function to be called, the compiler may need some help on which overloaded version it is.

To disambiguate functions overloaded on the const-\/ness of this object, use the {\ttfamily Const()} argument wrapper.


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ReturnRef;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(Bar\&, GetBar, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keyword}{const} Bar\&, GetBar, (), (\textcolor{keyword}{const}, \textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  Bar bar1, bar2;}
\DoxyCodeLine{  EXPECT\_CALL(foo, GetBar())         \textcolor{comment}{// The non-\/const GetBar().}}
\DoxyCodeLine{      .WillOnce(ReturnRef(bar1));}
\DoxyCodeLine{  EXPECT\_CALL(Const(foo), GetBar())  \textcolor{comment}{// The const GetBar().}}
\DoxyCodeLine{      .WillOnce(ReturnRef(bar2));}
\end{DoxyCode}


({\ttfamily Const()} is defined by g\+Mock and returns a {\ttfamily const} reference to its argument.)

To disambiguate overloaded functions with the same number of arguments but different argument types, you may need to specify the exact type of a matcher, either by wrapping your matcher in {\ttfamily Matcher$<$type$>$()}, or using a matcher whose type is fixed ({\ttfamily Typed\+Eq$<$type$>$}, {\ttfamily An$<$type$>$()}, etc)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::An;}
\DoxyCodeLine{using ::testing::Matcher;}
\DoxyCodeLine{using ::testing::TypedEq;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockPrinter : \textcolor{keyword}{public} Printer \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Print, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Print, (\textcolor{keywordtype}{char} c), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(PrinterTest, Print) \{}
\DoxyCodeLine{  MockPrinter printer;}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(printer, Print(An<int>()));            \textcolor{comment}{// void Print(int);}}
\DoxyCodeLine{  EXPECT\_CALL(printer, Print(Matcher<int>(Lt(5))));  \textcolor{comment}{// void Print(int);}}
\DoxyCodeLine{  EXPECT\_CALL(printer, Print(TypedEq<char>(\textcolor{charliteral}{'a'})));   \textcolor{comment}{// void Print(char);}}
\DoxyCodeLine{}
\DoxyCodeLine{  printer.Print(3);}
\DoxyCodeLine{  printer.Print(6);}
\DoxyCodeLine{  printer.Print(\textcolor{charliteral}{'a'});}
\DoxyCodeLine{\}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md50}{}\doxysubsubsection{Performing Different Actions Based on the Arguments}\label{md__c_autotoc_md50}
When a mock method is called, the {\itshape last} matching expectation that\textquotesingle{}s still active will be selected (think \char`\"{}newer overrides older\char`\"{}). So, you can make a method do different things depending on its argument values like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Lt;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{comment}{// The default case.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(\_))}
\DoxyCodeLine{      .WillRepeatedly(Return(\textcolor{charliteral}{'b'}));}
\DoxyCodeLine{  \textcolor{comment}{// The more specific case.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(Lt(5)))}
\DoxyCodeLine{      .WillRepeatedly(Return(\textcolor{charliteral}{'a'}));}
\end{DoxyCode}


Now, if {\ttfamily foo.\+Do\+This()} is called with a value less than 5, `\textquotesingle{}a'{\ttfamily will be returned; otherwise}\textquotesingle{}b\textquotesingle{}\`{} will be returned.\hypertarget{md__c_autotoc_md51}{}\doxysubsubsection{Matching Multiple Arguments as a Whole}\label{md__c_autotoc_md51}
Sometimes it\textquotesingle{}s not enough to match the arguments individually. For example, we may want to say that the first argument must be less than the second argument. The {\ttfamily With()} clause allows us to match all arguments of a mock function as a whole. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Ne;}
\DoxyCodeLine{using ::testing::Lt;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, InRange(Ne(0), \_))}
\DoxyCodeLine{      .With(Lt());}
\end{DoxyCode}


says that the first argument of {\ttfamily In\+Range()} must not be 0, and must be less than the second argument.

The expression inside {\ttfamily With()} must be a matcher of type {\ttfamily Matcher$<$ \+::std\+::tuple$<$A1, ..., An$>$ $>$}, where {\ttfamily A1}, ..., {\ttfamily An} are the types of the function arguments.

You can also write {\ttfamily All\+Args(m)} instead of {\ttfamily m} inside {\ttfamily .With()}. The two forms are equivalent, but {\ttfamily .With(All\+Args(\+Lt()))} is more readable than {\ttfamily .With(\+Lt())}.

You can use {\ttfamily Args$<$k1, ..., kn$>$(m)} to match the {\ttfamily n} selected arguments (as a tuple) against {\ttfamily m}. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::AllOf;}
\DoxyCodeLine{using ::testing::Args;}
\DoxyCodeLine{using ::testing::Lt;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Blah)}
\DoxyCodeLine{      .With(AllOf(Args<0, 1>(Lt()), Args<1, 2>(Lt())));}
\end{DoxyCode}


says that {\ttfamily Blah} will be called with arguments {\ttfamily x}, {\ttfamily y}, and {\ttfamily z} where {\ttfamily x $<$ y $<$ z}. Note that in this example, it wasn\textquotesingle{}t necessary specify the positional matchers.

As a convenience and example, g\+Mock provides some matchers for 2-\/tuples, including the {\ttfamily Lt()} matcher above. See \href{\#MultiArgMatchers}{\texttt{ here}} for the complete list.

Note that if you want to pass the arguments to a predicate of your own (e.\+g. {\ttfamily .With(Args$<$0, 1$>$(Truly(\&\+My\+Predicate)))}), that predicate M\+U\+ST be written to take a {\ttfamily \+::std\+::tuple} as its argument; g\+Mock will pass the {\ttfamily n} selected arguments as {\itshape one} single tuple to the predicate.\hypertarget{md__c_autotoc_md52}{}\doxysubsubsection{Using Matchers as Predicates}\label{md__c_autotoc_md52}
Have you noticed that a matcher is just a fancy predicate that also knows how to describe itself? Many existing algorithms take predicates as arguments (e.\+g. those defined in S\+TL\textquotesingle{}s {\ttfamily $<$algorithm$>$} header), and it would be a shame if g\+Mock matchers were not allowed to participate.

Luckily, you can use a matcher where a unary predicate functor is expected by wrapping it inside the {\ttfamily Matches()} function. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{}
\DoxyCodeLine{using ::testing::Matches;}
\DoxyCodeLine{using ::testing::Ge;}
\DoxyCodeLine{}
\DoxyCodeLine{vector<int> v;}
\DoxyCodeLine{...}
\DoxyCodeLine{\textcolor{comment}{// How many elements in v are >= 10?}}
\DoxyCodeLine{const \textcolor{keywordtype}{int} count = count\_if(v.begin(), v.end(), Matches(Ge(10)));}
\end{DoxyCode}


Since you can build complex matchers from simpler ones easily using g\+Mock, this gives you a way to conveniently construct composite predicates (doing the same using S\+TL\textquotesingle{}s {\ttfamily $<$functional$>$} header is just painful). For example, here\textquotesingle{}s a predicate that\textquotesingle{}s satisfied by any number that is $>$= 0, $<$= 100, and != 50\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using} testing::AllOf;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Ge;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Le;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Matches;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Ne;}
\DoxyCodeLine{...}
\DoxyCodeLine{Matches(AllOf(Ge(0), Le(100), Ne(50)))}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md53}{}\doxysubsubsection{Using Matchers in googletest Assertions}\label{md__c_autotoc_md53}
Since matchers are basically predicates that also know how to describe themselves, there is a way to take advantage of them in googletest assertions. It\textquotesingle{}s called {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+H\+AT} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+AT}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ASSERT\_THAT(value, matcher);  \textcolor{comment}{// Asserts that value matches matcher.}}
\DoxyCodeLine{EXPECT\_THAT(value, matcher);  \textcolor{comment}{// The non-\/fatal version.}}
\end{DoxyCode}


For example, in a googletest test you can write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "gmock/gmock.h"}}
\DoxyCodeLine{}
\DoxyCodeLine{using ::testing::AllOf;}
\DoxyCodeLine{using ::testing::Ge;}
\DoxyCodeLine{using ::testing::Le;}
\DoxyCodeLine{using ::testing::MatchesRegex;}
\DoxyCodeLine{using ::testing::StartsWith;}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_THAT(Foo(), StartsWith(\textcolor{stringliteral}{"Hello"}));}
\DoxyCodeLine{  EXPECT\_THAT(Bar(), MatchesRegex(\textcolor{stringliteral}{"Line \(\backslash\)\(\backslash\)d+"}));}
\DoxyCodeLine{  ASSERT\_THAT(Baz(), AllOf(Ge(5), Le(10)));}
\end{DoxyCode}


which (as you can probably guess) executes {\ttfamily Foo()}, {\ttfamily Bar()}, and {\ttfamily Baz()}, and verifies that\+:


\begin{DoxyItemize}
\item {\ttfamily Foo()} returns a string that starts with {\ttfamily \char`\"{}\+Hello\char`\"{}}.
\item {\ttfamily Bar()} returns a string that matches regular expression {\ttfamily \char`\"{}\+Line \textbackslash{}\textbackslash{}d+\char`\"{}}.
\item {\ttfamily Baz()} returns a number in the range \mbox{[}5, 10\mbox{]}.
\end{DoxyItemize}

The nice thing about these macros is that {\itshape they read like English}. They generate informative messages too. For example, if the first {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T()} above fails, the message will be something like\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: Foo()}
\DoxyCodeLine{  Actual: "Hi, world!"}
\DoxyCodeLine{Expected: starts with "Hello"}
\end{DoxyCode}


{\bfseries{Credit\+:}} The idea of {\ttfamily (A\+S\+S\+E\+R\+T$\vert$\+E\+X\+P\+E\+CT)\+\_\+\+T\+H\+AT} was borrowed from Joe Walnes\textquotesingle{} Hamcrest project, which adds {\ttfamily assert\+That()} to J\+Unit.\hypertarget{md__c_autotoc_md54}{}\doxysubsubsection{Using Predicates as Matchers}\label{md__c_autotoc_md54}
g\+Mock provides a \href{\#MatcherList}{\texttt{ built-\/in set}} of matchers. In case you find them lacking, you can use an arbitrary unary predicate function or functor as a matcher -\/ as long as the predicate accepts a value of the type you want. You do this by wrapping the predicate inside the {\ttfamily Truly()} function, for example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Truly;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int} IsEven(\textcolor{keywordtype}{int} n) \{ \textcolor{keywordflow}{return} (n \% 2) == 0 ? 1 : 0; \}}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{comment}{// Bar() must be called with an even number.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(Truly(IsEven)));}
\end{DoxyCode}


Note that the predicate function / functor doesn\textquotesingle{}t have to return {\ttfamily bool}. It works as long as the return value can be used as the condition in in statement {\ttfamily if (condition) ...}.\hypertarget{md__c_autotoc_md55}{}\doxysubsubsection{Matching Arguments that Are Not Copyable}\label{md__c_autotoc_md55}
When you do an {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L(mock\+\_\+obj, Foo(bar))}, g\+Mock saves away a copy of {\ttfamily bar}. When {\ttfamily Foo()} is called later, g\+Mock compares the argument to {\ttfamily Foo()} with the saved copy of {\ttfamily bar}. This way, you don\textquotesingle{}t need to worry about {\ttfamily bar} being modified or destroyed after the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} is executed. The same is true when you use matchers like {\ttfamily Eq(bar)}, {\ttfamily Le(bar)}, and so on.

But what if {\ttfamily bar} cannot be copied (i.\+e. has no copy constructor)? You could define your own matcher function or callback and use it with {\ttfamily Truly()}, as the previous couple of recipes have shown. Or, you may be able to get away from it if you can guarantee that {\ttfamily bar} won\textquotesingle{}t be changed after the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} is executed. Just tell g\+Mock that it should save a reference to {\ttfamily bar}, instead of a copy of it. Here\textquotesingle{}s how\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ByRef;}
\DoxyCodeLine{using ::testing::Eq;}
\DoxyCodeLine{using ::testing::Lt;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{comment}{// Expects that Foo()'s argument == bar.}}
\DoxyCodeLine{  EXPECT\_CALL(mock\_obj, Foo(Eq(ByRef(bar))));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Expects that Foo()'s argument < bar.}}
\DoxyCodeLine{  EXPECT\_CALL(mock\_obj, Foo(Lt(ByRef(bar))));}
\end{DoxyCode}


Remember\+: if you do this, don\textquotesingle{}t change {\ttfamily bar} after the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}, or the result is undefined.\hypertarget{md__c_autotoc_md56}{}\doxysubsubsection{Validating a Member of an Object}\label{md__c_autotoc_md56}
Often a mock function takes a reference to object as an argument. When matching the argument, you may not want to compare the entire object against a fixed object, as that may be over-\/specification. Instead, you may need to validate a certain member variable or the result of a certain getter method of the object. You can do this with {\ttfamily Field()} and {\ttfamily Property()}. More specifically,


\begin{DoxyCode}{0}
\DoxyCodeLine{Field(\&Foo::bar, m)}
\end{DoxyCode}


is a matcher that matches a {\ttfamily Foo} object whose {\ttfamily bar} member variable satisfies matcher {\ttfamily m}.


\begin{DoxyCode}{0}
\DoxyCodeLine{Property(\&Foo::baz, m)}
\end{DoxyCode}


is a matcher that matches a {\ttfamily Foo} object whose {\ttfamily baz()} method returns a value that satisfies matcher {\ttfamily m}.

For example\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Expression  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Expression  }&\cellcolor{\tableheadbgcolor}\textbf{ Description   }\\\cline{1-2}
\endhead
{\ttfamily Field(\&\+Foo\+::number, Ge(3))}  &Matches {\ttfamily x} where {\ttfamily x.\+number $>$= 3}.   \\\cline{1-2}
{\ttfamily Property(\&Foo\+::name, Starts\+With(\char`\"{}\+John \char`\"{}))}  &Matches {\ttfamily x} where {\ttfamily x.\+name()} starts with {\ttfamily \char`\"{}\+John \char`\"{}}.   \\\cline{1-2}
\end{longtabu}


Note that in {\ttfamily Property(\&\+Foo\+::baz, ...)}, method {\ttfamily baz()} must take no argument and be declared as {\ttfamily const}.

B\+TW, {\ttfamily Field()} and {\ttfamily Property()} can also match plain pointers to objects. For instance,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Field;}
\DoxyCodeLine{using ::testing::Ge;}
\DoxyCodeLine{...}
\DoxyCodeLine{Field(\&Foo::number, Ge(3))}
\end{DoxyCode}


matches a plain pointer {\ttfamily p} where {\ttfamily p-\/$>$number $>$= 3}. If {\ttfamily p} is {\ttfamily N\+U\+LL}, the match will always fail regardless of the inner matcher.

What if you want to validate more than one members at the same time? Remember that there are \href{\#CombiningMatchers}{\texttt{ {\ttfamily All\+Of()} and {\ttfamily All\+Of\+Array()}}}.

Finally {\ttfamily Field()} and {\ttfamily Property()} provide overloads that take the field or property names as the first argument to include it in the error message. This can be useful when creating combined matchers.


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::AllOf;}
\DoxyCodeLine{using ::testing::Field;}
\DoxyCodeLine{using ::testing::Matcher;}
\DoxyCodeLine{using ::testing::SafeMatcherCast;}
\DoxyCodeLine{}
\DoxyCodeLine{Matcher<Foo> IsFoo(\textcolor{keyword}{const} Foo\& foo) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} AllOf(Field(\textcolor{stringliteral}{"some\_field"}, \&Foo::some\_field, foo.some\_field),}
\DoxyCodeLine{               Field(\textcolor{stringliteral}{"other\_field"}, \&Foo::other\_field, foo.other\_field),}
\DoxyCodeLine{               Field(\textcolor{stringliteral}{"last\_field"}, \&Foo::last\_field, foo.last\_field));}
\DoxyCodeLine{\}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md57}{}\doxysubsubsection{Validating the Value Pointed to by a Pointer Argument}\label{md__c_autotoc_md57}
C++ functions often take pointers as arguments. You can use matchers like {\ttfamily Is\+Null()}, {\ttfamily Not\+Null()}, and other comparison matchers to match a pointer, but what if you want to make sure the value {\itshape pointed to} by the pointer, instead of the pointer itself, has a certain property? Well, you can use the {\ttfamily Pointee(m)} matcher.

{\ttfamily Pointee(m)} matches a pointer if {\ttfamily m} matches the value the pointer points to. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Ge;}
\DoxyCodeLine{using ::testing::Pointee;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(Pointee(Ge(3))));}
\end{DoxyCode}


expects {\ttfamily foo.\+Bar()} to be called with a pointer that points to a value greater than or equal to 3.

One nice thing about {\ttfamily Pointee()} is that it treats a {\ttfamily N\+U\+LL} pointer as a match failure, so you can write {\ttfamily Pointee(m)} instead of


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::AllOf;}
\DoxyCodeLine{using ::testing::NotNull;}
\DoxyCodeLine{using ::testing::Pointee;}
\DoxyCodeLine{...}
\DoxyCodeLine{  AllOf(NotNull(), Pointee(m))}
\end{DoxyCode}


without worrying that a {\ttfamily N\+U\+LL} pointer will crash your test.

Also, did we tell you that {\ttfamily Pointee()} works with both raw pointers {\bfseries{and}} smart pointers ({\ttfamily std\+::unique\+\_\+ptr}, {\ttfamily std\+::shared\+\_\+ptr}, etc)?

What if you have a pointer to pointer? You guessed it -\/ you can use nested {\ttfamily Pointee()} to probe deeper inside the value. For example, {\ttfamily Pointee(Pointee(\+Lt(3)))} matches a pointer that points to a pointer that points to a number less than 3 (what a mouthful...).\hypertarget{md__c_autotoc_md58}{}\doxysubsubsection{Testing a Certain Property of an Object}\label{md__c_autotoc_md58}
Sometimes you want to specify that an object argument has a certain property, but there is no existing matcher that does this. If you want good error messages, you should \href{\#NewMatchers}{\texttt{ define a matcher}}. If you want to do it quick and dirty, you could get away with writing an ordinary function.

Let\textquotesingle{}s say you have a mock function that takes an object of type {\ttfamily Foo}, which has an {\ttfamily int bar()} method and an {\ttfamily int baz()} method, and you want to constrain that the argument\textquotesingle{}s {\ttfamily bar()} value plus its {\ttfamily baz()} value is a given number. Here\textquotesingle{}s how you can define a matcher to do it\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Matcher;}
\DoxyCodeLine{using ::testing::MatcherInterface;}
\DoxyCodeLine{using ::testing::MatchResultListener;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }BarPlusBazEqMatcher : \textcolor{keyword}{public} MatcherInterface<const Foo\&> \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{explicit} BarPlusBazEqMatcher(\textcolor{keywordtype}{int} expected\_sum)}
\DoxyCodeLine{      : expected\_sum\_(expected\_sum) \{\}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} MatchAndExplain(\textcolor{keyword}{const} Foo\& foo,}
\DoxyCodeLine{                       MatchResultListener* \textcolor{comment}{/* listener */})\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} (foo.bar() + foo.baz()) == expected\_sum\_;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeTo(::std::ostream* os)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    *os << \textcolor{stringliteral}{"bar() + baz() equals "} << expected\_sum\_;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeNegationTo(::std::ostream* os)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    *os << \textcolor{stringliteral}{"bar() + baz() does not equal "} << expected\_sum\_;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ \textcolor{keyword}{private}:}
\DoxyCodeLine{  \textcolor{keyword}{const} \textcolor{keywordtype}{int} expected\_sum\_;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{Matcher<const Foo\&> BarPlusBazEq(\textcolor{keywordtype}{int} expected\_sum) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} MakeMatcher(\textcolor{keyword}{new} BarPlusBazEqMatcher(expected\_sum));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(..., DoThis(BarPlusBazEq(5)))...;}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md59}{}\doxysubsubsection{Matching Containers}\label{md__c_autotoc_md59}
Sometimes an S\+TL container (e.\+g. list, vector, map, ...) is passed to a mock function and you may want to validate it. Since most S\+TL containers support the {\ttfamily ==} operator, you can write {\ttfamily Eq(expected\+\_\+container)} or simply {\ttfamily expected\+\_\+container} to match a container exactly.

Sometimes, though, you may want to be more flexible (for example, the first element must be an exact match, but the second element can be any positive number, and so on). Also, containers used in tests often have a small number of elements, and having to define the expected container out-\/of-\/line is a bit of a hassle.

You can use the {\ttfamily Elements\+Are()} or {\ttfamily Unordered\+Elements\+Are()} matcher in such cases\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::ElementsAre;}
\DoxyCodeLine{using ::testing::Gt;}
\DoxyCodeLine{...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Foo, (\textcolor{keyword}{const} vector<int>\& numbers), (\textcolor{keyword}{override}));}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(ElementsAre(1, Gt(0), \_, 5)));}
\end{DoxyCode}


The above matcher says that the container must have 4 elements, which must be 1, greater than 0, anything, and 5 respectively.

If you instead write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Gt;}
\DoxyCodeLine{using ::testing::UnorderedElementsAre;}
\DoxyCodeLine{...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Foo, (\textcolor{keyword}{const} vector<int>\& numbers), (\textcolor{keyword}{override}));}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(UnorderedElementsAre(1, Gt(0), \_, 5)));}
\end{DoxyCode}


It means that the container must have 4 elements, which (under some permutation) must be 1, greater than 0, anything, and 5 respectively.

As an alternative you can place the arguments in a C-\/style array and use {\ttfamily Elements\+Are\+Array()} or {\ttfamily Unordered\+Elements\+Are\+Array()} instead\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ElementsAreArray;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{comment}{// ElementsAreArray accepts an array of element values.}}
\DoxyCodeLine{  \textcolor{keyword}{const} \textcolor{keywordtype}{int} expected\_vector1[] = \{1, 5, 2, 4, ...\};}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(ElementsAreArray(expected\_vector1)));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Or, an array of element matchers.}}
\DoxyCodeLine{  Matcher<int> expected\_vector2[] = \{1, Gt(2), \_, 3, ...\};}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(ElementsAreArray(expected\_vector2)));}
\end{DoxyCode}


In case the array needs to be dynamically created (and therefore the array size cannot be inferred by the compiler), you can give {\ttfamily Elements\+Are\+Array()} an additional argument to specify the array size\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ElementsAreArray;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{keywordtype}{int}* \textcolor{keyword}{const} expected\_vector3 = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[count];}
\DoxyCodeLine{  ... fill expected\_vector3 with values ...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(ElementsAreArray(expected\_vector3, count)));}
\end{DoxyCode}


Use {\ttfamily Pair} when comparing maps or other associative containers.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using} testing::ElementsAre;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Pair;}
\DoxyCodeLine{...}
\DoxyCodeLine{  std::map<string, int> m = \{\{\textcolor{stringliteral}{"a"}, 1\}, \{\textcolor{stringliteral}{"b"}, 2\}, \{\textcolor{stringliteral}{"c"}, 3\}\};}
\DoxyCodeLine{  EXPECT\_THAT(m, ElementsAre(Pair(\textcolor{stringliteral}{"a"}, 1), Pair(\textcolor{stringliteral}{"b"}, 2), Pair(\textcolor{stringliteral}{"c"}, 3)));}
\end{DoxyCode}


{\bfseries{Tips\+:}}


\begin{DoxyItemize}
\item {\ttfamily Elements\+Are$\ast$()} can be used to match {\itshape any} container that implements the S\+TL iterator pattern (i.\+e. it has a {\ttfamily const\+\_\+iterator} type and supports {\ttfamily begin()/end()}), not just the ones defined in S\+TL. It will even work with container types yet to be written -\/ as long as they follows the above pattern.
\item You can use nested {\ttfamily Elements\+Are$\ast$()} to match nested (multi-\/dimensional) containers.
\item If the container is passed by pointer instead of by reference, just write {\ttfamily Pointee(\+Elements\+Are$\ast$(...))}.
\item The order of elements {\itshape matters} for {\ttfamily Elements\+Are$\ast$()}. If you are using it with containers whose element order are undefined (e.\+g. {\ttfamily hash\+\_\+map}) you should use {\ttfamily When\+Sorted} around {\ttfamily Elements\+Are}.
\end{DoxyItemize}\hypertarget{md__c_autotoc_md60}{}\doxysubsubsection{Sharing Matchers}\label{md__c_autotoc_md60}
Under the hood, a g\+Mock matcher object consists of a pointer to a ref-\/counted implementation object. Copying matchers is allowed and very efficient, as only the pointer is copied. When the last matcher that references the implementation object dies, the implementation object will be deleted.

Therefore, if you have some complex matcher that you want to use again and again, there is no need to build it everytime. Just assign it to a matcher variable and use that variable repeatedly! For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::AllOf;}
\DoxyCodeLine{using ::testing::Gt;}
\DoxyCodeLine{using ::testing::Le;}
\DoxyCodeLine{using ::testing::Matcher;}
\DoxyCodeLine{...}
\DoxyCodeLine{  Matcher<int> in\_range = AllOf(Gt(5), Le(10));}
\DoxyCodeLine{  ... use in\_range as a matcher in multiple EXPECT\_CALLs ...}
\end{DoxyCode}
\hypertarget{md__c_PureMatchers}{}\doxysubsubsection{Matchers must have no side-\/effects}\label{md__c_PureMatchers}
W\+A\+R\+N\+I\+NG\+: g\+Mock does not guarantee when or how many times a matcher will be invoked. Therefore, all matchers must be {\itshape purely functional}\+: they cannot have any side effects, and the match result must not depend on anything other than the matcher\textquotesingle{}s parameters and the value being matched.

This requirement must be satisfied no matter how a matcher is defined (e.\+g., if it is one of the standard matchers, or a custom matcher). In particular, a matcher can never call a mock function, as that will affect the state of the mock object and g\+Mock.\hypertarget{md__c_autotoc_md61}{}\doxysubsection{Setting Expectations}\label{md__c_autotoc_md61}
\hypertarget{md__c_UseOnCall}{}\doxysubsubsection{Knowing When to Expect}\label{md__c_UseOnCall}
$\ast$$\ast${\ttfamily O\+N\+\_\+\+C\+A\+LL}$\ast$$\ast$ is likely the {\itshape single most under-\/utilized construct} in g\+Mock.

There are basically two constructs for defining the behavior of a mock object\+: {\ttfamily O\+N\+\_\+\+C\+A\+LL} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}. The difference? {\ttfamily O\+N\+\_\+\+C\+A\+LL} defines what happens when a mock method is called, but {\itshape doesn\textquotesingle{}t imply any expectation on the method being called}. {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} not only defines the behavior, but also sets an expectation that {\itshape the method will be called with the given arguments, for the given number of times} (and {\itshape in the given order} when you specify the order too).

Since {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} does more, isn\textquotesingle{}t it better than {\ttfamily O\+N\+\_\+\+C\+A\+LL}? Not really. Every {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} adds a constraint on the behavior of the code under test. Having more constraints than necessary is {\itshape baaad} -\/ even worse than not having enough constraints.

This may be counter-\/intuitive. How could tests that verify more be worse than tests that verify less? Isn\textquotesingle{}t verification the whole point of tests?

The answer lies in {\itshape what} a test should verify. {\bfseries{A good test verifies the contract of the code.}} If a test over-\/specifies, it doesn\textquotesingle{}t leave enough freedom to the implementation. As a result, changing the implementation without breaking the contract (e.\+g. refactoring and optimization), which should be perfectly fine to do, can break such tests. Then you have to spend time fixing them, only to see them broken again the next time the implementation is changed.

Keep in mind that one doesn\textquotesingle{}t have to verify more than one property in one test. In fact, {\bfseries{it\textquotesingle{}s a good style to verify only one thing in one test.}} If you do that, a bug will likely break only one or two tests instead of dozens (which case would you rather debug?). If you are also in the habit of giving tests descriptive names that tell what they verify, you can often easily guess what\textquotesingle{}s wrong just from the test log itself.

So use {\ttfamily O\+N\+\_\+\+C\+A\+LL} by default, and only use {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} when you actually intend to verify that the call is made. For example, you may have a bunch of {\ttfamily O\+N\+\_\+\+C\+A\+LL}s in your test fixture to set the common mock behavior shared by all tests in the same group, and write (scarcely) different {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}s in different {\ttfamily T\+E\+S\+T\+\_\+F}s to verify different aspects of the code\textquotesingle{}s behavior. Compared with the style where each {\ttfamily T\+E\+ST} has many {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}s, this leads to tests that are more resilient to implementational changes (and thus less likely to require maintenance) and makes the intent of the tests more obvious (so they are easier to maintain when you do need to maintain them).

If you are bothered by the \char`\"{}\+Uninteresting mock function call\char`\"{} message printed when a mock method without an {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} is called, you may use a {\ttfamily Nice\+Mock} instead to suppress all such messages for the mock object, or suppress the message for specific methods by adding {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L(...).Times(\+Any\+Number())}. DO N\+OT suppress it by blindly adding an {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L(...)}, or you\textquotesingle{}ll have a test that\textquotesingle{}s a pain to maintain.\hypertarget{md__c_autotoc_md62}{}\doxysubsubsection{Ignoring Uninteresting Calls}\label{md__c_autotoc_md62}
If you are not interested in how a mock method is called, just don\textquotesingle{}t say anything about it. In this case, if the method is ever called, g\+Mock will perform its default action to allow the test program to continue. If you are not happy with the default action taken by g\+Mock, you can override it using {\ttfamily Default\+Value$<$T$>$\+::\+Set()} (described \href{\#DefaultValue}{\texttt{ here}}) or {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()}.

Please note that once you expressed interest in a particular mock method (via {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}), all invocations to it must match some expectation. If this function is called but the arguments don\textquotesingle{}t match any {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} statement, it will be an error.\hypertarget{md__c_autotoc_md63}{}\doxysubsubsection{Disallowing Unexpected Calls}\label{md__c_autotoc_md63}
If a mock method shouldn\textquotesingle{}t be called at all, explicitly say so\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(\_))}
\DoxyCodeLine{      .Times(0);}
\end{DoxyCode}


If some calls to the method are allowed, but the rest are not, just list all the expected calls\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::AnyNumber;}
\DoxyCodeLine{using ::testing::Gt;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(5));}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(Gt(10)))}
\DoxyCodeLine{      .Times(AnyNumber());}
\end{DoxyCode}


A call to {\ttfamily foo.\+Bar()} that doesn\textquotesingle{}t match any of the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} statements will be an error.\hypertarget{md__c_uninteresting-vs-unexpected}{}\doxysubsubsection{Understanding Uninteresting vs Unexpected Calls}\label{md__c_uninteresting-vs-unexpected}
{\itshape Uninteresting} calls and {\itshape unexpected} calls are different concepts in g\+Mock. {\itshape Very} different.

A call {\ttfamily x.\+Y(...)} is {\bfseries{uninteresting}} if there\textquotesingle{}s {\itshape not even a single} {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L(x, Y(...))} set. In other words, the test isn\textquotesingle{}t interested in the {\ttfamily x.\+Y()} method at all, as evident in that the test doesn\textquotesingle{}t care to say anything about it.

A call {\ttfamily x.\+Y(...)} is {\bfseries{unexpected}} if there are {\itshape some} {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL(x, Y(...))}s set, but none of them matches the call. Put another way, the test is interested in the {\ttfamily x.\+Y()} method (therefore it explicitly sets some {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} to verify how it\textquotesingle{}s called); however, the verification fails as the test doesn\textquotesingle{}t expect this particular call to happen.

{\bfseries{An unexpected call is always an error,}} as the code under test doesn\textquotesingle{}t behave the way the test expects it to behave.

{\bfseries{By default, an uninteresting call is not an error,}} as it violates no constraint specified by the test. (g\+Mock\textquotesingle{}s philosophy is that saying nothing means there is no constraint.) However, it leads to a warning, as it {\itshape might} indicate a problem (e.\+g. the test author might have forgotten to specify a constraint).

In g\+Mock, {\ttfamily Nice\+Mock} and {\ttfamily Strict\+Mock} can be used to make a mock class \char`\"{}nice\char`\"{} or \char`\"{}strict\char`\"{}. How does this affect uninteresting calls and unexpected calls?

A {\bfseries{nice mock}} suppresses uninteresting call {\itshape warnings}. It is less chatty than the default mock, but otherwise is the same. If a test fails with a default mock, it will also fail using a nice mock instead. And vice versa. Don\textquotesingle{}t expect making a mock nice to change the test\textquotesingle{}s result.

A {\bfseries{strict mock}} turns uninteresting call warnings into errors. So making a mock strict may change the test\textquotesingle{}s result.

Let\textquotesingle{}s look at an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{TEST(...) \{}
\DoxyCodeLine{  NiceMock<MockDomainRegistry> mock\_registry;}
\DoxyCodeLine{  EXPECT\_CALL(mock\_registry, GetDomainOwner(\textcolor{stringliteral}{"google.com"}))}
\DoxyCodeLine{          .WillRepeatedly(Return(\textcolor{stringliteral}{"Larry Page"}));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Use mock\_registry in code under test.}}
\DoxyCodeLine{  ... \&mock\_registry ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


The sole {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} here says that all calls to {\ttfamily Get\+Domain\+Owner()} must have {\ttfamily \char`\"{}google.\+com\char`\"{}} as the argument. If {\ttfamily Get\+Domain\+Owner(\char`\"{}yahoo.\+com\char`\"{})} is called, it will be an unexpected call, and thus an error. {\itshape Having a nice mock doesn\textquotesingle{}t change the severity of an unexpected call.}

So how do we tell g\+Mock that {\ttfamily Get\+Domain\+Owner()} can be called with some other arguments as well? The standard technique is to add a \char`\"{}catch all\char`\"{} {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(mock\_registry, GetDomainOwner(\_))}
\DoxyCodeLine{      .Times(AnyNumber());  \textcolor{comment}{// catches all other calls to this method.}}
\DoxyCodeLine{EXPECT\_CALL(mock\_registry, GetDomainOwner(\textcolor{stringliteral}{"google.com"}))}
\DoxyCodeLine{      .WillRepeatedly(Return(\textcolor{stringliteral}{"Larry Page"}));}
\end{DoxyCode}


Remember that {\ttfamily \+\_\+} is the wildcard matcher that matches anything. With this, if {\ttfamily Get\+Domain\+Owner(\char`\"{}google.\+com\char`\"{})} is called, it will do what the second {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} says; if it is called with a different argument, it will do what the first {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} says.

Note that the order of the two {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}s is important, as a newer {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} takes precedence over an older one.

For more on uninteresting calls, nice mocks, and strict mocks, read \href{\#NiceStrictNaggy}{\texttt{ \char`\"{}\+The Nice, the Strict, and the Naggy\char`\"{}}}.\hypertarget{md__c_ParameterlessExpectations}{}\doxysubsubsection{Ignoring Uninteresting Arguments}\label{md__c_ParameterlessExpectations}
If your test doesn\textquotesingle{}t care about the parameters (it only cares about the number or order of calls), you can often simply omit the parameter list\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Expect foo.Bar( ... ) twice with any arguments.}}
\DoxyCodeLine{EXPECT\_CALL(foo, Bar).Times(2);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Delegate to the given method whenever the factory is invoked.}}
\DoxyCodeLine{ON\_CALL(foo\_factory, MakeFoo)}
\DoxyCodeLine{    .WillByDefault(\&BuildFooForTest);}
\end{DoxyCode}


This functionality is only available when a method is not overloaded; to prevent unexpected behavior it is a compilation error to try to set an expectation on a method where the specific overload is ambiguous. You can work around this by supplying a \href{\#SimplerInterfaces}{\texttt{ simpler mock interface}} than the mocked class provides.

This pattern is also useful when the arguments are interesting, but match logic is substantially complex. You can leave the argument list unspecified and use Save\+Arg actions to \href{\#SaveArgVerify}{\texttt{ save the values for later verification}}. If you do that, you can easily differentiate calling the method the wrong number of times from calling it with the wrong arguments.\hypertarget{md__c_OrderedCalls}{}\doxysubsubsection{Expecting Ordered Calls}\label{md__c_OrderedCalls}
Although an {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} statement defined earlier takes precedence when g\+Mock tries to match a function call with an expectation, by default calls don\textquotesingle{}t have to happen in the order {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} statements are written. For example, if the arguments match the matchers in the third {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}, but not those in the first two, then the third expectation will be used.

If you would rather have all calls occur in the order of the expectations, put the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} statements in a block where you define a variable of type {\ttfamily In\+Sequence}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::InSequence;}
\DoxyCodeLine{}
\DoxyCodeLine{  \{}
\DoxyCodeLine{    InSequence s;}
\DoxyCodeLine{}
\DoxyCodeLine{    EXPECT\_CALL(foo, DoThis(5));}
\DoxyCodeLine{    EXPECT\_CALL(bar, DoThat(\_))}
\DoxyCodeLine{        .Times(2);}
\DoxyCodeLine{    EXPECT\_CALL(foo, DoThis(6));}
\DoxyCodeLine{  \}}
\end{DoxyCode}


In this example, we expect a call to {\ttfamily foo.\+Do\+This(5)}, followed by two calls to {\ttfamily bar.\+Do\+That()} where the argument can be anything, which are in turn followed by a call to {\ttfamily foo.\+Do\+This(6)}. If a call occurred out-\/of-\/order, g\+Mock will report an error.\hypertarget{md__c_PartialOrder}{}\doxysubsubsection{Expecting Partially Ordered Calls}\label{md__c_PartialOrder}
Sometimes requiring everything to occur in a predetermined order can lead to brittle tests. For example, we may care about {\ttfamily A} occurring before both {\ttfamily B} and {\ttfamily C}, but aren\textquotesingle{}t interested in the relative order of {\ttfamily B} and {\ttfamily C}. In this case, the test should reflect our real intent, instead of being overly constraining.

g\+Mock allows you to impose an arbitrary D\+AG (directed acyclic graph) on the calls. One way to express the D\+AG is to use the \href{\#AfterClause}{\texttt{ After}} clause of {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}.

Another way is via the {\ttfamily In\+Sequence()} clause (not the same as the {\ttfamily In\+Sequence} class), which we borrowed from j\+Mock 2. It\textquotesingle{}s less flexible than {\ttfamily After()}, but more convenient when you have long chains of sequential calls, as it doesn\textquotesingle{}t require you to come up with different names for the expectations in the chains. Here\textquotesingle{}s how it works\+:

If we view {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} statements as nodes in a graph, and add an edge from node A to node B wherever A must occur before B, we can get a D\+AG. We use the term \char`\"{}sequence\char`\"{} to mean a directed path in this D\+AG. Now, if we decompose the D\+AG into sequences, we just need to know which sequences each {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} belongs to in order to be able to reconstruct the original D\+AG.

So, to specify the partial order on the expectations we need to do two things\+: first to define some {\ttfamily Sequence} objects, and then for each {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()} say which {\ttfamily Sequence} objects it is part of.

Expectations in the same sequence must occur in the order they are written. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Sequence;}
\DoxyCodeLine{...}
\DoxyCodeLine{  Sequence s1, s2;}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(foo, A())}
\DoxyCodeLine{      .InSequence(s1, s2);}
\DoxyCodeLine{  EXPECT\_CALL(bar, B())}
\DoxyCodeLine{      .InSequence(s1);}
\DoxyCodeLine{  EXPECT\_CALL(bar, C())}
\DoxyCodeLine{      .InSequence(s2);}
\DoxyCodeLine{  EXPECT\_CALL(foo, D())}
\DoxyCodeLine{      .InSequence(s2);}
\end{DoxyCode}


specifies the following D\+AG (where {\ttfamily s1} is {\ttfamily A -\/$>$ B}, and {\ttfamily s2} is {\ttfamily A -\/$>$ C -\/$>$ D})\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{     +-\/-\/-\/> B}
\DoxyCodeLine{     |}
\DoxyCodeLine{A -\/-\/-\/|}
\DoxyCodeLine{     |}
\DoxyCodeLine{      +-\/-\/-\/> C -\/-\/-\/> D}
\end{DoxyCode}


This means that A must occur before B and C, and C must occur before D. There\textquotesingle{}s no restriction about the order other than these.\hypertarget{md__c_autotoc_md64}{}\doxysubsubsection{Controlling When an Expectation Retires}\label{md__c_autotoc_md64}
When a mock method is called, g\+Mock only considers expectations that are still active. An expectation is active when created, and becomes inactive (aka {\itshape retires}) when a call that has to occur later has occurred. For example, in


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Sequence;}
\DoxyCodeLine{...}
\DoxyCodeLine{  Sequence s1, s2;}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \textcolor{stringliteral}{"File too large."}))      \textcolor{comment}{// \#1}}
\DoxyCodeLine{      .Times(AnyNumber())}
\DoxyCodeLine{      .InSequence(s1, s2);}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \textcolor{stringliteral}{"Data set is empty."}))   \textcolor{comment}{// \#2}}
\DoxyCodeLine{      .InSequence(s1);}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \textcolor{stringliteral}{"User not found."}))      \textcolor{comment}{// \#3}}
\DoxyCodeLine{      .InSequence(s2);}
\end{DoxyCode}


as soon as either \#2 or \#3 is matched, \#1 will retire. If a warning {\ttfamily \char`\"{}\+File too
large.\char`\"{}} is logged after this, it will be an error.

Note that an expectation doesn\textquotesingle{}t retire automatically when it\textquotesingle{}s saturated. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \_));                     \textcolor{comment}{// \#1}}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \textcolor{stringliteral}{"File too large."}));     \textcolor{comment}{// \#2}}
\end{DoxyCode}


says that there will be exactly one warning with the message {\ttfamily \char`\"{}\+File too
large.\char`\"{}}. If the second warning contains this message too, \#2 will match again and result in an upper-\/bound-\/violated error.

If this is not what you want, you can ask an expectation to retire as soon as it becomes saturated\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \_));                     \textcolor{comment}{// \#1}}
\DoxyCodeLine{  EXPECT\_CALL(log, Log(WARNING, \_, \textcolor{stringliteral}{"File too large."}))      \textcolor{comment}{// \#2}}
\DoxyCodeLine{      .RetiresOnSaturation();}
\end{DoxyCode}


Here \#2 can be used only once, so if you have two warnings with the message {\ttfamily \char`\"{}\+File too large.\char`\"{}}, the first will match \#2 and the second will match \#1 -\/ there will be no error.\hypertarget{md__c_autotoc_md65}{}\doxysubsection{Using Actions}\label{md__c_autotoc_md65}
\hypertarget{md__c_autotoc_md66}{}\doxysubsubsection{Returning References from Mock Methods}\label{md__c_autotoc_md66}
If a mock function\textquotesingle{}s return type is a reference, you need to use {\ttfamily Return\+Ref()} instead of {\ttfamily Return()} to return a result\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::ReturnRef;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(Bar\&, GetBar, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  Bar bar;}
\DoxyCodeLine{  EXPECT\_CALL(foo, GetBar())}
\DoxyCodeLine{      .WillOnce(ReturnRef(bar));}
\DoxyCodeLine{...}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md67}{}\doxysubsubsection{Returning Live Values from Mock Methods}\label{md__c_autotoc_md67}
The {\ttfamily Return(x)} action saves a copy of {\ttfamily x} when the action is created, and always returns the same value whenever it\textquotesingle{}s executed. Sometimes you may want to instead return the {\itshape live} value of {\ttfamily x} (i.\+e. its value at the time when the action is {\itshape executed}.). Use either {\ttfamily Return\+Ref()} or {\ttfamily Return\+Pointee()} for this purpose.

If the mock function\textquotesingle{}s return type is a reference, you can do it using {\ttfamily Return\+Ref(x)}, as shown in the previous recipe (\char`\"{}\+Returning References from Mock
\+Methods\char`\"{}). However, g\+Mock doesn\textquotesingle{}t let you use {\ttfamily Return\+Ref()} in a mock function whose return type is not a reference, as doing that usually indicates a user error. So, what shall you do?

Though you may be tempted, DO N\+OT use {\ttfamily By\+Ref()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using} testing::ByRef;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Return;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, GetValue, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{keywordtype}{int} x = 0;}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  EXPECT\_CALL(foo, GetValue())}
\DoxyCodeLine{      .WillRepeatedly(Return(ByRef(x)));  \textcolor{comment}{// Wrong!}}
\DoxyCodeLine{  x = 42;}
\DoxyCodeLine{  EXPECT\_EQ(42, foo.GetValue());}
\end{DoxyCode}


Unfortunately, it doesn\textquotesingle{}t work here. The above code will fail with error\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: foo.GetValue()}
\DoxyCodeLine{  Actual: 0}
\DoxyCodeLine{Expected: 42}
\end{DoxyCode}


The reason is that {\ttfamily Return($\ast$value$\ast$)} converts {\ttfamily value} to the actual return type of the mock function at the time when the action is {\itshape created}, not when it is {\itshape executed}. (This behavior was chosen for the action to be safe when {\ttfamily value} is a proxy object that references some temporary objects.) As a result, {\ttfamily By\+Ref(x)} is converted to an {\ttfamily int} value (instead of a {\ttfamily const int\&}) when the expectation is set, and {\ttfamily Return(\+By\+Ref(x))} will always return 0.

{\ttfamily Return\+Pointee(pointer)} was provided to solve this problem specifically. It returns the value pointed to by {\ttfamily pointer} at the time the action is {\itshape executed}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using} testing::ReturnPointee;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{keywordtype}{int} x = 0;}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  EXPECT\_CALL(foo, GetValue())}
\DoxyCodeLine{      .WillRepeatedly(ReturnPointee(\&x));  \textcolor{comment}{// Note the \& here.}}
\DoxyCodeLine{  x = 42;}
\DoxyCodeLine{  EXPECT\_EQ(42, foo.GetValue());  \textcolor{comment}{// This will succeed now.}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md68}{}\doxysubsubsection{Combining Actions}\label{md__c_autotoc_md68}
Want to do more than one thing when a function is called? That\textquotesingle{}s fine. {\ttfamily Do\+All()} allow you to do sequence of actions every time. Only the return value of the last action in the sequence will be used.


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::DoAll;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, Bar, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(\_))}
\DoxyCodeLine{      .WillOnce(DoAll(action\_1,}
\DoxyCodeLine{                      action\_2,}
\DoxyCodeLine{                      ...}
\DoxyCodeLine{                      action\_n));}
\end{DoxyCode}
\hypertarget{md__c_SaveArgVerify}{}\doxysubsubsection{Verifying Complex Arguments}\label{md__c_SaveArgVerify}
If you want to verify that a method is called with a particular argument but the match criteria is complex, it can be difficult to distinguish between cardinality failures (calling the method the wrong number of times) and argument match failures. Similarly, if you are matching multiple parameters, it may not be easy to distinguishing which argument failed to match. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Not ideal: this could fail because of a problem with arg1 or arg2, or maybe}}
\DoxyCodeLine{\textcolor{comment}{// just the method wasn't called.}}
\DoxyCodeLine{EXPECT\_CALL(foo, SendValues(\_, ElementsAre(1, 4, 4, 7), EqualsProto( ... )));}
\end{DoxyCode}


You can instead save the arguments and test them individually\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(foo, SendValues)}
\DoxyCodeLine{    .WillOnce(DoAll(SaveArg<1>(\&actual\_array), SaveArg<2>(\&actual\_proto)));}
\DoxyCodeLine{... run the test}
\DoxyCodeLine{EXPECT\_THAT(actual\_array, ElementsAre(1, 4, 4, 7));}
\DoxyCodeLine{EXPECT\_THAT(actual\_proto, EqualsProto( ... ));}
\end{DoxyCode}
\hypertarget{md__c_MockingSideEffects}{}\doxysubsubsection{Mocking Side Effects}\label{md__c_MockingSideEffects}
Sometimes a method exhibits its effect not via returning a value but via side effects. For example, it may change some global state or modify an output argument. To mock side effects, in general you can define your own action by implementing {\ttfamily \mbox{\hyperlink{classtesting_1_1_action_interface}{testing\+::\+Action\+Interface}}}.

If all you need to do is to change an output argument, the built-\/in {\ttfamily Set\+Arg\+Pointee()} action is convenient\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::SetArgPointee;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockMutator : \textcolor{keyword}{public} Mutator \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Mutate, (\textcolor{keywordtype}{bool} mutate, \textcolor{keywordtype}{int}* value), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockMutator mutator;}
\DoxyCodeLine{  EXPECT\_CALL(mutator, Mutate(\textcolor{keyword}{true}, \_))}
\DoxyCodeLine{      .WillOnce(SetArgPointee<1>(5));}
\end{DoxyCode}


In this example, when {\ttfamily mutator.\+Mutate()} is called, we will assign 5 to the {\ttfamily int} variable pointed to by argument \#1 (0-\/based).

{\ttfamily Set\+Arg\+Pointee()} conveniently makes an internal copy of the value you pass to it, removing the need to keep the value in scope and alive. The implication however is that the value must have a copy constructor and assignment operator.

If the mock method also needs to return a value as well, you can chain {\ttfamily Set\+Arg\+Pointee()} with {\ttfamily Return()} using {\ttfamily Do\+All()}, remembering to put the {\ttfamily Return()} statement last\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{using ::testing::SetArgPointee;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockMutator : \textcolor{keyword}{public} Mutator \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, MutateInt, (\textcolor{keywordtype}{int}* value), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockMutator mutator;}
\DoxyCodeLine{  EXPECT\_CALL(mutator, MutateInt(\_))}
\DoxyCodeLine{      .WillOnce(DoAll(SetArgPointee<0>(5),}
\DoxyCodeLine{                      Return(\textcolor{keyword}{true})));}
\end{DoxyCode}


Note, however, that if you use the {\ttfamily Return\+O\+K\+With()} method, it will override the values provided by {\ttfamily Set\+Arg\+Pointee()} in the response parameters of your function call.

If the output argument is an array, use the {\ttfamily Set\+Array\+Argument$<$N$>$(first, last)} action instead. It copies the elements in source range {\ttfamily \mbox{[}first, last)} to the array pointed to by the {\ttfamily N}-\/th (0-\/based) argument\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::NotNull;}
\DoxyCodeLine{using ::testing::SetArrayArgument;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockArrayMutator : \textcolor{keyword}{public} ArrayMutator \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Mutate, (\textcolor{keywordtype}{int}* values, \textcolor{keywordtype}{int} num\_values), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockArrayMutator mutator;}
\DoxyCodeLine{  \textcolor{keywordtype}{int} values[5] = \{1, 2, 3, 4, 5\};}
\DoxyCodeLine{  EXPECT\_CALL(mutator, Mutate(NotNull(), 5))}
\DoxyCodeLine{      .WillOnce(SetArrayArgument<0>(values, values + 5));}
\end{DoxyCode}


This also works when the argument is an output iterator\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::SetArrayArgument;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockRolodex : \textcolor{keyword}{public} Rolodex \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, GetNames, (std::back\_insert\_iterator<vector<string>>),}
\DoxyCodeLine{              (\textcolor{keyword}{override}));}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockRolodex rolodex;}
\DoxyCodeLine{  vector<string> names;}
\DoxyCodeLine{  names.push\_back(\textcolor{stringliteral}{"George"});}
\DoxyCodeLine{  names.push\_back(\textcolor{stringliteral}{"John"});}
\DoxyCodeLine{  names.push\_back(\textcolor{stringliteral}{"Thomas"});}
\DoxyCodeLine{  EXPECT\_CALL(rolodex, GetNames(\_))}
\DoxyCodeLine{      .WillOnce(SetArrayArgument<0>(names.begin(), names.end()));}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md69}{}\doxysubsubsection{Changing a Mock Object\textquotesingle{}s Behavior Based on the State}\label{md__c_autotoc_md69}
If you expect a call to change the behavior of a mock object, you can use {\ttfamily \+::testing\+::\+In\+Sequence} to specify different behaviors before and after the call\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::InSequence;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  \{}
\DoxyCodeLine{     InSequence seq;}
\DoxyCodeLine{     EXPECT\_CALL(my\_mock, IsDirty())}
\DoxyCodeLine{         .WillRepeatedly(Return(\textcolor{keyword}{true}));}
\DoxyCodeLine{     EXPECT\_CALL(my\_mock, Flush());}
\DoxyCodeLine{     EXPECT\_CALL(my\_mock, IsDirty())}
\DoxyCodeLine{         .WillRepeatedly(Return(\textcolor{keyword}{false}));}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  my\_mock.FlushIfDirty();}
\end{DoxyCode}


This makes {\ttfamily my\+\_\+mock.\+Is\+Dirty()} return {\ttfamily true} before {\ttfamily my\+\_\+mock.\+Flush()} is called and return {\ttfamily false} afterwards.

If the behavior change is more complex, you can store the effects in a variable and make a mock method get its return value from that variable\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::SaveArg;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{}
\DoxyCodeLine{ACTION\_P(ReturnPointee, p) \{ \textcolor{keywordflow}{return} *p; \}}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{keywordtype}{int} previous\_value = 0;}
\DoxyCodeLine{  EXPECT\_CALL(my\_mock, GetPrevValue)}
\DoxyCodeLine{      .WillRepeatedly(ReturnPointee(\&previous\_value));}
\DoxyCodeLine{  EXPECT\_CALL(my\_mock, UpdateValue)}
\DoxyCodeLine{      .WillRepeatedly(SaveArg<0>(\&previous\_value));}
\DoxyCodeLine{  my\_mock.DoSomethingToUpdateValue();}
\end{DoxyCode}


Here {\ttfamily my\+\_\+mock.\+Get\+Prev\+Value()} will always return the argument of the last {\ttfamily Update\+Value()} call.\hypertarget{md__c_DefaultValue}{}\doxysubsubsection{Setting the Default Value for a Return Type}\label{md__c_DefaultValue}
If a mock method\textquotesingle{}s return type is a built-\/in C++ type or pointer, by default it will return 0 when invoked. Also, in C++ 11 and above, a mock method whose return type has a default constructor will return a default-\/constructed value by default. You only need to specify an action if this default value doesn\textquotesingle{}t work for you.

Sometimes, you may want to change this default value, or you may want to specify a default value for types g\+Mock doesn\textquotesingle{}t know about. You can do this using the {\ttfamily \mbox{\hyperlink{classtesting_1_1_default_value}{testing\+::\+Default\+Value}}} class template\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::DefaultValue;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(Bar, CalculateBar, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  Bar default\_bar;}
\DoxyCodeLine{  \textcolor{comment}{// Sets the default return value for type Bar.}}
\DoxyCodeLine{  DefaultValue<Bar>::Set(default\_bar);}
\DoxyCodeLine{}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// We don't need to specify an action here, as the default}}
\DoxyCodeLine{  \textcolor{comment}{// return value works for us.}}
\DoxyCodeLine{  EXPECT\_CALL(foo, CalculateBar());}
\DoxyCodeLine{}
\DoxyCodeLine{  foo.CalculateBar();  \textcolor{comment}{// This should return default\_bar.}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Unsets the default return value.}}
\DoxyCodeLine{  DefaultValue<Bar>::Clear();}
\end{DoxyCode}


Please note that changing the default value for a type can make you tests hard to understand. We recommend you to use this feature judiciously. For example, you may want to make sure the {\ttfamily Set()} and {\ttfamily Clear()} calls are right next to the code that uses your mock.\hypertarget{md__c_autotoc_md70}{}\doxysubsubsection{Setting the Default Actions for a Mock Method}\label{md__c_autotoc_md70}
You\textquotesingle{}ve learned how to change the default value of a given type. However, this may be too coarse for your purpose\+: perhaps you have two mock methods with the same return type and you want them to have different behaviors. The {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} macro allows you to customize your mock\textquotesingle{}s behavior at the method level\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::AnyNumber;}
\DoxyCodeLine{using ::testing::Gt;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{...}
\DoxyCodeLine{  ON\_CALL(foo, Sign(\_))}
\DoxyCodeLine{      .WillByDefault(Return(-\/1));}
\DoxyCodeLine{  ON\_CALL(foo, Sign(0))}
\DoxyCodeLine{      .WillByDefault(Return(0));}
\DoxyCodeLine{  ON\_CALL(foo, Sign(Gt(0)))}
\DoxyCodeLine{      .WillByDefault(Return(1));}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(foo, Sign(\_))}
\DoxyCodeLine{      .Times(AnyNumber());}
\DoxyCodeLine{}
\DoxyCodeLine{  foo.Sign(5);   \textcolor{comment}{// This should return 1.}}
\DoxyCodeLine{  foo.Sign(-\/9);  \textcolor{comment}{// This should return -\/1.}}
\DoxyCodeLine{  foo.Sign(0);   \textcolor{comment}{// This should return 0.}}
\end{DoxyCode}


As you may have guessed, when there are more than one {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} statements, the newer ones in the order take precedence over the older ones. In other words, the {\bfseries{last}} one that matches the function arguments will be used. This matching order allows you to set up the common behavior in a mock object\textquotesingle{}s constructor or the test fixture\textquotesingle{}s set-\/up phase and specialize the mock\textquotesingle{}s behavior later.

Note that both {\ttfamily O\+N\+\_\+\+C\+A\+LL} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} have the same \char`\"{}later statements take
precedence\char`\"{} rule, but they don\textquotesingle{}t interact. That is, {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}s have their own precedence order distinct from the {\ttfamily O\+N\+\_\+\+C\+A\+LL} precedence order.\hypertarget{md__c_FunctionsAsActions}{}\doxysubsubsection{Using Functions/\+Methods/\+Functors/\+Lambdas as Actions}\label{md__c_FunctionsAsActions}
If the built-\/in actions don\textquotesingle{}t suit you, you can use an existing callable (function, {\ttfamily std\+::function}, method, functor, lambda as an action.


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_; using ::testing::Invoke;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, Sum, (\textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, ComplexJob, (\textcolor{keywordtype}{int} x), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int} CalculateSum(\textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y) \{ \textcolor{keywordflow}{return} x + y; \}}
\DoxyCodeLine{\textcolor{keywordtype}{int} Sum3(\textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y, \textcolor{keywordtype}{int} z) \{ \textcolor{keywordflow}{return} x + y + z; \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }Helper \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} ComplexJob(\textcolor{keywordtype}{int} x);}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  Helper helper;}
\DoxyCodeLine{  EXPECT\_CALL(foo, Sum(\_, \_))}
\DoxyCodeLine{      .WillOnce(\&CalculateSum)}
\DoxyCodeLine{      .WillRepeatedly(Invoke(NewPermanentCallback(Sum3, 1)));}
\DoxyCodeLine{  EXPECT\_CALL(foo, ComplexJob(\_))}
\DoxyCodeLine{      .WillOnce(Invoke(\&helper, \&Helper::ComplexJob));}
\DoxyCodeLine{      .WillRepeatedly([](\textcolor{keywordtype}{int} x) \{ \textcolor{keywordflow}{return} x > 0; \});}
\DoxyCodeLine{}
\DoxyCodeLine{  foo.Sum(5, 6);         \textcolor{comment}{// Invokes CalculateSum(5, 6).}}
\DoxyCodeLine{  foo.Sum(2, 3);         \textcolor{comment}{// Invokes Sum3(1, 2, 3).}}
\DoxyCodeLine{  foo.ComplexJob(10);    \textcolor{comment}{// Invokes helper.ComplexJob(10).}}
\DoxyCodeLine{  foo.ComplexJob(-\/1);    \textcolor{comment}{// Invokes the inline lambda.}}
\end{DoxyCode}


The only requirement is that the type of the function, etc must be {\itshape compatible} with the signature of the mock function, meaning that the latter\textquotesingle{}s arguments can be implicitly converted to the corresponding arguments of the former, and the former\textquotesingle{}s return type can be implicitly converted to that of the latter. So, you can invoke something whose type is {\itshape not} exactly the same as the mock function, as long as it\textquotesingle{}s safe to do so -\/ nice, huh?

$\ast$$\ast${\ttfamily Note\+:}\{.escaped\}$\ast$$\ast$


\begin{DoxyItemize}
\item The action takes ownership of the callback and will delete it when the action itself is destructed.
\item If the type of a callback is derived from a base callback type {\ttfamily C}, you need to implicitly cast it to {\ttfamily C} to resolve the overloading, e.\+g.

\`{}\`{}\`{}cpp using \+::testing\+::\+Invoke; ... Result\+Callback$<$bool$>$$\ast$ is\+\_\+ok = ...; ... Invoke(is\+\_\+ok) ...; // This works.

Blocking\+Closure$\ast$ done = new Blocking\+Closure; ... Invoke(implicit\+\_\+cast$<$\+Closure$\ast$$>$(done)) ...; // The cast is necessary. \`{}\`{}\`{}
\end{DoxyItemize}\hypertarget{md__c_autotoc_md71}{}\doxysubsubsection{Using Functions with Extra Info as Actions}\label{md__c_autotoc_md71}
The function or functor you call using {\ttfamily Invoke()} must have the same number of arguments as the mock function you use it for. Sometimes you may have a function that takes more arguments, and you are willing to pass in the extra arguments yourself to fill the gap. You can do this in g\+Mock using callbacks with pre-\/bound arguments. Here\textquotesingle{}s an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{char}, DoThis, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{char} SignOfSum(\textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y) \{}
\DoxyCodeLine{  \textcolor{keyword}{const} \textcolor{keywordtype}{int} sum = x + y;}
\DoxyCodeLine{  \textcolor{keywordflow}{return} (sum > 0) ? \textcolor{charliteral}{'+'} : (sum < 0) ? \textcolor{charliteral}{'-\/'} : \textcolor{charliteral}{'0'};}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, Test) \{}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(2))}
\DoxyCodeLine{      .WillOnce(Invoke(NewPermanentCallback(SignOfSum, 5)));}
\DoxyCodeLine{  EXPECT\_EQ(\textcolor{charliteral}{'+'}, foo.DoThis(2));  \textcolor{comment}{// Invokes SignOfSum(5, 2).}}
\DoxyCodeLine{\}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md72}{}\doxysubsubsection{Invoking a Function/\+Method/\+Functor/\+Lambda/\+Callback Without Arguments}\label{md__c_autotoc_md72}
{\ttfamily Invoke()} is very useful for doing actions that are more complex. It passes the mock function\textquotesingle{}s arguments to the function, etc being invoked such that the callee has the full context of the call to work with. If the invoked function is not interested in some or all of the arguments, it can simply ignore them.

Yet, a common pattern is that a test author wants to invoke a function without the arguments of the mock function. {\ttfamily Invoke()} allows her to do that using a wrapper function that throws away the arguments before invoking an underlining nullary function. Needless to say, this can be tedious and obscures the intent of the test.

{\ttfamily Invoke\+Without\+Args()} solves this problem. It\textquotesingle{}s like {\ttfamily Invoke()} except that it doesn\textquotesingle{}t pass the mock function\textquotesingle{}s arguments to the callee. Here\textquotesingle{}s an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::InvokeWithoutArgs;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, ComplexJob, (\textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{bool} Job1() \{ ... \}}
\DoxyCodeLine{\textcolor{keywordtype}{bool} Job2(\textcolor{keywordtype}{int} n, \textcolor{keywordtype}{char} c) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  EXPECT\_CALL(foo, ComplexJob(\_))}
\DoxyCodeLine{      .WillOnce(InvokeWithoutArgs(Job1))}
\DoxyCodeLine{      .WillOnce(InvokeWithoutArgs(NewPermanentCallback(Job2, 5, \textcolor{charliteral}{'a'})));}
\DoxyCodeLine{}
\DoxyCodeLine{  foo.ComplexJob(10);  \textcolor{comment}{// Invokes Job1().}}
\DoxyCodeLine{  foo.ComplexJob(20);  \textcolor{comment}{// Invokes Job2(5, 'a').}}
\end{DoxyCode}


$\ast$$\ast${\ttfamily Note\+:}\{.escaped\}$\ast$$\ast$


\begin{DoxyItemize}
\item The action takes ownership of the callback and will delete it when the action itself is destructed.
\item If the type of a callback is derived from a base callback type {\ttfamily C}, you need to implicitly cast it to {\ttfamily C} to resolve the overloading, e.\+g.

\`{}\`{}\`{}cpp using \+::testing\+::\+Invoke\+Without\+Args; ... Result\+Callback$<$bool$>$$\ast$ is\+\_\+ok = ...; ... Invoke\+Without\+Args(is\+\_\+ok) ...; // This works.

Blocking\+Closure$\ast$ done = ...; ... Invoke\+Without\+Args(implicit\+\_\+cast$<$\+Closure$\ast$$>$(done)) ...; // The cast is necessary. \`{}\`{}\`{}
\end{DoxyItemize}\hypertarget{md__c_autotoc_md73}{}\doxysubsubsection{Invoking an Argument of the Mock Function}\label{md__c_autotoc_md73}
Sometimes a mock function will receive a function pointer, a functor (in other words, a \char`\"{}callable\char`\"{}) as an argument, e.\+g.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, DoThis, (\textcolor{keywordtype}{int} n, (ResultCallback1<bool, int>* callback)),}
\DoxyCodeLine{              (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}


and you may want to invoke this callable argument\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(\_, \_))}
\DoxyCodeLine{      .WillOnce(...);}
\DoxyCodeLine{      \textcolor{comment}{// Will execute callback-\/>Run(5), where callback is the}}
\DoxyCodeLine{      \textcolor{comment}{// second argument DoThis() receives.}}
\end{DoxyCode}


N\+O\+TE\+: The section below is legacy documentation from before C++ had lambdas\+:

Arghh, you need to refer to a mock function argument but C++ has no lambda (yet), so you have to define your own action. \+:-\/( Or do you really?

Well, g\+Mock has an action to solve {\itshape exactly} this problem\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{InvokeArgument<N>(arg\_1, arg\_2, ..., arg\_m)}
\end{DoxyCode}


will invoke the {\ttfamily N}-\/th (0-\/based) argument the mock function receives, with {\ttfamily arg\+\_\+1}, {\ttfamily arg\+\_\+2}, ..., and {\ttfamily arg\+\_\+m}. No matter if the argument is a function pointer, a functor, or a callback. g\+Mock handles them all.

With that, you could write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::InvokeArgument;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis(\_, \_))}
\DoxyCodeLine{      .WillOnce(InvokeArgument<1>(5));}
\DoxyCodeLine{      \textcolor{comment}{// Will execute callback-\/>Run(5), where callback is the}}
\DoxyCodeLine{      \textcolor{comment}{// second argument DoThis() receives.}}
\end{DoxyCode}


What if the callable takes an argument by reference? No problem -\/ just wrap it inside {\ttfamily By\+Ref()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{...}
\DoxyCodeLine{MOCK\_METHOD(\textcolor{keywordtype}{bool}, Bar,}
\DoxyCodeLine{            ((ResultCallback2<bool, int, const Helper\&>* callback)),}
\DoxyCodeLine{            (\textcolor{keyword}{override}));}
\DoxyCodeLine{...}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::ByRef;}
\DoxyCodeLine{using ::testing::InvokeArgument;}
\DoxyCodeLine{...}
\DoxyCodeLine{MockFoo foo;}
\DoxyCodeLine{Helper helper;}
\DoxyCodeLine{...}
\DoxyCodeLine{EXPECT\_CALL(foo, Bar(\_))}
\DoxyCodeLine{    .WillOnce(InvokeArgument<0>(5, ByRef(helper)));}
\DoxyCodeLine{    \textcolor{comment}{// ByRef(helper) guarantees that a reference to helper, not a copy of it,}}
\DoxyCodeLine{    \textcolor{comment}{// will be passed to the callback.}}
\end{DoxyCode}


What if the callable takes an argument by reference and we do {\bfseries{not}} wrap the argument in {\ttfamily By\+Ref()}? Then {\ttfamily Invoke\+Argument()} will {\itshape make a copy} of the argument, and pass a {\itshape reference to the copy}, instead of a reference to the original value, to the callable. This is especially handy when the argument is a temporary value\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{...}
\DoxyCodeLine{MOCK\_METHOD(\textcolor{keywordtype}{bool}, DoThat, (\textcolor{keywordtype}{bool} (*f)(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& x, \textcolor{keyword}{const} \textcolor{keywordtype}{string}\& s)),}
\DoxyCodeLine{            (\textcolor{keyword}{override}));}
\DoxyCodeLine{...}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::InvokeArgument;}
\DoxyCodeLine{...}
\DoxyCodeLine{MockFoo foo;}
\DoxyCodeLine{...}
\DoxyCodeLine{EXPECT\_CALL(foo, DoThat(\_))}
\DoxyCodeLine{    .WillOnce(InvokeArgument<0>(5.0, \textcolor{keywordtype}{string}(\textcolor{stringliteral}{"Hi"})));}
\DoxyCodeLine{    \textcolor{comment}{// Will execute (*f)(5.0, string("Hi")), where f is the function pointer}}
\DoxyCodeLine{    \textcolor{comment}{// DoThat() receives.  Note that the values 5.0 and string("Hi") are}}
\DoxyCodeLine{    \textcolor{comment}{// temporary and dead once the EXPECT\_CALL() statement finishes.  Yet}}
\DoxyCodeLine{    \textcolor{comment}{// it's fine to perform this action later, since a copy of the values}}
\DoxyCodeLine{    \textcolor{comment}{// are kept inside the InvokeArgument action.}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md74}{}\doxysubsubsection{Ignoring an Action\textquotesingle{}s Result}\label{md__c_autotoc_md74}
Sometimes you have an action that returns {\itshape something}, but you need an action that returns {\ttfamily void} (perhaps you want to use it in a mock function that returns {\ttfamily void}, or perhaps it needs to be used in {\ttfamily Do\+All()} and it\textquotesingle{}s not the last in the list). {\ttfamily Ignore\+Result()} lets you do that. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::DoAll;}
\DoxyCodeLine{using ::testing::IgnoreResult;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int} Process(\textcolor{keyword}{const} MyData\& data);}
\DoxyCodeLine{\textcolor{keywordtype}{string} DoSomething();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Abc, (\textcolor{keyword}{const} MyData\& data), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, Xyz, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  EXPECT\_CALL(foo, Abc(\_))}
\DoxyCodeLine{      \textcolor{comment}{// .WillOnce(Invoke(Process));}}
\DoxyCodeLine{      \textcolor{comment}{// The above line won't compile as Process() returns int but Abc() needs}}
\DoxyCodeLine{      \textcolor{comment}{// to return void.}}
\DoxyCodeLine{      .WillOnce(IgnoreResult(Process));}
\DoxyCodeLine{  EXPECT\_CALL(foo, Xyz())}
\DoxyCodeLine{      .WillOnce(DoAll(IgnoreResult(DoSomething),}
\DoxyCodeLine{                      \textcolor{comment}{// Ignores the string DoSomething() returns.}}
\DoxyCodeLine{                      Return(\textcolor{keyword}{true})));}
\end{DoxyCode}


Note that you {\bfseries{cannot}} use {\ttfamily Ignore\+Result()} on an action that already returns {\ttfamily void}. Doing so will lead to ugly compiler errors.\hypertarget{md__c_SelectingArgs}{}\doxysubsubsection{Selecting an Action\textquotesingle{}s Arguments}\label{md__c_SelectingArgs}
Say you have a mock function {\ttfamily Foo()} that takes seven arguments, and you have a custom action that you want to invoke when {\ttfamily Foo()} is called. Trouble is, the custom action only wants three arguments\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{...}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, Foo,}
\DoxyCodeLine{              (\textcolor{keywordtype}{bool} visible, \textcolor{keyword}{const} \textcolor{keywordtype}{string}\& name, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y,}
\DoxyCodeLine{               (\textcolor{keyword}{const} map<pair<int, int>>), \textcolor{keywordtype}{double}\& weight, \textcolor{keywordtype}{double} min\_weight,}
\DoxyCodeLine{               \textcolor{keywordtype}{double} max\_wight));}
\DoxyCodeLine{...}
\DoxyCodeLine{bool IsVisibleInQuadrant1(\textcolor{keywordtype}{bool} visible, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} visible \&\& x >= 0 \&\& y >= 0;}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo)}
\DoxyCodeLine{      .WillOnce(Invoke(IsVisibleInQuadrant1));  \textcolor{comment}{// Uh, won't compile. :-\/(}}
\end{DoxyCode}


To please the compiler God, you need to define an \char`\"{}adaptor\char`\"{} that has the same signature as {\ttfamily Foo()} and calls the custom action with the right arguments\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{...}
\DoxyCodeLine{bool MyIsVisibleInQuadrant1(\textcolor{keywordtype}{bool} visible, \textcolor{keyword}{const} \textcolor{keywordtype}{string}\& name, \textcolor{keywordtype}{int} x, \textcolor{keywordtype}{int} y,}
\DoxyCodeLine{                            \textcolor{keyword}{const} map<pair<int, int>, \textcolor{keywordtype}{double}>\& weight,}
\DoxyCodeLine{                            \textcolor{keywordtype}{double} min\_weight, \textcolor{keywordtype}{double} max\_wight) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} IsVisibleInQuadrant1(visible, x, y);}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo)}
\DoxyCodeLine{      .WillOnce(Invoke(MyIsVisibleInQuadrant1));  \textcolor{comment}{// Now it works.}}
\end{DoxyCode}


But isn\textquotesingle{}t this awkward?

g\+Mock provides a generic {\itshape action adaptor}, so you can spend your time minding more important business than writing your own adaptors. Here\textquotesingle{}s the syntax\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{WithArgs<N1, N2, ..., Nk>(action)}
\end{DoxyCode}


creates an action that passes the arguments of the mock function at the given indices (0-\/based) to the inner {\ttfamily action} and performs it. Using {\ttfamily With\+Args}, our original example can be written as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{using ::testing::WithArgs;}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo)}
\DoxyCodeLine{      .WillOnce(WithArgs<0, 2, 3>(Invoke(IsVisibleInQuadrant1)));  \textcolor{comment}{// No need to define your own adaptor.}}
\end{DoxyCode}


For better readability, g\+Mock also gives you\+:


\begin{DoxyItemize}
\item {\ttfamily Without\+Args(action)} when the inner {\ttfamily action} takes {\itshape no} argument, and
\item {\ttfamily With\+Arg$<$N$>$(action)} (no {\ttfamily s} after {\ttfamily Arg}) when the inner {\ttfamily action} takes {\itshape one} argument.
\end{DoxyItemize}

As you may have realized, {\ttfamily Invoke\+Without\+Args(...)} is just syntactic sugar for {\ttfamily Without\+Args(\+Invoke(...))}.

Here are more tips\+:


\begin{DoxyItemize}
\item The inner action used in {\ttfamily With\+Args} and friends does not have to be {\ttfamily Invoke()} -- it can be anything.
\item You can repeat an argument in the argument list if necessary, e.\+g. {\ttfamily With\+Args$<$2, 3, 3, 5$>$(...)}.
\item You can change the order of the arguments, e.\+g. {\ttfamily With\+Args$<$3, 2, 1$>$(...)}.
\item The types of the selected arguments do {\itshape not} have to match the signature of the inner action exactly. It works as long as they can be implicitly converted to the corresponding arguments of the inner action. For example, if the 4-\/th argument of the mock function is an {\ttfamily int} and {\ttfamily my\+\_\+action} takes a {\ttfamily double}, {\ttfamily With\+Arg$<$4$>$(my\+\_\+action)} will work.
\end{DoxyItemize}\hypertarget{md__c_autotoc_md75}{}\doxysubsubsection{Ignoring Arguments in Action Functions}\label{md__c_autotoc_md75}
The \href{\#SelectingArgs}{\texttt{ selecting-\/an-\/action\textquotesingle{}s-\/arguments}} recipe showed us one way to make a mock function and an action with incompatible argument lists fit together. The downside is that wrapping the action in {\ttfamily With\+Args$<$...$>$()} can get tedious for people writing the tests.

If you are defining a function (or method, functor, lambda, callback) to be used with {\ttfamily Invoke$\ast$()}, and you are not interested in some of its arguments, an alternative to {\ttfamily With\+Args} is to declare the uninteresting arguments as {\ttfamily Unused}. This makes the definition less cluttered and less fragile in case the types of the uninteresting arguments change. It could also increase the chance the action function can be reused. For example, given


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{ MOCK\_METHOD(\textcolor{keywordtype}{double}, Foo, \textcolor{keywordtype}{double}(\textcolor{keyword}{const} \textcolor{keywordtype}{string}\& label, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y),}
\DoxyCodeLine{             (\textcolor{keyword}{override}));}
\DoxyCodeLine{ MOCK\_METHOD(\textcolor{keywordtype}{double}, Bar, (\textcolor{keywordtype}{int} index, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y), (\textcolor{keyword}{override}));}
\end{DoxyCode}


instead of


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{double} DistanceToOriginWithLabel(\textcolor{keyword}{const} \textcolor{keywordtype}{string}\& label, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} sqrt(x*x + y*y);}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{keywordtype}{double} DistanceToOriginWithIndex(\textcolor{keywordtype}{int} index, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} sqrt(x*x + y*y);}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(\textcolor{stringliteral}{"abc"}, \_, \_))}
\DoxyCodeLine{      .WillOnce(Invoke(DistanceToOriginWithLabel));}
\DoxyCodeLine{  EXPECT\_CALL(mock, Bar(5, \_, \_))}
\DoxyCodeLine{      .WillOnce(Invoke(DistanceToOriginWithIndex));}
\end{DoxyCode}


you could write


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Invoke;}
\DoxyCodeLine{using ::testing::Unused;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{double} DistanceToOrigin(Unused, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} sqrt(x*x + y*y);}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo(\textcolor{stringliteral}{"abc"}, \_, \_))}
\DoxyCodeLine{      .WillOnce(Invoke(DistanceToOrigin));}
\DoxyCodeLine{  EXPECT\_CALL(mock, Bar(5, \_, \_))}
\DoxyCodeLine{      .WillOnce(Invoke(DistanceToOrigin));}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md76}{}\doxysubsubsection{Sharing Actions}\label{md__c_autotoc_md76}
Just like matchers, a g\+Mock action object consists of a pointer to a ref-\/counted implementation object. Therefore copying actions is also allowed and very efficient. When the last action that references the implementation object dies, the implementation object will be deleted.

If you have some complex action that you want to use again and again, you may not have to build it from scratch everytime. If the action doesn\textquotesingle{}t have an internal state (i.\+e. if it always does the same thing no matter how many times it has been called), you can assign it to an action variable and use that variable repeatedly. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Action;}
\DoxyCodeLine{using ::testing::DoAll;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{using ::testing::SetArgPointee;}
\DoxyCodeLine{...}
\DoxyCodeLine{  Action<bool(\textcolor{keywordtype}{int}*)> set\_flag = DoAll(SetArgPointee<0>(5),}
\DoxyCodeLine{                                      Return(\textcolor{keyword}{true}));}
\DoxyCodeLine{  ... use set\_flag in .WillOnce() and .WillRepeatedly() ...}
\end{DoxyCode}


However, if the action has its own state, you may be surprised if you share the action object. Suppose you have an action factory {\ttfamily Increment\+Counter(init)} which creates an action that increments and returns a counter whose initial value is {\ttfamily init}, using two actions created from the same expression and using a shared action will exhibit different behaviors. Example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(foo, DoThis())}
\DoxyCodeLine{    .WillRepeatedly(IncrementCounter(0));}
\DoxyCodeLine{EXPECT\_CALL(foo, DoThat())}
\DoxyCodeLine{    .WillRepeatedly(IncrementCounter(0));}
\DoxyCodeLine{foo.DoThis();  \textcolor{comment}{// Returns 1.}}
\DoxyCodeLine{foo.DoThis();  \textcolor{comment}{// Returns 2.}}
\DoxyCodeLine{foo.DoThat();  \textcolor{comment}{// Returns 1 -\/ Blah() uses a different}}
\DoxyCodeLine{               \textcolor{comment}{// counter than Bar()'s.}}
\end{DoxyCode}


versus


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Action;}
\DoxyCodeLine{...}
\DoxyCodeLine{  Action<int()> increment = IncrementCounter(0);}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis())}
\DoxyCodeLine{      .WillRepeatedly(increment);}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThat())}
\DoxyCodeLine{      .WillRepeatedly(increment);}
\DoxyCodeLine{  foo.DoThis();  \textcolor{comment}{// Returns 1.}}
\DoxyCodeLine{  foo.DoThis();  \textcolor{comment}{// Returns 2.}}
\DoxyCodeLine{  foo.DoThat();  \textcolor{comment}{// Returns 3 -\/ the counter is shared.}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md77}{}\doxysubsubsection{Testing Asynchronous Behavior}\label{md__c_autotoc_md77}
One oft-\/encountered problem with g\+Mock is that it can be hard to test asynchronous behavior. Suppose you had a {\ttfamily Event\+Queue} class that you wanted to test, and you created a separate {\ttfamily Event\+Dispatcher} interface so that you could easily mock it out. However, the implementation of the class fired all the events on a background thread, which made test timings difficult. You could just insert {\ttfamily sleep()} statements and hope for the best, but that makes your test behavior nondeterministic. A better way is to use g\+Mock actions and {\ttfamily Notification} objects to force your asynchronous test to behave synchronously.


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::DoAll;}
\DoxyCodeLine{using ::testing::InvokeWithoutArgs;}
\DoxyCodeLine{using ::testing::Return;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockEventDispatcher : \textcolor{keyword}{public} EventDispatcher \{}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, DispatchEvent, (int32), (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{ACTION\_P(Notify, notification) \{}
\DoxyCodeLine{  notification-\/>Notify();}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(EventQueueTest, EnqueueEventTest) \{}
\DoxyCodeLine{  MockEventDispatcher mock\_event\_dispatcher;}
\DoxyCodeLine{  EventQueue event\_queue(\&mock\_event\_dispatcher);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{const} int32 kEventId = 321;}
\DoxyCodeLine{  Notification done;}
\DoxyCodeLine{  EXPECT\_CALL(mock\_event\_dispatcher, DispatchEvent(kEventId))}
\DoxyCodeLine{      .WillOnce(Notify(\&done));}
\DoxyCodeLine{}
\DoxyCodeLine{  event\_queue.EnqueueEvent(kEventId);}
\DoxyCodeLine{  done.WaitForNotification();}
\DoxyCodeLine{\}}
\end{DoxyCode}


In the example above, we set our normal g\+Mock expectations, but then add an additional action to notify the {\ttfamily Notification} object. Now we can just call {\ttfamily Notification\+::\+Wait\+For\+Notification()} in the main thread to wait for the asynchronous call to finish. After that, our test suite is complete and we can safely exit.

Note\+: this example has a downside\+: namely, if the expectation is not satisfied, our test will run forever. It will eventually time-\/out and fail, but it will take longer and be slightly harder to debug. To alleviate this problem, you can use {\ttfamily Wait\+For\+Notification\+With\+Timeout(ms)} instead of {\ttfamily Wait\+For\+Notification()}.\hypertarget{md__c_autotoc_md78}{}\doxysubsection{Misc Recipes on Using g\+Mock}\label{md__c_autotoc_md78}
\hypertarget{md__c_autotoc_md79}{}\doxysubsubsection{Mocking Methods That Use Move-\/\+Only Types}\label{md__c_autotoc_md79}
C++11 introduced {\itshape move-\/only types}. A move-\/only-\/typed value can be moved from one object to another, but cannot be copied. {\ttfamily std\+::unique\+\_\+ptr$<$T$>$} is probably the most commonly used move-\/only type.

Mocking a method that takes and/or returns move-\/only types presents some challenges, but nothing insurmountable. This recipe shows you how you can do it. Note that the support for move-\/only method arguments was only introduced to g\+Mock in April 2017; in older code, you may find more complex \href{\#LegacyMoveOnly}{\texttt{ workarounds}} for lack of this feature.

Lets say we are working on a fictional project that lets one post and share snippets called buzzes. Your code uses these types\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{enum class} AccessLevel \{ kInternal, kPublic \};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }Buzz \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{explicit} Buzz(AccessLevel access) \{ ... \}}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }Buzzer \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~Buzzer() \{\}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} std::unique\_ptr<Buzz> MakeBuzz(StringPiece text) = 0;}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} ShareBuzz(std::unique\_ptr<Buzz> buzz, int64\_t timestamp) = 0;}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


A {\ttfamily Buzz} object represents a snippet being posted. A class that implements the {\ttfamily Buzzer} interface is capable of creating and sharing {\ttfamily Buzz}es. Methods in {\ttfamily Buzzer} may return a {\ttfamily unique\+\_\+ptr$<$Buzz$>$} or take a {\ttfamily unique\+\_\+ptr$<$Buzz$>$}. Now we need to mock {\ttfamily Buzzer} in our tests.

To mock a method that accepts or returns move-\/only types, you just use the familiar {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} syntax as usual\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockBuzzer : \textcolor{keyword}{public} Buzzer \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(std::unique\_ptr<Buzz>, MakeBuzz, (StringPiece text), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, ShareBuzz, (std::unique\_ptr<Buzz> buzz, int64\_t timestamp),}
\DoxyCodeLine{              (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\end{DoxyCode}


Now that we have the mock class defined, we can use it in tests. In the following code examples, we assume that we have defined a {\ttfamily Mock\+Buzzer} object named {\ttfamily mock\+\_\+buzzer\+\_\+}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MockBuzzer mock\_buzzer\_;}
\end{DoxyCode}


First lets see how we can set expectations on the {\ttfamily Make\+Buzz()} method, which returns a {\ttfamily unique\+\_\+ptr$<$Buzz$>$}.

As usual, if you set an expectation without an action (i.\+e. the {\ttfamily .Will\+Once()} or {\ttfamily .Will\+Repeatedly()} clause), when that expectation fires, the default action for that method will be taken. Since {\ttfamily unique\+\_\+ptr$<$$>$} has a default constructor that returns a null {\ttfamily unique\+\_\+ptr}, thats what youll get if you dont specify an action\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Use the default action.}}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, MakeBuzz(\textcolor{stringliteral}{"hello"}));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Triggers the previous EXPECT\_CALL.}}
\DoxyCodeLine{EXPECT\_EQ(\textcolor{keyword}{nullptr}, mock\_buzzer\_.MakeBuzz(\textcolor{stringliteral}{"hello"}));}
\end{DoxyCode}


If you are not happy with the default action, you can tweak it as usual; see \href{\#OnCall}{\texttt{ Setting Default Actions}}.

If you just need to return a pre-\/defined move-\/only value, you can use the {\ttfamily Return(\+By\+Move(...))} action\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// When this fires, the unique\_ptr<> specified by ByMove(...) will}}
\DoxyCodeLine{\textcolor{comment}{// be returned.}}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, MakeBuzz(\textcolor{stringliteral}{"world"}))}
\DoxyCodeLine{    .WillOnce(Return(ByMove(MakeUnique<Buzz>(AccessLevel::kInternal))));}
\DoxyCodeLine{}
\DoxyCodeLine{EXPECT\_NE(\textcolor{keyword}{nullptr}, mock\_buzzer\_.MakeBuzz(\textcolor{stringliteral}{"world"}));}
\end{DoxyCode}


Note that {\ttfamily By\+Move()} is essential here -\/ if you drop it, the code wont compile.

Quiz time! What do you think will happen if a {\ttfamily Return(\+By\+Move(...))} action is performed more than once (e.\+g. you write {\ttfamily ... .Will\+Repeatedly(Return(\+By\+Move(...)));})? Come think of it, after the first time the action runs, the source value will be consumed (since its a move-\/only value), so the next time around, theres no value to move from -- youll get a run-\/time error that {\ttfamily Return(\+By\+Move(...))} can only be run once.

If you need your mock method to do more than just moving a pre-\/defined value, remember that you can always use a lambda or a callable object, which can do pretty much anything you want\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, MakeBuzz(\textcolor{stringliteral}{"x"}))}
\DoxyCodeLine{    .WillRepeatedly([](StringPiece text) \{}
\DoxyCodeLine{      \textcolor{keywordflow}{return} MakeUnique<Buzz>(AccessLevel::kInternal);}
\DoxyCodeLine{    \});}
\DoxyCodeLine{}
\DoxyCodeLine{EXPECT\_NE(\textcolor{keyword}{nullptr}, mock\_buzzer\_.MakeBuzz(\textcolor{stringliteral}{"x"}));}
\DoxyCodeLine{EXPECT\_NE(\textcolor{keyword}{nullptr}, mock\_buzzer\_.MakeBuzz(\textcolor{stringliteral}{"x"}));}
\end{DoxyCode}


Every time this {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} fires, a new {\ttfamily unique\+\_\+ptr$<$Buzz$>$} will be created and returned. You cannot do this with {\ttfamily Return(\+By\+Move(...))}.

That covers returning move-\/only values; but how do we work with methods accepting move-\/only arguments? The answer is that they work normally, although some actions will not compile when any of method\textquotesingle{}s arguments are move-\/only. You can always use {\ttfamily Return}, or a \href{\#FunctionsAsActions}{\texttt{ lambda or functor}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Unused;}
\DoxyCodeLine{}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, ShareBuzz(NotNull(), \_)).WillOnce(Return(\textcolor{keyword}{true}));}
\DoxyCodeLine{EXPECT\_TRUE(mock\_buzzer\_.ShareBuzz(MakeUnique<Buzz>(AccessLevel::kInternal)),}
\DoxyCodeLine{            0);}
\DoxyCodeLine{}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, ShareBuzz(\_, \_)).WillOnce(}
\DoxyCodeLine{    [](std::unique\_ptr<Buzz> buzz, Unused) \{ \textcolor{keywordflow}{return} buzz != \textcolor{keyword}{nullptr}; \});}
\DoxyCodeLine{EXPECT\_FALSE(mock\_buzzer\_.ShareBuzz(\textcolor{keyword}{nullptr}, 0));}
\end{DoxyCode}


Many built-\/in actions ({\ttfamily With\+Args}, {\ttfamily Without\+Args},{\ttfamily Delete\+Arg}, {\ttfamily Save\+Arg}, ...) could in principle support move-\/only arguments, but the support for this is not implemented yet. If this is blocking you, please file a bug.

A few actions (e.\+g. {\ttfamily Do\+All}) copy their arguments internally, so they can never work with non-\/copyable objects; you\textquotesingle{}ll have to use functors instead.\hypertarget{md__c_LegacyMoveOnly}{}\doxyparagraph{Legacy workarounds for move-\/only types}\label{md__c_LegacyMoveOnly}
Support for move-\/only function arguments was only introduced to g\+Mock in April
\begin{DoxyEnumerate}
\item In older code, you may encounter the following workaround for the lack of this feature (it is no longer necessary -\/ we\textquotesingle{}re including it just for reference)\+:
\end{DoxyEnumerate}


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockBuzzer : \textcolor{keyword}{public} Buzzer \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, DoShareBuzz, (Buzz* buzz, Time timestamp));}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} ShareBuzz(std::unique\_ptr<Buzz> buzz, Time timestamp)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} DoShareBuzz(buzz.get(), timestamp);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


The trick is to delegate the {\ttfamily Share\+Buzz()} method to a mock method (lets call it {\ttfamily Do\+Share\+Buzz()}) that does not take move-\/only parameters. Then, instead of setting expectations on {\ttfamily Share\+Buzz()}, you set them on the {\ttfamily Do\+Share\+Buzz()} mock method\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MockBuzzer mock\_buzzer\_;}
\DoxyCodeLine{EXPECT\_CALL(mock\_buzzer\_, DoShareBuzz(NotNull(), \_));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// When one calls ShareBuzz() on the MockBuzzer like this, the call is}}
\DoxyCodeLine{\textcolor{comment}{// forwarded to DoShareBuzz(), which is mocked.  Therefore this statement}}
\DoxyCodeLine{\textcolor{comment}{// will trigger the above EXPECT\_CALL.}}
\DoxyCodeLine{mock\_buzzer\_.ShareBuzz(MakeUnique<Buzz>(AccessLevel::kInternal), 0);}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md80}{}\doxysubsubsection{Making the Compilation Faster}\label{md__c_autotoc_md80}
Believe it or not, the {\itshape vast majority} of the time spent on compiling a mock class is in generating its constructor and destructor, as they perform non-\/trivial tasks (e.\+g. verification of the expectations). What\textquotesingle{}s more, mock methods with different signatures have different types and thus their constructors/destructors need to be generated by the compiler separately. As a result, if you mock many different types of methods, compiling your mock class can get really slow.

If you are experiencing slow compilation, you can move the definition of your mock class\textquotesingle{} constructor and destructor out of the class body and into a {\ttfamily .cc} file. This way, even if you {\ttfamily \#include} your mock class in N files, the compiler only needs to generate its constructor and destructor once, resulting in a much faster compilation.

Let\textquotesingle{}s illustrate the idea using an example. Here\textquotesingle{}s the definition of a mock class before applying this recipe\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// File mock\_foo.h.}}
\DoxyCodeLine{...}
\DoxyCodeLine{class MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{comment}{// Since we don't declare the constructor or the destructor,}}
\DoxyCodeLine{  \textcolor{comment}{// the compiler will generate them in every translation unit}}
\DoxyCodeLine{  \textcolor{comment}{// where this mock class is used.}}
\DoxyCodeLine{}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, DoThis, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, DoThat, (\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  ... more mock methods ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


After the change, it would look like\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// File mock\_foo.h.}}
\DoxyCodeLine{...}
\DoxyCodeLine{class MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{comment}{// The constructor and destructor are declared, but not defined, here.}}
\DoxyCodeLine{  MockFoo();}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~MockFoo();}
\DoxyCodeLine{}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, DoThis, (), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{bool}, DoThat, (\textcolor{keyword}{const} \textcolor{keywordtype}{char}* str), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  ... more mock methods ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


and


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// File mock\_foo.cc.}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "path/to/mock\_foo.h"}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The definitions may appear trivial, but the functions actually do a}}
\DoxyCodeLine{\textcolor{comment}{// lot of things through the constructors/destructors of the member}}
\DoxyCodeLine{\textcolor{comment}{// variables used to implement the mock methods.}}
\DoxyCodeLine{MockFoo::MockFoo() \{\}}
\DoxyCodeLine{MockFoo::~MockFoo() \{\}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md81}{}\doxysubsubsection{Forcing a Verification}\label{md__c_autotoc_md81}
When it\textquotesingle{}s being destroyed, your friendly mock object will automatically verify that all expectations on it have been satisfied, and will generate googletest failures if not. This is convenient as it leaves you with one less thing to worry about. That is, unless you are not sure if your mock object will be destroyed.

How could it be that your mock object won\textquotesingle{}t eventually be destroyed? Well, it might be created on the heap and owned by the code you are testing. Suppose there\textquotesingle{}s a bug in that code and it doesn\textquotesingle{}t delete the mock object properly -\/ you could end up with a passing test when there\textquotesingle{}s actually a bug.

Using a heap checker is a good idea and can alleviate the concern, but its implementation is not 100\% reliable. So, sometimes you do want to {\itshape force} g\+Mock to verify a mock object before it is (hopefully) destructed. You can do this with {\ttfamily Mock\+::\+Verify\+And\+Clear\+Expectations(\&mock\+\_\+object)}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{TEST(MyServerTest, ProcessesRequest) \{}
\DoxyCodeLine{  using ::testing::Mock;}
\DoxyCodeLine{}
\DoxyCodeLine{  MockFoo* \textcolor{keyword}{const} foo = \textcolor{keyword}{new} MockFoo;}
\DoxyCodeLine{  EXPECT\_CALL(*foo, ...)...;}
\DoxyCodeLine{  \textcolor{comment}{// ... other expectations ...}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// server now owns foo.}}
\DoxyCodeLine{  MyServer server(foo);}
\DoxyCodeLine{  server.ProcessRequest(...);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// In case that server's destructor will forget to delete foo,}}
\DoxyCodeLine{  \textcolor{comment}{// this will verify the expectations anyway.}}
\DoxyCodeLine{  Mock::VerifyAndClearExpectations(foo);}
\DoxyCodeLine{\}  \textcolor{comment}{// server is destroyed when it goes out of scope here.}}
\end{DoxyCode}


{\bfseries{Tip\+:}} The {\ttfamily Mock\+::\+Verify\+And\+Clear\+Expectations()} function returns a {\ttfamily bool} to indicate whether the verification was successful ({\ttfamily true} for yes), so you can wrap that function call inside a {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+R\+U\+E()} if there is no point going further when the verification has failed.\hypertarget{md__c_UsingCheckPoints}{}\doxysubsubsection{Using Check Points}\label{md__c_UsingCheckPoints}
Sometimes you may want to \char`\"{}reset\char`\"{} a mock object at various check points in your test\+: at each check point, you verify that all existing expectations on the mock object have been satisfied, and then you set some new expectations on it as if it\textquotesingle{}s newly created. This allows you to work with a mock object in \char`\"{}phases\char`\"{} whose sizes are each manageable.

One such scenario is that in your test\textquotesingle{}s {\ttfamily Set\+Up()} function, you may want to put the object you are testing into a certain state, with the help from a mock object. Once in the desired state, you want to clear all expectations on the mock, such that in the {\ttfamily T\+E\+S\+T\+\_\+F} body you can set fresh expectations on it.

As you may have figured out, the {\ttfamily Mock\+::\+Verify\+And\+Clear\+Expectations()} function we saw in the previous recipe can help you here. Or, if you are using {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} to set default actions on the mock object and want to clear the default actions as well, use {\ttfamily Mock\+::\+Verify\+And\+Clear(\&mock\+\_\+object)} instead. This function does what {\ttfamily Mock\+::\+Verify\+And\+Clear\+Expectations(\&mock\+\_\+object)} does and returns the same {\ttfamily bool}, {\bfseries{plus}} it clears the {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} statements on {\ttfamily mock\+\_\+object} too.

Another trick you can use to achieve the same effect is to put the expectations in sequences and insert calls to a dummy \char`\"{}check-\/point\char`\"{} function at specific places. Then you can verify that the mock function calls do happen at the right time. For example, if you are exercising code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Foo(1);}
\DoxyCodeLine{Foo(2);}
\DoxyCodeLine{Foo(3);}
\end{DoxyCode}


and want to verify that {\ttfamily Foo(1)} and {\ttfamily Foo(3)} both invoke {\ttfamily mock.\+Bar(\char`\"{}a\char`\"{})}, but {\ttfamily Foo(2)} doesn\textquotesingle{}t invoke anything. You can write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::MockFunction;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(FooTest, InvokesBarCorrectly) \{}
\DoxyCodeLine{  MyMock mock;}
\DoxyCodeLine{  \textcolor{comment}{// Class MockFunction<F> has exactly one mock method.  It is named}}
\DoxyCodeLine{  \textcolor{comment}{// Call() and has type F.}}
\DoxyCodeLine{  MockFunction<void(\textcolor{keywordtype}{string} check\_point\_name)> check;}
\DoxyCodeLine{  \{}
\DoxyCodeLine{    InSequence s;}
\DoxyCodeLine{}
\DoxyCodeLine{    EXPECT\_CALL(mock, Bar(\textcolor{stringliteral}{"a"}));}
\DoxyCodeLine{    EXPECT\_CALL(check, Call(\textcolor{stringliteral}{"1"}));}
\DoxyCodeLine{    EXPECT\_CALL(check, Call(\textcolor{stringliteral}{"2"}));}
\DoxyCodeLine{    EXPECT\_CALL(mock, Bar(\textcolor{stringliteral}{"a"}));}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  Foo(1);}
\DoxyCodeLine{  check.Call(\textcolor{stringliteral}{"1"});}
\DoxyCodeLine{  Foo(2);}
\DoxyCodeLine{  check.Call(\textcolor{stringliteral}{"2"});}
\DoxyCodeLine{  Foo(3);}
\DoxyCodeLine{\}}
\end{DoxyCode}


The expectation spec says that the first {\ttfamily Bar(\char`\"{}a\char`\"{})} must happen before check point \char`\"{}1\char`\"{}, the second {\ttfamily Bar(\char`\"{}a\char`\"{})} must happen after check point \char`\"{}2\char`\"{}, and nothing should happen between the two check points. The explicit check points make it easy to tell which {\ttfamily Bar(\char`\"{}a\char`\"{})} is called by which call to {\ttfamily Foo()}.\hypertarget{md__c_autotoc_md82}{}\doxysubsubsection{Mocking Destructors}\label{md__c_autotoc_md82}
Sometimes you want to make sure a mock object is destructed at the right time, e.\+g. after {\ttfamily bar-\/$>$A()} is called but before {\ttfamily bar-\/$>$B()} is called. We already know that you can specify constraints on the \href{\#OrderedCalls}{\texttt{ order}} of mock function calls, so all we need to do is to mock the destructor of the mock function.

This sounds simple, except for one problem\+: a destructor is a special function with special syntax and special semantics, and the {\ttfamily M\+O\+C\+K\+\_\+\+M\+E\+T\+H\+OD} macro doesn\textquotesingle{}t work for it\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MOCK\_METHOD(\textcolor{keywordtype}{void}, ~MockFoo, ());  \textcolor{comment}{// Won't compile!}}
\end{DoxyCode}


The good news is that you can use a simple pattern to achieve the same effect. First, add a mock function {\ttfamily Die()} to your mock class and call it in the destructor, like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{comment}{// Add the following two lines to the mock class.}}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, Die, ());}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~MockFoo() \{ Die(); \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


(If the name {\ttfamily Die()} clashes with an existing symbol, choose another name.) Now, we have translated the problem of testing when a {\ttfamily \mbox{\hyperlink{class_mock_foo}{Mock\+Foo}}} object dies to testing when its {\ttfamily Die()} method is called\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MockFoo* foo = \textcolor{keyword}{new} MockFoo;}
\DoxyCodeLine{MockBar* bar = \textcolor{keyword}{new} MockBar;}
\DoxyCodeLine{...}
\DoxyCodeLine{\{}
\DoxyCodeLine{  InSequence s;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Expects *foo to die after bar-\/>A() and before bar-\/>B().}}
\DoxyCodeLine{  EXPECT\_CALL(*bar, A());}
\DoxyCodeLine{  EXPECT\_CALL(*foo, Die());}
\DoxyCodeLine{  EXPECT\_CALL(*bar, B());}
\DoxyCodeLine{\}}
\end{DoxyCode}


And that\textquotesingle{}s that.\hypertarget{md__c_UsingThreads}{}\doxysubsubsection{Using g\+Mock and Threads}\label{md__c_UsingThreads}
In a {\bfseries{unit}} test, it\textquotesingle{}s best if you could isolate and test a piece of code in a single-\/threaded context. That avoids race conditions and dead locks, and makes debugging your test much easier.

Yet most programs are multi-\/threaded, and sometimes to test something we need to pound on it from more than one thread. g\+Mock works for this purpose too.

Remember the steps for using a mock\+:


\begin{DoxyEnumerate}
\item Create a mock object {\ttfamily foo}.
\item Set its default actions and expectations using {\ttfamily O\+N\+\_\+\+C\+A\+L\+L()} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+L\+L()}.
\item The code under test calls methods of {\ttfamily foo}.
\item Optionally, verify and reset the mock.
\item Destroy the mock yourself, or let the code under test destroy it. The destructor will automatically verify it.
\end{DoxyEnumerate}

If you follow the following simple rules, your mocks and threads can live happily together\+:


\begin{DoxyItemize}
\item Execute your {\itshape test code} (as opposed to the code being tested) in {\itshape one} thread. This makes your test easy to follow.
\item Obviously, you can do step \#1 without locking.
\item When doing step \#2 and \#5, make sure no other thread is accessing {\ttfamily foo}. Obvious too, huh?
\item \#3 and \#4 can be done either in one thread or in multiple threads -\/ anyway you want. g\+Mock takes care of the locking, so you don\textquotesingle{}t have to do any -\/ unless required by your test logic.
\end{DoxyItemize}

If you violate the rules (for example, if you set expectations on a mock while another thread is calling its methods), you get undefined behavior. That\textquotesingle{}s not fun, so don\textquotesingle{}t do it.

g\+Mock guarantees that the action for a mock function is done in the same thread that called the mock function. For example, in


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_CALL(mock, Foo(1))}
\DoxyCodeLine{    .WillOnce(action1);}
\DoxyCodeLine{EXPECT\_CALL(mock, Foo(2))}
\DoxyCodeLine{    .WillOnce(action2);}
\end{DoxyCode}


if {\ttfamily Foo(1)} is called in thread 1 and {\ttfamily Foo(2)} is called in thread 2, g\+Mock will execute {\ttfamily action1} in thread 1 and {\ttfamily action2} in thread 2.

g\+Mock does {\itshape not} impose a sequence on actions performed in different threads (doing so may create deadlocks as the actions may need to cooperate). This means that the execution of {\ttfamily action1} and {\ttfamily action2} in the above example {\itshape may} interleave. If this is a problem, you should add proper synchronization logic to {\ttfamily action1} and {\ttfamily action2} to make the test thread-\/safe.

Also, remember that {\ttfamily Default\+Value$<$T$>$} is a global resource that potentially affects {\itshape all} living mock objects in your program. Naturally, you won\textquotesingle{}t want to mess with it from multiple threads or when there still are mocks in action.\hypertarget{md__c_autotoc_md83}{}\doxysubsubsection{Controlling How Much Information g\+Mock Prints}\label{md__c_autotoc_md83}
When g\+Mock sees something that has the potential of being an error (e.\+g. a mock function with no expectation is called, a.\+k.\+a. an uninteresting call, which is allowed but perhaps you forgot to explicitly ban the call), it prints some warning messages, including the arguments of the function, the return value, and the stack trace. Hopefully this will remind you to take a look and see if there is indeed a problem.

Sometimes you are confident that your tests are correct and may not appreciate such friendly messages. Some other times, you are debugging your tests or learning about the behavior of the code you are testing, and wish you could observe every mock call that happens (including argument values, the return value, and the stack trace). Clearly, one size doesn\textquotesingle{}t fit all.

You can control how much g\+Mock tells you using the {\ttfamily -\/-\/gmock\+\_\+verbose=L\+E\+V\+EL} command-\/line flag, where {\ttfamily L\+E\+V\+EL} is a string with three possible values\+:


\begin{DoxyItemize}
\item {\ttfamily info}\+: g\+Mock will print all informational messages, warnings, and errors (most verbose). At this setting, g\+Mock will also log any calls to the {\ttfamily O\+N\+\_\+\+C\+A\+L\+L/\+E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} macros. It will include a stack trace in \char`\"{}uninteresting call\char`\"{} warnings.
\item {\ttfamily warning}\+: g\+Mock will print both warnings and errors (less verbose); it will omit the stack traces in \char`\"{}uninteresting call\char`\"{} warnings. This is the default.
\item {\ttfamily error}\+: g\+Mock will print errors only (least verbose).
\end{DoxyItemize}

Alternatively, you can adjust the value of that flag from within your tests like so\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{::testing::FLAGS\_gmock\_verbose = \textcolor{stringliteral}{"error"};}
\end{DoxyCode}


If you find g\+Mock printing too many stack frames with its informational or warning messages, remember that you can control their amount with the {\ttfamily -\/-\/gtest\+\_\+stack\+\_\+trace\+\_\+depth=max\+\_\+depth} flag.

Now, judiciously use the right flag to enable g\+Mock serve you better!\hypertarget{md__c_autotoc_md84}{}\doxysubsubsection{Gaining Super Vision into Mock Calls}\label{md__c_autotoc_md84}
You have a test using g\+Mock. It fails\+: g\+Mock tells you some expectations aren\textquotesingle{}t satisfied. However, you aren\textquotesingle{}t sure why\+: Is there a typo somewhere in the matchers? Did you mess up the order of the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}s? Or is the code under test doing something wrong? How can you find out the cause?

Won\textquotesingle{}t it be nice if you have X-\/ray vision and can actually see the trace of all {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}s and mock method calls as they are made? For each call, would you like to see its actual argument values and which {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} g\+Mock thinks it matches? If you still need some help to figure out who made these calls, how about being able to see the complete stack trace at each mock call?

You can unlock this power by running your test with the {\ttfamily -\/-\/gmock\+\_\+verbose=info} flag. For example, given the test program\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "gmock/gmock.h"}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using} testing::\_;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::HasSubstr;}
\DoxyCodeLine{\textcolor{keyword}{using} testing::Return;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{void}, F, (\textcolor{keyword}{const} \textcolor{keywordtype}{string}\& x, \textcolor{keyword}{const} \textcolor{keywordtype}{string}\& y));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Foo, Bar) \{}
\DoxyCodeLine{  MockFoo mock;}
\DoxyCodeLine{  EXPECT\_CALL(mock, F(\_, \_)).WillRepeatedly(Return());}
\DoxyCodeLine{  EXPECT\_CALL(mock, F(\textcolor{stringliteral}{"a"}, \textcolor{stringliteral}{"b"}));}
\DoxyCodeLine{  EXPECT\_CALL(mock, F(\textcolor{stringliteral}{"c"}, HasSubstr(\textcolor{stringliteral}{"d"})));}
\DoxyCodeLine{}
\DoxyCodeLine{  mock.F(\textcolor{stringliteral}{"a"}, \textcolor{stringliteral}{"good"});}
\DoxyCodeLine{  mock.F(\textcolor{stringliteral}{"a"}, \textcolor{stringliteral}{"b"});}
\DoxyCodeLine{\}}
\end{DoxyCode}


if you run it with {\ttfamily -\/-\/gmock\+\_\+verbose=info}, you will see this output\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{[ RUN       ] Foo.Bar}
\DoxyCodeLine{}
\DoxyCodeLine{foo\_test.cc:14: EXPECT\_CALL(mock, F(\_, \_)) invoked}
\DoxyCodeLine{Stack trace: ...}
\DoxyCodeLine{}
\DoxyCodeLine{foo\_test.cc:15: EXPECT\_CALL(mock, F("a", "b")) invoked}
\DoxyCodeLine{Stack trace: ...}
\DoxyCodeLine{}
\DoxyCodeLine{foo\_test.cc:16: EXPECT\_CALL(mock, F("c", HasSubstr("d"))) invoked}
\DoxyCodeLine{Stack trace: ...}
\DoxyCodeLine{}
\DoxyCodeLine{foo\_test.cc:14: Mock function call matches EXPECT\_CALL(mock, F(\_, \_))...}
\DoxyCodeLine{    Function call: F(@0x7fff7c8dad40"a",@0x7fff7c8dad10"good")}
\DoxyCodeLine{Stack trace: ...}
\DoxyCodeLine{}
\DoxyCodeLine{foo\_test.cc:15: Mock function call matches EXPECT\_CALL(mock, F("a", "b"))...}
\DoxyCodeLine{    Function call: F(@0x7fff7c8dada0"a",@0x7fff7c8dad70"b")}
\DoxyCodeLine{Stack trace: ...}
\DoxyCodeLine{}
\DoxyCodeLine{foo\_test.cc:16: Failure}
\DoxyCodeLine{Actual function call count doesn't match EXPECT\_CALL(mock, F("c", HasSubstr("d")))...}
\DoxyCodeLine{         Expected: to be called once}
\DoxyCodeLine{           Actual: never called -\/ unsatisfied and active}
\DoxyCodeLine{[  FAILED  ] Foo.Bar}
\end{DoxyCode}


Suppose the bug is that the {\ttfamily \char`\"{}c\char`\"{}} in the third {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} is a typo and should actually be {\ttfamily \char`\"{}a\char`\"{}}. With the above message, you should see that the actual {\ttfamily F(\char`\"{}a\char`\"{}, \char`\"{}good\char`\"{})} call is matched by the first {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL}, not the third as you thought. From that it should be obvious that the third {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} is written wrong. Case solved.

If you are interested in the mock call trace but not the stack traces, you can combine {\ttfamily -\/-\/gmock\+\_\+verbose=info} with {\ttfamily -\/-\/gtest\+\_\+stack\+\_\+trace\+\_\+depth=0} on the test command line.\hypertarget{md__c_autotoc_md85}{}\doxysubsubsection{Running Tests in Emacs}\label{md__c_autotoc_md85}
If you build and run your tests in Emacs using the {\ttfamily M-\/x google-\/compile} command (as many googletest users do), the source file locations of g\+Mock and googletest errors will be highlighted. Just press {\ttfamily $<$Enter$>$} on one of them and you\textquotesingle{}ll be taken to the offending line. Or, you can just type {\ttfamily C-\/x}\`{} to jump to the next error.

To make it even easier, you can add the following lines to your {\ttfamily $\sim$/.emacs} file\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{(global-\/set-\/key "\(\backslash\)M-\/m"  'google-\/compile)  ; m is for make}
\DoxyCodeLine{(global-\/set-\/key [M-\/down] 'next-\/error)}
\DoxyCodeLine{(global-\/set-\/key [M-\/up]  '(lambda () (interactive) (next-\/error -\/1)))}
\end{DoxyCode}


Then you can type {\ttfamily M-\/m} to start a build (if you want to run the test as well, just make sure {\ttfamily foo\+\_\+test.\+run} or {\ttfamily runtests} is in the build command you supply after typing {\ttfamily M-\/m}), or {\ttfamily M-\/up}/{\ttfamily M-\/down} to move back and forth between errors.\hypertarget{md__c_autotoc_md86}{}\doxysubsection{Extending g\+Mock}\label{md__c_autotoc_md86}
\hypertarget{md__c_NewMatchers}{}\doxysubsubsection{Writing New Matchers Quickly}\label{md__c_NewMatchers}
W\+A\+R\+N\+I\+NG\+: g\+Mock does not guarantee when or how many times a matcher will be invoked. Therefore, all matchers must be functionally pure. See \href{\#PureMatchers}{\texttt{ this section}} for more details.

The {\ttfamily M\+A\+T\+C\+H\+E\+R$\ast$} family of macros can be used to define custom matchers easily. The syntax\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER(name, description\_string\_expression) \{ statements; \}}
\end{DoxyCode}


will define a matcher with the given name that executes the statements, which must return a {\ttfamily bool} to indicate if the match succeeds. Inside the statements, you can refer to the value being matched by {\ttfamily arg}, and refer to its type by {\ttfamily arg\+\_\+type}.

The {\itshape description string} is a {\ttfamily string}-\/typed expression that documents what the matcher does, and is used to generate the failure message when the match fails. It can (and should) reference the special {\ttfamily bool} variable {\ttfamily negation}, and should evaluate to the description of the matcher when {\ttfamily negation} is {\ttfamily false}, or that of the matcher\textquotesingle{}s negation when {\ttfamily negation} is {\ttfamily true}.

For convenience, we allow the description string to be empty ({\ttfamily \char`\"{}\char`\"{}}), in which case g\+Mock will use the sequence of words in the matcher name as the description.

For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER(IsDivisibleBy7, \textcolor{stringliteral}{""}) \{ \textcolor{keywordflow}{return} (arg \% 7) == 0; \}}
\end{DoxyCode}


allows you to write


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Expects mock\_foo.Bar(n) to be called where n is divisible by 7.}}
\DoxyCodeLine{EXPECT\_CALL(mock\_foo, Bar(IsDivisibleBy7()));}
\end{DoxyCode}


or,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Not;}
\DoxyCodeLine{...}
\DoxyCodeLine{\textcolor{comment}{// Verifies that two values are divisible by 7.}}
\DoxyCodeLine{EXPECT\_THAT(some\_expression, IsDivisibleBy7());}
\DoxyCodeLine{EXPECT\_THAT(some\_other\_expression, Not(IsDivisibleBy7()));}
\end{DoxyCode}


If the above assertions fail, they will print something like\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: some\_expression}
\DoxyCodeLine{Expected: is divisible by 7}
\DoxyCodeLine{  Actual: 27}
\DoxyCodeLine{...}
\DoxyCodeLine{Value of: some\_other\_expression}
\DoxyCodeLine{Expected: not (is divisible by 7)}
\DoxyCodeLine{  Actual: 21}
\end{DoxyCode}


where the descriptions {\ttfamily \char`\"{}is divisible by 7\char`\"{}} and {\ttfamily \char`\"{}not (is divisible by 7)\char`\"{}} are automatically calculated from the matcher name {\ttfamily Is\+Divisible\+By7}.

As you may have noticed, the auto-\/generated descriptions (especially those for the negation) may not be so great. You can always override them with a {\ttfamily string} expression of your own\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER(IsDivisibleBy7,}
\DoxyCodeLine{        absl::StrCat(negation ? \textcolor{stringliteral}{"isn't"} : \textcolor{stringliteral}{"is"}, \textcolor{stringliteral}{" divisible by 7"})) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} (arg \% 7) == 0;}
\DoxyCodeLine{\}}
\end{DoxyCode}


Optionally, you can stream additional information to a hidden argument named {\ttfamily result\+\_\+listener} to explain the match result. For example, a better definition of {\ttfamily Is\+Divisible\+By7} is\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER(IsDivisibleBy7, \textcolor{stringliteral}{""}) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{if} ((arg \% 7) == 0)}
\DoxyCodeLine{    \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{}
\DoxyCodeLine{  *result\_listener << \textcolor{stringliteral}{"the remainder is "} << (arg \% 7);}
\DoxyCodeLine{  \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\}}
\end{DoxyCode}


With this definition, the above assertion will give a better message\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: some\_expression}
\DoxyCodeLine{Expected: is divisible by 7}
\DoxyCodeLine{  Actual: 27 (the remainder is 6)}
\end{DoxyCode}


You should let {\ttfamily Match\+And\+Explain()} print {\itshape any additional information} that can help a user understand the match result. Note that it should explain why the match succeeds in case of a success (unless it\textquotesingle{}s obvious) -\/ this is useful when the matcher is used inside {\ttfamily Not()}. There is no need to print the argument value itself, as g\+Mock already prints it for you.

N\+O\+TE\+: The type of the value being matched ({\ttfamily arg\+\_\+type}) is determined by the context in which you use the matcher and is supplied to you by the compiler, so you don\textquotesingle{}t need to worry about declaring it (nor can you). This allows the matcher to be polymorphic. For example, {\ttfamily Is\+Divisible\+By7()} can be used to match any type where the value of {\ttfamily (arg \% 7) == 0} can be implicitly converted to a {\ttfamily bool}. In the {\ttfamily Bar(\+Is\+Divisible\+By7())} example above, if method {\ttfamily Bar()} takes an {\ttfamily int}, {\ttfamily arg\+\_\+type} will be {\ttfamily int}; if it takes an {\ttfamily unsigned long}, {\ttfamily arg\+\_\+type} will be {\ttfamily unsigned long}; and so on.\hypertarget{md__c_autotoc_md87}{}\doxysubsubsection{Writing New Parameterized Matchers Quickly}\label{md__c_autotoc_md87}
Sometimes you\textquotesingle{}ll want to define a matcher that has parameters. For that you can use the macro\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER\_P(name, param\_name, description\_string) \{ statements; \}}
\end{DoxyCode}


where the description string can be either {\ttfamily \char`\"{}\char`\"{}} or a {\ttfamily string} expression that references {\ttfamily negation} and {\ttfamily param\+\_\+name}.

For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER\_P(HasAbsoluteValue, value, \textcolor{stringliteral}{""}) \{ \textcolor{keywordflow}{return} abs(arg) == value; \}}
\end{DoxyCode}


will allow you to write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{EXPECT\_THAT(Blah(\textcolor{stringliteral}{"a"}), HasAbsoluteValue(n));}
\end{DoxyCode}


which may lead to this message (assuming {\ttfamily n} is 10)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: Blah("a")}
\DoxyCodeLine{Expected: has absolute value 10}
\DoxyCodeLine{  Actual: -\/9}
\end{DoxyCode}


Note that both the matcher description and its parameter are printed, making the message human-\/friendly.

In the matcher definition body, you can write {\ttfamily foo\+\_\+type} to reference the type of a parameter named {\ttfamily foo}. For example, in the body of {\ttfamily M\+A\+T\+C\+H\+E\+R\+\_\+\+P(\+Has\+Absolute\+Value, value)} above, you can write {\ttfamily value\+\_\+type} to refer to the type of {\ttfamily value}.

g\+Mock also provides {\ttfamily M\+A\+T\+C\+H\+E\+R\+\_\+\+P2}, {\ttfamily M\+A\+T\+C\+H\+E\+R\+\_\+\+P3}, ..., up to {\ttfamily M\+A\+T\+C\+H\+E\+R\+\_\+\+P10} to support multi-\/parameter matchers\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER\_Pk(name, param\_1, ..., param\_k, description\_string) \{ statements; \}}
\end{DoxyCode}


Please note that the custom description string is for a particular {\itshape instance} of the matcher, where the parameters have been bound to actual values. Therefore usually you\textquotesingle{}ll want the parameter values to be part of the description. g\+Mock lets you do that by referencing the matcher parameters in the description string expression.

For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::PrintToString;}
\DoxyCodeLine{MATCHER\_P2(InClosedRange, low, hi,}
\DoxyCodeLine{           absl::StrFormat(\textcolor{stringliteral}{"\%s in range [\%s, \%s]"}, negation ? \textcolor{stringliteral}{"isn't"} : \textcolor{stringliteral}{"is"},}
\DoxyCodeLine{                           PrintToString(low), PrintToString(hi))) \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} low <= arg \&\& arg <= hi;}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{EXPECT\_THAT(3, InClosedRange(4, 6));}
\end{DoxyCode}


would generate a failure that contains the message\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Expected: is in range [4, 6]}
\end{DoxyCode}


If you specify {\ttfamily \char`\"{}\char`\"{}} as the description, the failure message will contain the sequence of words in the matcher name followed by the parameter values printed as a tuple. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER\_P2(InClosedRange, low, hi, \textcolor{stringliteral}{""}) \{ ... \}}
\DoxyCodeLine{...}
\DoxyCodeLine{EXPECT\_THAT(3, InClosedRange(4, 6));}
\end{DoxyCode}


would generate a failure that contains the text\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Expected: in closed range (4, 6)}
\end{DoxyCode}


For the purpose of typing, you can view


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER\_Pk(Foo, p1, ..., pk, description\_string) \{ ... \}}
\end{DoxyCode}


as shorthand for


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} p1\_type, ..., \textcolor{keyword}{typename} pk\_type>}
\DoxyCodeLine{FooMatcherPk<p1\_type, ..., pk\_type>}
\DoxyCodeLine{Foo(p1\_type p1, ..., pk\_type pk) \{ ... \}}
\end{DoxyCode}


When you write {\ttfamily Foo(v1, ..., vk)}, the compiler infers the types of the parameters {\ttfamily v1}, ..., and {\ttfamily vk} for you. If you are not happy with the result of the type inference, you can specify the types by explicitly instantiating the template, as in {\ttfamily Foo$<$long, bool$>$(5, false)}. As said earlier, you don\textquotesingle{}t get to (or need to) specify {\ttfamily arg\+\_\+type} as that\textquotesingle{}s determined by the context in which the matcher is used.

You can assign the result of expression {\ttfamily Foo(p1, ..., pk)} to a variable of type {\ttfamily Foo\+Matcher\+Pk$<$p1\+\_\+type, ..., pk\+\_\+type$>$}. This can be useful when composing matchers. Matchers that don\textquotesingle{}t have a parameter or have only one parameter have special types\+: you can assign {\ttfamily Foo()} to a {\ttfamily Foo\+Matcher}-\/typed variable, and assign {\ttfamily Foo(p)} to a {\ttfamily Foo\+MatcherP$<$p\+\_\+type$>$}-\/typed variable.

While you can instantiate a matcher template with reference types, passing the parameters by pointer usually makes your code more readable. If, however, you still want to pass a parameter by reference, be aware that in the failure message generated by the matcher you will see the value of the referenced object but not its address.

You can overload matchers with different numbers of parameters\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{MATCHER\_P(Blah, a, description\_string\_1) \{ ... \}}
\DoxyCodeLine{MATCHER\_P2(Blah, a, b, description\_string\_2) \{ ... \}}
\end{DoxyCode}


While it\textquotesingle{}s tempting to always use the {\ttfamily M\+A\+T\+C\+H\+E\+R$\ast$} macros when defining a new matcher, you should also consider implementing {\ttfamily Matcher\+Interface} or using {\ttfamily Make\+Polymorphic\+Matcher()} instead (see the recipes that follow), especially if you need to use the matcher a lot. While these approaches require more work, they give you more control on the types of the value being matched and the matcher parameters, which in general leads to better compiler error messages that pay off in the long run. They also allow overloading matchers based on parameter types (as opposed to just based on the number of parameters).\hypertarget{md__c_autotoc_md88}{}\doxysubsubsection{Writing New Monomorphic Matchers}\label{md__c_autotoc_md88}
A matcher of argument type {\ttfamily T} implements {\ttfamily \+::testing\+::\+Matcher\+Interface$<$T$>$} and does two things\+: it tests whether a value of type {\ttfamily T} matches the matcher, and can describe what kind of values it matches. The latter ability is used for generating readable error messages when expectations are violated.

The interface looks like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }MatchResultListener \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  \textcolor{comment}{// Streams x to the underlying ostream; does nothing if the ostream}}
\DoxyCodeLine{  \textcolor{comment}{// is NULL.}}
\DoxyCodeLine{  \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{  MatchResultListener\& operator<<(\textcolor{keyword}{const} T\& x);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Returns the underlying ostream.}}
\DoxyCodeLine{  ::std::ostream* stream();}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{\textcolor{keyword}{class }MatcherInterface \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~MatcherInterface();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Returns true if the matcher matches x; also explains the match}}
\DoxyCodeLine{  \textcolor{comment}{// result to 'listener'.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} MatchAndExplain(T x, MatchResultListener* listener) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Describes this matcher to an ostream.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} DescribeTo(::std::ostream* os) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Describes the negation of this matcher to an ostream.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} DescribeNegationTo(::std::ostream* os) \textcolor{keyword}{const};}
\DoxyCodeLine{\};}
\end{DoxyCode}


If you need a custom matcher but {\ttfamily Truly()} is not a good option (for example, you may not be happy with the way {\ttfamily Truly(predicate)} describes itself, or you may want your matcher to be polymorphic as {\ttfamily Eq(value)} is), you can define a matcher to do whatever you want in two steps\+: first implement the matcher interface, and then define a factory function to create a matcher instance. The second step is not strictly needed but it makes the syntax of using the matcher nicer.

For example, you can define a matcher to test whether an {\ttfamily int} is divisible by 7 and then use it like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::MakeMatcher;}
\DoxyCodeLine{using ::testing::Matcher;}
\DoxyCodeLine{using ::testing::MatcherInterface;}
\DoxyCodeLine{using ::testing::MatchResultListener;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }DivisibleBy7Matcher : \textcolor{keyword}{public} MatcherInterface<int> \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} MatchAndExplain(\textcolor{keywordtype}{int} n,}
\DoxyCodeLine{                       MatchResultListener* \textcolor{comment}{/* listener */})\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} (n \% 7) == 0;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeTo(::std::ostream* os)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    *os << \textcolor{stringliteral}{"is divisible by 7"};}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeNegationTo(::std::ostream* os)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    *os << \textcolor{stringliteral}{"is not divisible by 7"};}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{Matcher<int> DivisibleBy7() \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} MakeMatcher(\textcolor{keyword}{new} DivisibleBy7Matcher);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(DivisibleBy7()));}
\end{DoxyCode}


You may improve the matcher message by streaming additional information to the {\ttfamily listener} argument in {\ttfamily Match\+And\+Explain()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }DivisibleBy7Matcher : \textcolor{keyword}{public} MatcherInterface<int> \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} MatchAndExplain(\textcolor{keywordtype}{int} n,}
\DoxyCodeLine{                       MatchResultListener* listener)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keywordtype}{int} remainder = n \% 7;}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (remainder != 0) \{}
\DoxyCodeLine{      *listener << \textcolor{stringliteral}{"the remainder is "} << remainder;}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    \textcolor{keywordflow}{return} remainder == 0;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


Then, {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T(x, Divisible\+By7());} may generate a message like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: x}
\DoxyCodeLine{Expected: is divisible by 7}
\DoxyCodeLine{  Actual: 23 (the remainder is 2)}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md89}{}\doxysubsubsection{Writing New Polymorphic Matchers}\label{md__c_autotoc_md89}
You\textquotesingle{}ve learned how to write your own matchers in the previous recipe. Just one problem\+: a matcher created using {\ttfamily Make\+Matcher()} only works for one particular type of arguments. If you want a {\itshape polymorphic} matcher that works with arguments of several types (for instance, {\ttfamily Eq(x)} can be used to match a $\ast${\ttfamily value}$\ast$ as long as {\ttfamily value == x} compiles -- $\ast${\ttfamily value}$\ast$ and {\ttfamily x} don\textquotesingle{}t have to share the same type), you can learn the trick from {\ttfamily testing/base/public/gmock-\/matchers.\+h} but it\textquotesingle{}s a bit involved.

Fortunately, most of the time you can define a polymorphic matcher easily with the help of {\ttfamily Make\+Polymorphic\+Matcher()}. Here\textquotesingle{}s how you can define {\ttfamily Not\+Null()} as an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::MakePolymorphicMatcher;}
\DoxyCodeLine{using ::testing::MatchResultListener;}
\DoxyCodeLine{using ::testing::PolymorphicMatcher;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }NotNullMatcher \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{comment}{// To implement a polymorphic matcher, first define a COPYABLE class}}
\DoxyCodeLine{  \textcolor{comment}{// that has three members MatchAndExplain(), DescribeTo(), and}}
\DoxyCodeLine{  \textcolor{comment}{// DescribeNegationTo(), like the following.}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// In this example, we want to use NotNull() with any pointer, so}}
\DoxyCodeLine{  \textcolor{comment}{// MatchAndExplain() accepts a pointer of any type as its first argument.}}
\DoxyCodeLine{  \textcolor{comment}{// In general, you can define MatchAndExplain() as an ordinary method or}}
\DoxyCodeLine{  \textcolor{comment}{// a method template, or even overload it.}}
\DoxyCodeLine{  \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} MatchAndExplain(T* p,}
\DoxyCodeLine{                       MatchResultListener* \textcolor{comment}{/* listener */})\textcolor{keyword}{ const }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} p != NULL;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Describes the property of a value matching this matcher.}}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeTo(::std::ostream* os)\textcolor{keyword}{ const }\{ *os << \textcolor{stringliteral}{"is not NULL"}; \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Describes the property of a value NOT matching this matcher.}}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeNegationTo(::std::ostream* os)\textcolor{keyword}{ const }\{ *os << \textcolor{stringliteral}{"is NULL"}; \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// To construct a polymorphic matcher, pass an instance of the class}}
\DoxyCodeLine{\textcolor{comment}{// to MakePolymorphicMatcher().  Note the return type.}}
\DoxyCodeLine{PolymorphicMatcher<NotNullMatcher> NotNull() \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} MakePolymorphicMatcher(NotNullMatcher());}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(NotNull()));  \textcolor{comment}{// The argument must be a non-\/NULL pointer.}}
\end{DoxyCode}


{\bfseries{Note\+:}} Your polymorphic matcher class does {\bfseries{not}} need to inherit from {\ttfamily Matcher\+Interface} or any other class, and its methods do {\bfseries{not}} need to be virtual.

Like in a monomorphic matcher, you may explain the match result by streaming additional information to the {\ttfamily listener} argument in {\ttfamily Match\+And\+Explain()}.\hypertarget{md__c_autotoc_md90}{}\doxysubsubsection{Writing New Cardinalities}\label{md__c_autotoc_md90}
A cardinality is used in {\ttfamily Times()} to tell g\+Mock how many times you expect a call to occur. It doesn\textquotesingle{}t have to be exact. For example, you can say {\ttfamily At\+Least(5)} or {\ttfamily Between(2, 4)}.

If the \href{cheat_sheet.md\#CardinalityList}{\texttt{ built-\/in set}} of cardinalities doesn\textquotesingle{}t suit you, you are free to define your own by implementing the following interface (in namespace {\ttfamily testing})\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }CardinalityInterface \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~CardinalityInterface();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Returns true if call\_count calls will satisfy this cardinality.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} IsSatisfiedByCallCount(\textcolor{keywordtype}{int} call\_count) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Returns true if call\_count calls will saturate this cardinality.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} IsSaturatedByCallCount(\textcolor{keywordtype}{int} call\_count) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Describes self to an ostream.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} DescribeTo(::std::ostream* os) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{\};}
\end{DoxyCode}


For example, to specify that a call must occur even number of times, you can write


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::Cardinality;}
\DoxyCodeLine{using ::testing::CardinalityInterface;}
\DoxyCodeLine{using ::testing::MakeCardinality;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }EvenNumberCardinality : \textcolor{keyword}{public} CardinalityInterface \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} IsSatisfiedByCallCount(\textcolor{keywordtype}{int} call\_count)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} (call\_count \% 2) == 0;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} IsSaturatedByCallCount(\textcolor{keywordtype}{int} call\_count)\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} DescribeTo(::std::ostream* os)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{    *os << \textcolor{stringliteral}{"called even number of times"};}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{Cardinality EvenNumber() \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} MakeCardinality(\textcolor{keyword}{new} EvenNumberCardinality);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Bar(3))}
\DoxyCodeLine{      .Times(EvenNumber());}
\end{DoxyCode}
\hypertarget{md__c_QuickNewActions}{}\doxysubsubsection{Writing New Actions Quickly}\label{md__c_QuickNewActions}
If the built-\/in actions don\textquotesingle{}t work for you, you can easily define your own one. Just define a functor class with a (possibly templated) call operator, matching the signature of your action.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct }Increment \{}
\DoxyCodeLine{  \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{  T operator()(T* arg) \{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} ++(*arg);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\}}
\end{DoxyCode}


The same approach works with stateful functors (or any callable, really)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{struct MultiplyBy \{}
\DoxyCodeLine{  template <typename T>}
\DoxyCodeLine{  T operator()(T arg) \{ return arg * multiplier; \}}
\DoxyCodeLine{}
\DoxyCodeLine{  int multiplier;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{// Then use:}
\DoxyCodeLine{// EXPECT\_CALL(...).WillOnce(MultiplyBy\{7\});}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md91}{}\doxyparagraph{Legacy macro-\/based Actions}\label{md__c_autotoc_md91}
Before C++11, the functor-\/based actions were not supported; the old way of writing actions was through a set of {\ttfamily A\+C\+T\+I\+O\+N$\ast$} macros. We suggest to avoid them in new code; they hide a lot of logic behind the macro, potentially leading to harder-\/to-\/understand compiler errors. Nevertheless, we cover them here for completeness.

By writing


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION(name) \{ statements; \}}
\end{DoxyCode}


in a namespace scope (i.\+e. not inside a class or function), you will define an action with the given name that executes the statements. The value returned by {\ttfamily statements} will be used as the return value of the action. Inside the statements, you can refer to the K-\/th (0-\/based) argument of the mock function as {\ttfamily argK}. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION(IncrementArg1) \{ \textcolor{keywordflow}{return} ++(*arg1); \}}
\end{DoxyCode}


allows you to write


\begin{DoxyCode}{0}
\DoxyCodeLine{... WillOnce(IncrementArg1());}
\end{DoxyCode}


Note that you don\textquotesingle{}t need to specify the types of the mock function arguments. Rest assured that your code is type-\/safe though\+: you\textquotesingle{}ll get a compiler error if {\ttfamily $\ast$arg1} doesn\textquotesingle{}t support the {\ttfamily ++} operator, or if the type of {\ttfamily ++($\ast$arg1)} isn\textquotesingle{}t compatible with the mock function\textquotesingle{}s return type.

Another example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION(Foo) \{}
\DoxyCodeLine{  (*arg2)(5);}
\DoxyCodeLine{  Blah();}
\DoxyCodeLine{  *arg1 = 0;}
\DoxyCodeLine{  \textcolor{keywordflow}{return} arg0;}
\DoxyCodeLine{\}}
\end{DoxyCode}


defines an action {\ttfamily Foo()} that invokes argument \#2 (a function pointer) with 5, calls function {\ttfamily Blah()}, sets the value pointed to by argument \#1 to 0, and returns argument \#0.

For more convenience and flexibility, you can also use the following pre-\/defined symbols in the body of {\ttfamily A\+C\+T\+I\+ON}\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily arg\+K\+\_\+type}  }&\cellcolor{\tableheadbgcolor}\textbf{ The type of the K-\/th (0-\/based) argument of the mock function   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily arg\+K\+\_\+type}  }&\cellcolor{\tableheadbgcolor}\textbf{ The type of the K-\/th (0-\/based) argument of the mock function   }\\\cline{1-2}
\endhead
{\ttfamily args}  &All arguments of the mock function as a tuple   \\\cline{1-2}
{\ttfamily args\+\_\+type}  &The type of all arguments of the mock function as a tuple   \\\cline{1-2}
{\ttfamily return\+\_\+type}  &The return type of the mock function   \\\cline{1-2}
{\ttfamily function\+\_\+type}  &The type of the mock function   \\\cline{1-2}
\end{longtabu}


For example, when using an {\ttfamily A\+C\+T\+I\+ON} as a stub action for mock function\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} DoSomething(\textcolor{keywordtype}{bool} flag, \textcolor{keywordtype}{int}* ptr);}
\end{DoxyCode}


we have\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Pre-\/defined Symbol  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Is Bound To   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Pre-\/defined Symbol  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Is Bound To   }\\\cline{1-2}
\endhead
{\ttfamily arg0}  &the value of {\ttfamily flag}   \\\cline{1-2}
{\ttfamily arg0\+\_\+type}  &the type {\ttfamily bool}   \\\cline{1-2}
{\ttfamily arg1}  &the value of {\ttfamily ptr}   \\\cline{1-2}
{\ttfamily arg1\+\_\+type}  &the type {\ttfamily int$\ast$}   \\\cline{1-2}
{\ttfamily args}  &the tuple {\ttfamily (flag, ptr)}   \\\cline{1-2}
{\ttfamily args\+\_\+type}  &the type {\ttfamily std\+::tuple$<$bool, int$\ast$$>$}   \\\cline{1-2}
{\ttfamily return\+\_\+type}  &the type {\ttfamily int}   \\\cline{1-2}
{\ttfamily function\+\_\+type}  &the type {\ttfamily int(bool, int$\ast$)}   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__c_autotoc_md92}{}\doxyparagraph{Legacy macro-\/based parameterized Actions}\label{md__c_autotoc_md92}
Sometimes you\textquotesingle{}ll want to parameterize an action you define. For that we have another macro


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION\_P(name, param) \{ statements; \}}
\end{DoxyCode}


For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION\_P(Add, n) \{ \textcolor{keywordflow}{return} arg0 + n; \}}
\end{DoxyCode}


will allow you to write


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Returns argument \#0 + 5.}}
\DoxyCodeLine{... WillOnce(Add(5));}
\end{DoxyCode}


For convenience, we use the term {\itshape arguments} for the values used to invoke the mock function, and the term {\itshape parameters} for the values used to instantiate an action.

Note that you don\textquotesingle{}t need to provide the type of the parameter either. Suppose the parameter is named {\ttfamily param}, you can also use the g\+Mock-\/defined symbol {\ttfamily param\+\_\+type} to refer to the type of the parameter as inferred by the compiler. For example, in the body of {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P(\+Add, n)} above, you can write {\ttfamily n\+\_\+type} for the type of {\ttfamily n}.

g\+Mock also provides {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P2}, {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P3}, and etc to support multi-\/parameter actions. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION\_P2(ReturnDistanceTo, x, y) \{}
\DoxyCodeLine{  \textcolor{keywordtype}{double} dx = arg0 -\/ x;}
\DoxyCodeLine{  \textcolor{keywordtype}{double} dy = arg1 -\/ y;}
\DoxyCodeLine{  \textcolor{keywordflow}{return} sqrt(dx*dx + dy*dy);}
\DoxyCodeLine{\}}
\end{DoxyCode}


lets you write


\begin{DoxyCode}{0}
\DoxyCodeLine{... WillOnce(ReturnDistanceTo(5.0, 26.5));}
\end{DoxyCode}


You can view {\ttfamily A\+C\+T\+I\+ON} as a degenerated parameterized action where the number of parameters is 0.

You can also easily define actions overloaded on the number of parameters\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION\_P(Plus, a) \{ ... \}}
\DoxyCodeLine{ACTION\_P2(Plus, a, b) \{ ... \}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md93}{}\doxysubsubsection{Restricting the Type of an Argument or Parameter in an A\+C\+T\+I\+ON}\label{md__c_autotoc_md93}
For maximum brevity and reusability, the {\ttfamily A\+C\+T\+I\+O\+N$\ast$} macros don\textquotesingle{}t ask you to provide the types of the mock function arguments and the action parameters. Instead, we let the compiler infer the types for us.

Sometimes, however, we may want to be more explicit about the types. There are several tricks to do that. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION(Foo) \{}
\DoxyCodeLine{  \textcolor{comment}{// Makes sure arg0 can be converted to int.}}
\DoxyCodeLine{  \textcolor{keywordtype}{int} n = arg0;}
\DoxyCodeLine{  ... use n instead of arg0 here ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{ACTION\_P(Bar, param) \{}
\DoxyCodeLine{  \textcolor{comment}{// Makes sure the type of arg1 is const char*.}}
\DoxyCodeLine{  ::testing::StaticAssertTypeEq<const char*, arg1\_type>();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Makes sure param can be converted to bool.}}
\DoxyCodeLine{  \textcolor{keywordtype}{bool} flag = param;}
\DoxyCodeLine{\}}
\end{DoxyCode}


where {\ttfamily Static\+Assert\+Type\+Eq} is a compile-\/time assertion in googletest that verifies two types are the same.\hypertarget{md__c_autotoc_md94}{}\doxysubsubsection{Writing New Action Templates Quickly}\label{md__c_autotoc_md94}
Sometimes you want to give an action explicit template parameters that cannot be inferred from its value parameters. {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+T\+E\+M\+P\+L\+A\+T\+E()} supports that and can be viewed as an extension to {\ttfamily A\+C\+T\+I\+O\+N()} and {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P$\ast$()}.

The syntax\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ACTION\_TEMPLATE(ActionName,}
\DoxyCodeLine{                HAS\_m\_TEMPLATE\_PARAMS(kind1, name1, ..., kind\_m, name\_m),}
\DoxyCodeLine{                AND\_n\_VALUE\_PARAMS(p1, ..., p\_n)) \{ statements; \}}
\end{DoxyCode}


defines an action template that takes {\itshape m} explicit template parameters and {\itshape n} value parameters, where {\itshape m} is in \mbox{[}1, 10\mbox{]} and {\itshape n} is in \mbox{[}0, 10\mbox{]}. {\ttfamily name\+\_\+i} is the name of the {\itshape i}-\/th template parameter, and {\ttfamily kind\+\_\+i} specifies whether it\textquotesingle{}s a {\ttfamily typename}, an integral constant, or a template. {\ttfamily p\+\_\+i} is the name of the {\itshape i}-\/th value parameter.

Example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// DuplicateArg<k, T>(output) converts the k-\/th argument of the mock}}
\DoxyCodeLine{\textcolor{comment}{// function to type T and copies it to *output.}}
\DoxyCodeLine{ACTION\_TEMPLATE(DuplicateArg,}
\DoxyCodeLine{                \textcolor{comment}{// Note the comma between int and k:}}
\DoxyCodeLine{                HAS\_2\_TEMPLATE\_PARAMS(\textcolor{keywordtype}{int}, k, \textcolor{keyword}{typename}, T),}
\DoxyCodeLine{                AND\_1\_VALUE\_PARAMS(output)) \{}
\DoxyCodeLine{  *output = T(::std::get<k>(args));}
\DoxyCodeLine{\}}
\end{DoxyCode}


To create an instance of an action template, write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ActionName<t1, ..., t\_m>(v1, ..., v\_n)}
\end{DoxyCode}


where the {\ttfamily t}s are the template arguments and the {\ttfamily v}s are the value arguments. The value argument types are inferred by the compiler. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{...}
\DoxyCodeLine{  \textcolor{keywordtype}{int} n;}
\DoxyCodeLine{  EXPECT\_CALL(mock, Foo).WillOnce(DuplicateArg<1, unsigned char>(\&n));}
\end{DoxyCode}


If you want to explicitly specify the value argument types, you can provide additional template arguments\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ActionName<t1, ..., t\_m, u1, ..., u\_k>(v1, ..., v\_n)}
\end{DoxyCode}


where {\ttfamily u\+\_\+i} is the desired type of {\ttfamily v\+\_\+i}.

{\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+T\+E\+M\+P\+L\+A\+TE} and {\ttfamily A\+C\+T\+I\+ON}/{\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P$\ast$} can be overloaded on the number of value parameters, but not on the number of template parameters. Without the restriction, the meaning of the following is unclear\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{OverloadedAction<int, bool>(x);}
\end{DoxyCode}


Are we using a single-\/template-\/parameter action where {\ttfamily bool} refers to the type of {\ttfamily x}, or a two-\/template-\/parameter action where the compiler is asked to infer the type of {\ttfamily x}?\hypertarget{md__c_autotoc_md95}{}\doxysubsubsection{Using the A\+C\+T\+I\+O\+N Object\textquotesingle{}s Type}\label{md__c_autotoc_md95}
If you are writing a function that returns an {\ttfamily A\+C\+T\+I\+ON} object, you\textquotesingle{}ll need to know its type. The type depends on the macro used to define the action and the parameter types. The rule is relatively simple\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Given Definition  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expression  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Has Type   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Given Definition  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expression  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Has Type   }\\\cline{1-3}
\endhead
{\ttfamily A\+C\+T\+I\+O\+N(\+Foo)}  &{\ttfamily Foo()}  &{\ttfamily Foo\+Action}   \\\cline{1-3}
{\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+T\+E\+M\+P\+L\+A\+TE(Foo,}  &\`{}\+Foo$<$t1, ...,  &\`{}\+Foo\+Action$<$t1, ...,   \\\cline{1-3}
\end{longtabu}
\+: {\ttfamily H\+A\+S\+\_\+m\+\_\+\+T\+E\+M\+P\+L\+A\+T\+E\+\_\+\+P\+A\+R\+A\+M\+S(...),} \+: t\+\_\+m$>$(){\ttfamily \+: t\+\_\+m$>$} \+: \+: {\ttfamily A\+N\+D\+\_\+0\+\_\+\+V\+A\+L\+U\+E\+\_\+\+P\+A\+R\+A\+M\+S())} \+: \+: \+: $\vert$ {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P(\+Bar, param)} $\vert$ {\ttfamily Bar(int\+\_\+value)} $\vert$ {\ttfamily Bar\+ActionP$<$int$>$} $\vert$ $\vert$ {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+T\+E\+M\+P\+L\+A\+TE(Bar,} $\vert$ {\ttfamily Bar$<$t1, ..., t\+\_\+m$>$} $\vert$ {\ttfamily Foo\+ActionP$<$t1, ..., $\vert$ \+:}H\+A\+S\+\_\+m\+\_\+\+T\+E\+M\+P\+L\+A\+T\+E\+\_\+\+P\+A\+R\+A\+M\+S(...),{\ttfamily \+:}(int\+\_\+value){\ttfamily \+: t\+\_\+m, int$>$} \+: \+: {\ttfamily A\+N\+D\+\_\+1\+\_\+\+V\+A\+L\+U\+E\+\_\+\+P\+A\+R\+A\+M\+S(p1))} \+: \+: \+: $\vert$ {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+P2(\+Baz, p1, p2)} $\vert$ {\ttfamily Baz(bool\+\_\+value,} $\vert$ {\ttfamily Baz\+Action\+P2$<$bool, $\vert$ \+: \+:}int\+\_\+value){\ttfamily \+: int$>$} \+: $\vert$ {\ttfamily A\+C\+T\+I\+O\+N\+\_\+\+T\+E\+M\+P\+L\+A\+TE(Baz,} $\vert$ {\ttfamily Baz$<$t1, ..., t\+\_\+m$>$} $\vert$ {\ttfamily Foo\+Action\+P2$<$t1, ..., $\vert$ \+:}H\+A\+S\+\_\+m\+\_\+\+T\+E\+M\+P\+L\+A\+T\+E\+\_\+\+P\+A\+R\+A\+M\+S(...),{\ttfamily \+:}(bool\+\_\+value,{\ttfamily \+: t\+\_\+m,} {\ttfamily bool, int$>$} \+: \+: {\ttfamily A\+N\+D\+\_\+2\+\_\+\+V\+A\+L\+U\+E\+\_\+\+P\+A\+R\+A\+M\+S(p1, p2))} \+: {\ttfamily int\+\_\+value)} \+: \+: $\vert$ ... $\vert$ ... $\vert$ ... $\vert$

Note that we have to pick different suffixes ({\ttfamily Action}, {\ttfamily ActionP}, {\ttfamily Action\+P2}, and etc) for actions with different numbers of value parameters, or the action definitions cannot be overloaded on the number of them.\hypertarget{md__c_NewMonoActions}{}\doxysubsubsection{Writing New Monomorphic Actions}\label{md__c_NewMonoActions}
While the {\ttfamily A\+C\+T\+I\+O\+N$\ast$} macros are very convenient, sometimes they are inappropriate. For example, despite the tricks shown in the previous recipes, they don\textquotesingle{}t let you directly specify the types of the mock function arguments and the action parameters, which in general leads to unoptimized compiler error messages that can baffle unfamiliar users. They also don\textquotesingle{}t allow overloading actions based on parameter types without jumping through some hoops.

An alternative to the {\ttfamily A\+C\+T\+I\+O\+N$\ast$} macros is to implement {\ttfamily \mbox{\hyperlink{classtesting_1_1_action_interface}{testing\+::\+Action\+Interface}}$<$F$>$}, where {\ttfamily F} is the type of the mock function in which the action will be used. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} F>}
\DoxyCodeLine{\textcolor{keyword}{class }ActionInterface \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{virtual} ~ActionInterface();}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// Performs the action.  Result is the return type of function type}}
\DoxyCodeLine{  \textcolor{comment}{// F, and ArgumentTuple is the tuple of arguments of F.}}
\DoxyCodeLine{  \textcolor{comment}{//}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// For example, if F is int(bool, const string\&), then Result would}}
\DoxyCodeLine{  \textcolor{comment}{// be int, and ArgumentTuple would be ::std::tuple<bool, const string\&>.}}
\DoxyCodeLine{  \textcolor{keyword}{virtual} Result Perform(\textcolor{keyword}{const} ArgumentTuple\& args) = 0;}
\DoxyCodeLine{\};}
\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{using ::testing::Action;}
\DoxyCodeLine{using ::testing::ActionInterface;}
\DoxyCodeLine{using ::testing::MakeAction;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{typedef} \textcolor{keywordtype}{int} IncrementMethod(\textcolor{keywordtype}{int}*);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }IncrementArgumentAction : \textcolor{keyword}{public} ActionInterface<IncrementMethod> \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{int} Perform(const ::std::tuple<int*>\& args)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{    \textcolor{keywordtype}{int}* p = ::std::get<0>(args);  \textcolor{comment}{// Grabs the first argument.}}
\DoxyCodeLine{    \textcolor{keywordflow}{return} *p++;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{Action<IncrementMethod> IncrementArgument() \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} MakeAction(\textcolor{keyword}{new} IncrementArgumentAction);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{...}
\DoxyCodeLine{  EXPECT\_CALL(foo, Baz(\_))}
\DoxyCodeLine{      .WillOnce(IncrementArgument());}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{int} n = 5;}
\DoxyCodeLine{  foo.Baz(\&n);  \textcolor{comment}{// Should return 5 and change n to 6.}}
\end{DoxyCode}
\hypertarget{md__c_NewPolyActions}{}\doxysubsubsection{Writing New Polymorphic Actions}\label{md__c_NewPolyActions}
The previous recipe showed you how to define your own action. This is all good, except that you need to know the type of the function in which the action will be used. Sometimes that can be a problem. For example, if you want to use the action in functions with {\itshape different} types (e.\+g. like {\ttfamily Return()} and {\ttfamily Set\+Arg\+Pointee()}).

If an action can be used in several types of mock functions, we say it\textquotesingle{}s {\itshape polymorphic}. The {\ttfamily Make\+Polymorphic\+Action()} function template makes it easy to define such an action\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{namespace }testing \{}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} Impl>}
\DoxyCodeLine{PolymorphicAction<Impl> MakePolymorphicAction(\textcolor{keyword}{const} Impl\& impl);}
\DoxyCodeLine{\}  \textcolor{comment}{// namespace testing}}
\end{DoxyCode}


As an example, let\textquotesingle{}s define an action that returns the second argument in the mock function\textquotesingle{}s argument list. The first step is to define an implementation class\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class }ReturnSecondArgumentAction \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keyword}{template} <\textcolor{keyword}{typename} Result, \textcolor{keyword}{typename} ArgumentTuple>}
\DoxyCodeLine{  Result Perform(\textcolor{keyword}{const} ArgumentTuple\& args)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{    \textcolor{comment}{// To get the i-\/th (0-\/based) argument, use ::std::get(args).}}
\DoxyCodeLine{    return ::std::get<1>(args);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


This implementation class does {\itshape not} need to inherit from any particular class. What matters is that it must have a {\ttfamily Perform()} method template. This method template takes the mock function\textquotesingle{}s arguments as a tuple in a {\bfseries{single}} argument, and returns the result of the action. It can be either {\ttfamily const} or not, but must be invokable with exactly one template argument, which is the result type. In other words, you must be able to call {\ttfamily Perform$<$R$>$(args)} where {\ttfamily R} is the mock function\textquotesingle{}s return type and {\ttfamily args} is its arguments in a tuple.

Next, we use {\ttfamily Make\+Polymorphic\+Action()} to turn an instance of the implementation class into the polymorphic action we need. It will be convenient to have a wrapper for this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::MakePolymorphicAction;}
\DoxyCodeLine{using ::testing::PolymorphicAction;}
\DoxyCodeLine{}
\DoxyCodeLine{PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() \{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} MakePolymorphicAction(ReturnSecondArgumentAction());}
\DoxyCodeLine{\}}
\end{DoxyCode}


Now, you can use this polymorphic action the same way you use the built-\/in ones\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{using ::testing::\_;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class }MockFoo : \textcolor{keyword}{public} Foo \{}
\DoxyCodeLine{ \textcolor{keyword}{public}:}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{int}, DoThis, (\textcolor{keywordtype}{bool} flag, \textcolor{keywordtype}{int} n), (\textcolor{keyword}{override}));}
\DoxyCodeLine{  MOCK\_METHOD(\textcolor{keywordtype}{string}, DoThat, (\textcolor{keywordtype}{int} x, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* str1, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* str2),}
\DoxyCodeLine{              (\textcolor{keyword}{override}));}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  MockFoo foo;}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThis).WillOnce(ReturnSecondArgument());}
\DoxyCodeLine{  EXPECT\_CALL(foo, DoThat).WillOnce(ReturnSecondArgument());}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  foo.DoThis(\textcolor{keyword}{true}, 5);  \textcolor{comment}{// Will return 5.}}
\DoxyCodeLine{  foo.DoThat(1, \textcolor{stringliteral}{"Hi"}, \textcolor{stringliteral}{"Bye"});  \textcolor{comment}{// Will return "Hi".}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md96}{}\doxysubsubsection{Teaching g\+Mock How to Print Your Values}\label{md__c_autotoc_md96}
When an uninteresting or unexpected call occurs, g\+Mock prints the argument values and the stack trace to help you debug. Assertion macros like {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+AT} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+EQ} also print the values in question when the assertion fails. g\+Mock and googletest do this using googletest\textquotesingle{}s user-\/extensible value printer.

This printer knows how to print built-\/in C++ types, native arrays, S\+TL containers, and any type that supports the {\ttfamily $<$$<$} operator. For other types, it prints the raw bytes in the value and hopes that you the user can figure it out. \href{../../googletest/docs/advanced.md\#teaching-googletest-how-to-print-your-values}{\texttt{ googletest\textquotesingle{}s advanced guide}} explains how to extend the printer to do a better job at printing your particular type than to dump the bytes.\hypertarget{md__c_autotoc_md97}{}\doxysubsection{Useful Mocks Created Using g\+Mock}\label{md__c_autotoc_md97}
\hypertarget{md__c_MockFunction}{}\doxysubsubsection{Mock std\+::function}\label{md__c_MockFunction}
{\ttfamily std\+::function} is a general function type introduced in C++11. It is a preferred way of passing callbacks to new interfaces. Functions are copiable, and are not usually passed around by pointer, which makes them tricky to mock. But fear not -\/ {\ttfamily Mock\+Function} can help you with that.

{\ttfamily Mock\+Function$<$R(\+T1, ..., Tn)$>$} has a mock method {\ttfamily Call()} with the signature\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{R Call(T1, ..., Tn);}
\end{DoxyCode}


It also has a {\ttfamily As\+Std\+Function()} method, which creates a {\ttfamily std\+::function} proxy forwarding to Call\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{std::function<R(T1, ..., Tn)> AsStdFunction();}
\end{DoxyCode}


To use {\ttfamily Mock\+Function}, first create {\ttfamily Mock\+Function} object and set up expectations on its {\ttfamily Call} method. Then pass proxy obtained from {\ttfamily As\+Std\+Function()} to the code you are testing. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{TEST(FooTest, RunsCallbackWithBarArgument) \{}
\DoxyCodeLine{  \textcolor{comment}{// 1. Create a mock object.}}
\DoxyCodeLine{  MockFunction<int(\textcolor{keywordtype}{string})> mock\_function;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// 2. Set expectations on Call() method.}}
\DoxyCodeLine{  EXPECT\_CALL(mock\_function, Call(\textcolor{stringliteral}{"bar"})).WillOnce(Return(1));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// 3. Exercise code that uses std::function.}}
\DoxyCodeLine{  Foo(mock\_function.AsStdFunction());}
\DoxyCodeLine{  \textcolor{comment}{// Foo's signature can be either of:}}
\DoxyCodeLine{  \textcolor{comment}{// void Foo(const std::function<int(string)>\& fun);}}
\DoxyCodeLine{  \textcolor{comment}{// void Foo(std::function<int(string)> fun);}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// 4. All expectations will be verified when mock\_function}}
\DoxyCodeLine{  \textcolor{comment}{//     goes out of scope and is destroyed.}}
\DoxyCodeLine{\}}
\end{DoxyCode}


Remember that function objects created with {\ttfamily As\+Std\+Function()} are just forwarders. If you create multiple of them, they will share the same set of expectations.

Although {\ttfamily std\+::function} supports unlimited number of arguments, {\ttfamily Mock\+Function} implementation is limited to ten. If you ever hit that limit... well, your callback has bigger problems than being mockable. \+:-\/)

The custom directory is an injection point for custom user configurations.\hypertarget{md__c_autotoc_md131}{}\doxysection{Header $<$tt$>$gmock-\/port.\+h$<$/tt$>$}\label{md__c_autotoc_md131}
The following macros can be defined\+:\hypertarget{md__c_autotoc_md132}{}\doxysubsection{Flag related macros\+:}\label{md__c_autotoc_md132}

\begin{DoxyItemize}
\item {\ttfamily G\+M\+O\+C\+K\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+bool\+\_\+(name)}
\item {\ttfamily G\+M\+O\+C\+K\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+int32\+\_\+(name)}
\item {\ttfamily G\+M\+O\+C\+K\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+string\+\_\+(name)}
\item {\ttfamily G\+M\+O\+C\+K\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+bool\+\_\+(name, default\+\_\+val, doc)}
\item {\ttfamily G\+M\+O\+C\+K\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+int32\+\_\+(name, default\+\_\+val, doc)}
\item {\ttfamily G\+M\+O\+C\+K\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+string\+\_\+(name, default\+\_\+val, doc)}
\end{DoxyItemize}\hypertarget{md__c_autotoc_md134}{}\doxysubsection{Overview}\label{md__c_autotoc_md134}
Google\textquotesingle{}s framework for writing and using C++ mock classes. It can help you derive better designs of your system and write better tests.

It is inspired by\+:


\begin{DoxyItemize}
\item \href{http://www.jmock.org/}{\texttt{ j\+Mock}},
\item \href{http://www.easymock.org/}{\texttt{ Easy\+Mock}}, and
\item \href{http://code.google.com/p/hamcrest/}{\texttt{ Hamcrest}},
\end{DoxyItemize}

and designed with C++\textquotesingle{}s specifics in mind.

g\+Mock\+:


\begin{DoxyItemize}
\item provides a declarative syntax for defining mocks,
\item can define partial (hybrid) mocks, which are a cross of real and mock objects,
\item handles functions of arbitrary types and overloaded functions,
\item comes with a rich set of matchers for validating function arguments,
\item uses an intuitive syntax for controlling the behavior of a mock,
\item does automatic verification of expectations (no record-\/and-\/replay needed),
\item allows arbitrary (partial) ordering constraints on function calls to be expressed,
\item lets a user extend it by defining new matchers and actions.
\item does not use exceptions, and
\item is easy to learn and use.
\end{DoxyItemize}

Details and examples can be found here\+:


\begin{DoxyItemize}
\item g\+Mock for Dummies
\item Legacy g\+Mock F\+AQ
\item g\+Mock Cookbook
\item g\+Mock Cheat Sheet
\end{DoxyItemize}

Please note that code under scripts/generator/ is from the \href{http://code.google.com/p/cppclean/}{\texttt{ cppclean project}} and under the Apache License, which is different from Google \mbox{\hyperlink{class_mock}{Mock}}\textquotesingle{}s license.

Google \mbox{\hyperlink{class_mock}{Mock}} is a part of \href{http://github.com/google/googletest/}{\texttt{ Google Test C++ testing framework}} and a subject to the same requirements.\hypertarget{md__c_autotoc_md137}{}\doxysection{Introduction}\label{md__c_autotoc_md137}
Now that you have read the googletest Primer and learned how to write tests using googletest, it\textquotesingle{}s time to learn some new tricks. This document will show you more assertions as well as how to construct complex failure messages, propagate fatal failures, reuse and speed up your test fixtures, and use various flags with your tests.\hypertarget{md__c_autotoc_md138}{}\doxysection{More Assertions}\label{md__c_autotoc_md138}
This section covers some less frequently used, but still significant, assertions.\hypertarget{md__c_autotoc_md139}{}\doxysubsection{Explicit Success and Failure}\label{md__c_autotoc_md139}
These three assertions do not actually test a value or expression. Instead, they generate a success or failure directly. Like the macros that actually perform a test, you may stream a custom failure message into them.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{SUCCEED();}
\end{DoxyCode}


Generates a success. This does {\bfseries{N\+OT}} make the overall test succeed. A test is considered successful only if none of its assertions fail during its execution.

N\+O\+TE\+: {\ttfamily S\+U\+C\+C\+E\+E\+D()} is purely documentary and currently doesn\textquotesingle{}t generate any user-\/visible output. However, we may add {\ttfamily S\+U\+C\+C\+E\+E\+D()} messages to googletest\textquotesingle{}s output in the future.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{FAIL();}
\DoxyCodeLine{ADD\_FAILURE();}
\DoxyCodeLine{ADD\_FAILURE\_AT("file\_path", line\_number);}
\end{DoxyCode}


{\ttfamily F\+A\+I\+L()} generates a fatal failure, while {\ttfamily A\+D\+D\+\_\+\+F\+A\+I\+L\+U\+R\+E()} and {\ttfamily A\+D\+D\+\_\+\+F\+A\+I\+L\+U\+R\+E\+\_\+\+A\+T()} generate a nonfatal failure. These are useful when control flow, rather than a Boolean expression, determines the test\textquotesingle{}s success or failure. For example, you might want to write something like\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{switch(expression) \{}
\DoxyCodeLine{  case 1:}
\DoxyCodeLine{     ... some checks ...}
\DoxyCodeLine{  case 2:}
\DoxyCodeLine{     ... some other checks ...}
\DoxyCodeLine{  default:}
\DoxyCodeLine{     FAIL() << "We shouldn't get here.";}
\DoxyCodeLine{\}}
\end{DoxyCode}


N\+O\+TE\+: you can only use {\ttfamily F\+A\+I\+L()} in functions that return {\ttfamily void}. See the \href{\#assertion-placement}{\texttt{ Assertion Placement section}} for more information.\hypertarget{md__c_autotoc_md140}{}\doxysubsection{Exception Assertions}\label{md__c_autotoc_md140}
These are for verifying that a piece of code throws (or does not throw) an exception of the given type\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+H\+R\+O\+W(statement, exception\+\_\+type);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+R\+O\+W(statement, exception\+\_\+type);}  &{\ttfamily statement} throws an exception of the given type   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+A\+N\+Y\+\_\+\+T\+H\+R\+O\+W(statement);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+A\+N\+Y\+\_\+\+T\+H\+R\+O\+W(statement);}  &{\ttfamily statement} throws an exception of any type   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+N\+O\+\_\+\+T\+H\+R\+O\+W(statement);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+O\+\_\+\+T\+H\+R\+O\+W(statement);}  &{\ttfamily statement} doesn\textquotesingle{}t throw any exception   \\\cline{1-3}
\end{longtabu}


Examples\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{ASSERT\_THROW(Foo(5), bar\_exception);}
\DoxyCodeLine{}
\DoxyCodeLine{EXPECT\_NO\_THROW(\{}
\DoxyCodeLine{  int n = 5;}
\DoxyCodeLine{  Bar(\&n);}
\DoxyCodeLine{\});}
\end{DoxyCode}


{\bfseries{Availability}}\+: requires exceptions to be enabled in the build environment\hypertarget{md__c_autotoc_md141}{}\doxysubsection{Predicate Assertions for Better Error Messages}\label{md__c_autotoc_md141}
Even though googletest has a rich set of assertions, they can never be complete, as it\textquotesingle{}s impossible (nor a good idea) to anticipate all scenarios a user might run into. Therefore, sometimes a user has to use {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+U\+E()} to check a complex expression, for lack of a better macro. This has the problem of not showing you the values of the parts of the expression, making it hard to understand what went wrong. As a workaround, some users choose to construct the failure message by themselves, streaming it into {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+U\+E()}. However, this is awkward especially when the expression has side-\/effects or is expensive to evaluate.

googletest gives you three different options to solve this problem\+:\hypertarget{md__c_autotoc_md142}{}\doxysubsubsection{Using an Existing Boolean Function}\label{md__c_autotoc_md142}
If you already have a function or functor that returns {\ttfamily bool} (or a type that can be implicitly converted to {\ttfamily bool}), you can use it in a {\itshape predicate assertion} to get the function arguments printed for free\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D1(pred1, val1)}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D1(pred1, val1)}  &{\ttfamily pred1(val1)} is true   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D2(pred2, val1, val2)}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D2(pred2, val1, val2)}  &{\ttfamily pred1(val1, val2)} is true   \\\cline{1-3}
{\ttfamily ...}  &{\ttfamily ...}  &{\ttfamily ...}   \\\cline{1-3}
\end{longtabu}


In the above, {\ttfamily predn} is an {\ttfamily n}-\/ary predicate function or functor, where {\ttfamily val1}, {\ttfamily val2}, ..., and {\ttfamily valn} are its arguments. The assertion succeeds if the predicate returns {\ttfamily true} when applied to the given arguments, and fails otherwise. When the assertion fails, it prints the value of each argument. In either case, the arguments are evaluated exactly once.

Here\textquotesingle{}s an example. Given


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// Returns true if m and n have no common divisors except 1.}
\DoxyCodeLine{bool MutuallyPrime(int m, int n) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{const int a = 3;}
\DoxyCodeLine{const int b = 4;}
\DoxyCodeLine{const int c = 10;}
\end{DoxyCode}


the assertion


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ EXPECT\_PRED2(MutuallyPrime, a, b);}
\end{DoxyCode}


will succeed, while the assertion


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ EXPECT\_PRED2(MutuallyPrime, b, c);}
\end{DoxyCode}


will fail with the message


\begin{DoxyCode}{0}
\DoxyCodeLine{MutuallyPrime(b, c) is false, where}
\DoxyCodeLine{b is 4}
\DoxyCodeLine{c is 10}
\end{DoxyCode}


\begin{quote}
N\+O\+TE\+:


\begin{DoxyEnumerate}
\item If you see a compiler error \char`\"{}no matching function to call\char`\"{} when using {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D$\ast$} or {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D$\ast$}, please see \href{faq.md\#the-compiler-complains-no-matching-function-to-call-when-i-use-assert-pred-how-do-i-fix-it}{\texttt{ this}} for how to resolve it. 
\end{DoxyEnumerate}\end{quote}
\hypertarget{md__c_autotoc_md143}{}\doxysubsubsection{Using a Function That Returns an Assertion\+Result}\label{md__c_autotoc_md143}
While {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D$\ast$()} and friends are handy for a quick job, the syntax is not satisfactory\+: you have to use different macros for different arities, and it feels more like Lisp than C++. The {\ttfamily \+::testing\+::\+Assertion\+Result} class solves this problem.

An {\ttfamily Assertion\+Result} object represents the result of an assertion (whether it\textquotesingle{}s a success or a failure, and an associated message). You can create an {\ttfamily Assertion\+Result} using one of these factory functions\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{namespace testing \{}
\DoxyCodeLine{}
\DoxyCodeLine{// Returns an AssertionResult object to indicate that an assertion has}
\DoxyCodeLine{// succeeded.}
\DoxyCodeLine{AssertionResult AssertionSuccess();}
\DoxyCodeLine{}
\DoxyCodeLine{// Returns an AssertionResult object to indicate that an assertion has}
\DoxyCodeLine{// failed.}
\DoxyCodeLine{AssertionResult AssertionFailure();}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\end{DoxyCode}


You can then use the {\ttfamily $<$$<$} operator to stream messages to the {\ttfamily Assertion\+Result} object.

To provide more readable messages in Boolean assertions (e.\+g. {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+U\+E()}), write a predicate function that returns {\ttfamily Assertion\+Result} instead of {\ttfamily bool}. For example, if you define {\ttfamily Is\+Even()} as\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::AssertionResult IsEven(int n) \{}
\DoxyCodeLine{  if ((n \% 2) == 0)}
\DoxyCodeLine{     return ::testing::AssertionSuccess();}
\DoxyCodeLine{  else}
\DoxyCodeLine{     return ::testing::AssertionFailure() << n << " is odd";}
\DoxyCodeLine{\}}
\end{DoxyCode}


instead of\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{bool IsEven(int n) \{}
\DoxyCodeLine{  return (n \% 2) == 0;}
\DoxyCodeLine{\}}
\end{DoxyCode}


the failed assertion {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+UE(Is\+Even(\+Fib(4)))} will print\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: IsEven(Fib(4))}
\DoxyCodeLine{  Actual: false (3 is odd)}
\DoxyCodeLine{Expected: true}
\end{DoxyCode}


instead of a more opaque


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: IsEven(Fib(4))}
\DoxyCodeLine{  Actual: false}
\DoxyCodeLine{Expected: true}
\end{DoxyCode}


If you want informative messages in {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+F\+A\+L\+SE} and {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+F\+A\+L\+SE} as well (one third of Boolean assertions in the Google code base are negative ones), and are fine with making the predicate slower in the success case, you can supply a success message\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::AssertionResult IsEven(int n) \{}
\DoxyCodeLine{  if ((n \% 2) == 0)}
\DoxyCodeLine{     return ::testing::AssertionSuccess() << n << " is even";}
\DoxyCodeLine{  else}
\DoxyCodeLine{     return ::testing::AssertionFailure() << n << " is odd";}
\DoxyCodeLine{\}}
\end{DoxyCode}


Then the statement {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+F\+A\+L\+SE(Is\+Even(\+Fib(6)))} will print


\begin{DoxyCode}{0}
\DoxyCodeLine{Value of: IsEven(Fib(6))}
\DoxyCodeLine{   Actual: true (8 is even)}
\DoxyCodeLine{Expected: false}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md144}{}\doxysubsubsection{Using a Predicate-\/\+Formatter}\label{md__c_autotoc_md144}
If you find the default message generated by {\ttfamily (A\+S\+S\+E\+R\+T$\vert$\+E\+X\+P\+E\+CT)\+\_\+\+P\+R\+E\+D$\ast$} and {\ttfamily (A\+S\+S\+E\+R\+T$\vert$\+E\+X\+P\+E\+CT)\+\_\+(T\+R\+U\+E$\vert$\+F\+A\+L\+SE)} unsatisfactory, or some arguments to your predicate do not support streaming to {\ttfamily ostream}, you can instead use the following {\itshape predicate-\/formatter assertions} to {\itshape fully} customize how the message is formatted\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T1(pred\+\_\+format1, val1);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T1(pred\+\_\+format1, val1);}  &{\ttfamily pred\+\_\+format1(val1)} is successful   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T2(pred\+\_\+format2, val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T2(pred\+\_\+format2, val1, val2);}  &{\ttfamily pred\+\_\+format2(val1, val2)} is successful   \\\cline{1-3}
{\ttfamily ...}  &{\ttfamily ...}  &...   \\\cline{1-3}
\end{longtabu}


The difference between this and the previous group of macros is that instead of a predicate, {\ttfamily (A\+S\+S\+E\+R\+T$\vert$\+E\+X\+P\+E\+CT)\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T$\ast$} take a {\itshape predicate-\/formatter} ({\ttfamily pred\+\_\+formatn}), which is a function or functor with the signature\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::AssertionResult PredicateFormattern(const char* expr1,}
\DoxyCodeLine{                                               const char* expr2,}
\DoxyCodeLine{                                               ...}
\DoxyCodeLine{                                               const char* exprn,}
\DoxyCodeLine{                                               T1 val1,}
\DoxyCodeLine{                                               T2 val2,}
\DoxyCodeLine{                                               ...}
\DoxyCodeLine{                                               Tn valn);}
\end{DoxyCode}


where {\ttfamily val1}, {\ttfamily val2}, ..., and {\ttfamily valn} are the values of the predicate arguments, and {\ttfamily expr1}, {\ttfamily expr2}, ..., and {\ttfamily exprn} are the corresponding expressions as they appear in the source code. The types {\ttfamily T1}, {\ttfamily T2}, ..., and {\ttfamily Tn} can be either value types or reference types. For example, if an argument has type {\ttfamily Foo}, you can declare it as either {\ttfamily Foo} or {\ttfamily const Foo\&}, whichever is appropriate.

As an example, let\textquotesingle{}s improve the failure message in {\ttfamily Mutually\+Prime()}, which was used with {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D2()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// Returns the smallest prime common divisor of m and n,}
\DoxyCodeLine{// or 1 when m and n are mutually prime.}
\DoxyCodeLine{int SmallestPrimeCommonDivisor(int m, int n) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{// A predicate-\/formatter for asserting that two integers are mutually prime.}
\DoxyCodeLine{::testing::AssertionResult AssertMutuallyPrime(const char* m\_expr,}
\DoxyCodeLine{                                               const char* n\_expr,}
\DoxyCodeLine{                                               int m,}
\DoxyCodeLine{                                               int n) \{}
\DoxyCodeLine{  if (MutuallyPrime(m, n)) return ::testing::AssertionSuccess();}
\DoxyCodeLine{}
\DoxyCodeLine{  return ::testing::AssertionFailure() << m\_expr << " and " << n\_expr}
\DoxyCodeLine{      << " (" << m << " and " << n << ") are not mutually prime, "}
\DoxyCodeLine{      << "as they have a common divisor " << SmallestPrimeCommonDivisor(m, n);}
\DoxyCodeLine{\}}
\end{DoxyCode}


With this predicate-\/formatter, we can use


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ EXPECT\_PRED\_FORMAT2(AssertMutuallyPrime, b, c);}
\end{DoxyCode}


to generate the message


\begin{DoxyCode}{0}
\DoxyCodeLine{b and c (4 and 10) are not mutually prime, as they have a common divisor 2.}
\end{DoxyCode}


As you may have realized, many of the built-\/in assertions we introduced earlier are special cases of {\ttfamily (E\+X\+P\+E\+C\+T$\vert$\+A\+S\+S\+E\+RT)\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T$\ast$}. In fact, most of them are indeed defined using {\ttfamily (E\+X\+P\+E\+C\+T$\vert$\+A\+S\+S\+E\+RT)\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T$\ast$}.\hypertarget{md__c_autotoc_md145}{}\doxysubsection{Floating-\/\+Point Comparison}\label{md__c_autotoc_md145}
Comparing floating-\/point numbers is tricky. Due to round-\/off errors, it is very unlikely that two floating-\/points will match exactly. Therefore, {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+EQ} \textquotesingle{}s naive comparison usually doesn\textquotesingle{}t work. And since floating-\/points can have a wide value range, no single fixed error bound works. It\textquotesingle{}s better to compare by a fixed relative error bound, except for values close to 0 due to the loss of precision there.

In general, for floating-\/point comparison to make sense, the user needs to carefully choose the error bound. If they don\textquotesingle{}t want or care to, comparing in terms of Units in the Last Place (U\+L\+Ps) is a good default, and googletest provides assertions to do this. Full details about U\+L\+Ps are quite long; if you want to learn more, see \href{https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/}{\texttt{ here}}.\hypertarget{md__c_autotoc_md146}{}\doxysubsubsection{Floating-\/\+Point Macros}\label{md__c_autotoc_md146}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+F\+L\+O\+A\+T\+\_\+\+E\+Q(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+F\+L\+O\+A\+T\+\_\+\+E\+Q(val1, val2);}  &the two {\ttfamily float} values are almost equal   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+D\+O\+U\+B\+L\+E\+\_\+\+E\+Q(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+O\+U\+B\+L\+E\+\_\+\+E\+Q(val1, val2);}  &the two {\ttfamily double} values are almost equal   \\\cline{1-3}
\end{longtabu}


By \char`\"{}almost equal\char`\"{} we mean the values are within 4 U\+LP\textquotesingle{}s from each other.

The following assertions allow you to choose the acceptable error bound\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+N\+E\+A\+R(val1, val2, abs\+\_\+error);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+E\+A\+R(val1, val2, abs\+\_\+error);}  &the difference between {\ttfamily val1} and {\ttfamily val2} doesn\textquotesingle{}t exceed the given absolute error   \\\cline{1-3}
\end{longtabu}
\hypertarget{md__c_autotoc_md147}{}\doxysubsubsection{Floating-\/\+Point Predicate-\/\+Format Functions}\label{md__c_autotoc_md147}
Some floating-\/point operations are useful, but not that often used. In order to avoid an explosion of new macros, we provide them as predicate-\/format functions that can be used in predicate assertion macros (e.\+g. {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T2}, etc).


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{EXPECT\_PRED\_FORMAT2(::testing::FloatLE, val1, val2);}
\DoxyCodeLine{EXPECT\_PRED\_FORMAT2(::testing::DoubleLE, val1, val2);}
\end{DoxyCode}


Verifies that {\ttfamily val1} is less than, or almost equal to, {\ttfamily val2}. You can replace {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T2} in the above table with {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T2}.\hypertarget{md__c_autotoc_md148}{}\doxysubsection{Asserting Using g\+Mock Matchers}\label{md__c_autotoc_md148}
\href{../../googlemock}{\texttt{ g\+Mock}} comes with a library of matchers for validating arguments passed to mock objects. A g\+Mock {\itshape matcher} is basically a predicate that knows how to describe itself. It can be used in these assertion macros\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+H\+A\+T(value, matcher);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T(value, matcher);}  &value matches matcher   \\\cline{1-3}
\end{longtabu}


For example, {\ttfamily Starts\+With(prefix)} is a matcher that matches a string starting with {\ttfamily prefix}, and you can write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{using ::testing::StartsWith;}
\DoxyCodeLine{...}
\DoxyCodeLine{    // Verifies that Foo() returns a string starting with "Hello".}
\DoxyCodeLine{    EXPECT\_THAT(Foo(), StartsWith("Hello"));}
\end{DoxyCode}


Read this \href{../../googlemock/docs/cook_book.md\#using-matchers-in-googletest-assertions}{\texttt{ recipe}} in the g\+Mock Cookbook for more details.

g\+Mock has a rich set of matchers. You can do many things googletest cannot do alone with them. For a list of matchers g\+Mock provides, read \href{../../googlemock/docs/cook_book.md\#\#using-matchers}{\texttt{ this}}. It\textquotesingle{}s easy to write your \href{../../googlemock/docs/cook_book.md\#NewMatchers}{\texttt{ own matchers}} too.

g\+Mock is bundled with googletest, so you don\textquotesingle{}t need to add any build dependency in order to take advantage of this. Just include {\ttfamily \char`\"{}testing/base/public/gmock.\+h\char`\"{}} and you\textquotesingle{}re ready to go.\hypertarget{md__c_autotoc_md149}{}\doxysubsection{More String Assertions}\label{md__c_autotoc_md149}
(Please read the \href{\#asserting-using-gmock-matchers}{\texttt{ previous}} section first if you haven\textquotesingle{}t.)

You can use the g\+Mock \href{../../googlemock/docs/cheat_sheet.md\#string-matchers}{\texttt{ string matchers}} with {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T()} or {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+H\+A\+T()} to do more string comparison tricks (sub-\/string, prefix, suffix, regular expression, and etc). For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{using ::testing::HasSubstr;}
\DoxyCodeLine{using ::testing::MatchesRegex;}
\DoxyCodeLine{...}
\DoxyCodeLine{  ASSERT\_THAT(foo\_string, HasSubstr("needle"));}
\DoxyCodeLine{  EXPECT\_THAT(bar\_string, MatchesRegex("\(\backslash\)\(\backslash\)w*\(\backslash\)\(\backslash\)d+"));}
\end{DoxyCode}


If the string contains a well-\/formed H\+T\+ML or X\+ML document, you can check whether its D\+OM tree matches an \href{http://www.w3.org/TR/xpath/\#contents}{\texttt{ X\+Path expression}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// Currently still in //template/prototemplate/testing:xpath\_matcher}
\DoxyCodeLine{\#include "template/prototemplate/testing/xpath\_matcher.h"}
\DoxyCodeLine{using prototemplate::testing::MatchesXPath;}
\DoxyCodeLine{EXPECT\_THAT(html\_string, MatchesXPath("//a[text()='click here']"));}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md150}{}\doxysubsection{Windows H\+R\+E\+S\+U\+L\+T assertions}\label{md__c_autotoc_md150}
These assertions test for {\ttfamily H\+R\+E\+S\+U\+LT} success or failure.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+H\+R\+E\+S\+U\+L\+T\+\_\+\+S\+U\+C\+C\+E\+E\+D\+E\+D(expression)}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+H\+R\+E\+S\+U\+L\+T\+\_\+\+S\+U\+C\+C\+E\+E\+D\+E\+D(expression)}  &{\ttfamily expression} is a success {\ttfamily H\+R\+E\+S\+U\+LT}   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+H\+R\+E\+S\+U\+L\+T\+\_\+\+F\+A\+I\+L\+E\+D(expression)}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+H\+R\+E\+S\+U\+L\+T\+\_\+\+F\+A\+I\+L\+E\+D(expression)}  &{\ttfamily expression} is a failure {\ttfamily H\+R\+E\+S\+U\+LT}   \\\cline{1-3}
\end{longtabu}


The generated output contains the human-\/readable error message associated with the {\ttfamily H\+R\+E\+S\+U\+LT} code returned by {\ttfamily expression}.

You might use them like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{CComPtr<IShellDispatch2> shell;}
\DoxyCodeLine{ASSERT\_HRESULT\_SUCCEEDED(shell.CoCreateInstance(L"Shell.Application"));}
\DoxyCodeLine{CComVariant empty;}
\DoxyCodeLine{ASSERT\_HRESULT\_SUCCEEDED(shell-\/>ShellExecute(CComBSTR(url), empty, empty, empty, empty));}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md151}{}\doxysubsection{Type Assertions}\label{md__c_autotoc_md151}
You can call the function


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::StaticAssertTypeEq<T1, T2>();}
\end{DoxyCode}


to assert that types {\ttfamily T1} and {\ttfamily T2} are the same. The function does nothing if the assertion is satisfied. If the types are different, the function call will fail to compile, and the compiler error message will likely (depending on the compiler) show you the actual values of {\ttfamily T1} and {\ttfamily T2}. This is mainly useful inside template code.

{\bfseries{Caveat}}\+: When used inside a member function of a class template or a function template, {\ttfamily Static\+Assert\+Type\+Eq$<$T1, T2$>$()} is effective only if the function is instantiated. For example, given\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{template <typename T> class Foo \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  void Bar() \{ ::testing::StaticAssertTypeEq<int, T>(); \}}
\DoxyCodeLine{\};}
\end{DoxyCode}


the code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{void Test1() \{ Foo<bool> foo; \}}
\end{DoxyCode}


will not generate a compiler error, as {\ttfamily Foo$<$bool$>$\+::\+Bar()} is never actually instantiated. Instead, you need\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{void Test2() \{ Foo<bool> foo; foo.Bar(); \}}
\end{DoxyCode}


to cause a compiler error.\hypertarget{md__c_autotoc_md152}{}\doxysubsection{Assertion Placement}\label{md__c_autotoc_md152}
You can use assertions in any C++ function. In particular, it doesn\textquotesingle{}t have to be a method of the test fixture class. The one constraint is that assertions that generate a fatal failure ({\ttfamily F\+A\+I\+L$\ast$} and {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$}) can only be used in void-\/returning functions. This is a consequence of Google\textquotesingle{}s not using exceptions. By placing it in a non-\/void function you\textquotesingle{}ll get a confusing compile error like {\ttfamily \char`\"{}error\+: void value not ignored as it ought to be\char`\"{}} or `\char`\"{}cannot
initialize return object of type \textquotesingle{}bool' with an rvalue of type \textquotesingle{}void\textquotesingle{}\char`\"{}\`{} or \`{}\char`\"{}error\+: no viable conversion from \textquotesingle{}void\textquotesingle{} to \textquotesingle{}string\textquotesingle{}\char`\"{}\`{}.

If you need to use fatal assertions in a function that returns non-\/void, one option is to make the function return the value in an out parameter instead. For example, you can rewrite {\ttfamily T2 Foo(\+T1 x)} to {\ttfamily void Foo(\+T1 x, T2$\ast$ result)}. You need to make sure that {\ttfamily $\ast$result} contains some sensible value even when the function returns prematurely. As the function now returns {\ttfamily void}, you can use any assertion inside of it.

If changing the function\textquotesingle{}s type is not an option, you should just use assertions that generate non-\/fatal failures, such as {\ttfamily A\+D\+D\+\_\+\+F\+A\+I\+L\+U\+R\+E$\ast$} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$}.

N\+O\+TE\+: Constructors and destructors are not considered void-\/returning functions, according to the C++ language specification, and so you may not use fatal assertions in them; you\textquotesingle{}ll get a compilation error if you try. Instead, either call {\ttfamily abort} and crash the entire test executable, or put the fatal assertion in a {\ttfamily Set\+Up}/{\ttfamily Tear\+Down} function; see \href{faq.md\#CtorVsSetUp}{\texttt{ constructor/destructor vs. {\ttfamily Set\+Up}/{\ttfamily Tear\+Down}}}

W\+A\+R\+N\+I\+NG\+: A fatal assertion in a helper function (private void-\/returning method) called from a constructor or destructor does not does not terminate the current test, as your intuition might suggest\+: it merely returns from the constructor or destructor early, possibly leaving your object in a partially-\/constructed or partially-\/destructed state! You almost certainly want to {\ttfamily abort} or use {\ttfamily Set\+Up}/{\ttfamily Tear\+Down} instead.\hypertarget{md__c_autotoc_md153}{}\doxysection{Teaching googletest How to Print Your Values}\label{md__c_autotoc_md153}
When a test assertion such as {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+EQ} fails, googletest prints the argument values to help you debug. It does this using a user-\/extensible value printer.

This printer knows how to print built-\/in C++ types, native arrays, S\+TL containers, and any type that supports the {\ttfamily $<$$<$} operator. For other types, it prints the raw bytes in the value and hopes that you the user can figure it out.

As mentioned earlier, the printer is {\itshape extensible}. That means you can teach it to do a better job at printing your particular type than to dump the bytes. To do that, define {\ttfamily $<$$<$} for your type\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{\#include <ostream>}
\DoxyCodeLine{}
\DoxyCodeLine{namespace foo \{}
\DoxyCodeLine{}
\DoxyCodeLine{class Bar \{  // We want googletest to be able to print instances of this.}
\DoxyCodeLine{...}
\DoxyCodeLine{  // Create a free inline friend function.}
\DoxyCodeLine{  friend std::ostream\& operator<<(std::ostream\& os, const Bar\& bar) \{}
\DoxyCodeLine{    return os << bar.DebugString();  // whatever needed to print bar to os}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{// If you can't declare the function in the class it's important that the}
\DoxyCodeLine{// << operator is defined in the SAME namespace that defines Bar.  C++'s look-\/up}
\DoxyCodeLine{// rules rely on that.}
\DoxyCodeLine{std::ostream\& operator<<(std::ostream\& os, const Bar\& bar) \{}
\DoxyCodeLine{  return os << bar.DebugString();  // whatever needed to print bar to os}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\}  // namespace foo}
\end{DoxyCode}


Sometimes, this might not be an option\+: your team may consider it bad style to have a {\ttfamily $<$$<$} operator for {\ttfamily Bar}, or {\ttfamily Bar} may already have a {\ttfamily $<$$<$} operator that doesn\textquotesingle{}t do what you want (and you cannot change it). If so, you can instead define a {\ttfamily Print\+To()} function like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{\#include <ostream>}
\DoxyCodeLine{}
\DoxyCodeLine{namespace foo \{}
\DoxyCodeLine{}
\DoxyCodeLine{class Bar \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  friend void PrintTo(const Bar\& bar, std::ostream* os) \{}
\DoxyCodeLine{    *os << bar.DebugString();  // whatever needed to print bar to os}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{// If you can't declare the function in the class it's important that PrintTo()}
\DoxyCodeLine{// is defined in the SAME namespace that defines Bar.  C++'s look-\/up rules rely}
\DoxyCodeLine{// on that.}
\DoxyCodeLine{void PrintTo(const Bar\& bar, std::ostream* os) \{}
\DoxyCodeLine{  *os << bar.DebugString();  // whatever needed to print bar to os}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\}  // namespace foo}
\end{DoxyCode}


If you have defined both {\ttfamily $<$$<$} and {\ttfamily Print\+To()}, the latter will be used when googletest is concerned. This allows you to customize how the value appears in googletest\textquotesingle{}s output without affecting code that relies on the behavior of its {\ttfamily $<$$<$} operator.

If you want to print a value {\ttfamily x} using googletest\textquotesingle{}s value printer yourself, just call {\ttfamily \+::testing\+::\+Print\+To\+String(x)}, which returns an {\ttfamily std\+::string}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{vector<pair<Bar, int> > bar\_ints = GetBarIntVector();}
\DoxyCodeLine{}
\DoxyCodeLine{EXPECT\_TRUE(IsCorrectBarIntVector(bar\_ints))}
\DoxyCodeLine{    << "bar\_ints = " << ::testing::PrintToString(bar\_ints);}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md154}{}\doxysection{Death Tests}\label{md__c_autotoc_md154}
In many applications, there are assertions that can cause application failure if a condition is not met. These sanity checks, which ensure that the program is in a known good state, are there to fail at the earliest possible time after some program state is corrupted. If the assertion checks the wrong condition, then the program may proceed in an erroneous state, which could lead to memory corruption, security holes, or worse. Hence it is vitally important to test that such assertion statements work as expected.

Since these precondition checks cause the processes to die, we call such tests {\itshape death tests}. More generally, any test that checks that a program terminates (except by throwing an exception) in an expected fashion is also a death test.

Note that if a piece of code throws an exception, we don\textquotesingle{}t consider it \char`\"{}death\char`\"{} for the purpose of death tests, as the caller of the code could catch the exception and avoid the crash. If you want to verify exceptions thrown by your code, see \href{\#ExceptionAssertions}{\texttt{ Exception Assertions}}.

If you want to test {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$()/\+A\+S\+S\+E\+R\+T\+\_\+$\ast$()} failures in your test code, see Catching Failures\hypertarget{md__c_autotoc_md155}{}\doxysubsection{How to Write a Death Test}\label{md__c_autotoc_md155}
googletest has the following macros to support death tests\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+T\+H(statement, matcher);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+T\+H(statement, matcher);}  &{\ttfamily statement} crashes with the given error   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+T\+H\+\_\+\+I\+F\+\_\+\+S\+U\+P\+P\+O\+R\+T\+E\+D(statement, matcher);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+T\+H\+\_\+\+I\+F\+\_\+\+S\+U\+P\+P\+O\+R\+T\+E\+D(statement, matcher);}  &if death tests are supported, verifies that {\ttfamily statement} crashes with the given error; otherwise verifies nothing   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+X\+I\+T(statement, predicate, matcher);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+X\+I\+T(statement, predicate, matcher);}  &{\ttfamily statement} exits with the given error, and its exit code matches {\ttfamily predicate}   \\\cline{1-3}
\end{longtabu}


where {\ttfamily statement} is a statement that is expected to cause the process to die, {\ttfamily predicate} is a function or function object that evaluates an integer exit status, and {\ttfamily matcher} is either a G\+Mock matcher matching a {\ttfamily const std\+::string\&} or a (Perl) regular expression -\/ either of which is matched against the stderr output of {\ttfamily statement}. For legacy reasons, a bare string (i.\+e. with no matcher) is interpreted as {\ttfamily Contains\+Regex(str)}, {\bfseries{not}} {\ttfamily Eq(str)}. Note that {\ttfamily statement} can be {\itshape any valid statement} (including {\itshape compound statement}) and doesn\textquotesingle{}t have to be an expression.

As usual, the {\ttfamily A\+S\+S\+E\+RT} variants abort the current test function, while the {\ttfamily E\+X\+P\+E\+CT} variants do not.

\begin{quote}
N\+O\+TE\+: We use the word \char`\"{}crash\char`\"{} here to mean that the process terminates with a {\itshape non-\/zero} exit status code. There are two possibilities\+: either the process has called {\ttfamily exit()} or {\ttfamily \+\_\+exit()} with a non-\/zero value, or it may be killed by a signal.

This means that if {\ttfamily $\ast$statement$\ast$} terminates the process with a 0 exit code, it is {\itshape not} considered a crash by {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+TH}. Use {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+X\+IT} instead if this is the case, or if you want to restrict the exit code more precisely. \end{quote}


A predicate here must accept an {\ttfamily int} and return a {\ttfamily bool}. The death test succeeds only if the predicate returns {\ttfamily true}. googletest defines a few predicates that handle the most common cases\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::ExitedWithCode(exit\_code)}
\end{DoxyCode}


This expression is {\ttfamily true} if the program exited normally with the given exit code.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::KilledBySignal(signal\_number)  // Not available on Windows.}
\end{DoxyCode}


This expression is {\ttfamily true} if the program was killed by the given signal.

The {\ttfamily $\ast$\+\_\+\+D\+E\+A\+TH} macros are convenient wrappers for {\ttfamily $\ast$\+\_\+\+E\+X\+IT} that use a predicate that verifies the process\textquotesingle{} exit code is non-\/zero.

Note that a death test only cares about three things\+:


\begin{DoxyEnumerate}
\item does {\ttfamily statement} abort or exit the process?
\item (in the case of {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+X\+IT} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+X\+IT}) does the exit status satisfy {\ttfamily predicate}? Or (in the case of {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+TH} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+TH}) is the exit status non-\/zero? And
\item does the stderr output match {\ttfamily regex}?
\end{DoxyEnumerate}

In particular, if {\ttfamily statement} generates an {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} or {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$} failure, it will {\bfseries{not}} cause the death test to fail, as googletest assertions don\textquotesingle{}t abort the process.

To write a death test, simply use one of the above macros inside your test function. For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST(MyDeathTest, Foo) \{}
\DoxyCodeLine{  // This death test uses a compound statement.}
\DoxyCodeLine{  ASSERT\_DEATH(\{}
\DoxyCodeLine{    int n = 5;}
\DoxyCodeLine{    Foo(\&n);}
\DoxyCodeLine{  \}, "Error on line .* of Foo()");}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(MyDeathTest, NormalExit) \{}
\DoxyCodeLine{  EXPECT\_EXIT(NormalExit(), ::testing::ExitedWithCode(0), "Success");}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(MyDeathTest, KillMyself) \{}
\DoxyCodeLine{  EXPECT\_EXIT(KillMyself(), ::testing::KilledBySignal(SIGKILL),}
\DoxyCodeLine{              "Sending myself unblockable signal");}
\DoxyCodeLine{\}}
\end{DoxyCode}


verifies that\+:


\begin{DoxyItemize}
\item calling {\ttfamily Foo(5)} causes the process to die with the given error message,
\item calling {\ttfamily Normal\+Exit()} causes the process to print {\ttfamily \char`\"{}\+Success\char`\"{}} to stderr and exit with exit code 0, and
\item calling {\ttfamily Kill\+Myself()} kills the process with signal {\ttfamily S\+I\+G\+K\+I\+LL}.
\end{DoxyItemize}

The test function body may contain other assertions and statements as well, if necessary.\hypertarget{md__c_autotoc_md156}{}\doxysubsection{Death Test Naming}\label{md__c_autotoc_md156}
I\+M\+P\+O\+R\+T\+A\+NT\+: We strongly recommend you to follow the convention of naming your {\bfseries{test suite}} (not test) {\ttfamily $\ast$\+Death\+Test} when it contains a death test, as demonstrated in the above example. The \href{\#death-tests-and-threads}{\texttt{ Death Tests And Threads}} section below explains why.

If a test fixture class is shared by normal tests and death tests, you can use {\ttfamily using} or {\ttfamily typedef} to introduce an alias for the fixture class and avoid duplicating its code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class FooTest : public ::testing::Test \{ ... \};}
\DoxyCodeLine{}
\DoxyCodeLine{using FooDeathTest = FooTest;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, DoesThis) \{}
\DoxyCodeLine{  // normal test}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooDeathTest, DoesThat) \{}
\DoxyCodeLine{  // death test}
\DoxyCodeLine{\}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md157}{}\doxysubsection{Regular Expression Syntax}\label{md__c_autotoc_md157}
On P\+O\+S\+IX systems (e.\+g. Linux, Cygwin, and Mac), googletest uses the \href{http://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html\#tag_09_04}{\texttt{ P\+O\+S\+IX extended regular expression}} syntax. To learn about this syntax, you may want to read this \href{http://en.wikipedia.org/wiki/Regular_expression\#POSIX_Extended_Regular_Expressions}{\texttt{ Wikipedia entry}}.

On Windows, googletest uses its own simple regular expression implementation. It lacks many features. For example, we don\textquotesingle{}t support union ({\ttfamily \char`\"{}x$\vert$y\char`\"{}}), grouping ({\ttfamily \char`\"{}(xy)\char`\"{}}), brackets ({\ttfamily \char`\"{}\mbox{[}xy\mbox{]}\char`\"{}}), and repetition count ({\ttfamily \char`\"{}x\{5,7\}\char`\"{}}), among others. Below is what we do support ({\ttfamily A} denotes a literal character, period ({\ttfamily .}), or a single {\ttfamily \textbackslash{}\textbackslash{}} escape sequence; {\ttfamily x} and {\ttfamily y} denote regular expressions.)\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expression  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Meaning   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expression  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Meaning   }\\\cline{1-2}
\endhead
{\ttfamily c}  &matches any literal character {\ttfamily c}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}d}  &matches any decimal digit   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}D}  &matches any character that\textquotesingle{}s not a decimal digit   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}f}  &matches {\ttfamily \textbackslash{}f}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}n}  &matches {\ttfamily \textbackslash{}n}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}r}  &matches {\ttfamily \textbackslash{}r}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}s}  &matches any A\+S\+C\+II whitespace, including {\ttfamily \textbackslash{}n}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}S}  &matches any character that\textquotesingle{}s not a whitespace   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}t}  &matches {\ttfamily \textbackslash{}t}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}v}  &matches {\ttfamily \textbackslash{}v}   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}w}  &matches any letter, {\ttfamily \+\_\+}, or decimal digit   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}W}  &matches any character that {\ttfamily \textbackslash{}\textbackslash{}w} doesn\textquotesingle{}t match   \\\cline{1-2}
{\ttfamily \textbackslash{}\textbackslash{}c}  &matches any literal character {\ttfamily c}, which must be a punctuation   \\\cline{1-2}
{\ttfamily .}  &matches any single character except {\ttfamily \textbackslash{}n}   \\\cline{1-2}
{\ttfamily A?}  &matches 0 or 1 occurrences of {\ttfamily A}   \\\cline{1-2}
{\ttfamily A$\ast$}  &matches 0 or many occurrences of {\ttfamily A}   \\\cline{1-2}
{\ttfamily A+}  &matches 1 or many occurrences of {\ttfamily A}   \\\cline{1-2}
{\ttfamily $^\wedge$}  &matches the beginning of a string (not that of each line)   \\\cline{1-2}
{\ttfamily \$}  &matches the end of a string (not that of each line)   \\\cline{1-2}
{\ttfamily xy}  &matches {\ttfamily x} followed by {\ttfamily y}   \\\cline{1-2}
\end{longtabu}


To help you determine which capability is available on your system, googletest defines macros to govern which regular expression it is using. The macros are\+: {\ttfamily G\+T\+E\+S\+T\+\_\+\+U\+S\+E\+S\+\_\+\+S\+I\+M\+P\+L\+E\+\_\+\+RE=1} or {\ttfamily G\+T\+E\+S\+T\+\_\+\+U\+S\+E\+S\+\_\+\+P\+O\+S\+I\+X\+\_\+\+RE=1}. If you want your death tests to work in all cases, you can either {\ttfamily \#if} on these macros or use the more limited syntax only.\hypertarget{md__c_autotoc_md158}{}\doxysubsection{How It Works}\label{md__c_autotoc_md158}
Under the hood, {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+X\+I\+T()} spawns a new process and executes the death test statement in that process. The details of how precisely that happens depend on the platform and the variable \+::testing\+::\+G\+T\+E\+S\+T\+\_\+\+F\+L\+A\+G(death\+\_\+test\+\_\+style) (which is initialized from the command-\/line flag {\ttfamily -\/-\/gtest\+\_\+death\+\_\+test\+\_\+style}).


\begin{DoxyItemize}
\item On P\+O\+S\+IX systems, {\ttfamily fork()} (or {\ttfamily clone()} on Linux) is used to spawn the child, after which\+:
\begin{DoxyItemize}
\item If the variable\textquotesingle{}s value is {\ttfamily \char`\"{}fast\char`\"{}}, the death test statement is immediately executed.
\item If the variable\textquotesingle{}s value is {\ttfamily \char`\"{}threadsafe\char`\"{}}, the child process re-\/executes the unit test binary just as it was originally invoked, but with some extra flags to cause just the single death test under consideration to be run.
\end{DoxyItemize}
\item On Windows, the child is spawned using the {\ttfamily Create\+Process()} A\+PI, and re-\/executes the binary to cause just the single death test under consideration to be run -\/ much like the {\ttfamily threadsafe} mode on P\+O\+S\+IX.
\end{DoxyItemize}

Other values for the variable are illegal and will cause the death test to fail. Currently, the flag\textquotesingle{}s default value is $\ast$$\ast$\char`\"{}fast\char`\"{}$\ast$$\ast$


\begin{DoxyEnumerate}
\item the child\textquotesingle{}s exit status satisfies the predicate, and
\item the child\textquotesingle{}s stderr matches the regular expression.
\end{DoxyEnumerate}

If the death test statement runs to completion without dying, the child process will nonetheless terminate, and the assertion fails.\hypertarget{md__c_autotoc_md159}{}\doxysubsection{Death Tests And Threads}\label{md__c_autotoc_md159}
The reason for the two death test styles has to do with thread safety. Due to well-\/known problems with forking in the presence of threads, death tests should be run in a single-\/threaded context. Sometimes, however, it isn\textquotesingle{}t feasible to arrange that kind of environment. For example, statically-\/initialized modules may start threads before main is ever reached. Once threads have been created, it may be difficult or impossible to clean them up.

googletest has three features intended to raise awareness of threading issues.


\begin{DoxyEnumerate}
\item A warning is emitted if multiple threads are running when a death test is encountered.
\item Test suites with a name ending in \char`\"{}\+Death\+Test\char`\"{} are run before all other tests.
\item It uses {\ttfamily clone()} instead of {\ttfamily fork()} to spawn the child process on Linux ({\ttfamily clone()} is not available on Cygwin and Mac), as {\ttfamily fork()} is more likely to cause the child to hang when the parent process has multiple threads.
\end{DoxyEnumerate}

It\textquotesingle{}s perfectly fine to create threads inside a death test statement; they are executed in a separate process and cannot affect the parent.\hypertarget{md__c_autotoc_md160}{}\doxysubsection{Death Test Styles}\label{md__c_autotoc_md160}
The \char`\"{}threadsafe\char`\"{} death test style was introduced in order to help mitigate the risks of testing in a possibly multithreaded environment. It trades increased test execution time (potentially dramatically so) for improved thread safety.

The automated testing framework does not set the style flag. You can choose a particular style of death tests by setting the flag programmatically\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{testing::FLAGS\_gtest\_death\_test\_style="threadsafe"}
\end{DoxyCode}


You can do this in {\ttfamily main()} to set the style for all death tests in the binary, or in individual tests. Recall that flags are saved before running each test and restored afterwards, so you need not do that yourself. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{int main(int argc, char** argv) \{}
\DoxyCodeLine{  InitGoogle(argv[0], \&argc, \&argv, true);}
\DoxyCodeLine{  ::testing::FLAGS\_gtest\_death\_test\_style = "fast";}
\DoxyCodeLine{  return RUN\_ALL\_TESTS();}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(MyDeathTest, TestOne) \{}
\DoxyCodeLine{  ::testing::FLAGS\_gtest\_death\_test\_style = "threadsafe";}
\DoxyCodeLine{  // This test is run in the "threadsafe" style:}
\DoxyCodeLine{  ASSERT\_DEATH(ThisShouldDie(), "");}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(MyDeathTest, TestTwo) \{}
\DoxyCodeLine{  // This test is run in the "fast" style:}
\DoxyCodeLine{  ASSERT\_DEATH(ThisShouldDie(), "");}
\DoxyCodeLine{\}}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md161}{}\doxysubsection{Caveats}\label{md__c_autotoc_md161}
The {\ttfamily statement} argument of {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+X\+I\+T()} can be any valid C++ statement. If it leaves the current function via a {\ttfamily return} statement or by throwing an exception, the death test is considered to have failed. Some googletest macros may return from the current function (e.\+g. {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+R\+U\+E()}), so be sure to avoid them in {\ttfamily statement}.

Since {\ttfamily statement} runs in the child process, any in-\/memory side effect (e.\+g. modifying a variable, releasing memory, etc) it causes will {\itshape not} be observable in the parent process. In particular, if you release memory in a death test, your program will fail the heap check as the parent process will never see the memory reclaimed. To solve this problem, you can


\begin{DoxyEnumerate}
\item try not to free memory in a death test;
\item free the memory again in the parent process; or
\item do not use the heap checker in your program.
\end{DoxyEnumerate}

Due to an implementation detail, you cannot place multiple death test assertions on the same line; otherwise, compilation will fail with an unobvious error message.

Despite the improved thread safety afforded by the \char`\"{}threadsafe\char`\"{} style of death test, thread problems such as deadlock are still possible in the presence of handlers registered with {\ttfamily pthread\+\_\+atfork(3)}.\hypertarget{md__c_autotoc_md162}{}\doxysection{Using Assertions in Sub-\/routines}\label{md__c_autotoc_md162}
\hypertarget{md__c_autotoc_md163}{}\doxysubsection{Adding Traces to Assertions}\label{md__c_autotoc_md163}
If a test sub-\/routine is called from several places, when an assertion inside it fails, it can be hard to tell which invocation of the sub-\/routine the failure is from. You can alleviate this problem using extra logging or custom failure messages, but that usually clutters up your tests. A better solution is to use the {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE} macro or the {\ttfamily Scoped\+Trace} utility\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{SCOPED\_TRACE(message);}
\DoxyCodeLine{ScopedTrace trace("file\_path", line\_number, message);}
\end{DoxyCode}


where {\ttfamily message} can be anything streamable to {\ttfamily std\+::ostream}. {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE} macro will cause the current file name, line number, and the given message to be added in every failure message. {\ttfamily Scoped\+Trace} accepts explicit file name and line number in arguments, which is useful for writing test helpers. The effect will be undone when the control leaves the current lexical scope.

For example,


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{10: void Sub1(int n) \{}
\DoxyCodeLine{11:   EXPECT\_EQ(Bar(n), 1);}
\DoxyCodeLine{12:   EXPECT\_EQ(Bar(n + 1), 2);}
\DoxyCodeLine{13: \}}
\DoxyCodeLine{14:}
\DoxyCodeLine{15: TEST(FooTest, Bar) \{}
\DoxyCodeLine{16:   \{}
\DoxyCodeLine{17:     SCOPED\_TRACE("A");  // This trace point will be included in}
\DoxyCodeLine{18:                         // every failure in this scope.}
\DoxyCodeLine{19:     Sub1(1);}
\DoxyCodeLine{20:   \}}
\DoxyCodeLine{21:   // Now it won't.}
\DoxyCodeLine{22:   Sub1(9);}
\DoxyCodeLine{23: \}}
\end{DoxyCode}


could result in messages like these\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{path/to/foo\_test.cc:11: Failure}
\DoxyCodeLine{Value of: Bar(n)}
\DoxyCodeLine{Expected: 1}
\DoxyCodeLine{  Actual: 2}
\DoxyCodeLine{   Trace:}
\DoxyCodeLine{path/to/foo\_test.cc:17: A}
\DoxyCodeLine{}
\DoxyCodeLine{path/to/foo\_test.cc:12: Failure}
\DoxyCodeLine{Value of: Bar(n + 1)}
\DoxyCodeLine{Expected: 2}
\DoxyCodeLine{  Actual: 3}
\end{DoxyCode}


Without the trace, it would\textquotesingle{}ve been difficult to know which invocation of {\ttfamily Sub1()} the two failures come from respectively. (You could add an extra message to each assertion in {\ttfamily Sub1()} to indicate the value of {\ttfamily n}, but that\textquotesingle{}s tedious.)

Some tips on using {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE}\+:


\begin{DoxyEnumerate}
\item With a suitable message, it\textquotesingle{}s often enough to use {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE} at the beginning of a sub-\/routine, instead of at each call site.
\item When calling sub-\/routines inside a loop, make the loop iterator part of the message in {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE} such that you can know which iteration the failure is from.
\item Sometimes the line number of the trace point is enough for identifying the particular invocation of a sub-\/routine. In this case, you don\textquotesingle{}t have to choose a unique message for {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE}. You can simply use {\ttfamily \char`\"{}\char`\"{}}.
\item You can use {\ttfamily S\+C\+O\+P\+E\+D\+\_\+\+T\+R\+A\+CE} in an inner scope when there is one in the outer scope. In this case, all active trace points will be included in the failure messages, in reverse order they are encountered.
\item The trace dump is clickable in Emacs -\/ hit {\ttfamily return} on a line number and you\textquotesingle{}ll be taken to that line in the source file!
\end{DoxyEnumerate}\hypertarget{md__c_autotoc_md164}{}\doxysubsection{Propagating Fatal Failures}\label{md__c_autotoc_md164}
A common pitfall when using {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} and {\ttfamily F\+A\+I\+L$\ast$} is not understanding that when they fail they only abort the {\itshape current function}, not the entire test. For example, the following test will segfault\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{void Subroutine() \{}
\DoxyCodeLine{  // Generates a fatal failure and aborts the current function.}
\DoxyCodeLine{  ASSERT\_EQ(1, 2);}
\DoxyCodeLine{}
\DoxyCodeLine{  // The following won't be executed.}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(FooTest, Bar) \{}
\DoxyCodeLine{  Subroutine();  // The intended behavior is for the fatal failure}
\DoxyCodeLine{                 // in Subroutine() to abort the entire test.}
\DoxyCodeLine{}
\DoxyCodeLine{  // The actual behavior: the function goes on after Subroutine() returns.}
\DoxyCodeLine{  int* p = NULL;}
\DoxyCodeLine{  *p = 3;  // Segfault!}
\DoxyCodeLine{\}}
\end{DoxyCode}


To alleviate this, googletest provides three different solutions. You could use either exceptions, the {\ttfamily (A\+S\+S\+E\+R\+T$\vert$\+E\+X\+P\+E\+CT)\+\_\+\+N\+O\+\_\+\+F\+A\+T\+A\+L\+\_\+\+F\+A\+I\+L\+U\+RE} assertions or the {\ttfamily Has\+Fatal\+Failure()} function. They are described in the following two subsections.\hypertarget{md__c_autotoc_md165}{}\doxysubsubsection{Asserting on Subroutines with an exception}\label{md__c_autotoc_md165}
The following code can turn A\+S\+S\+E\+R\+T-\/failure into an exception\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class ThrowListener : public testing::EmptyTestEventListener \{}
\DoxyCodeLine{  void OnTestPartResult(const testing::TestPartResult\& result) override \{}
\DoxyCodeLine{    if (result.type() == testing::TestPartResult::kFatalFailure) \{}
\DoxyCodeLine{      throw testing::AssertionException(result);}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{int main(int argc, char** argv) \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  testing::UnitTest::GetInstance()-\/>listeners().Append(new ThrowListener);}
\DoxyCodeLine{  return RUN\_ALL\_TESTS();}
\DoxyCodeLine{\}}
\end{DoxyCode}


This listener should be added after other listeners if you have any, otherwise they won\textquotesingle{}t see failed {\ttfamily On\+Test\+Part\+Result}.\hypertarget{md__c_autotoc_md166}{}\doxysubsubsection{Asserting on Subroutines}\label{md__c_autotoc_md166}
As shown above, if your test calls a subroutine that has an {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} failure in it, the test will continue after the subroutine returns. This may not be what you want.

Often people want fatal failures to propagate like exceptions. For that googletest offers the following macros\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+N\+O\+\_\+\+F\+A\+T\+A\+L\+\_\+\+F\+A\+I\+L\+U\+R\+E(statement);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+O\+\_\+\+F\+A\+T\+A\+L\+\_\+\+F\+A\+I\+L\+U\+R\+E(statement);}  &{\ttfamily statement} doesn\textquotesingle{}t generate any new fatal failures in the current thread.   \\\cline{1-3}
\end{longtabu}


Only failures in the thread that executes the assertion are checked to determine the result of this type of assertions. If {\ttfamily statement} creates new threads, failures in these threads are ignored.

Examples\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{ASSERT\_NO\_FATAL\_FAILURE(Foo());}
\DoxyCodeLine{}
\DoxyCodeLine{int i;}
\DoxyCodeLine{EXPECT\_NO\_FATAL\_FAILURE(\{}
\DoxyCodeLine{  i = Bar();}
\DoxyCodeLine{\});}
\end{DoxyCode}


Assertions from multiple threads are currently not supported on Windows.\hypertarget{md__c_autotoc_md167}{}\doxysubsubsection{Checking for Failures in the Current Test}\label{md__c_autotoc_md167}
{\ttfamily Has\+Fatal\+Failure()} in the {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}} class returns {\ttfamily true} if an assertion in the current test has suffered a fatal failure. This allows functions to catch fatal failures in a sub-\/routine and return early.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class Test \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  static bool HasFatalFailure();}
\DoxyCodeLine{\};}
\end{DoxyCode}


The typical usage, which basically simulates the behavior of a thrown exception, is\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST(FooTest, Bar) \{}
\DoxyCodeLine{  Subroutine();}
\DoxyCodeLine{  // Aborts if Subroutine() had a fatal failure.}
\DoxyCodeLine{  if (HasFatalFailure()) return;}
\DoxyCodeLine{}
\DoxyCodeLine{  // The following won't be executed.}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


If {\ttfamily Has\+Fatal\+Failure()} is used outside of {\ttfamily T\+E\+S\+T()} , {\ttfamily T\+E\+S\+T\+\_\+\+F()} , or a test fixture, you must add the {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}\+:\+:} prefix, as in\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{if (::testing::Test::HasFatalFailure()) return;}
\end{DoxyCode}


Similarly, {\ttfamily Has\+Nonfatal\+Failure()} returns {\ttfamily true} if the current test has at least one non-\/fatal failure, and {\ttfamily Has\+Failure()} returns {\ttfamily true} if the current test has at least one failure of either kind.\hypertarget{md__c_autotoc_md168}{}\doxysection{Logging Additional Information}\label{md__c_autotoc_md168}
In your test code, you can call {\ttfamily Record\+Property(\char`\"{}key\char`\"{}, value)} to log additional information, where {\ttfamily value} can be either a string or an {\ttfamily int}. The {\itshape last} value recorded for a key will be emitted to the \href{\#generating-an-xml-report}{\texttt{ X\+ML output}} if you specify one. For example, the test


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST\_F(WidgetUsageTest, MinAndMaxWidgets) \{}
\DoxyCodeLine{  RecordProperty("MaximumWidgets", ComputeMaxUsage());}
\DoxyCodeLine{  RecordProperty("MinimumWidgets", ComputeMinUsage());}
\DoxyCodeLine{\}}
\end{DoxyCode}


will output X\+ML like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{...}
\DoxyCodeLine{  <\textcolor{keywordtype}{testcase} \textcolor{keyword}{name}=\textcolor{stringliteral}{"MinAndMaxWidgets"} \textcolor{keyword}{status}=\textcolor{stringliteral}{"run"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.006"} \textcolor{keyword}{classname}=\textcolor{stringliteral}{"WidgetUsageTest"} \textcolor{keyword}{MaximumWidgets}=\textcolor{stringliteral}{"12"} \textcolor{keyword}{MinimumWidgets}=\textcolor{stringliteral}{"9"} />}
\DoxyCodeLine{...}
\end{DoxyCode}


\begin{quote}
N\+O\+TE\+:


\begin{DoxyItemize}
\item {\ttfamily Record\+Property()} is a static member of the {\ttfamily Test} class. Therefore it needs to be prefixed with {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}\+:\+:} if used outside of the {\ttfamily T\+E\+ST} body and the test fixture class.
\item {\ttfamily $\ast$key$\ast$} must be a valid X\+ML attribute name, and cannot conflict with the ones already used by googletest ({\ttfamily name}, {\ttfamily status}, {\ttfamily time}, {\ttfamily classname}, {\ttfamily type\+\_\+param}, and {\ttfamily value\+\_\+param}).
\item Calling {\ttfamily Record\+Property()} outside of the lifespan of a test is allowed. If it\textquotesingle{}s called outside of a test but between a test suite\textquotesingle{}s {\ttfamily Set\+Up\+Test\+Suite()} and {\ttfamily Tear\+Down\+Test\+Suite()} methods, it will be attributed to the X\+ML element for the test suite. If it\textquotesingle{}s called outside of all test suites (e.\+g. in a test environment), it will be attributed to the top-\/level X\+ML element. 
\end{DoxyItemize}\end{quote}
\hypertarget{md__c_autotoc_md169}{}\doxysection{Sharing Resources Between Tests in the Same Test Suite}\label{md__c_autotoc_md169}
googletest creates a new test fixture object for each test in order to make tests independent and easier to debug. However, sometimes tests use resources that are expensive to set up, making the one-\/copy-\/per-\/test model prohibitively expensive.

If the tests don\textquotesingle{}t change the resource, there\textquotesingle{}s no harm in their sharing a single resource copy. So, in addition to per-\/test set-\/up/tear-\/down, googletest also supports per-\/test-\/suite set-\/up/tear-\/down. To use it\+:


\begin{DoxyEnumerate}
\item In your test fixture class (say {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} ), declare as {\ttfamily static} some member variables to hold the shared resources.
\item Outside your test fixture class (typically just below it), define those member variables, optionally giving them initial values.
\item In the same test fixture class, define a {\ttfamily static void Set\+Up\+Test\+Suite()} function (remember not to spell it as $\ast$$\ast${\ttfamily Setup\+Test\+Suite}$\ast$$\ast$ with a small {\ttfamily u}!) to set up the shared resources and a {\ttfamily static void Tear\+Down\+Test\+Suite()} function to tear them down.
\end{DoxyEnumerate}

That\textquotesingle{}s it! googletest automatically calls {\ttfamily Set\+Up\+Test\+Suite()} before running the {\itshape first test} in the {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} test suite (i.\+e. before creating the first {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} object), and calls {\ttfamily Tear\+Down\+Test\+Suite()} after running the {\itshape last test} in it (i.\+e. after deleting the last {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} object). In between, the tests can use the shared resources.

Remember that the test order is undefined, so your code can\textquotesingle{}t depend on a test preceding or following another. Also, the tests must either not modify the state of any shared resource, or, if they do modify the state, they must restore the state to its original value before passing control to the next test.

Here\textquotesingle{}s an example of per-\/test-\/suite set-\/up and tear-\/down\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class FooTest : public ::testing::Test \{}
\DoxyCodeLine{ protected:}
\DoxyCodeLine{  // Per-\/test-\/suite set-\/up.}
\DoxyCodeLine{  // Called before the first test in this test suite.}
\DoxyCodeLine{  // Can be omitted if not needed.}
\DoxyCodeLine{  static void SetUpTestSuite() \{}
\DoxyCodeLine{    shared\_resource\_ = new ...;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // Per-\/test-\/suite tear-\/down.}
\DoxyCodeLine{  // Called after the last test in this test suite.}
\DoxyCodeLine{  // Can be omitted if not needed.}
\DoxyCodeLine{  static void TearDownTestSuite() \{}
\DoxyCodeLine{    delete shared\_resource\_;}
\DoxyCodeLine{    shared\_resource\_ = NULL;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // You can define per-\/test set-\/up logic as usual.}
\DoxyCodeLine{  virtual void SetUp() \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // You can define per-\/test tear-\/down logic as usual.}
\DoxyCodeLine{  virtual void TearDown() \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // Some expensive resource shared by all tests.}
\DoxyCodeLine{  static T* shared\_resource\_;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{T* FooTest::shared\_resource\_ = NULL;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, Test1) \{}
\DoxyCodeLine{  ... you can refer to shared\_resource\_ here ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, Test2) \{}
\DoxyCodeLine{  ... you can refer to shared\_resource\_ here ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


N\+O\+TE\+: Though the above code declares {\ttfamily Set\+Up\+Test\+Suite()} protected, it may sometimes be necessary to declare it public, such as when using it with {\ttfamily T\+E\+S\+T\+\_\+P}.\hypertarget{md__c_autotoc_md170}{}\doxysection{Global Set-\/\+Up and Tear-\/\+Down}\label{md__c_autotoc_md170}
Just as you can do set-\/up and tear-\/down at the test level and the test suite level, you can also do it at the test program level. Here\textquotesingle{}s how.

First, you subclass the {\ttfamily \mbox{\hyperlink{classtesting_1_1_environment}{testing\+::\+Environment}}} class to define a test environment, which knows how to set-\/up and tear-\/down\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class Environment : public ::testing::Environment \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  virtual ~Environment() \{\}}
\DoxyCodeLine{}
\DoxyCodeLine{  // Override this to define how to set up the environment.}
\DoxyCodeLine{  void SetUp() override \{\}}
\DoxyCodeLine{}
\DoxyCodeLine{  // Override this to define how to tear down the environment.}
\DoxyCodeLine{  void TearDown() override \{\}}
\DoxyCodeLine{\};}
\end{DoxyCode}


Then, you register an instance of your environment class with googletest by calling the {\ttfamily \+::testing\+::\+Add\+Global\+Test\+Environment()} function\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{Environment* AddGlobalTestEnvironment(Environment* env);}
\end{DoxyCode}


Now, when {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} is called, it first calls the {\ttfamily Set\+Up()} method of each environment object, then runs the tests if none of the environments reported fatal failures and {\ttfamily G\+T\+E\+S\+T\+\_\+\+S\+K\+I\+P()} was not called. {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} always calls {\ttfamily Tear\+Down()} with each environment object, regardless of whether or not the tests were run.

It\textquotesingle{}s OK to register multiple environment objects. In this suite, their {\ttfamily Set\+Up()} will be called in the order they are registered, and their {\ttfamily Tear\+Down()} will be called in the reverse order.

Note that googletest takes ownership of the registered environment objects. Therefore {\bfseries{do not delete them}} by yourself.

You should call {\ttfamily Add\+Global\+Test\+Environment()} before {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} is called, probably in {\ttfamily main()}. If you use {\ttfamily gtest\+\_\+main}, you need to call this before {\ttfamily main()} starts for it to take effect. One way to do this is to define a global variable like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{::testing::Environment* const foo\_env =}
\DoxyCodeLine{    ::testing::AddGlobalTestEnvironment(new FooEnvironment);}
\end{DoxyCode}


However, we strongly recommend you to write your own {\ttfamily main()} and call {\ttfamily Add\+Global\+Test\+Environment()} there, as relying on initialization of global variables makes the code harder to read and may cause problems when you register multiple environments from different translation units and the environments have dependencies among them (remember that the compiler doesn\textquotesingle{}t guarantee the order in which global variables from different translation units are initialized).\hypertarget{md__c_autotoc_md171}{}\doxysection{Value-\/\+Parameterized Tests}\label{md__c_autotoc_md171}
{\itshape Value-\/parameterized tests} allow you to test your code with different parameters without writing multiple copies of the same test. This is useful in a number of situations, for example\+:


\begin{DoxyItemize}
\item You have a piece of code whose behavior is affected by one or more command-\/line flags. You want to make sure your code performs correctly for various values of those flags.
\item You want to test different implementations of an OO interface.
\item You want to test your code over various inputs (a.\+k.\+a. data-\/driven testing). This feature is easy to abuse, so please exercise your good sense when doing it!
\end{DoxyItemize}\hypertarget{md__c_autotoc_md172}{}\doxysubsection{How to Write Value-\/\+Parameterized Tests}\label{md__c_autotoc_md172}
To write value-\/parameterized tests, first you should define a fixture class. It must be derived from both {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}} and {\ttfamily \mbox{\hyperlink{classtesting_1_1_with_param_interface}{testing\+::\+With\+Param\+Interface}}$<$T$>$} (the latter is a pure interface), where {\ttfamily T} is the type of your parameter values. For convenience, you can just derive the fixture class from {\ttfamily \mbox{\hyperlink{classtesting_1_1_test_with_param}{testing\+::\+Test\+With\+Param}}$<$T$>$}, which itself is derived from both {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}} and {\ttfamily \mbox{\hyperlink{classtesting_1_1_with_param_interface}{testing\+::\+With\+Param\+Interface}}$<$T$>$}. {\ttfamily T} can be any copyable type. If it\textquotesingle{}s a raw pointer, you are responsible for managing the lifespan of the pointed values.

N\+O\+TE\+: If your test fixture defines {\ttfamily Set\+Up\+Test\+Suite()} or {\ttfamily Tear\+Down\+Test\+Suite()} they must be declared {\bfseries{public}} rather than {\bfseries{protected}} in order to use {\ttfamily T\+E\+S\+T\+\_\+P}.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class FooTest :}
\DoxyCodeLine{    public testing::TestWithParam<const char*> \{}
\DoxyCodeLine{  // You can implement all the usual fixture class members here.}
\DoxyCodeLine{  // To access the test parameter, call GetParam() from class}
\DoxyCodeLine{  // TestWithParam<T>.}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{// Or, when you want to add parameters to a pre-\/existing fixture class:}
\DoxyCodeLine{class BaseTest : public testing::Test \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\DoxyCodeLine{class BarTest : public BaseTest,}
\DoxyCodeLine{                public testing::WithParamInterface<const char*> \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


Then, use the {\ttfamily T\+E\+S\+T\+\_\+P} macro to define as many test patterns using this fixture as you want. The {\ttfamily \+\_\+P} suffix is for \char`\"{}parameterized\char`\"{} or \char`\"{}pattern\char`\"{}, whichever you prefer to think.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST\_P(FooTest, DoesBlah) \{}
\DoxyCodeLine{  // Inside a test, access the test parameter with the GetParam() method}
\DoxyCodeLine{  // of the TestWithParam<T> class:}
\DoxyCodeLine{  EXPECT\_TRUE(foo.Blah(GetParam()));}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_P(FooTest, HasBlahBlah) \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\end{DoxyCode}


Finally, you can use {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P} to instantiate the test suite with any set of parameters you want. googletest defines a number of functions for generating test parameters. They return what we call (surprise!) {\itshape parameter generators}. Here is a summary of them, which are all in the {\ttfamily testing} namespace\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Parameter Generator  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Behavior   }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Parameter Generator  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Behavior   }\\\cline{1-2}
\endhead
{\ttfamily Range(begin, end \mbox{[}, step\mbox{]})}  &Yields values {\ttfamily \{begin, begin+step, begin+step+step, ...\}}. The values do not include {\ttfamily end}. {\ttfamily step} defaults to 1.   \\\cline{1-2}
{\ttfamily Values(v1, v2, ..., v\+N)}  &Yields values {\ttfamily \{v1, v2, ..., vN\}}.   \\\cline{1-2}
{\ttfamily Values\+In(container)} and {\ttfamily Values\+In(begin,end)}  &Yields values from a C-\/style array, an S\+T\+L-\/style container, or an iterator range {\ttfamily \mbox{[}begin, end)}   \\\cline{1-2}
{\ttfamily \mbox{\hyperlink{struct_bool}{Bool()}}}  &Yields sequence {\ttfamily \{false, true\}}.   \\\cline{1-2}
{\ttfamily Combine(g1, g2, ..., g\+N)}  &Yields all combinations (Cartesian product) as std\textbackslash{}\+:\textbackslash{}\+:tuples of the values generated by the {\ttfamily N} generators.   \\\cline{1-2}
\end{longtabu}


For more details, see the comments at the definitions of these functions.

The following statement will instantiate tests from the {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} test suite each with parameter values {\ttfamily \char`\"{}meeny\char`\"{}}, {\ttfamily \char`\"{}miny\char`\"{}}, and {\ttfamily \char`\"{}moe\char`\"{}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{INSTANTIATE\_TEST\_SUITE\_P(InstantiationName,}
\DoxyCodeLine{                         FooTest,}
\DoxyCodeLine{                         testing::Values("meeny", "miny", "moe"));}
\end{DoxyCode}


N\+O\+TE\+: The code above must be placed at global or namespace scope, not at function scope.

N\+O\+TE\+: Don\textquotesingle{}t forget this step! If you do your test will silently pass, but none of its suites will ever run!

To distinguish different instances of the pattern (yes, you can instantiate it more than once), the first argument to {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P} is a prefix that will be added to the actual test suite name. Remember to pick unique prefixes for different instantiations. The tests from the instantiation above will have these names\+:


\begin{DoxyItemize}
\item {\ttfamily Instantiation\+Name/\+Foo\+Test.\+Does\+Blah/0} for {\ttfamily \char`\"{}meeny\char`\"{}}
\item {\ttfamily Instantiation\+Name/\+Foo\+Test.\+Does\+Blah/1} for {\ttfamily \char`\"{}miny\char`\"{}}
\item {\ttfamily Instantiation\+Name/\+Foo\+Test.\+Does\+Blah/2} for {\ttfamily \char`\"{}moe\char`\"{}}
\item {\ttfamily Instantiation\+Name/\+Foo\+Test.\+Has\+Blah\+Blah/0} for {\ttfamily \char`\"{}meeny\char`\"{}}
\item {\ttfamily Instantiation\+Name/\+Foo\+Test.\+Has\+Blah\+Blah/1} for {\ttfamily \char`\"{}miny\char`\"{}}
\item {\ttfamily Instantiation\+Name/\+Foo\+Test.\+Has\+Blah\+Blah/2} for {\ttfamily \char`\"{}moe\char`\"{}}
\end{DoxyItemize}

You can use these names in \href{\#running-a-subset-of-the-tests}{\texttt{ {\ttfamily -\/-\/gtest\+\_\+filter}}}.

This statement will instantiate all tests from {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} again, each with parameter values {\ttfamily \char`\"{}cat\char`\"{}} and {\ttfamily \char`\"{}dog\char`\"{}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{const char* pets[] = \{"cat", "dog"\};}
\DoxyCodeLine{INSTANTIATE\_TEST\_SUITE\_P(AnotherInstantiationName, FooTest,}
\DoxyCodeLine{                         testing::ValuesIn(pets));}
\end{DoxyCode}


The tests from the instantiation above will have these names\+:


\begin{DoxyItemize}
\item {\ttfamily Another\+Instantiation\+Name/\+Foo\+Test.\+Does\+Blah/0} for {\ttfamily \char`\"{}cat\char`\"{}}
\item {\ttfamily Another\+Instantiation\+Name/\+Foo\+Test.\+Does\+Blah/1} for {\ttfamily \char`\"{}dog\char`\"{}}
\item {\ttfamily Another\+Instantiation\+Name/\+Foo\+Test.\+Has\+Blah\+Blah/0} for {\ttfamily \char`\"{}cat\char`\"{}}
\item {\ttfamily Another\+Instantiation\+Name/\+Foo\+Test.\+Has\+Blah\+Blah/1} for {\ttfamily \char`\"{}dog\char`\"{}}
\end{DoxyItemize}

Please note that {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P} will instantiate {\itshape all} tests in the given test suite, whether their definitions come before or {\itshape after} the {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P} statement.

You can see \href{../samples/sample7_unittest.cc}{\texttt{ sample7\+\_\+unittest.\+cc}} and \href{../samples/sample8_unittest.cc}{\texttt{ sample8\+\_\+unittest.\+cc}} for more examples.\hypertarget{md__c_autotoc_md173}{}\doxysubsection{Creating Value-\/\+Parameterized Abstract Tests}\label{md__c_autotoc_md173}
In the above, we define and instantiate {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} in the {\itshape same} source file. Sometimes you may want to define value-\/parameterized tests in a library and let other people instantiate them later. This pattern is known as {\itshape abstract tests}. As an example of its application, when you are designing an interface you can write a standard suite of abstract tests (perhaps using a factory function as the test parameter) that all implementations of the interface are expected to pass. When someone implements the interface, they can instantiate your suite to get all the interface-\/conformance tests for free.

To define abstract tests, you should organize your code like this\+:


\begin{DoxyEnumerate}
\item Put the definition of the parameterized test fixture class (e.\+g. {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}}) in a header file, say {\ttfamily foo\+\_\+param\+\_\+test.\+h}. Think of this as {\itshape declaring} your abstract tests.
\item Put the {\ttfamily T\+E\+S\+T\+\_\+P} definitions in {\ttfamily foo\+\_\+param\+\_\+test.\+cc}, which includes {\ttfamily foo\+\_\+param\+\_\+test.\+h}. Think of this as {\itshape implementing} your abstract tests.
\end{DoxyEnumerate}

Once they are defined, you can instantiate them by including {\ttfamily foo\+\_\+param\+\_\+test.\+h}, invoking {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+\+P()}, and depending on the library target that contains {\ttfamily foo\+\_\+param\+\_\+test.\+cc}. You can instantiate the same abstract test suite multiple times, possibly in different source files.\hypertarget{md__c_autotoc_md174}{}\doxysubsection{Specifying Names for Value-\/\+Parameterized Test Parameters}\label{md__c_autotoc_md174}
The optional last argument to {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+\+P()} allows the user to specify a function or functor that generates custom test name suffixes based on the test parameters. The function should accept one argument of type {\ttfamily \mbox{\hyperlink{structtesting_1_1_test_param_info}{testing\+::\+Test\+Param\+Info}}$<$class Param\+Type$>$}, and return {\ttfamily std\+::string}.

{\ttfamily \mbox{\hyperlink{structtesting_1_1_print_to_string_param_name}{testing\+::\+Print\+To\+String\+Param\+Name}}} is a builtin test suffix generator that returns the value of {\ttfamily testing\+::\+Print\+To\+String(\+Get\+Param())}. It does not work for {\ttfamily std\+::string} or C strings.

N\+O\+TE\+: test names must be non-\/empty, unique, and may only contain A\+S\+C\+II alphanumeric characters. In particular, they \href{faq.md\#why-should-test-suite-names-and-test-names-not-contain-underscore}{\texttt{ should not contain underscores}}


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class MyTestSuite : public testing::TestWithParam<int> \{\};}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_P(MyTestSuite, MyTest)}
\DoxyCodeLine{\{}
\DoxyCodeLine{  std::cout << "Example Test Param: " << GetParam() << std::endl;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{INSTANTIATE\_TEST\_SUITE\_P(MyGroup, MyTestSuite, testing::Range(0, 10),}
\DoxyCodeLine{                         testing::PrintToStringParamName());}
\end{DoxyCode}


Providing a custom functor allows for more control over test parameter name generation, especially for types where the automatic conversion does not generate helpful parameter names (e.\+g. strings as demonstrated above). The following example illustrates this for multiple parameters, an enumeration type and a string, and also demonstrates how to combine generators. It uses a lambda for conciseness\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{enum class MyType \{ MY\_FOO = 0, MY\_BAR = 1 \};}
\DoxyCodeLine{}
\DoxyCodeLine{class MyTestSuite : public testing::TestWithParam<std::tuple<MyType, string>> \{}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{INSTANTIATE\_TEST\_SUITE\_P(}
\DoxyCodeLine{    MyGroup, MyTestSuite,}
\DoxyCodeLine{    testing::Combine(}
\DoxyCodeLine{        testing::Values(MyType::VALUE\_0, MyType::VALUE\_1),}
\DoxyCodeLine{        testing::ValuesIn("", "")),}
\DoxyCodeLine{    [](const testing::TestParamInfo<MyTestSuite::ParamType>\& info) \{}
\DoxyCodeLine{      string name = absl::StrCat(}
\DoxyCodeLine{          std::get<0>(info.param) == MY\_FOO ? "Foo" : "Bar", "\_",}
\DoxyCodeLine{          std::get<1>(info.param));}
\DoxyCodeLine{      absl::c\_replace\_if(name, [](char c) \{ return !std::isalnum(c); \}, '\_');}
\DoxyCodeLine{      return name;}
\DoxyCodeLine{    \});}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md175}{}\doxysection{Typed Tests}\label{md__c_autotoc_md175}
Suppose you have multiple implementations of the same interface and want to make sure that all of them satisfy some common requirements. Or, you may have defined several types that are supposed to conform to the same \char`\"{}concept\char`\"{} and you want to verify it. In both cases, you want the same test logic repeated for different types.

While you can write one {\ttfamily T\+E\+ST} or {\ttfamily T\+E\+S\+T\+\_\+F} for each type you want to test (and you may even factor the test logic into a function template that you invoke from the {\ttfamily T\+E\+ST}), it\textquotesingle{}s tedious and doesn\textquotesingle{}t scale\+: if you want {\ttfamily m} tests over {\ttfamily n} types, you\textquotesingle{}ll end up writing {\ttfamily m$\ast$n} {\ttfamily T\+E\+ST}s.

{\itshape Typed tests} allow you to repeat the same test logic over a list of types. You only need to write the test logic once, although you must know the type list when writing typed tests. Here\textquotesingle{}s how you do it\+:

First, define a fixture class template. It should be parameterized by a type. Remember to derive it from {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{template <typename T>}
\DoxyCodeLine{class FooTest : public ::testing::Test \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  typedef std::list<T> List;}
\DoxyCodeLine{  static T shared\_;}
\DoxyCodeLine{  T value\_;}
\DoxyCodeLine{\};}
\end{DoxyCode}


Next, associate a list of types with the test suite, which will be repeated for each type in the list\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{using MyTypes = ::testing::Types<char, int, unsigned int>;}
\DoxyCodeLine{TYPED\_TEST\_SUITE(FooTest, MyTypes);}
\end{DoxyCode}


The type alias ({\ttfamily using} or {\ttfamily typedef}) is necessary for the {\ttfamily T\+Y\+P\+E\+D\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+TE} macro to parse correctly. Otherwise the compiler will think that each comma in the type list introduces a new macro argument.

Then, use {\ttfamily T\+Y\+P\+E\+D\+\_\+\+T\+E\+S\+T()} instead of {\ttfamily T\+E\+S\+T\+\_\+\+F()} to define a typed test for this test suite. You can repeat this as many times as you want\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TYPED\_TEST(FooTest, DoesBlah) \{}
\DoxyCodeLine{  // Inside a test, refer to the special name TypeParam to get the type}
\DoxyCodeLine{  // parameter.  Since we are inside a derived class template, C++ requires}
\DoxyCodeLine{  // us to visit the members of FooTest via 'this'.}
\DoxyCodeLine{  TypeParam n = this-\/>value\_;}
\DoxyCodeLine{}
\DoxyCodeLine{  // To visit static members of the fixture, add the 'TestFixture::'}
\DoxyCodeLine{  // prefix.}
\DoxyCodeLine{  n += TestFixture::shared\_;}
\DoxyCodeLine{}
\DoxyCodeLine{  // To refer to typedefs in the fixture, add the 'typename TestFixture::'}
\DoxyCodeLine{  // prefix.  The 'typename' is required to satisfy the compiler.}
\DoxyCodeLine{  typename TestFixture::List values;}
\DoxyCodeLine{}
\DoxyCodeLine{  values.push\_back(n);}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TYPED\_TEST(FooTest, HasPropertyA) \{ ... \}}
\end{DoxyCode}


You can see \href{../samples/sample6_unittest.cc}{\texttt{ sample6\+\_\+unittest.\+cc}} for a complete example.\hypertarget{md__c_autotoc_md176}{}\doxysection{Type-\/\+Parameterized Tests}\label{md__c_autotoc_md176}
{\itshape Type-\/parameterized tests} are like typed tests, except that they don\textquotesingle{}t require you to know the list of types ahead of time. Instead, you can define the test logic first and instantiate it with different type lists later. You can even instantiate it more than once in the same program.

If you are designing an interface or concept, you can define a suite of type-\/parameterized tests to verify properties that any valid implementation of the interface/concept should have. Then, the author of each implementation can just instantiate the test suite with their type to verify that it conforms to the requirements, without having to write similar tests repeatedly. Here\textquotesingle{}s an example\+:

First, define a fixture class template, as we did with typed tests\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{template <typename T>}
\DoxyCodeLine{class FooTest : public ::testing::Test \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}


Next, declare that you will define a type-\/parameterized test suite\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TYPED\_TEST\_SUITE\_P(FooTest);}
\end{DoxyCode}


Then, use {\ttfamily T\+Y\+P\+E\+D\+\_\+\+T\+E\+S\+T\+\_\+\+P()} to define a type-\/parameterized test. You can repeat this as many times as you want\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TYPED\_TEST\_P(FooTest, DoesBlah) \{}
\DoxyCodeLine{  // Inside a test, refer to TypeParam to get the type parameter.}
\DoxyCodeLine{  TypeParam n = 0;}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TYPED\_TEST\_P(FooTest, HasPropertyA) \{ ... \}}
\end{DoxyCode}


Now the tricky part\+: you need to register all test patterns using the {\ttfamily R\+E\+G\+I\+S\+T\+E\+R\+\_\+\+T\+Y\+P\+E\+D\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P} macro before you can instantiate them. The first argument of the macro is the test suite name; the rest are the names of the tests in this test suite\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{REGISTER\_TYPED\_TEST\_SUITE\_P(FooTest,}
\DoxyCodeLine{                            DoesBlah, HasPropertyA);}
\end{DoxyCode}


Finally, you are free to instantiate the pattern with the types you want. If you put the above code in a header file, you can {\ttfamily \#include} it in multiple C++ source files and instantiate it multiple times.


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{typedef ::testing::Types<char, int, unsigned int> MyTypes;}
\DoxyCodeLine{INSTANTIATE\_TYPED\_TEST\_SUITE\_P(My, FooTest, MyTypes);}
\end{DoxyCode}


To distinguish different instances of the pattern, the first argument to the {\ttfamily I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+D\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P} macro is a prefix that will be added to the actual test suite name. Remember to pick unique prefixes for different instances.

In the special case where the type list contains only one type, you can write that type directly without {\ttfamily \+::testing\+::\+Types$<$...$>$}, like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{INSTANTIATE\_TYPED\_TEST\_SUITE\_P(My, FooTest, int);}
\end{DoxyCode}


You can see \href{../samples/sample6_unittest.cc}{\texttt{ sample6\+\_\+unittest.\+cc}} for a complete example.\hypertarget{md__c_autotoc_md177}{}\doxysection{Testing Private Code}\label{md__c_autotoc_md177}
If you change your software\textquotesingle{}s internal implementation, your tests should not break as long as the change is not observable by users. Therefore, {\bfseries{per the black-\/box testing principle, most of the time you should test your code through its public interfaces.}}

{\bfseries{If you still find yourself needing to test internal implementation code, consider if there\textquotesingle{}s a better design.}} The desire to test internal implementation is often a sign that the class is doing too much. Consider extracting an implementation class, and testing it. Then use that implementation class in the original class.

If you absolutely have to test non-\/public interface code though, you can. There are two cases to consider\+:


\begin{DoxyItemize}
\item Static functions ( {\itshape not} the same as static member functions!) or unnamed namespaces, and
\item Private or protected class members
\end{DoxyItemize}

To test them, we use the following special techniques\+:


\begin{DoxyItemize}
\item Both static functions and definitions/declarations in an unnamed namespace are only visible within the same translation unit. To test them, you can {\ttfamily \#include} the entire {\ttfamily .cc} file being tested in your {\ttfamily $\ast$\+\_\+test.cc} file. (\#including {\ttfamily .cc} files is not a good way to reuse code -\/ you should not do this in production code!)

However, a better approach is to move the private code into the {\ttfamily foo\+::internal} namespace, where {\ttfamily foo} is the namespace your project normally uses, and put the private declarations in a {\ttfamily $\ast$-\/internal.h} file. Your production {\ttfamily .cc} files and your tests are allowed to include this internal header, but your clients are not. This way, you can fully test your internal implementation without leaking it to your clients.
\item Private class members are only accessible from within the class or by friends. To access a class\textquotesingle{} private members, you can declare your test fixture as a friend to the class and define accessors in your fixture. Tests using the fixture can then access the private members of your production class via the accessors in the fixture. Note that even though your fixture is a friend to your production class, your tests are not automatically friends to it, as they are technically defined in sub-\/classes of the fixture.

Another way to test private members is to refactor them into an implementation class, which is then declared in a {\ttfamily $\ast$-\/internal.h} file. Your clients aren\textquotesingle{}t allowed to include this header but your tests can. Such is called the \href{https://www.gamedev.net/articles/programming/general-and-gameplay-programming/the-c-pimpl-r1794/}{\texttt{ Pimpl}} (Private Implementation) idiom.

Or, you can declare an individual test as a friend of your class by adding this line in the class body\+:

\`{}\`{}\`{}c++ F\+R\+I\+E\+N\+D\+\_\+\+T\+E\+S\+T(\+Test\+Suite\+Name, Test\+Name); \`{}\`{}\`{}

For example,

\`{}\`{}\`{}c++ // foo.\+h class Foo \{ ... private\+: F\+R\+I\+E\+N\+D\+\_\+\+T\+E\+S\+T(\+Foo\+Test, Bar\+Returns\+Zero\+On\+Null);

int Bar(void$\ast$ x); \};

// foo\+\_\+test.\+cc ... T\+E\+S\+T(\+Foo\+Test, Bar\+Returns\+Zero\+On\+Null) \{ Foo foo; E\+X\+P\+E\+C\+T\+\_\+\+EQ(foo.\+Bar(\+N\+U\+L\+L), 0); // Uses Foo\textquotesingle{}s private member Bar(). \} \`{}\`{}\`{}

Pay special attention when your class is defined in a namespace, as you should define your test fixtures and tests in the same namespace if you want them to be friends of your class. For example, if the code to be tested looks like\+:

\`{}\`{}\`{}c++ namespace my\+\_\+namespace \{

class Foo \{ friend class \mbox{\hyperlink{class_foo_test}{Foo\+Test}}; F\+R\+I\+E\+N\+D\+\_\+\+T\+E\+S\+T(\+Foo\+Test, Bar); F\+R\+I\+E\+N\+D\+\_\+\+T\+E\+S\+T(\+Foo\+Test, Baz); ... definition of the class Foo ... \};

\} // namespace my\+\_\+namespace \`{}\`{}\`{}

Your test code should be something like\+:

\`{}\`{}\`{}c++ namespace my\+\_\+namespace \{

class \mbox{\hyperlink{class_foo_test}{Foo\+Test}} \+: public \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}} \{ protected\+: ... \};

T\+E\+S\+T\+\_\+\+F(\+Foo\+Test, Bar) \{ ... \} T\+E\+S\+T\+\_\+\+F(\+Foo\+Test, Baz) \{ ... \}

\} // namespace my\+\_\+namespace \`{}\`{}\`{}
\end{DoxyItemize}\hypertarget{md__c_autotoc_md178}{}\doxysection{\char`\"{}\+Catching\char`\"{} Failures}\label{md__c_autotoc_md178}
If you are building a testing utility on top of googletest, you\textquotesingle{}ll want to test your utility. What framework would you use to test it? googletest, of course.

The challenge is to verify that your testing utility reports failures correctly. In frameworks that report a failure by throwing an exception, you could catch the exception and assert on it. But googletest doesn\textquotesingle{}t use exceptions, so how do we test that a piece of code generates an expected failure?

gunit-\/spi.\+h contains some constructs to do this. After \#including this header, you can use


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ EXPECT\_FATAL\_FAILURE(statement, substring);}
\end{DoxyCode}


to assert that {\ttfamily statement} generates a fatal (e.\+g. {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$}) failure in the current thread whose message contains the given {\ttfamily substring}, or use


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ EXPECT\_NONFATAL\_FAILURE(statement, substring);}
\end{DoxyCode}


if you are expecting a non-\/fatal (e.\+g. {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$}) failure.

Only failures in the current thread are checked to determine the result of this type of expectations. If {\ttfamily statement} creates new threads, failures in these threads are also ignored. If you want to catch failures in other threads as well, use one of the following macros instead\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ EXPECT\_FATAL\_FAILURE\_ON\_ALL\_THREADS(statement, substring);}
\DoxyCodeLine{ EXPECT\_NONFATAL\_FAILURE\_ON\_ALL\_THREADS(statement, substring);}
\end{DoxyCode}


N\+O\+TE\+: Assertions from multiple threads are currently not supported on Windows.

For technical reasons, there are some caveats\+:


\begin{DoxyEnumerate}
\item You cannot stream a failure message to either macro.
\item {\ttfamily statement} in {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+F\+A\+T\+A\+L\+\_\+\+F\+A\+I\+L\+U\+RE\{\+\_\+\+O\+N\+\_\+\+A\+L\+L\+\_\+\+T\+H\+R\+E\+A\+DS\}()} cannot reference local non-\/static variables or non-\/static members of {\ttfamily this} object.
\item {\ttfamily statement} in {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+F\+A\+T\+A\+L\+\_\+\+F\+A\+I\+L\+U\+RE\{\+\_\+\+O\+N\+\_\+\+A\+L\+L\+\_\+\+T\+H\+R\+E\+A\+DS\}()} cannot return a value.
\end{DoxyEnumerate}\hypertarget{md__c_autotoc_md179}{}\doxysection{Registering tests programmatically}\label{md__c_autotoc_md179}
The {\ttfamily T\+E\+ST} macros handle the vast majority of all use cases, but there are few were runtime registration logic is required. For those cases, the framework provides the {\ttfamily \+::testing\+::\+Register\+Test} that allows callers to register arbitrary tests dynamically.

This is an advanced A\+PI only to be used when the {\ttfamily T\+E\+ST} macros are insufficient. The macros should be preferred when possible, as they avoid most of the complexity of calling this function.

It provides the following signature\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{template <typename Factory>}
\DoxyCodeLine{TestInfo* RegisterTest(const char* test\_suite\_name, const char* test\_name,}
\DoxyCodeLine{                       const char* type\_param, const char* value\_param,}
\DoxyCodeLine{                       const char* file, int line, Factory factory);}
\end{DoxyCode}


The {\ttfamily factory} argument is a factory callable (move-\/constructible) object or function pointer that creates a new instance of the Test object. It handles ownership to the caller. The signature of the callable is {\ttfamily Fixture$\ast$()}, where {\ttfamily \mbox{\hyperlink{class_fixture}{Fixture}}} is the test fixture class for the test. All tests registered with the same {\ttfamily test\+\_\+suite\+\_\+name} must return the same fixture type. This is checked at runtime.

The framework will infer the fixture class from the factory and will call the {\ttfamily Set\+Up\+Test\+Suite} and {\ttfamily Tear\+Down\+Test\+Suite} for it.

Must be called before {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} is invoked, otherwise behavior is undefined.

Use case example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class MyFixture : public ::testing::Test \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  // All of these optional, just like in regular macro usage.}
\DoxyCodeLine{  static void SetUpTestSuite() \{ ... \}}
\DoxyCodeLine{  static void TearDownTestSuite() \{ ... \}}
\DoxyCodeLine{  void SetUp() override \{ ... \}}
\DoxyCodeLine{  void TearDown() override \{ ... \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{class MyTest : public MyFixture \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  explicit MyTest(int data) : data\_(data) \{\}}
\DoxyCodeLine{  void TestBody() override \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{ private:}
\DoxyCodeLine{  int data\_;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{void RegisterMyTests(const std::vector<int>\& values) \{}
\DoxyCodeLine{  for (int v : values) \{}
\DoxyCodeLine{    ::testing::RegisterTest(}
\DoxyCodeLine{        "MyFixture", ("Test" + std::to\_string(v)).c\_str(), nullptr,}
\DoxyCodeLine{        std::to\_string(v).c\_str(),}
\DoxyCodeLine{        \_\_FILE\_\_, \_\_LINE\_\_,}
\DoxyCodeLine{        // Important to use the fixture type as the return type here.}
\DoxyCodeLine{        [=]() -\/> MyFixture* \{ return new MyTest(v); \});}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{...}
\DoxyCodeLine{int main(int argc, char** argv) \{}
\DoxyCodeLine{  std::vector<int> values\_to\_test = LoadValuesFromConfig();}
\DoxyCodeLine{  RegisterMyTests(values\_to\_test);}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  return RUN\_ALL\_TESTS();}
\DoxyCodeLine{\}}
\end{DoxyCode}
 \hypertarget{md__c_autotoc_md180}{}\doxysection{Getting the Current Test\textquotesingle{}s Name}\label{md__c_autotoc_md180}
Sometimes a function may need to know the name of the currently running test. For example, you may be using the {\ttfamily Set\+Up()} method of your test fixture to set the golden file name based on which test is running. The {\ttfamily \mbox{\hyperlink{classtesting_1_1_test_info}{testing\+::\+Test\+Info}}} class has this information\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{namespace testing \{}
\DoxyCodeLine{}
\DoxyCodeLine{class TestInfo \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  // Returns the test suite name and the test name, respectively.}
\DoxyCodeLine{  //}
\DoxyCodeLine{  // Do NOT delete or free the return value -\/ it's managed by the}
\DoxyCodeLine{  // TestInfo class.}
\DoxyCodeLine{  const char* test\_suite\_name() const;}
\DoxyCodeLine{  const char* name() const;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\end{DoxyCode}


To obtain a {\ttfamily Test\+Info} object for the currently running test, call {\ttfamily current\+\_\+test\+\_\+info()} on the {\ttfamily Unit\+Test} singleton object\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ // Gets information about the currently running test.}
\DoxyCodeLine{ // Do NOT delete the returned object -\/ it's managed by the UnitTest class.}
\DoxyCodeLine{ const ::testing::TestInfo* const test\_info =}
\DoxyCodeLine{   ::testing::UnitTest::GetInstance()-\/>current\_test\_info();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ printf("We are in test \%s of test suite \%s.\(\backslash\)n",}
\DoxyCodeLine{        test\_info-\/>name(),}
\DoxyCodeLine{        test\_info-\/>test\_suite\_name());}
\end{DoxyCode}


{\ttfamily current\+\_\+test\+\_\+info()} returns a null pointer if no test is running. In particular, you cannot find the test suite name in {\ttfamily Test\+Suite\+Set\+Up()}, {\ttfamily Test\+Suite\+Tear\+Down()} (where you know the test suite name implicitly), or functions called from them.\hypertarget{md__c_autotoc_md181}{}\doxysection{Extending googletest by Handling Test Events}\label{md__c_autotoc_md181}
googletest provides an {\bfseries{event listener A\+PI}} to let you receive notifications about the progress of a test program and test failures. The events you can listen to include the start and end of the test program, a test suite, or a test method, among others. You may use this A\+PI to augment or replace the standard console output, replace the X\+ML output, or provide a completely different form of output, such as a G\+UI or a database. You can also use test events as checkpoints to implement a resource leak checker, for example.\hypertarget{md__c_autotoc_md182}{}\doxysubsection{Defining Event Listeners}\label{md__c_autotoc_md182}
To define a event listener, you subclass either \mbox{\hyperlink{classtesting_1_1_test_event_listener}{testing\+::\+Test\+Event\+Listener}} or \mbox{\hyperlink{classtesting_1_1_empty_test_event_listener}{testing\+::\+Empty\+Test\+Event\+Listener}} The former is an (abstract) interface, where {\itshape each pure virtual method can be overridden to handle a test event} (For example, when a test starts, the {\ttfamily On\+Test\+Start()} method will be called.). The latter provides an empty implementation of all methods in the interface, such that a subclass only needs to override the methods it cares about.

When an event is fired, its context is passed to the handler function as an argument. The following argument types are used\+:


\begin{DoxyItemize}
\item Unit\+Test reflects the state of the entire test program,
\item Test\+Suite has information about a test suite, which can contain one or more tests,
\item Test\+Info contains the state of a test, and
\item Test\+Part\+Result represents the result of a test assertion.
\end{DoxyItemize}

An event handler function can examine the argument it receives to find out interesting information about the event and the test program\textquotesingle{}s state.

Here\textquotesingle{}s an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ class MinimalistPrinter : public ::testing::EmptyTestEventListener \{}
\DoxyCodeLine{   // Called before a test starts.}
\DoxyCodeLine{   virtual void OnTestStart(const ::testing::TestInfo\& test\_info) \{}
\DoxyCodeLine{     printf("*** Test \%s.\%s starting.\(\backslash\)n",}
\DoxyCodeLine{            test\_info.test\_suite\_name(), test\_info.name());}
\DoxyCodeLine{   \}}
\DoxyCodeLine{}
\DoxyCodeLine{   // Called after a failed assertion or a SUCCESS().}
\DoxyCodeLine{   virtual void OnTestPartResult(const ::testing::TestPartResult\& test\_part\_result) \{}
\DoxyCodeLine{     printf("\%s in \%s:\%d\(\backslash\)n\%s\(\backslash\)n",}
\DoxyCodeLine{            test\_part\_result.failed() ? "*** Failure" : "Success",}
\DoxyCodeLine{            test\_part\_result.file\_name(),}
\DoxyCodeLine{            test\_part\_result.line\_number(),}
\DoxyCodeLine{            test\_part\_result.summary());}
\DoxyCodeLine{   \}}
\DoxyCodeLine{}
\DoxyCodeLine{   // Called after a test ends.}
\DoxyCodeLine{   virtual void OnTestEnd(const ::testing::TestInfo\& test\_info) \{}
\DoxyCodeLine{     printf("*** Test \%s.\%s ending.\(\backslash\)n",}
\DoxyCodeLine{            test\_info.test\_suite\_name(), test\_info.name());}
\DoxyCodeLine{   \}}
\DoxyCodeLine{ \};}
\end{DoxyCode}
\hypertarget{md__c_autotoc_md183}{}\doxysubsection{Using Event Listeners}\label{md__c_autotoc_md183}
To use the event listener you have defined, add an instance of it to the googletest event listener list (represented by class Test\+Event\+Listeners -\/ note the \char`\"{}s\char`\"{} at the end of the name) in your {\ttfamily main()} function, before calling {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{int main(int argc, char** argv) \{}
\DoxyCodeLine{  ::testing::InitGoogleTest(\&argc, argv);}
\DoxyCodeLine{  // Gets hold of the event listener list.}
\DoxyCodeLine{  ::testing::TestEventListeners\& listeners =}
\DoxyCodeLine{        ::testing::UnitTest::GetInstance()-\/>listeners();}
\DoxyCodeLine{  // Adds a listener to the end.  googletest takes the ownership.}
\DoxyCodeLine{  listeners.Append(new MinimalistPrinter);}
\DoxyCodeLine{  return RUN\_ALL\_TESTS();}
\DoxyCodeLine{\}}
\end{DoxyCode}


There\textquotesingle{}s only one problem\+: the default test result printer is still in effect, so its output will mingle with the output from your minimalist printer. To suppress the default printer, just release it from the event listener list and delete it. You can do so by adding one line\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ ...}
\DoxyCodeLine{ delete listeners.Release(listeners.default\_result\_printer());}
\DoxyCodeLine{ listeners.Append(new MinimalistPrinter);}
\DoxyCodeLine{ return RUN\_ALL\_TESTS();}
\end{DoxyCode}


Now, sit back and enjoy a completely different output from your tests. For more details, see \href{../samples/sample9_unittest.cc}{\texttt{ sample9\+\_\+unittest.\+cc}}.

You may append more than one listener to the list. When an {\ttfamily On$\ast$\+Start()} or {\ttfamily On\+Test\+Part\+Result()} event is fired, the listeners will receive it in the order they appear in the list (since new listeners are added to the end of the list, the default text printer and the default X\+ML generator will receive the event first). An {\ttfamily On$\ast$\+End()} event will be received by the listeners in the {\itshape reverse} order. This allows output by listeners added later to be framed by output from listeners added earlier.\hypertarget{md__c_autotoc_md184}{}\doxysubsection{Generating Failures in Listeners}\label{md__c_autotoc_md184}
You may use failure-\/raising macros ({\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$()}, {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$()}, {\ttfamily F\+A\+I\+L()}, etc) when processing an event. There are some restrictions\+:


\begin{DoxyEnumerate}
\item You cannot generate any failure in {\ttfamily On\+Test\+Part\+Result()} (otherwise it will cause {\ttfamily On\+Test\+Part\+Result()} to be called recursively).
\item A listener that handles {\ttfamily On\+Test\+Part\+Result()} is not allowed to generate any failure.
\end{DoxyEnumerate}

When you add listeners to the listener list, you should put listeners that handle {\ttfamily On\+Test\+Part\+Result()} {\itshape before} listeners that can generate failures. This ensures that failures generated by the latter are attributed to the right test by the former.

See \href{../samples/sample10_unittest.cc}{\texttt{ sample10\+\_\+unittest.\+cc}} for an example of a failure-\/raising listener.\hypertarget{md__c_autotoc_md185}{}\doxysection{Running Test Programs\+: Advanced Options}\label{md__c_autotoc_md185}
googletest test programs are ordinary executables. Once built, you can run them directly and affect their behavior via the following environment variables and/or command line flags. For the flags to work, your programs must call {\ttfamily \+::testing\+::\+Init\+Google\+Test()} before calling {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}.

To see a list of supported flags and their usage, please run your test program with the {\ttfamily -\/-\/help} flag. You can also use {\ttfamily -\/h}, {\ttfamily -\/?}, or {\ttfamily /?} for short.

If an option is specified both by an environment variable and by a flag, the latter takes precedence.\hypertarget{md__c_autotoc_md186}{}\doxysubsection{Selecting Tests}\label{md__c_autotoc_md186}
\hypertarget{md__c_autotoc_md187}{}\doxysubsubsection{Listing Test Names}\label{md__c_autotoc_md187}
Sometimes it is necessary to list the available tests in a program before running them so that a filter may be applied if needed. Including the flag {\ttfamily -\/-\/gtest\+\_\+list\+\_\+tests} overrides all other flags and lists tests in the following format\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{TestSuite1.}
\DoxyCodeLine{  TestName1}
\DoxyCodeLine{  TestName2}
\DoxyCodeLine{TestSuite2.}
\DoxyCodeLine{  TestName}
\end{DoxyCode}


None of the tests listed are actually run if the flag is provided. There is no corresponding environment variable for this flag.\hypertarget{md__c_autotoc_md188}{}\doxysubsubsection{Running a Subset of the Tests}\label{md__c_autotoc_md188}
By default, a googletest program runs all tests the user has defined. Sometimes, you want to run only a subset of the tests (e.\+g. for debugging or quickly verifying a change). If you set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+F\+I\+L\+T\+ER} environment variable or the {\ttfamily -\/-\/gtest\+\_\+filter} flag to a filter string, googletest will only run the tests whose full names (in the form of {\ttfamily Test\+Suite\+Name.\+Test\+Name}) match the filter.

The format of a filter is a \textquotesingle{}{\ttfamily \+:}\textquotesingle{}-\/separated list of wildcard patterns (called the {\itshape positive patterns}) optionally followed by a \textquotesingle{}{\ttfamily -\/}\textquotesingle{} and another \textquotesingle{}{\ttfamily \+:}\textquotesingle{}-\/separated pattern list (called the {\itshape negative patterns}). A test matches the filter if and only if it matches any of the positive patterns but does not match any of the negative patterns.

A pattern may contain `'$\ast$\textquotesingle{}{\ttfamily (matches any string) or}\textquotesingle{}?\textquotesingle{}{\ttfamily (matches any single character). For convenience, the filter}\textquotesingle{}{\itshape -\/Negative\+Patterns\textquotesingle{}{\ttfamily can be also written as}\textquotesingle{}-\/Negative\+Patterns\textquotesingle{}\`{}.}

{\itshape For example\+:}

{\itshape 
\begin{DoxyItemize}
\item {\ttfamily ./foo\+\_\+test} Has no flag, and thus runs all its tests.
\item \`{}./foo\+\_\+test --gtest\+\_\+filter={\ttfamily Also runs everything, due to the single match-\/everything}$\ast${\ttfamily value. $\ast$}./foo\+\_\+test --gtest\+\_\+filter=\mbox{\hyperlink{class_foo_test}{Foo\+Test}}.$\ast${\ttfamily Runs everything in test suite }\mbox{\hyperlink{class_foo_test}{Foo\+Test}}{\ttfamily . $\ast$}./foo\+\_\+test --gtest\+\_\+filter=$\ast$\+Null$\ast$\+:{\itshape Constructor}{\ttfamily Runs any test whose full name contains either}\char`\"{}\+Null\char`\"{}{\ttfamily or}\char`\"{}\+Constructor\char`\"{}{\ttfamily . $\ast$}./foo\+\_\+test --gtest\+\_\+filter=-\/$\ast$\+Death\+Test.$\ast${\ttfamily Runs all non-\/death tests. $\ast$}./foo\+\_\+test --gtest\+\_\+filter=\mbox{\hyperlink{class_foo_test}{Foo\+Test}}.$\ast$-\/\+Foo\+Test.Bar{\ttfamily Runs everything in test suite}\mbox{\hyperlink{class_foo_test}{Foo\+Test}}{\ttfamily except}Foo\+Test.\+Bar$<$tt$>$. $\ast$./foo\+\_\+test --gtest\+\_\+filter=\mbox{\hyperlink{class_foo_test}{Foo\+Test}}.$\ast$\+:Bar\+Test.$\ast$-\/\+Foo\+Test.Bar\+:Bar\+Test.\+Foo$<$tt$>$Runs everything in test suite\mbox{\hyperlink{class_foo_test}{Foo\+Test}}{\ttfamily except}Foo\+Test.\+Bar$<$tt$>$and everything in test suiteBar\+Test{\ttfamily except}Bar\+Test.\+Foo\`{}.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md189}{}\doxysubsubsection{Temporarily Disabling Tests}\label{md__c_autotoc_md189}
{\itshape  If you have a broken test that you cannot fix right away, you can add the {\ttfamily D\+I\+S\+A\+B\+L\+E\+D\+\_\+} prefix to its name. This will exclude it from execution. This is better than commenting out the code or using {\ttfamily \#if 0}, as disabled tests are still compiled (and thus won\textquotesingle{}t rot).}

{\itshape If you need to disable all tests in a test suite, you can either add {\ttfamily D\+I\+S\+A\+B\+L\+E\+D\+\_\+} to the front of the name of each test, or alternatively add it to the front of the test suite name.}

{\itshape For example, the following tests won\textquotesingle{}t be run by googletest, even though they will still be compiled\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// Tests that Foo does Abc.}
\DoxyCodeLine{TEST(FooTest, DISABLED\_DoesAbc) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{class DISABLED\_BarTest : public ::testing::Test \{ ... \};}
\DoxyCodeLine{}
\DoxyCodeLine{// Tests that Bar does Xyz.}
\DoxyCodeLine{TEST\_F(DISABLED\_BarTest, DoesXyz) \{ ... \}}
\end{DoxyCode}
}

{\itshape N\+O\+TE\+: This feature should only be used for temporary pain-\/relief. You still have to fix the disabled tests at a later date. As a reminder, googletest will print a banner warning you if a test program contains any disabled tests.}

{\itshape T\+IP\+: You can easily count the number of disabled tests you have using {\ttfamily gsearch} and/or {\ttfamily grep}. This number can be used as a metric for improving your test quality.}

{\itshape }\hypertarget{md__c_autotoc_md190}{}\doxysubsubsection{Temporarily Enabling Disabled Tests}\label{md__c_autotoc_md190}
{\itshape  To include disabled tests in test execution, just invoke the test program with the {\ttfamily -\/-\/gtest\+\_\+also\+\_\+run\+\_\+disabled\+\_\+tests} flag or set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+A\+L\+S\+O\+\_\+\+R\+U\+N\+\_\+\+D\+I\+S\+A\+B\+L\+E\+D\+\_\+\+T\+E\+S\+TS} environment variable to a value other than {\ttfamily 0}. You can combine this with the {\ttfamily -\/-\/gtest\+\_\+filter} flag to further select which disabled tests to run.}

{\itshape }\hypertarget{md__c_autotoc_md191}{}\doxysubsection{Repeating the Tests}\label{md__c_autotoc_md191}
{\itshape  Once in a while you\textquotesingle{}ll run into a test whose result is hit-\/or-\/miss. Perhaps it will fail only 1\% of the time, making it rather hard to reproduce the bug under a debugger. This can be a major source of frustration.}

{\itshape The {\ttfamily -\/-\/gtest\+\_\+repeat} flag allows you to repeat all (or selected) test methods in a program many times. Hopefully, a flaky test will eventually fail and give you a chance to debug. Here\textquotesingle{}s how to use it\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$ foo\_test -\/-\/gtest\_repeat=1000}
\DoxyCodeLine{Repeat foo\_test 1000 times and don't stop at failures.}
\DoxyCodeLine{}
\DoxyCodeLine{\$ foo\_test -\/-\/gtest\_repeat=-\/1}
\DoxyCodeLine{A negative count means repeating forever.}
\DoxyCodeLine{}
\DoxyCodeLine{\$ foo\_test -\/-\/gtest\_repeat=1000 -\/-\/gtest\_break\_on\_failure}
\DoxyCodeLine{Repeat foo\_test 1000 times, stopping at the first failure.  This}
\DoxyCodeLine{is especially useful when running under a debugger: when the test}
\DoxyCodeLine{fails, it will drop into the debugger and you can then inspect}
\DoxyCodeLine{variables and stacks.}
\DoxyCodeLine{}
\DoxyCodeLine{\$ foo\_test -\/-\/gtest\_repeat=1000 -\/-\/gtest\_filter=FooBar.*}
\DoxyCodeLine{Repeat the tests whose name matches the filter 1000 times.}
\end{DoxyCode}
}

{\itshape If your test program contains \href{\#global-set-up-and-tear-down}{\texttt{ global set-\/up/tear-\/down}} code, it will be repeated in each iteration as well, as the flakiness may be in it. You can also specify the repeat count by setting the {\ttfamily G\+T\+E\+S\+T\+\_\+\+R\+E\+P\+E\+AT} environment variable.}

{\itshape }\hypertarget{md__c_autotoc_md192}{}\doxysubsection{Shuffling the Tests}\label{md__c_autotoc_md192}
{\itshape  You can specify the {\ttfamily -\/-\/gtest\+\_\+shuffle} flag (or set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+S\+H\+U\+F\+F\+LE} environment variable to {\ttfamily 1}) to run the tests in a program in a random order. This helps to reveal bad dependencies between tests.}

{\itshape By default, googletest uses a random seed calculated from the current time. Therefore you\textquotesingle{}ll get a different order every time. The console output includes the random seed value, such that you can reproduce an order-\/related test failure later. To specify the random seed explicitly, use the {\ttfamily -\/-\/gtest\+\_\+random\+\_\+seed=S\+E\+ED} flag (or set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+R\+A\+N\+D\+O\+M\+\_\+\+S\+E\+ED} environment variable), where {\ttfamily S\+E\+ED} is an integer in the range \mbox{[}0, 99999\mbox{]}. The seed value 0 is special\+: it tells googletest to do the default behavior of calculating the seed from the current time.}

{\itshape If you combine this with {\ttfamily -\/-\/gtest\+\_\+repeat=N}, googletest will pick a different random seed and re-\/shuffle the tests in each iteration.}

{\itshape }\hypertarget{md__c_autotoc_md193}{}\doxysubsection{Controlling Test Output}\label{md__c_autotoc_md193}
{\itshape  }\hypertarget{md__c_autotoc_md194}{}\doxysubsubsection{Colored Terminal Output}\label{md__c_autotoc_md194}
{\itshape  googletest can use colors in its terminal output to make it easier to spot the important information\+:}

{\itshape {\ttfamily  ...~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[}-\/-\/-\/-\/-\/-\/-\/---\mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ 1 test from \mbox{\hyperlink{class_foo_test}{Foo\+Test}}$<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[} R\+UN ~ ~ ~\mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Foo\+Test.\+Does\+Abc$<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[} ~ ~ ~ OK \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Foo\+Test.\+Does\+Abc $<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[}-\/-\/-\/-\/-\/-\/-\/---\mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ 2 tests from Bar\+Test$<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[} R\+UN ~ ~ ~\mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Bar\+Test.\+Has\+Xyz\+Property $<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[} ~ ~ ~ OK \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Bar\+Test.\+Has\+Xyz\+Property$<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[} R\+UN ~ ~ ~\mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Bar\+Test.\+Returns\+True\+On\+Success ... some error messages ...$<$/font$>$~\newline
 $<$font color=\char`\"{}red\char`\"{}$>$\mbox{[} ~ F\+A\+I\+L\+ED \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Bar\+Test.\+Returns\+True\+On\+Success ...$<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[}==========\mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ 30 tests from 14 test suites ran.$<$/font$>$~\newline
 $<$font color=\char`\"{}green\char`\"{}$>$\mbox{[} ~ P\+A\+S\+S\+ED \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ 28 tests.$<$/font$>$~\newline
 $<$font color=\char`\"{}red\char`\"{}$>$\mbox{[} ~ F\+A\+I\+L\+ED \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ 2 tests, listed below\+:$<$/font$>$~\newline
 $<$font color=\char`\"{}red\char`\"{}$>$\mbox{[} ~ F\+A\+I\+L\+ED \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Bar\+Test.\+Returns\+True\+On\+Success$<$/font$>$~\newline
 $<$font color=\char`\"{}red\char`\"{}$>$\mbox{[} ~ F\+A\+I\+L\+ED \mbox{]}$<$/font$>$$<$font color=\char`\"{}black\char`\"{}$>$ Another\+Test.\+Does\+Xyz~\newline
 ~\newline
 2 F\+A\+I\+L\+ED T\+E\+S\+TS $<$/font$>$ }}

{\itshape You can set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+C\+O\+L\+OR} environment variable or the {\ttfamily -\/-\/gtest\+\_\+color} command line flag to {\ttfamily yes}, {\ttfamily no}, or {\ttfamily auto} (the default) to enable colors, disable colors, or let googletest decide. When the value is {\ttfamily auto}, googletest will use colors if and only if the output goes to a terminal and (on non-\/\+Windows platforms) the {\ttfamily T\+E\+RM} environment variable is set to {\ttfamily xterm} or {\ttfamily xterm-\/color}.}

{\itshape }\hypertarget{md__c_autotoc_md195}{}\doxysubsubsection{Suppressing the Elapsed Time}\label{md__c_autotoc_md195}
{\itshape  By default, googletest prints the time it takes to run each test. To disable that, run the test program with the {\ttfamily -\/-\/gtest\+\_\+print\+\_\+time=0} command line flag, or set the G\+T\+E\+S\+T\+\_\+\+P\+R\+I\+N\+T\+\_\+\+T\+I\+ME environment variable to {\ttfamily 0}.}

{\itshape }\hypertarget{md__c_autotoc_md196}{}\doxysubsubsection{Suppressing U\+T\+F-\/8 Text Output}\label{md__c_autotoc_md196}
{\itshape  In case of assertion failures, googletest prints expected and actual values of type {\ttfamily string} both as hex-\/encoded strings as well as in readable U\+T\+F-\/8 text if they contain valid non-\/\+A\+S\+C\+II U\+T\+F-\/8 characters. If you want to suppress the U\+T\+F-\/8 text because, for example, you don\textquotesingle{}t have an U\+T\+F-\/8 compatible output medium, run the test program with {\ttfamily -\/-\/gtest\+\_\+print\+\_\+utf8=0} or set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+P\+R\+I\+N\+T\+\_\+\+U\+T\+F8} environment variable to {\ttfamily 0}.}

{\itshape }\hypertarget{md__c_autotoc_md197}{}\doxysubsubsection{Generating an X\+M\+L Report}\label{md__c_autotoc_md197}
{\itshape  googletest can emit a detailed X\+ML report to a file in addition to its normal textual output. The report contains the duration of each test, and thus can help you identify slow tests. The report is also used by the \href{http://unittest}{\texttt{ http\+://unittest}} dashboard to show per-\/test-\/method error messages.}

{\itshape To generate the X\+ML report, set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+O\+U\+T\+P\+UT} environment variable or the {\ttfamily -\/-\/gtest\+\_\+output} flag to the string {\ttfamily \char`\"{}xml\+:path\+\_\+to\+\_\+output\+\_\+file\char`\"{}}, which will create the file at the given location. You can also just use the string {\ttfamily \char`\"{}xml\char`\"{}}, in which case the output can be found in the {\ttfamily test\+\_\+detail.\+xml} file in the current directory.}

{\itshape If you specify a directory (for example, {\ttfamily \char`\"{}xml\+:output/directory/\char`\"{}} on Linux or {\ttfamily \char`\"{}xml\+:output\textbackslash{}directory\textbackslash{}\char`\"{}} on Windows), googletest will create the X\+ML file in that directory, named after the test executable (e.\+g. {\ttfamily foo\+\_\+test.\+xml} for test program {\ttfamily foo\+\_\+test} or {\ttfamily foo\+\_\+test.\+exe}). If the file already exists (perhaps left over from a previous run), googletest will pick a different name (e.\+g. {\ttfamily foo\+\_\+test\+\_\+1.\+xml}) to avoid overwriting it.}

{\itshape The report is based on the {\ttfamily junitreport} Ant task. Since that format was originally intended for Java, a little interpretation is required to make it apply to googletest tests, as shown here\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{<\textcolor{keywordtype}{testsuites} \textcolor{keyword}{name}=\textcolor{stringliteral}{"AllTests"} ...>}
\DoxyCodeLine{  <\textcolor{keywordtype}{testsuite} \textcolor{keyword}{name}=\textcolor{stringliteral}{"test\_case\_name"} ...>}
\DoxyCodeLine{    <\textcolor{keywordtype}{testcase}    \textcolor{keyword}{name}=\textcolor{stringliteral}{"test\_name"} ...>}
\DoxyCodeLine{      <\textcolor{keywordtype}{failure} \textcolor{keyword}{message}=\textcolor{stringliteral}{"..."}/>}
\DoxyCodeLine{      <\textcolor{keywordtype}{failure} \textcolor{keyword}{message}=\textcolor{stringliteral}{"..."}/>}
\DoxyCodeLine{      <\textcolor{keywordtype}{failure} \textcolor{keyword}{message}=\textcolor{stringliteral}{"..."}/>}
\DoxyCodeLine{    </\textcolor{keywordtype}{testcase}>}
\DoxyCodeLine{  </\textcolor{keywordtype}{testsuite}>}
\DoxyCodeLine{</\textcolor{keywordtype}{testsuites}>}
\end{DoxyCode}
}

{\itshape 
\begin{DoxyItemize}
\item The root {\ttfamily $<$testsuites$>$} element corresponds to the entire test program.
\item {\ttfamily $<$testsuite$>$} elements correspond to googletest test suites.
\item {\ttfamily $<$testcase$>$} elements correspond to googletest test functions.
\end{DoxyItemize}}

{\itshape For instance, the following program}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST(MathTest, Addition) \{ ... \}}
\DoxyCodeLine{TEST(MathTest, Subtraction) \{ ... \}}
\DoxyCodeLine{TEST(LogicTest, NonContradiction) \{ ... \}}
\end{DoxyCode}
}

{\itshape could generate this report\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{<?\textcolor{keyword}{xml} \textcolor{keyword}{version}=\textcolor{stringliteral}{"1.0"} \textcolor{keyword}{encoding}=\textcolor{stringliteral}{"UTF-\/8"}?>}
\DoxyCodeLine{<\textcolor{keywordtype}{testsuites} \textcolor{keyword}{tests}=\textcolor{stringliteral}{"3"} \textcolor{keyword}{failures}=\textcolor{stringliteral}{"1"} \textcolor{keyword}{errors}=\textcolor{stringliteral}{"0"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.035"} \textcolor{keyword}{timestamp}=\textcolor{stringliteral}{"2011-\/10-\/31T18:52:42"} \textcolor{keyword}{name}=\textcolor{stringliteral}{"AllTests"}>}
\DoxyCodeLine{  <\textcolor{keywordtype}{testsuite} \textcolor{keyword}{name}=\textcolor{stringliteral}{"MathTest"} \textcolor{keyword}{tests}=\textcolor{stringliteral}{"2"} \textcolor{keyword}{failures}=\textcolor{stringliteral}{"1"} \textcolor{keyword}{errors}=\textcolor{stringliteral}{"0"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.015"}>}
\DoxyCodeLine{    <\textcolor{keywordtype}{testcase} \textcolor{keyword}{name}=\textcolor{stringliteral}{"Addition"} \textcolor{keyword}{status}=\textcolor{stringliteral}{"run"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.007"} \textcolor{keyword}{classname}=\textcolor{stringliteral}{""}>}
\DoxyCodeLine{      <\textcolor{keywordtype}{failure} \textcolor{keyword}{message}=\textcolor{stringliteral}{"Value of: add(1, 1)\&\#x0A;  Actual: 3\&\#x0A;Expected: 2"} \textcolor{keyword}{type}=\textcolor{stringliteral}{""}>...</\textcolor{keywordtype}{failure}>}
\DoxyCodeLine{      <\textcolor{keywordtype}{failure} \textcolor{keyword}{message}=\textcolor{stringliteral}{"Value of: add(1, -\/1)\&\#x0A;  Actual: 1\&\#x0A;Expected: 0"} \textcolor{keyword}{type}=\textcolor{stringliteral}{""}>...</\textcolor{keywordtype}{failure}>}
\DoxyCodeLine{    </\textcolor{keywordtype}{testcase}>}
\DoxyCodeLine{    <\textcolor{keywordtype}{testcase} \textcolor{keyword}{name}=\textcolor{stringliteral}{"Subtraction"} \textcolor{keyword}{status}=\textcolor{stringliteral}{"run"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.005"} \textcolor{keyword}{classname}=\textcolor{stringliteral}{""}>}
\DoxyCodeLine{    </\textcolor{keywordtype}{testcase}>}
\DoxyCodeLine{  </\textcolor{keywordtype}{testsuite}>}
\DoxyCodeLine{  <\textcolor{keywordtype}{testsuite} \textcolor{keyword}{name}=\textcolor{stringliteral}{"LogicTest"} \textcolor{keyword}{tests}=\textcolor{stringliteral}{"1"} \textcolor{keyword}{failures}=\textcolor{stringliteral}{"0"} \textcolor{keyword}{errors}=\textcolor{stringliteral}{"0"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.005"}>}
\DoxyCodeLine{    <\textcolor{keywordtype}{testcase} \textcolor{keyword}{name}=\textcolor{stringliteral}{"NonContradiction"} \textcolor{keyword}{status}=\textcolor{stringliteral}{"run"} \textcolor{keyword}{time}=\textcolor{stringliteral}{"0.005"} \textcolor{keyword}{classname}=\textcolor{stringliteral}{""}>}
\DoxyCodeLine{    </\textcolor{keywordtype}{testcase}>}
\DoxyCodeLine{  </\textcolor{keywordtype}{testsuite}>}
\DoxyCodeLine{</\textcolor{keywordtype}{testsuites}>}
\end{DoxyCode}
}

{\itshape Things to note\+:}

{\itshape 
\begin{DoxyItemize}
\item The {\ttfamily tests} attribute of a {\ttfamily $<$testsuites$>$} or {\ttfamily $<$testsuite$>$} element tells how many test functions the googletest program or test suite contains, while the {\ttfamily failures} attribute tells how many of them failed.
\item The {\ttfamily time} attribute expresses the duration of the test, test suite, or entire test program in seconds.
\item The {\ttfamily timestamp} attribute records the local date and time of the test execution.
\item Each {\ttfamily $<$failure$>$} element corresponds to a single failed googletest assertion.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md198}{}\doxysubsubsection{Generating a J\+S\+O\+N Report}\label{md__c_autotoc_md198}
{\itshape  googletest can also emit a J\+S\+ON report as an alternative format to X\+ML. To generate the J\+S\+ON report, set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+O\+U\+T\+P\+UT} environment variable or the {\ttfamily -\/-\/gtest\+\_\+output} flag to the string {\ttfamily \char`\"{}json\+:path\+\_\+to\+\_\+output\+\_\+file\char`\"{}}, which will create the file at the given location. You can also just use the string {\ttfamily \char`\"{}json\char`\"{}}, in which case the output can be found in the {\ttfamily test\+\_\+detail.\+json} file in the current directory.}

{\itshape The report format conforms to the following J\+S\+ON Schema\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{  "\$schema": "http://json-\/schema.org/schema\#",}
\DoxyCodeLine{  "type": "object",}
\DoxyCodeLine{  "definitions": \{}
\DoxyCodeLine{    "TestCase": \{}
\DoxyCodeLine{      "type": "object",}
\DoxyCodeLine{      "properties": \{}
\DoxyCodeLine{        "name": \{ "type": "string" \},}
\DoxyCodeLine{        "tests": \{ "type": "integer" \},}
\DoxyCodeLine{        "failures": \{ "type": "integer" \},}
\DoxyCodeLine{        "disabled": \{ "type": "integer" \},}
\DoxyCodeLine{        "time": \{ "type": "string" \},}
\DoxyCodeLine{        "testsuite": \{}
\DoxyCodeLine{          "type": "array",}
\DoxyCodeLine{          "items": \{}
\DoxyCodeLine{            "\$ref": "\#/definitions/TestInfo"}
\DoxyCodeLine{          \}}
\DoxyCodeLine{        \}}
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \},}
\DoxyCodeLine{    "TestInfo": \{}
\DoxyCodeLine{      "type": "object",}
\DoxyCodeLine{      "properties": \{}
\DoxyCodeLine{        "name": \{ "type": "string" \},}
\DoxyCodeLine{        "status": \{}
\DoxyCodeLine{          "type": "string",}
\DoxyCodeLine{          "enum": ["RUN", "NOTRUN"]}
\DoxyCodeLine{        \},}
\DoxyCodeLine{        "time": \{ "type": "string" \},}
\DoxyCodeLine{        "classname": \{ "type": "string" \},}
\DoxyCodeLine{        "failures": \{}
\DoxyCodeLine{          "type": "array",}
\DoxyCodeLine{          "items": \{}
\DoxyCodeLine{            "\$ref": "\#/definitions/Failure"}
\DoxyCodeLine{          \}}
\DoxyCodeLine{        \}}
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \},}
\DoxyCodeLine{    "Failure": \{}
\DoxyCodeLine{      "type": "object",}
\DoxyCodeLine{      "properties": \{}
\DoxyCodeLine{        "failures": \{ "type": "string" \},}
\DoxyCodeLine{        "type": \{ "type": "string" \}}
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \},}
\DoxyCodeLine{  "properties": \{}
\DoxyCodeLine{    "tests": \{ "type": "integer" \},}
\DoxyCodeLine{    "failures": \{ "type": "integer" \},}
\DoxyCodeLine{    "disabled": \{ "type": "integer" \},}
\DoxyCodeLine{    "errors": \{ "type": "integer" \},}
\DoxyCodeLine{    "timestamp": \{}
\DoxyCodeLine{      "type": "string",}
\DoxyCodeLine{      "format": "date-\/time"}
\DoxyCodeLine{    \},}
\DoxyCodeLine{    "time": \{ "type": "string" \},}
\DoxyCodeLine{    "name": \{ "type": "string" \},}
\DoxyCodeLine{    "testsuites": \{}
\DoxyCodeLine{      "type": "array",}
\DoxyCodeLine{      "items": \{}
\DoxyCodeLine{        "\$ref": "\#/definitions/TestCase"}
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape The report uses the format that conforms to the following Proto3 using the \href{https://developers.google.com/protocol-buffers/docs/proto3\#json}{\texttt{ J\+S\+ON encoding}}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{syntax = "proto3";}
\DoxyCodeLine{}
\DoxyCodeLine{package googletest;}
\DoxyCodeLine{}
\DoxyCodeLine{import "google/protobuf/timestamp.proto";}
\DoxyCodeLine{import "google/protobuf/duration.proto";}
\DoxyCodeLine{}
\DoxyCodeLine{message UnitTest \{}
\DoxyCodeLine{  int32 tests = 1;}
\DoxyCodeLine{  int32 failures = 2;}
\DoxyCodeLine{  int32 disabled = 3;}
\DoxyCodeLine{  int32 errors = 4;}
\DoxyCodeLine{  google.protobuf.Timestamp timestamp = 5;}
\DoxyCodeLine{  google.protobuf.Duration time = 6;}
\DoxyCodeLine{  string name = 7;}
\DoxyCodeLine{  repeated TestCase testsuites = 8;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{message TestCase \{}
\DoxyCodeLine{  string name = 1;}
\DoxyCodeLine{  int32 tests = 2;}
\DoxyCodeLine{  int32 failures = 3;}
\DoxyCodeLine{  int32 disabled = 4;}
\DoxyCodeLine{  int32 errors = 5;}
\DoxyCodeLine{  google.protobuf.Duration time = 6;}
\DoxyCodeLine{  repeated TestInfo testsuite = 7;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{message TestInfo \{}
\DoxyCodeLine{  string name = 1;}
\DoxyCodeLine{  enum Status \{}
\DoxyCodeLine{    RUN = 0;}
\DoxyCodeLine{    NOTRUN = 1;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  Status status = 2;}
\DoxyCodeLine{  google.protobuf.Duration time = 3;}
\DoxyCodeLine{  string classname = 4;}
\DoxyCodeLine{  message Failure \{}
\DoxyCodeLine{    string failures = 1;}
\DoxyCodeLine{    string type = 2;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  repeated Failure failures = 5;}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape For instance, the following program}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST(MathTest, Addition) \{ ... \}}
\DoxyCodeLine{TEST(MathTest, Subtraction) \{ ... \}}
\DoxyCodeLine{TEST(LogicTest, NonContradiction) \{ ... \}}
\end{DoxyCode}
}

{\itshape could generate this report\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{  "tests": 3,}
\DoxyCodeLine{  "failures": 1,}
\DoxyCodeLine{  "errors": 0,}
\DoxyCodeLine{  "time": "0.035s",}
\DoxyCodeLine{  "timestamp": "2011-\/10-\/31T18:52:42Z",}
\DoxyCodeLine{  "name": "AllTests",}
\DoxyCodeLine{  "testsuites": [}
\DoxyCodeLine{    \{}
\DoxyCodeLine{      "name": "MathTest",}
\DoxyCodeLine{      "tests": 2,}
\DoxyCodeLine{      "failures": 1,}
\DoxyCodeLine{      "errors": 0,}
\DoxyCodeLine{      "time": "0.015s",}
\DoxyCodeLine{      "testsuite": [}
\DoxyCodeLine{        \{}
\DoxyCodeLine{          "name": "Addition",}
\DoxyCodeLine{          "status": "RUN",}
\DoxyCodeLine{          "time": "0.007s",}
\DoxyCodeLine{          "classname": "",}
\DoxyCodeLine{          "failures": [}
\DoxyCodeLine{            \{}
\DoxyCodeLine{              "message": "Value of: add(1, 1)\(\backslash\)n  Actual: 3\(\backslash\)nExpected: 2",}
\DoxyCodeLine{              "type": ""}
\DoxyCodeLine{            \},}
\DoxyCodeLine{            \{}
\DoxyCodeLine{              "message": "Value of: add(1, -\/1)\(\backslash\)n  Actual: 1\(\backslash\)nExpected: 0",}
\DoxyCodeLine{              "type": ""}
\DoxyCodeLine{            \}}
\DoxyCodeLine{          ]}
\DoxyCodeLine{        \},}
\DoxyCodeLine{        \{}
\DoxyCodeLine{          "name": "Subtraction",}
\DoxyCodeLine{          "status": "RUN",}
\DoxyCodeLine{          "time": "0.005s",}
\DoxyCodeLine{          "classname": ""}
\DoxyCodeLine{        \}}
\DoxyCodeLine{      ]}
\DoxyCodeLine{    \},}
\DoxyCodeLine{    \{}
\DoxyCodeLine{      "name": "LogicTest",}
\DoxyCodeLine{      "tests": 1,}
\DoxyCodeLine{      "failures": 0,}
\DoxyCodeLine{      "errors": 0,}
\DoxyCodeLine{      "time": "0.005s",}
\DoxyCodeLine{      "testsuite": [}
\DoxyCodeLine{        \{}
\DoxyCodeLine{          "name": "NonContradiction",}
\DoxyCodeLine{          "status": "RUN",}
\DoxyCodeLine{          "time": "0.005s",}
\DoxyCodeLine{          "classname": ""}
\DoxyCodeLine{        \}}
\DoxyCodeLine{      ]}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  ]}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape I\+M\+P\+O\+R\+T\+A\+NT\+: The exact format of the J\+S\+ON document is subject to change.}

{\itshape }\hypertarget{md__c_autotoc_md199}{}\doxysubsection{Controlling How Failures Are Reported}\label{md__c_autotoc_md199}
{\itshape  }\hypertarget{md__c_autotoc_md200}{}\doxysubsubsection{Turning Assertion Failures into Break-\/\+Points}\label{md__c_autotoc_md200}
{\itshape  When running test programs under a debugger, it\textquotesingle{}s very convenient if the debugger can catch an assertion failure and automatically drop into interactive mode. googletest\textquotesingle{}s {\itshape break-\/on-\/failure} mode supports this behavior.}

{\itshape To enable it, set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+B\+R\+E\+A\+K\+\_\+\+O\+N\+\_\+\+F\+A\+I\+L\+U\+RE} environment variable to a value other than {\ttfamily 0}. Alternatively, you can use the {\ttfamily -\/-\/gtest\+\_\+break\+\_\+on\+\_\+failure} command line flag.}

{\itshape }\hypertarget{md__c_autotoc_md201}{}\doxysubsubsection{Disabling Catching Test-\/\+Thrown Exceptions}\label{md__c_autotoc_md201}
{\itshape  googletest can be used either with or without exceptions enabled. If a test throws a C++ exception or (on Windows) a structured exception (S\+EH), by default googletest catches it, reports it as a test failure, and continues with the next test method. This maximizes the coverage of a test run. Also, on Windows an uncaught exception will cause a pop-\/up window, so catching the exceptions allows you to run the tests automatically.}

{\itshape When debugging the test failures, however, you may instead want the exceptions to be handled by the debugger, such that you can examine the call stack when an exception is thrown. To achieve that, set the {\ttfamily G\+T\+E\+S\+T\+\_\+\+C\+A\+T\+C\+H\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+NS} environment variable to {\ttfamily 0}, or use the {\ttfamily -\/-\/gtest\+\_\+catch\+\_\+exceptions=0} flag when running the tests.}

{\itshape }\hypertarget{md__c_autotoc_md203}{}\doxysection{Why should test suite names and test names not contain underscore?}\label{md__c_autotoc_md203}
{\itshape  Underscore ({\ttfamily \+\_\+}) is special, as C++ reserves the following to be used by the compiler and the standard library\+:}

{\itshape 
\begin{DoxyEnumerate}
\item any identifier that starts with an {\ttfamily \+\_\+} followed by an upper-\/case letter, and
\item any identifier that contains two consecutive underscores (i.\+e. {\ttfamily \+\_\+\+\_\+}) {\itshape anywhere} in its name.
\end{DoxyEnumerate}}

{\itshape User code is {\itshape prohibited} from using such identifiers.}

{\itshape Now let\textquotesingle{}s look at what this means for {\ttfamily T\+E\+ST} and {\ttfamily T\+E\+S\+T\+\_\+F}.}

{\itshape Currently {\ttfamily T\+E\+S\+T(\+Test\+Suite\+Name, Test\+Name)} generates a class named {\ttfamily Test\+Suite\+Name\+\_\+\+Test\+Name\+\_\+\+Test}. What happens if {\ttfamily Test\+Suite\+Name} or {\ttfamily Test\+Name} contains {\ttfamily \+\_\+}?}

{\itshape 
\begin{DoxyEnumerate}
\item If {\ttfamily Test\+Suite\+Name} starts with an {\ttfamily \+\_\+} followed by an upper-\/case letter (say, {\ttfamily \+\_\+\+Foo}), we end up with {\ttfamily \+\_\+\+Foo\+\_\+\+Test\+Name\+\_\+\+Test}, which is reserved and thus invalid.
\item If {\ttfamily Test\+Suite\+Name} ends with an {\ttfamily \+\_\+} (say, {\ttfamily Foo\+\_\+}), we get {\ttfamily Foo\+\_\+\+\_\+\+Test\+Name\+\_\+\+Test}, which is invalid.
\item If {\ttfamily Test\+Name} starts with an {\ttfamily \+\_\+} (say, {\ttfamily \+\_\+\+Bar}), we get {\ttfamily Test\+Suite\+Name\+\_\+\+\_\+\+Bar\+\_\+\+Test}, which is invalid.
\item If {\ttfamily Test\+Name} ends with an {\ttfamily \+\_\+} (say, {\ttfamily Bar\+\_\+}), we get {\ttfamily Test\+Suite\+Name\+\_\+\+Bar\+\_\+\+\_\+\+Test}, which is invalid.
\end{DoxyEnumerate}}

{\itshape So clearly {\ttfamily Test\+Suite\+Name} and {\ttfamily Test\+Name} cannot start or end with {\ttfamily \+\_\+} (Actually, {\ttfamily Test\+Suite\+Name} can start with {\ttfamily \+\_\+} -- as long as the {\ttfamily \+\_\+} isn\textquotesingle{}t followed by an upper-\/case letter. But that\textquotesingle{}s getting complicated. So for simplicity we just say that it cannot start with {\ttfamily \+\_\+}.).}

{\itshape It may seem fine for {\ttfamily Test\+Suite\+Name} and {\ttfamily Test\+Name} to contain {\ttfamily \+\_\+} in the middle. However, consider this\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST(Time, Flies\_Like\_An\_Arrow) \{ ... \}}
\DoxyCodeLine{TEST(Time\_Flies, Like\_An\_Arrow) \{ ... \}}
\end{DoxyCode}
}

{\itshape Now, the two {\ttfamily T\+E\+ST}s will both generate the same class ({\ttfamily Time\+\_\+\+Flies\+\_\+\+Like\+\_\+\+An\+\_\+\+Arrow\+\_\+\+Test}). That\textquotesingle{}s not good.}

{\itshape So for simplicity, we just ask the users to avoid {\ttfamily \+\_\+} in {\ttfamily Test\+Suite\+Name} and {\ttfamily Test\+Name}. The rule is more constraining than necessary, but it\textquotesingle{}s simple and easy to remember. It also gives googletest some wiggle room in case its implementation needs to change in the future.}

{\itshape If you violate the rule, there may not be immediate consequences, but your test may (just may) break with a new compiler (or a new version of the compiler you are using) or with a new version of googletest. Therefore it\textquotesingle{}s best to follow the rule.}

{\itshape }\hypertarget{md__c_autotoc_md204}{}\doxysection{Why does googletest support $<$tt$>$\+E\+X\+P\+E\+C\+T\+\_\+\+E\+Q(\+N\+U\+L\+L, ptr)$<$/tt$>$ and $<$tt$>$\+A\+S\+S\+E\+R\+T\+\_\+\+E\+Q(\+N\+U\+L\+L, ptr)$<$/tt$>$ but not $<$tt$>$\+E\+X\+P\+E\+C\+T\+\_\+\+N\+E(\+N\+U\+L\+L, ptr)$<$/tt$>$ and $<$tt$>$\+A\+S\+S\+E\+R\+T\+\_\+\+N\+E(\+N\+U\+L\+L, ptr)$<$/tt$>$?}\label{md__c_autotoc_md204}
{\itshape  First of all you can use {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+E(nullptr, ptr)} and {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+NE(nullptr, ptr)}. This is the preferred syntax in the style guide because nullptr does not have the type problems that N\+U\+LL does. Which is why N\+U\+LL does not work.}

{\itshape Due to some peculiarity of C++, it requires some non-\/trivial template meta programming tricks to support using {\ttfamily N\+U\+LL} as an argument of the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+X\+X()} and {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+X\+X()} macros. Therefore we only do it where it\textquotesingle{}s most needed (otherwise we make the implementation of googletest harder to maintain and more error-\/prone than necessary).}

{\itshape The {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+Q()} macro takes the {\itshape expected} value as its first argument and the {\itshape actual} value as the second. It\textquotesingle{}s reasonable that someone wants to write {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+Q(\+N\+U\+L\+L, some\+\_\+expression)}, and this indeed was requested several times. Therefore we implemented it.}

{\itshape The need for {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+E(\+N\+U\+L\+L, ptr)} isn\textquotesingle{}t nearly as strong. When the assertion fails, you already know that {\ttfamily ptr} must be {\ttfamily N\+U\+LL}, so it doesn\textquotesingle{}t add any information to print {\ttfamily ptr} in this case. That means {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+UE(ptr != N\+U\+LL)} works just as well.}

{\itshape If we were to support {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+E(\+N\+U\+L\+L, ptr)}, for consistency we\textquotesingle{}ll have to support {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+E(ptr, N\+U\+L\+L)} as well, as unlike {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+EQ}, we don\textquotesingle{}t have a convention on the order of the two arguments for {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+NE}. This means using the template meta programming tricks twice in the implementation, making it even harder to understand and maintain. We believe the benefit doesn\textquotesingle{}t justify the cost.}

{\itshape Finally, with the growth of the g\+Mock matcher library, we are encouraging people to use the unified {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+H\+A\+T(value, matcher)} syntax more often in tests. One significant advantage of the matcher approach is that matchers can be easily combined to form new matchers, while the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+NE}, etc, macros cannot be easily combined. Therefore we want to invest more in the matchers than in the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+X\+X()} macros.}

{\itshape }\hypertarget{md__c_autotoc_md205}{}\doxysection{I need to test that different implementations of an interface satisfy some common requirements. Should I use typed tests or value-\/parameterized tests?}\label{md__c_autotoc_md205}
{\itshape  For testing various implementations of the same interface, either typed tests or value-\/parameterized tests can get it done. It\textquotesingle{}s really up to you the user to decide which is more convenient for you, depending on your particular case. Some rough guidelines\+:}

{\itshape 
\begin{DoxyItemize}
\item Typed tests can be easier to write if instances of the different implementations can be created the same way, modulo the type. For example, if all these implementations have a public default constructor (such that you can write {\ttfamily new Type\+Param}), or if their factory functions have the same form (e.\+g. {\ttfamily Create\+Instance$<$Type\+Param$>$()}).
\item Value-\/parameterized tests can be easier to write if you need different code patterns to create different implementations\textquotesingle{} instances, e.\+g. {\ttfamily new Foo} vs {\ttfamily new Bar(5)}. To accommodate for the differences, you can write factory function wrappers and pass these function pointers to the tests as their parameters.
\item When a typed test fails, the default output includes the name of the type, which can help you quickly identify which implementation is wrong. Value-\/parameterized tests only show the number of the failed iteration by default. You will need to define a function that returns the iteration name and pass it as the third parameter to I\+N\+S\+T\+A\+N\+T\+I\+A\+T\+E\+\_\+\+T\+E\+S\+T\+\_\+\+S\+U\+I\+T\+E\+\_\+P to have more useful output.
\item When using typed tests, you need to make sure you are testing against the interface type, not the concrete types (in other words, you want to make sure {\ttfamily implicit\+\_\+cast$<$My\+Interface$\ast$$>$(my\+\_\+concrete\+\_\+impl)} works, not just that {\ttfamily my\+\_\+concrete\+\_\+impl} works). It\textquotesingle{}s less likely to make mistakes in this area when using value-\/parameterized tests.
\end{DoxyItemize}}

{\itshape I hope I didn\textquotesingle{}t confuse you more. \+:-\/) If you don\textquotesingle{}t mind, I\textquotesingle{}d suggest you to give both approaches a try. Practice is a much better way to grasp the subtle differences between the two tools. Once you have some concrete experience, you can much more easily decide which one to use the next time.}

{\itshape }\hypertarget{md__c_autotoc_md206}{}\doxysection{I got some run-\/time errors about invalid proto descriptors when using $<$tt$>$\+Protocol\+Message\+Equals$<$/tt$>$. Help!}\label{md__c_autotoc_md206}
{\itshape  {\bfseries{Note\+:}} {\ttfamily Protocol\+Message\+Equals} and {\ttfamily Protocol\+Message\+Equiv} are {\itshape deprecated} now. Please use {\ttfamily Equals\+Proto}, etc instead.}

{\itshape {\ttfamily Protocol\+Message\+Equals} and {\ttfamily Protocol\+Message\+Equiv} were redefined recently and are now less tolerant of invalid protocol buffer definitions. In particular, if you have a {\ttfamily foo.\+proto} that doesn\textquotesingle{}t fully qualify the type of a protocol message it references (e.\+g. {\ttfamily message$<$Bar$>$} where it should be {\ttfamily message$<$blah.\+Bar$>$}), you will now get run-\/time errors like\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{... descriptor.cc:...] Invalid proto descriptor for file "path/to/foo.proto":}
\DoxyCodeLine{... descriptor.cc:...]  blah.MyMessage.my\_field: ".Bar" is not defined.}
\end{DoxyCode}
}

{\itshape If you see this, your {\ttfamily .proto} file is broken and needs to be fixed by making the types fully qualified. The new definition of {\ttfamily Protocol\+Message\+Equals} and {\ttfamily Protocol\+Message\+Equiv} just happen to reveal your bug.}

{\itshape }\hypertarget{md__c_autotoc_md207}{}\doxysection{My death test modifies some state, but the change seems lost after the death test finishes. Why?}\label{md__c_autotoc_md207}
{\itshape  Death tests ({\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+TH}, etc) are executed in a sub-\/process s.\+t. the expected crash won\textquotesingle{}t kill the test program (i.\+e. the parent process). As a result, any in-\/memory side effects they incur are observable in their respective sub-\/processes, but not in the parent process. You can think of them as running in a parallel universe, more or less.}

{\itshape In particular, if you use mocking and the death test statement invokes some mock methods, the parent process will think the calls have never occurred. Therefore, you may want to move your {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+C\+A\+LL} statements inside the {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+TH} macro.}

{\itshape }\hypertarget{md__c_autotoc_md208}{}\doxysection{E\+X\+P\+E\+C\+T\+\_\+\+E\+Q(htonl(blah), blah\+\_\+blah) generates weird compiler errors in opt mode. Is this a googletest bug?}\label{md__c_autotoc_md208}
{\itshape  Actually, the bug is in {\ttfamily htonl()}.}

{\itshape According to `\textquotesingle{}man htonl'{\ttfamily ,}htonl(){\ttfamily is a $\ast$function$\ast$, which means it\textquotesingle{}s valid to use}htonl{\ttfamily as a function pointer. However, in opt mode}htonl()\`{} is defined as a {\itshape macro}, which breaks this usage.}

{\itshape Worse, the macro definition of {\ttfamily htonl()} uses a {\ttfamily gcc} extension and is {\itshape not} standard C++. That hacky implementation has some ad hoc limitations. In particular, it prevents you from writing {\ttfamily Foo$<$sizeof(htonl(x))$>$()}, where {\ttfamily Foo} is a template that has an integral argument.}

{\itshape The implementation of {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+Q(a, b)} uses {\ttfamily sizeof(... a ...)} inside a template argument, and thus doesn\textquotesingle{}t compile in opt mode when {\ttfamily a} contains a call to {\ttfamily htonl()}. It is difficult to make {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+EQ} bypass the {\ttfamily htonl()} bug, as the solution must work with different compilers on various platforms.}

{\itshape {\ttfamily htonl()} has some other problems as described in {\ttfamily //util/endian/endian.h}, which defines {\ttfamily ghtonl()} to replace it. {\ttfamily ghtonl()} does the same thing {\ttfamily htonl()} does, only without its problems. We suggest you to use {\ttfamily ghtonl()} instead of {\ttfamily htonl()}, both in your tests and production code.}

{\itshape {\ttfamily //util/endian/endian.h} also defines {\ttfamily ghtons()}, which solves similar problems in {\ttfamily htons()}.}

{\itshape Don\textquotesingle{}t forget to add {\ttfamily //util/endian} to the list of dependencies in the {\ttfamily B\+U\+I\+LD} file wherever {\ttfamily ghtonl()} and {\ttfamily ghtons()} are used. The library consists of a single header file and will not bloat your binary.}

{\itshape }\hypertarget{md__c_autotoc_md209}{}\doxysection{The compiler complains about \char`\"{}undefined references\char`\"{} to some static const member variables, but I did define them in the class body. What\textquotesingle{}s wrong?}\label{md__c_autotoc_md209}
{\itshape  If your class has a static data member\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// foo.h}
\DoxyCodeLine{class Foo \{}
\DoxyCodeLine{  ...}
\DoxyCodeLine{  static const int kBar = 100;}
\DoxyCodeLine{\};}
\end{DoxyCode}
}

{\itshape You also need to define it {\itshape outside} of the class body in {\ttfamily foo.\+cc}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{const int Foo::kBar;  // No initializer here.}
\end{DoxyCode}
}

{\itshape Otherwise your code is {\bfseries{invalid C++}}, and may break in unexpected ways. In particular, using it in googletest comparison assertions ({\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+EQ}, etc) will generate an \char`\"{}undefined reference\char`\"{} linker error. The fact that \char`\"{}it used to work\char`\"{} doesn\textquotesingle{}t mean it\textquotesingle{}s valid. It just means that you were lucky. \+:-\/)}

{\itshape }\hypertarget{md__c_autotoc_md210}{}\doxysection{Can I derive a test fixture from another?}\label{md__c_autotoc_md210}
{\itshape  Yes.}

{\itshape Each test fixture has a corresponding and same named test suite. This means only one test suite can use a particular fixture. Sometimes, however, multiple test cases may want to use the same or slightly different fixtures. For example, you may want to make sure that all of a G\+UI library\textquotesingle{}s test suites don\textquotesingle{}t leak important system resources like fonts and brushes.}

{\itshape In googletest, you share a fixture among test suites by putting the shared logic in a base test fixture, then deriving from that base a separate fixture for each test suite that wants to use this common logic. You then use {\ttfamily T\+E\+S\+T\+\_\+\+F()} to write tests using each derived fixture.}

{\itshape Typically, your code looks like this\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// Defines a base test fixture.}
\DoxyCodeLine{class BaseTest : public ::testing::Test \{}
\DoxyCodeLine{ protected:}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{// Derives a fixture FooTest from BaseTest.}
\DoxyCodeLine{class FooTest : public BaseTest \{}
\DoxyCodeLine{ protected:}
\DoxyCodeLine{  void SetUp() override \{}
\DoxyCodeLine{    BaseTest::SetUp();  // Sets up the base fixture first.}
\DoxyCodeLine{    ... additional set-\/up work ...}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  void TearDown() override \{}
\DoxyCodeLine{    ... clean-\/up work for FooTest ...}
\DoxyCodeLine{    BaseTest::TearDown();  // Remember to tear down the base fixture}
\DoxyCodeLine{                           // after cleaning up FooTest!}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  ... functions and variables for FooTest ...}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{// Tests that use the fixture FooTest.}
\DoxyCodeLine{TEST\_F(FooTest, Bar) \{ ... \}}
\DoxyCodeLine{TEST\_F(FooTest, Baz) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{... additional fixtures derived from BaseTest ...}
\end{DoxyCode}
}

{\itshape If necessary, you can continue to derive test fixtures from a derived fixture. googletest has no limit on how deep the hierarchy can be.}

{\itshape For a complete example using derived test fixtures, see \href{../samples/sample5_unittest.cc}{\texttt{ sample5\+\_\+unittest.\+cc}}.}

{\itshape }\hypertarget{md__c_autotoc_md211}{}\doxysection{My compiler complains \char`\"{}void value not ignored as it ought to be.\char`\"{} What does this mean?}\label{md__c_autotoc_md211}
{\itshape  You\textquotesingle{}re probably using an {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$()} in a function that doesn\textquotesingle{}t return {\ttfamily void}. {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$()} can only be used in {\ttfamily void} functions, due to exceptions being disabled by our build system. Please see more details \href{advanced.md\#assertion-placement}{\texttt{ here}}.}

{\itshape }\hypertarget{md__c_autotoc_md212}{}\doxysection{My death test hangs (or seg-\/faults). How do I fix it?}\label{md__c_autotoc_md212}
{\itshape  In googletest, death tests are run in a child process and the way they work is delicate. To write death tests you really need to understand how they work. Please make sure you have read \href{advanced.md\#how-it-works}{\texttt{ this}}.}

{\itshape In particular, death tests don\textquotesingle{}t like having multiple threads in the parent process. So the first thing you can try is to eliminate creating threads outside of {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+T\+H()}. For example, you may want to use mocks or fake objects instead of real ones in your tests.}

{\itshape Sometimes this is impossible as some library you must use may be creating threads before {\ttfamily main()} is even reached. In this case, you can try to minimize the chance of conflicts by either moving as many activities as possible inside {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+T\+H()} (in the extreme case, you want to move everything inside), or leaving as few things as possible in it. Also, you can try to set the death test style to {\ttfamily \char`\"{}threadsafe\char`\"{}}, which is safer but slower, and see if it helps.}

{\itshape If you go with thread-\/safe death tests, remember that they rerun the test program from the beginning in the child process. Therefore make sure your program can run side-\/by-\/side with itself and is deterministic.}

{\itshape In the end, this boils down to good concurrent programming. You have to make sure that there is no race conditions or dead locks in your program. No silver bullet -\/ sorry!}

{\itshape }\hypertarget{md__c_autotoc_md213}{}\doxysection{Should I use the constructor/destructor of the test fixture or Set\+Up()/\+Tear\+Down()?}\label{md__c_autotoc_md213}
{\itshape  The first thing to remember is that googletest does {\bfseries{not}} reuse the same test fixture object across multiple tests. For each {\ttfamily T\+E\+S\+T\+\_\+F}, googletest will create a {\bfseries{fresh}} test fixture object, immediately call {\ttfamily Set\+Up()}, run the test body, call {\ttfamily Tear\+Down()}, and then delete the test fixture object.}

{\itshape When you need to write per-\/test set-\/up and tear-\/down logic, you have the choice between using the test fixture constructor/destructor or {\ttfamily Set\+Up()/\+Tear\+Down()}. The former is usually preferred, as it has the following benefits\+:}

{\itshape 
\begin{DoxyItemize}
\item By initializing a member variable in the constructor, we have the option to make it {\ttfamily const}, which helps prevent accidental changes to its value and makes the tests more obviously correct.
\item In case we need to subclass the test fixture class, the subclass\textquotesingle{} constructor is guaranteed to call the base class\textquotesingle{} constructor {\itshape first}, and the subclass\textquotesingle{} destructor is guaranteed to call the base class\textquotesingle{} destructor {\itshape afterward}. With {\ttfamily Set\+Up()/\+Tear\+Down()}, a subclass may make the mistake of forgetting to call the base class\textquotesingle{} {\ttfamily Set\+Up()/\+Tear\+Down()} or call them at the wrong time.
\end{DoxyItemize}}

{\itshape You may still want to use {\ttfamily Set\+Up()/\+Tear\+Down()} in the following cases\+:}

{\itshape 
\begin{DoxyItemize}
\item C++ does not allow virtual function calls in constructors and destructors. You can call a method declared as virtual, but it will not use dynamic dispatch, it will use the definition from the class the constructor of which is currently executing. This is because calling a virtual method before the derived class constructor has a chance to run is very dangerous -\/ the virtual method might operate on uninitialized data. Therefore, if you need to call a method that will be overridden in a derived class, you have to use {\ttfamily Set\+Up()/\+Tear\+Down()}.
\item In the body of a constructor (or destructor), it\textquotesingle{}s not possible to use the {\ttfamily A\+S\+S\+E\+R\+T\+\_\+xx} macros. Therefore, if the set-\/up operation could cause a fatal test failure that should prevent the test from running, it\textquotesingle{}s necessary to use {\ttfamily abort} and abort the whole test executable, or to use {\ttfamily Set\+Up()} instead of a constructor.
\item If the tear-\/down operation could throw an exception, you must use {\ttfamily Tear\+Down()} as opposed to the destructor, as throwing in a destructor leads to undefined behavior and usually will kill your program right away. Note that many standard libraries (like S\+TL) may throw when exceptions are enabled in the compiler. Therefore you should prefer {\ttfamily Tear\+Down()} if you want to write portable tests that work with or without exceptions.
\item The googletest team is considering making the assertion macros throw on platforms where exceptions are enabled (e.\+g. Windows, Mac OS, and Linux client-\/side), which will eliminate the need for the user to propagate failures from a subroutine to its caller. Therefore, you shouldn\textquotesingle{}t use googletest assertions in a destructor if your code could run on such a platform.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md214}{}\doxysection{The compiler complains \char`\"{}no matching function to call\char`\"{} when I use A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D$\ast$. How do I fix it?}\label{md__c_autotoc_md214}
{\itshape  If the predicate function you use in {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D$\ast$} or {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D$\ast$} is overloaded or a template, the compiler will have trouble figuring out which overloaded version it should use. {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T$\ast$} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T$\ast$} don\textquotesingle{}t have this problem.}

{\itshape If you see this error, you might want to switch to {\ttfamily (A\+S\+S\+E\+R\+T$\vert$\+E\+X\+P\+E\+CT)\+\_\+\+P\+R\+E\+D\+\_\+\+F\+O\+R\+M\+A\+T$\ast$}, which will also give you a better failure message. If, however, that is not an option, you can resolve the problem by explicitly telling the compiler which version to pick.}

{\itshape For example, suppose you have}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{bool IsPositive(int n) \{}
\DoxyCodeLine{  return n > 0;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{bool IsPositive(double x) \{}
\DoxyCodeLine{  return x > 0;}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape you will get a compiler error if you write}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{EXPECT\_PRED1(IsPositive, 5);}
\end{DoxyCode}
}

{\itshape However, this will work\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{EXPECT\_PRED1(static\_cast<bool (*)(int)>(IsPositive), 5);}
\end{DoxyCode}
}

{\itshape (The stuff inside the angled brackets for the {\ttfamily static\+\_\+cast} operator is the type of the function pointer for the {\ttfamily int}-\/version of {\ttfamily Is\+Positive()}.)}

{\itshape As another example, when you have a template function}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{template <typename T>}
\DoxyCodeLine{bool IsNegative(T x) \{}
\DoxyCodeLine{  return x < 0;}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape you can use it in a predicate assertion like this\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{ASSERT\_PRED1(IsNegative<int>, -\/5);}
\end{DoxyCode}
}

{\itshape Things are more interesting if your template has more than one parameters. The following won\textquotesingle{}t compile\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{ASSERT\_PRED2(GreaterThan<int, int>, 5, 0);}
\end{DoxyCode}
}

{\itshape as the C++ pre-\/processor thinks you are giving {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+P\+R\+E\+D2} 4 arguments, which is one more than expected. The workaround is to wrap the predicate function in parentheses\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{ASSERT\_PRED2((GreaterThan<int, int>), 5, 0);}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md215}{}\doxysection{My compiler complains about \char`\"{}ignoring return value\char`\"{} when I call R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S(). Why?}\label{md__c_autotoc_md215}
{\itshape  Some people had been ignoring the return value of {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}. That is, instead of}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ return RUN\_ALL\_TESTS();}
\end{DoxyCode}
}

{\itshape they write}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ RUN\_ALL\_TESTS();}
\end{DoxyCode}
}

{\itshape This is {\bfseries{wrong and dangerous}}. The testing services needs to see the return value of {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} in order to determine if a test has passed. If your {\ttfamily main()} function ignores it, your test will be considered successful even if it has a googletest assertion failure. Very bad.}

{\itshape We have decided to fix this (thanks to Michael Chastain for the idea). Now, your code will no longer be able to ignore {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} when compiled with {\ttfamily gcc}. If you do so, you\textquotesingle{}ll get a compiler error.}

{\itshape If you see the compiler complaining about you ignoring the return value of {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}, the fix is simple\+: just make sure its value is used as the return value of {\ttfamily main()}.}

{\itshape But how could we introduce a change that breaks existing tests? Well, in this case, the code was already broken in the first place, so we didn\textquotesingle{}t break it. \+:-\/)}

{\itshape }\hypertarget{md__c_autotoc_md216}{}\doxysection{My compiler complains that a constructor (or destructor) cannot return a value. What\textquotesingle{}s going on?}\label{md__c_autotoc_md216}
{\itshape  Due to a peculiarity of C++, in order to support the syntax for streaming messages to an {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$}, e.\+g.}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\{c++\}}
\DoxyCodeLine{ ASSERT\_EQ(1, Foo()) << "blah blah" << foo;}
\end{DoxyCode}
}

{\itshape we had to give up using {\ttfamily A\+S\+S\+E\+R\+T$\ast$} and {\ttfamily F\+A\+I\+L$\ast$} (but not {\ttfamily E\+X\+P\+E\+C\+T$\ast$} and {\ttfamily A\+D\+D\+\_\+\+F\+A\+I\+L\+U\+R\+E$\ast$}) in constructors and destructors. The workaround is to move the content of your constructor/destructor to a private void member function, or switch to {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$()} if that works. This \href{advanced.md\#assertion-placement}{\texttt{ section}} in the user\textquotesingle{}s guide explains it.}

{\itshape }\hypertarget{md__c_autotoc_md217}{}\doxysection{My Set\+Up() function is not called. Why?}\label{md__c_autotoc_md217}
{\itshape  C++ is case-\/sensitive. Did you spell it as {\ttfamily Setup()}?}

{\itshape Similarly, sometimes people spell {\ttfamily Set\+Up\+Test\+Suite()} as {\ttfamily Setup\+Test\+Suite()} and wonder why it\textquotesingle{}s never called.}

{\itshape }\hypertarget{md__c_autotoc_md218}{}\doxysection{I have several test suites which share the same test fixture logic, do I have to define a new test fixture class for each of them? This seems pretty tedious.}\label{md__c_autotoc_md218}
{\itshape  You don\textquotesingle{}t have to. Instead of}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class FooTest : public BaseTest \{\};}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, Abc) \{ ... \}}
\DoxyCodeLine{TEST\_F(FooTest, Def) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{class BarTest : public BaseTest \{\};}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(BarTest, Abc) \{ ... \}}
\DoxyCodeLine{TEST\_F(BarTest, Def) \{ ... \}}
\end{DoxyCode}
}

{\itshape you can simply {\ttfamily typedef} the test fixtures\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{typedef BaseTest FooTest;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, Abc) \{ ... \}}
\DoxyCodeLine{TEST\_F(FooTest, Def) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{typedef BaseTest BarTest;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(BarTest, Abc) \{ ... \}}
\DoxyCodeLine{TEST\_F(BarTest, Def) \{ ... \}}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md219}{}\doxysection{googletest output is buried in a whole bunch of L\+O\+G messages. What do I do?}\label{md__c_autotoc_md219}
{\itshape  The googletest output is meant to be a concise and human-\/friendly report. If your test generates textual output itself, it will mix with the googletest output, making it hard to read. However, there is an easy solution to this problem.}

{\itshape Since {\ttfamily L\+OG} messages go to stderr, we decided to let googletest output go to stdout. This way, you can easily separate the two using redirection. For example\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$ ./my\_test > gtest\_output.txt}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md220}{}\doxysection{Why should I prefer test fixtures over global variables?}\label{md__c_autotoc_md220}
{\itshape  There are several good reasons\+:}

{\itshape 
\begin{DoxyEnumerate}
\item It\textquotesingle{}s likely your test needs to change the states of its global variables. This makes it difficult to keep side effects from escaping one test and contaminating others, making debugging difficult. By using fixtures, each test has a fresh set of variables that\textquotesingle{}s different (but with the same names). Thus, tests are kept independent of each other.
\item Global variables pollute the global namespace.
\item Test fixtures can be reused via subclassing, which cannot be done easily with global variables. This is useful if many test suites have something in common.
\end{DoxyEnumerate}}

{\itshape }\hypertarget{md__c_autotoc_md221}{}\doxysection{What can the statement argument in A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+T\+H() be?}\label{md__c_autotoc_md221}
{\itshape  {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+T\+H($\ast$statement$\ast$, $\ast$regex$\ast$)} (or any death assertion macro) can be used wherever {\ttfamily $\ast$statement$\ast$} is valid. So basically {\ttfamily $\ast$statement$\ast$} can be any C++ statement that makes sense in the current context. In particular, it can reference global and/or local variables, and can be\+:}

{\itshape 
\begin{DoxyItemize}
\item a simple function call (often the case),
\item a complex expression, or
\item a compound statement.
\end{DoxyItemize}}

{\itshape Some examples are shown here\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// A death test can be a simple function call.}
\DoxyCodeLine{TEST(MyDeathTest, FunctionCall) \{}
\DoxyCodeLine{  ASSERT\_DEATH(Xyz(5), "Xyz failed");}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{// Or a complex expression that references variables and functions.}
\DoxyCodeLine{TEST(MyDeathTest, ComplexExpression) \{}
\DoxyCodeLine{  const bool c = Condition();}
\DoxyCodeLine{  ASSERT\_DEATH((c ? Func1(0) : object2.Method("test")),}
\DoxyCodeLine{               "(Func1|Method) failed");}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{// Death assertions can be used any where in a function.  In}
\DoxyCodeLine{// particular, they can be inside a loop.}
\DoxyCodeLine{TEST(MyDeathTest, InsideLoop) \{}
\DoxyCodeLine{  // Verifies that Foo(0), Foo(1), ..., and Foo(4) all die.}
\DoxyCodeLine{  for (int i = 0; i < 5; i++) \{}
\DoxyCodeLine{    EXPECT\_DEATH\_M(Foo(i), "Foo has \(\backslash\)\(\backslash\)d+ errors",}
\DoxyCodeLine{                   ::testing::Message() << "where i is " << i);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{// A death assertion can contain a compound statement.}
\DoxyCodeLine{TEST(MyDeathTest, CompoundStatement) \{}
\DoxyCodeLine{  // Verifies that at lease one of Bar(0), Bar(1), ..., and}
\DoxyCodeLine{  // Bar(4) dies.}
\DoxyCodeLine{  ASSERT\_DEATH(\{}
\DoxyCodeLine{    for (int i = 0; i < 5; i++) \{}
\DoxyCodeLine{      Bar(i);}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \},}
\DoxyCodeLine{  "Bar has \(\backslash\)\(\backslash\)d+ errors");}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape gtest-\/death-\/test\+\_\+test.\+cc contains more examples if you are interested.}

{\itshape }\hypertarget{md__c_autotoc_md222}{}\doxysection{I have a fixture class $<$tt$>$\+Foo\+Test$<$/tt$>$, but $<$tt$>$\+T\+E\+S\+T\+\_\+\+F(\+Foo\+Test, Bar)$<$/tt$>$ gives me error $<$tt$>$\char`\"{}no matching function for call to \`{}\+Foo\+Test\+::\+Foo\+Test()\textquotesingle{}\char`\"{}$<$/tt$>$. Why?}\label{md__c_autotoc_md222}
{\itshape  Googletest needs to be able to create objects of your test fixture class, so it must have a default constructor. Normally the compiler will define one for you. However, there are cases where you have to define your own\+:}

{\itshape 
\begin{DoxyItemize}
\item If you explicitly declare a non-\/default constructor for class {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} ({\ttfamily D\+I\+S\+A\+L\+L\+O\+W\+\_\+\+E\+V\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+U\+C\+T\+O\+R\+S()} does this), then you need to define a default constructor, even if it would be empty.
\item If {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} has a const non-\/static data member, then you have to define the default constructor {\itshape and} initialize the const member in the initializer list of the constructor. (Early versions of {\ttfamily gcc} doesn\textquotesingle{}t force you to initialize the const member. It\textquotesingle{}s a bug that has been fixed in {\ttfamily gcc 4}.)
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md223}{}\doxysection{Why does A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+T\+H complain about previous threads that were already joined?}\label{md__c_autotoc_md223}
{\itshape  With the Linux pthread library, there is no turning back once you cross the line from single thread to multiple threads. The first time you create a thread, a manager thread is created in addition, so you get 3, not 2, threads. Later when the thread you create joins the main thread, the thread count decrements by 1, but the manager thread will never be killed, so you still have 2 threads, which means you cannot safely run a death test.}

{\itshape The new N\+P\+TL thread library doesn\textquotesingle{}t suffer from this problem, as it doesn\textquotesingle{}t create a manager thread. However, if you don\textquotesingle{}t control which machine your test runs on, you shouldn\textquotesingle{}t depend on this.}

{\itshape }\hypertarget{md__c_autotoc_md224}{}\doxysection{Why does googletest require the entire test suite, instead of individual tests, to be named $\ast$\+Death\+Test when it uses A\+S\+S\+E\+R\+T\+\_\+\+D\+E\+A\+T\+H?}\label{md__c_autotoc_md224}
{\itshape  googletest does not interleave tests from different test suites. That is, it runs all tests in one test suite first, and then runs all tests in the next test suite, and so on. googletest does this because it needs to set up a test suite before the first test in it is run, and tear it down afterwords. Splitting up the test case would require multiple set-\/up and tear-\/down processes, which is inefficient and makes the semantics unclean.}

{\itshape If we were to determine the order of tests based on test name instead of test case name, then we would have a problem with the following situation\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST\_F(FooTest, AbcDeathTest) \{ ... \}}
\DoxyCodeLine{TEST\_F(FooTest, Uvw) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(BarTest, DefDeathTest) \{ ... \}}
\DoxyCodeLine{TEST\_F(BarTest, Xyz) \{ ... \}}
\end{DoxyCode}
}

{\itshape Since {\ttfamily Foo\+Test.\+Abc\+Death\+Test} needs to run before {\ttfamily Bar\+Test.\+Xyz}, and we don\textquotesingle{}t interleave tests from different test suites, we need to run all tests in the {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} case before running any test in the {\ttfamily Bar\+Test} case. This contradicts with the requirement to run {\ttfamily Bar\+Test.\+Def\+Death\+Test} before {\ttfamily Foo\+Test.\+Uvw}.}

{\itshape }\hypertarget{md__c_autotoc_md225}{}\doxysection{But I don\textquotesingle{}t like calling my entire test suite $\ast$\+Death\+Test when it contains both death tests and non-\/death tests. What do I do?}\label{md__c_autotoc_md225}
{\itshape  You don\textquotesingle{}t have to, but if you like, you may split up the test suite into {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} and {\ttfamily Foo\+Death\+Test}, where the names make it clear that they are related\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class FooTest : public ::testing::Test \{ ... \};}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooTest, Abc) \{ ... \}}
\DoxyCodeLine{TEST\_F(FooTest, Def) \{ ... \}}
\DoxyCodeLine{}
\DoxyCodeLine{using FooDeathTest = FooTest;}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(FooDeathTest, Uvw) \{ ... EXPECT\_DEATH(...) ... \}}
\DoxyCodeLine{TEST\_F(FooDeathTest, Xyz) \{ ... ASSERT\_DEATH(...) ... \}}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md226}{}\doxysection{googletest prints the L\+O\+G messages in a death test\textquotesingle{}s child process only when the test fails. How can I see the L\+O\+G messages when the death test succeeds?}\label{md__c_autotoc_md226}
{\itshape  Printing the L\+OG messages generated by the statement inside {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+D\+E\+A\+T\+H()} makes it harder to search for real problems in the parent\textquotesingle{}s log. Therefore, googletest only prints them when the death test has failed.}

{\itshape If you really need to see such L\+OG messages, a workaround is to temporarily break the death test (e.\+g. by changing the regex pattern it is expected to match). Admittedly, this is a hack. We\textquotesingle{}ll consider a more permanent solution after the fork-\/and-\/exec-\/style death tests are implemented.}

{\itshape }\hypertarget{md__c_autotoc_md227}{}\doxysection{The compiler complains about \char`\"{}no match for \textquotesingle{}operator$<$$<$\textquotesingle{}\char`\"{} when I use an assertion. What gives?}\label{md__c_autotoc_md227}
{\itshape  If you use a user-\/defined type {\ttfamily Foo\+Type} in an assertion, you must make sure there is an {\ttfamily std\+::ostream\& operator$<$$<$(std\+::ostream\&, const Foo\+Type\&)} function defined such that we can print a value of {\ttfamily Foo\+Type}.}

{\itshape In addition, if {\ttfamily Foo\+Type} is declared in a name space, the {\ttfamily $<$$<$} operator also needs to be defined in the {\itshape same} name space. See \href{https://abseil.io/tips/49}{\texttt{ https\+://abseil.\+io/tips/49}} for details.}

{\itshape }\hypertarget{md__c_autotoc_md228}{}\doxysection{How do I suppress the memory leak messages on Windows?}\label{md__c_autotoc_md228}
{\itshape  Since the statically initialized googletest singleton requires allocations on the heap, the Visual C++ memory leak detector will report memory leaks at the end of the program run. The easiest way to avoid this is to use the {\ttfamily \+\_\+\+Crt\+Mem\+Checkpoint} and {\ttfamily \+\_\+\+Crt\+Mem\+Dump\+All\+Objects\+Since} calls to not report any statically initialized heap objects. See M\+S\+DN for more details and additional heap check/debug routines.}

{\itshape }\hypertarget{md__c_autotoc_md229}{}\doxysection{How can my code detect if it is running in a test?}\label{md__c_autotoc_md229}
{\itshape  If you write code that sniffs whether it\textquotesingle{}s running in a test and does different things accordingly, you are leaking test-\/only logic into production code and there is no easy way to ensure that the test-\/only code paths aren\textquotesingle{}t run by mistake in production. Such cleverness also leads to \href{https://en.wikipedia.org/wiki/Heisenbug}{\texttt{ Heisenbugs}}. Therefore we strongly advise against the practice, and googletest doesn\textquotesingle{}t provide a way to do it.}

{\itshape In general, the recommended way to cause the code to behave differently under test is \href{https://en.wikipedia.org/wiki/Dependency_injection}{\texttt{ Dependency Injection}}. You can inject different functionality from the test and from the production code. Since your production code doesn\textquotesingle{}t link in the for-\/test logic at all (the \href{https://docs.bazel.build/versions/master/be/common-definitions.html\#common.testonly}{\texttt{ {\ttfamily testonly}}} attribute for B\+U\+I\+LD targets helps to ensure that), there is no danger in accidentally running it.}

{\itshape However, if you {\itshape really}, {\itshape really}, {\itshape really} have no choice, and if you follow the rule of ending your test program names with {\ttfamily \+\_\+test}, you can use the {\itshape horrible} hack of sniffing your executable name ({\ttfamily argv\mbox{[}0\mbox{]}} in {\ttfamily main()}) to know whether the code is under test.}

{\itshape }\hypertarget{md__c_autotoc_md230}{}\doxysection{How do I temporarily disable a test?}\label{md__c_autotoc_md230}
{\itshape  If you have a broken test that you cannot fix right away, you can add the D\+I\+S\+A\+B\+L\+E\+D\+\_\+ prefix to its name. This will exclude it from execution. This is better than commenting out the code or using \#if 0, as disabled tests are still compiled (and thus won\textquotesingle{}t rot).}

{\itshape To include disabled tests in test execution, just invoke the test program with the --gtest\+\_\+also\+\_\+run\+\_\+disabled\+\_\+tests flag.}

{\itshape }\hypertarget{md__c_autotoc_md231}{}\doxysection{Is it O\+K if I have two separate $<$tt$>$\+T\+E\+S\+T(\+Foo, Bar)$<$/tt$>$ test methods defined in different namespaces?}\label{md__c_autotoc_md231}
{\itshape  Yes.}

{\itshape The rule is {\bfseries{all test methods in the same test suite must use the same fixture class.}} This means that the following is {\bfseries{allowed}} because both tests use the same fixture class ({\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}}).}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{namespace foo \{}
\DoxyCodeLine{TEST(CoolTest, DoSomething) \{}
\DoxyCodeLine{  SUCCEED();}
\DoxyCodeLine{\}}
\DoxyCodeLine{\}  // namespace foo}
\DoxyCodeLine{}
\DoxyCodeLine{namespace bar \{}
\DoxyCodeLine{TEST(CoolTest, DoSomething) \{}
\DoxyCodeLine{  SUCCEED();}
\DoxyCodeLine{\}}
\DoxyCodeLine{\}  // namespace bar}
\end{DoxyCode}
}

{\itshape However, the following code is {\bfseries{not allowed}} and will produce a runtime error from googletest because the test methods are using different test fixture classes with the same test suite name.}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{namespace foo \{}
\DoxyCodeLine{class CoolTest : public ::testing::Test \{\};  // Fixture foo::CoolTest}
\DoxyCodeLine{TEST\_F(CoolTest, DoSomething) \{}
\DoxyCodeLine{  SUCCEED();}
\DoxyCodeLine{\}}
\DoxyCodeLine{\}  // namespace foo}
\DoxyCodeLine{}
\DoxyCodeLine{namespace bar \{}
\DoxyCodeLine{class CoolTest : public ::testing::Test \{\};  // Fixture: bar::CoolTest}
\DoxyCodeLine{TEST\_F(CoolTest, DoSomething) \{}
\DoxyCodeLine{  SUCCEED();}
\DoxyCodeLine{\}}
\DoxyCodeLine{\}  // namespace bar}
\end{DoxyCode}
}

{\itshape Google\+Test comes with pkg-\/config files that can be used to determine all necessary flags for compiling and linking to Google\+Test (and Google\+Mock). Pkg-\/config is a standardised plain-\/text format containing}

{\itshape 
\begin{DoxyItemize}
\item the includedir (-\/I) path
\item necessary macro (-\/D) definitions
\item further required flags (-\/pthread)
\item the library (-\/L) path
\item the library (-\/l) to link to
\end{DoxyItemize}}

{\itshape All current build systems support pkg-\/config in one way or another. For all examples here we assume you want to compile the sample {\ttfamily samples/sample3\+\_\+unittest.\+cc}.}

{\itshape }\hypertarget{md__c_autotoc_md233}{}\doxysubsection{C\+Make}\label{md__c_autotoc_md233}
{\itshape  Using {\ttfamily pkg-\/config} in C\+Make is fairly easy\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{cmake\_minimum\_required(VERSION 3.0)}
\DoxyCodeLine{}
\DoxyCodeLine{cmake\_policy(SET CMP0048 NEW)}
\DoxyCodeLine{project(my\_gtest\_pkgconfig VERSION 0.0.1 LANGUAGES CXX)}
\DoxyCodeLine{}
\DoxyCodeLine{find\_package(PkgConfig)}
\DoxyCodeLine{pkg\_search\_module(GTEST REQUIRED gtest\_main)}
\DoxyCodeLine{}
\DoxyCodeLine{add\_executable(testapp samples/sample3\_unittest.cc)}
\DoxyCodeLine{target\_link\_libraries(testapp \$\{GTEST\_LDFLAGS\})}
\DoxyCodeLine{target\_compile\_options(testapp PUBLIC \$\{GTEST\_CFLAGS\})}
\DoxyCodeLine{}
\DoxyCodeLine{include(CTest)}
\DoxyCodeLine{add\_test(first\_and\_only\_test testapp)}
\end{DoxyCode}
}

{\itshape It is generally recommended that you use {\ttfamily target\+\_\+compile\+\_\+options} + {\ttfamily \+\_\+\+C\+F\+L\+A\+GS} over {\ttfamily target\+\_\+include\+\_\+directories} + {\ttfamily \+\_\+\+I\+N\+C\+L\+U\+D\+E\+\_\+\+D\+I\+RS} as the former includes not just -\/I flags (Google\+Test might require a macro indicating to internal headers that all libraries have been compiled with threading enabled. In addition, Google\+Test might also require {\ttfamily -\/pthread} in the compiling step, and as such splitting the pkg-\/config {\ttfamily Cflags} variable into include dirs and macros for {\ttfamily target\+\_\+compile\+\_\+definitions()} might still miss this). The same recommendation goes for using {\ttfamily \+\_\+\+L\+D\+F\+L\+A\+GS} over the more commonplace {\ttfamily \+\_\+\+L\+I\+B\+R\+A\+R\+I\+ES}, which happens to discard {\ttfamily -\/L} flags and {\ttfamily -\/pthread}.}

{\itshape }\hypertarget{md__c_autotoc_md234}{}\doxysubsection{Autotools}\label{md__c_autotoc_md234}
{\itshape  Finding Google\+Test in Autoconf and using it from Automake is also fairly easy\+:}

{\itshape In your {\ttfamily configure.\+ac}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{AC\_PREREQ([2.69])}
\DoxyCodeLine{AC\_INIT([my\_gtest\_pkgconfig], [0.0.1])}
\DoxyCodeLine{AC\_CONFIG\_SRCDIR([samples/sample3\_unittest.cc])}
\DoxyCodeLine{AC\_PROG\_CXX}
\DoxyCodeLine{}
\DoxyCodeLine{PKG\_CHECK\_MODULES([GTEST], [gtest\_main])}
\DoxyCodeLine{}
\DoxyCodeLine{AM\_INIT\_AUTOMAKE([foreign subdir-\/objects])}
\DoxyCodeLine{AC\_CONFIG\_FILES([Makefile])}
\DoxyCodeLine{AC\_OUTPUT}
\end{DoxyCode}
}

{\itshape and in your {\ttfamily Makefile.\+am}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{check\_PROGRAMS = testapp}
\DoxyCodeLine{TESTS = \$(check\_PROGRAMS)}
\DoxyCodeLine{}
\DoxyCodeLine{testapp\_SOURCES = samples/sample3\_unittest.cc}
\DoxyCodeLine{testapp\_CXXFLAGS = \$(GTEST\_CFLAGS)}
\DoxyCodeLine{testapp\_LDADD = \$(GTEST\_LIBS)}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md235}{}\doxysubsection{Meson}\label{md__c_autotoc_md235}
{\itshape  Meson natively uses pkgconfig to query dependencies\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{project('my\_gtest\_pkgconfig', 'cpp', version : '0.0.1')}
\DoxyCodeLine{}
\DoxyCodeLine{gtest\_dep = dependency('gtest\_main')}
\DoxyCodeLine{}
\DoxyCodeLine{testapp = executable(}
\DoxyCodeLine{  'testapp',}
\DoxyCodeLine{  files(['samples/sample3\_unittest.cc']),}
\DoxyCodeLine{  dependencies : gtest\_dep,}
\DoxyCodeLine{  install : false)}
\DoxyCodeLine{}
\DoxyCodeLine{test('first\_and\_only\_test', testapp)}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md236}{}\doxysubsection{Plain Makefiles}\label{md__c_autotoc_md236}
{\itshape  Since {\ttfamily pkg-\/config} is a small Unix command-\/line utility, it can be used in handwritten {\ttfamily Makefile}s too\+:}

{\itshape \`{}\`{}{\ttfamily Makefile G\+T\+E\+S\+T\+\_\+\+C\+F\+L\+A\+GS =}pkg-\/config --cflags gtest\+\_\+main{\ttfamily  G\+T\+E\+S\+T\+\_\+\+L\+I\+BS =}pkg-\/config --libs gtest\+\_\+main\`{}}

{\itshape .P\+H\+O\+NY\+: tests all}

{\itshape tests\+: all ./testapp}

{\itshape all\+: testapp}

{\itshape testapp\+: testapp.\+o    \$$<$ -\/o \$@ }

{\itshape testapp.\+o\+: samples/sample3\+\_\+unittest.\+cc    \$$<$ -\/c -\/o \$@  
\begin{DoxyCode}{0}
\DoxyCodeLine{\#\#\# Help! pkg-\/config can't find GoogleTest!}
\DoxyCodeLine{}
\DoxyCodeLine{Let's say you have a `CMakeLists.txt` along the lines of the one in this}
\DoxyCodeLine{tutorial and you try to run `cmake`. It is very possible that you get a failure}
\DoxyCodeLine{along the lines of:}
\end{DoxyCode}
 -- Checking for one of the modules \textquotesingle{}gtest\+\_\+main\textquotesingle{} C\+Make Error at /usr/share/cmake/\+Modules/\+Find\+Pkg\+Config.cmake\+:640 (message)\+: None of the required \textquotesingle{}gtest\+\_\+main\textquotesingle{} found 
\begin{DoxyCode}{0}
\DoxyCodeLine{These failures are common if you installed GoogleTest yourself and have not}
\DoxyCodeLine{sourced it from a distro or other package manager. If so, you need to tell}
\DoxyCodeLine{pkg-\/config where it can find the `.pc` files containing the information. Say you}
\DoxyCodeLine{installed GoogleTest to `/usr/local`, then it might be that the `.pc` files are}
\DoxyCodeLine{installed under `/usr/local/lib64/pkgconfig`. If you set}
\end{DoxyCode}
 export P\+K\+G\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+P\+A\+TH=/usr/local/lib64/pkgconfig \`{}\`{}\`{}}

{\itshape pkg-\/config will also try to look in {\ttfamily P\+K\+G\+\_\+\+C\+O\+N\+F\+I\+G\+\_\+\+P\+A\+TH} to find {\ttfamily gtest\+\_\+main.\+pc}.}

{\itshape }\hypertarget{md__c_autotoc_md238}{}\doxysection{Introduction\+: Why googletest?}\label{md__c_autotoc_md238}
{\itshape  {\itshape googletest} helps you write better C++ tests.}

{\itshape googletest is a testing framework developed by the Testing Technology team with Google\textquotesingle{}s specific requirements and constraints in mind. No matter whether you work on Linux, Windows, or a Mac, if you write C++ code, googletest can help you. And it supports {\itshape any} kind of tests, not just unit tests.}

{\itshape So what makes a good test, and how does googletest fit in? We believe\+:}

{\itshape 
\begin{DoxyEnumerate}
\item Tests should be {\itshape independent} and {\itshape repeatable}. It\textquotesingle{}s a pain to debug a test that succeeds or fails as a result of other tests. googletest isolates the tests by running each of them on a different object. When a test fails, googletest allows you to run it in isolation for quick debugging.
\item Tests should be well {\itshape organized} and reflect the structure of the tested code. googletest groups related tests into test suites that can share data and subroutines. This common pattern is easy to recognize and makes tests easy to maintain. Such consistency is especially helpful when people switch projects and start to work on a new code base.
\item Tests should be {\itshape portable} and {\itshape reusable}. Google has a lot of code that is platform-\/neutral, its tests should also be platform-\/neutral. googletest works on different O\+Ses, with different compilers, with or without exceptions, so googletest tests can work with a variety of configurations.
\item When tests fail, they should provide as much {\itshape information} about the problem as possible. googletest doesn\textquotesingle{}t stop at the first test failure. Instead, it only stops the current test and continues with the next. You can also set up tests that report non-\/fatal failures after which the current test continues. Thus, you can detect and fix multiple bugs in a single run-\/edit-\/compile cycle.
\item The testing framework should liberate test writers from housekeeping chores and let them focus on the test {\itshape content}. googletest automatically keeps track of all tests defined, and doesn\textquotesingle{}t require the user to enumerate them in order to run them.
\item Tests should be {\itshape fast}. With googletest, you can reuse shared resources across tests and pay for the set-\/up/tear-\/down only once, without making tests depend on each other.
\end{DoxyEnumerate}}

{\itshape Since googletest is based on the popular x\+Unit architecture, you\textquotesingle{}ll feel right at home if you\textquotesingle{}ve used J\+Unit or Py\+Unit before. If not, it will take you about 10 minutes to learn the basics and get started. So let\textquotesingle{}s go!}

{\itshape }\hypertarget{md__c_autotoc_md239}{}\doxysection{Beware of the nomenclature}\label{md__c_autotoc_md239}
{\itshape  {\itshape Note\+:} There might be some confusion of idea due to different definitions of the terms {\itshape Test}, {\itshape Test Case} and {\itshape Test Suite}, so beware of misunderstanding these.}

{\itshape Historically, googletest started to use the term {\itshape Test Case} for grouping related tests, whereas current publications including the International Software Testing Qualifications Board (\href{http://www.istqb.org/}{\texttt{ I\+S\+T\+QB}}) and various textbooks on Software Quality use the term {\itshape \href{http://glossary.istqb.org/en/search/test\%20suite}{\texttt{ Test Suite}}} for this.}

{\itshape The related term {\itshape Test}, as it is used in the googletest, is corresponding to the term {\itshape \href{http://glossary.istqb.org/en/search/test\%20case}{\texttt{ Test Case}}} of I\+S\+T\+QB and others.}

{\itshape The term {\itshape Test} is commonly of broad enough sense, including I\+S\+T\+QB\textquotesingle{}s definition of {\itshape Test Case}, so it\textquotesingle{}s not much of a problem here. But the term {\itshape Test Case} as was used in Google Test is of contradictory sense and thus confusing.}

{\itshape googletest recently started replacing the term {\itshape Test Case} with {\itshape Test Suite}. The preferred A\+PI is {\itshape Test\+Suite}. The older Test\+Case A\+PI is being slowly deprecated and refactored away.}

{\itshape So please be aware of the different definitions of the terms\+:}

{\itshape \tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Meaning  }&\cellcolor{\tableheadbgcolor}\textbf{ googletest Term  }&\cellcolor{\tableheadbgcolor}\textbf{ \href{http://www.istqb.org/}{\texttt{ I\+S\+T\+QB}} Term   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Meaning  }&\cellcolor{\tableheadbgcolor}\textbf{ googletest Term  }&\cellcolor{\tableheadbgcolor}\textbf{ \href{http://www.istqb.org/}{\texttt{ I\+S\+T\+QB}} Term   }\\\cline{1-3}
\endhead
Exercise a particular program path with specific input values and verify the results  &\href{\#simple-tests}{\texttt{ T\+E\+S\+T()}}  &\href{http://glossary.istqb.org/en/search/test\%20case}{\texttt{ Test Case}}   \\\cline{1-3}
\end{longtabu}
}

{\itshape }\hypertarget{md__c_autotoc_md240}{}\doxysection{Basic Concepts}\label{md__c_autotoc_md240}
{\itshape  When using googletest, you start by writing {\itshape assertions}, which are statements that check whether a condition is true. An assertion\textquotesingle{}s result can be {\itshape success}, {\itshape nonfatal failure}, or {\itshape fatal failure}. If a fatal failure occurs, it aborts the current function; otherwise the program continues normally.}

{\itshape {\itshape Tests} use assertions to verify the tested code\textquotesingle{}s behavior. If a test crashes or has a failed assertion, then it {\itshape fails}; otherwise it {\itshape succeeds}.}

{\itshape A {\itshape test suite} contains one or many tests. You should group your tests into test suites that reflect the structure of the tested code. When multiple tests in a test suite need to share common objects and subroutines, you can put them into a {\itshape test fixture} class.}

{\itshape A {\itshape test program} can contain multiple test suites.}

{\itshape We\textquotesingle{}ll now explain how to write a test program, starting at the individual assertion level and building up to tests and test suites.}

{\itshape }\hypertarget{md__c_autotoc_md241}{}\doxysection{Assertions}\label{md__c_autotoc_md241}
{\itshape  googletest assertions are macros that resemble function calls. You test a class or function by making assertions about its behavior. When an assertion fails, googletest prints the assertion\textquotesingle{}s source file and line number location, along with a failure message. You may also supply a custom failure message which will be appended to googletest\textquotesingle{}s message.}

{\itshape The assertions come in pairs that test the same thing but have different effects on the current function. {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} versions generate fatal failures when they fail, and {\bfseries{abort the current function}}. {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$} versions generate nonfatal failures, which don\textquotesingle{}t abort the current function. Usually {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$} are preferred, as they allow more than one failure to be reported in a test. However, you should use {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} if it doesn\textquotesingle{}t make sense to continue when the assertion in question fails.}

{\itshape Since a failed {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} returns from the current function immediately, possibly skipping clean-\/up code that comes after it, it may cause a space leak. Depending on the nature of the leak, it may or may not be worth fixing -\/ so keep this in mind if you get a heap checker error in addition to assertion errors.}

{\itshape To provide a custom failure message, simply stream it into the macro using the {\ttfamily $<$$<$} operator, or a sequence of such operators. An example\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{ASSERT\_EQ(x.size(), y.size()) << "Vectors x and y are of unequal length";}
\DoxyCodeLine{}
\DoxyCodeLine{for (int i = 0; i < x.size(); ++i) \{}
\DoxyCodeLine{  EXPECT\_EQ(x[i], y[i]) << "Vectors x and y differ at index " << i;}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape Anything that can be streamed to an {\ttfamily ostream} can be streamed to an assertion macro--in particular, C strings and {\ttfamily string} objects. If a wide string ({\ttfamily wchar\+\_\+t$\ast$}, {\ttfamily T\+C\+H\+A\+R$\ast$} in {\ttfamily U\+N\+I\+C\+O\+DE} mode on Windows, or {\ttfamily std\+::wstring}) is streamed to an assertion, it will be translated to U\+T\+F-\/8 when printed.}

{\itshape }\hypertarget{md__c_autotoc_md242}{}\doxysubsection{Basic Assertions}\label{md__c_autotoc_md242}
{\itshape  These assertions do basic true/false condition testing.}

{\itshape \tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+R\+U\+E(condition);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+U\+E(condition);}  &{\ttfamily condition} is true   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+F\+A\+L\+S\+E(condition);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+F\+A\+L\+S\+E(condition);}  &{\ttfamily condition} is false   \\\cline{1-3}
\end{longtabu}
}

{\itshape Remember, when they fail, {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} yields a fatal failure and returns from the current function, while {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$} yields a nonfatal failure, allowing the function to continue running. In either case, an assertion failure means its containing test fails.}

{\itshape {\bfseries{Availability}}\+: Linux, Windows, Mac.}

{\itshape }\hypertarget{md__c_autotoc_md243}{}\doxysubsection{Binary Comparison}\label{md__c_autotoc_md243}
{\itshape  This section describes assertions that compare two values.}

{\itshape \tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+Q(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+E\+Q(val1, val2);}  &{\ttfamily val1 == val2}   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+N\+E(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+N\+E(val1, val2);}  &{\ttfamily val1 != val2}   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+L\+T(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+L\+T(val1, val2);}  &{\ttfamily val1 $<$ val2}   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+L\+E(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+L\+E(val1, val2);}  &{\ttfamily val1 $<$= val2}   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+G\+T(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+G\+T(val1, val2);}  &{\ttfamily val1 $>$ val2}   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+G\+E(val1, val2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+G\+E(val1, val2);}  &{\ttfamily val1 $>$= val2}   \\\cline{1-3}
\end{longtabu}
}

{\itshape Value arguments must be comparable by the assertion\textquotesingle{}s comparison operator or you\textquotesingle{}ll get a compiler error. We used to require the arguments to support the {\ttfamily $<$$<$} operator for streaming to an {\ttfamily ostream}, but it\textquotesingle{}s no longer necessary. If {\ttfamily $<$$<$} is supported, it will be called to print the arguments when the assertion fails; otherwise googletest will attempt to print them in the best way it can. For more details and how to customize the printing of the arguments, see \href{../../googlemock/docs/cook_book.md\#teaching-gmock-how-to-print-your-values}{\texttt{ documentation}}}

{\itshape These assertions can work with a user-\/defined type, but only if you define the corresponding comparison operator (e.\+g. {\ttfamily ==}, {\ttfamily $<$}, etc). Since this is discouraged by the Google \href{https://google.github.io/styleguide/cppguide.html\#Operator_Overloading}{\texttt{ C++ Style Guide}}, you may need to use {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+R\+U\+E()} or {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+T\+R\+U\+E()} to assert the equality of two objects of a user-\/defined type.}

{\itshape However, when possible, {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+Q(actual, expected)} is preferred to {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+T\+R\+UE(actual == expected)}, since it tells you {\ttfamily actual} and {\ttfamily expected}\textquotesingle{}s values on failure.}

{\itshape Arguments are always evaluated exactly once. Therefore, it\textquotesingle{}s OK for the arguments to have side effects. However, as with any ordinary C/\+C++ function, the arguments\textquotesingle{} evaluation order is undefined (i.\+e. the compiler is free to choose any order) and your code should not depend on any particular argument evaluation order.}

{\itshape {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+Q()} does pointer equality on pointers. If used on two C strings, it tests if they are in the same memory location, not if they have the same value. Therefore, if you want to compare C strings (e.\+g. {\ttfamily const char$\ast$}) by value, use {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+S\+T\+R\+E\+Q()}, which will be described later on. In particular, to assert that a C string is {\ttfamily N\+U\+LL}, use {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+S\+T\+R\+E\+Q(c\+\_\+string, N\+U\+L\+L)}. Consider using {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+Q(c\+\_\+string, nullptr)} if c++11 is supported. To compare two {\ttfamily string} objects, you should use {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+EQ}.}

{\itshape When doing pointer comparisons use {\ttfamily $\ast$\+\_\+\+EQ(ptr, nullptr)} and {\ttfamily $\ast$\+\_\+\+NE(ptr, nullptr)} instead of {\ttfamily $\ast$\+\_\+\+EQ(ptr, N\+U\+LL)} and {\ttfamily $\ast$\+\_\+\+NE(ptr, N\+U\+LL)}. This is because {\ttfamily nullptr} is typed while {\ttfamily N\+U\+LL} is not. See F\+AQ for more details.}

{\itshape If you\textquotesingle{}re working with floating point numbers, you may want to use the floating point variations of some of these macros in order to avoid problems caused by rounding. See Advanced googletest Topics for details.}

{\itshape Macros in this section work with both narrow and wide string objects ({\ttfamily string} and {\ttfamily wstring}).}

{\itshape {\bfseries{Availability}}\+: Linux, Windows, Mac.}

{\itshape {\bfseries{Historical note}}\+: Before February 2016 {\ttfamily $\ast$\+\_\+\+EQ} had a convention of calling it as {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+E\+Q(expected, actual)}, so lots of existing code uses this order. Now {\ttfamily $\ast$\+\_\+\+EQ} treats both parameters in the same way.}

{\itshape }\hypertarget{md__c_autotoc_md244}{}\doxysubsection{String Comparison}\label{md__c_autotoc_md244}
{\itshape  The assertions in this group compare two {\bfseries{C strings}}. If you want to compare two {\ttfamily string} objects, use {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+EQ}, {\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+NE}, and etc instead.}

{\itshape \tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Fatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nonfatal assertion  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Verifies   }\\\cline{1-3}
\endhead
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+S\+T\+R\+E\+Q(str1,str2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+S\+T\+R\+E\+Q(str1,str2);}  &the two C strings have the same content   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+S\+T\+R\+N\+E(str1,str2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+S\+T\+R\+N\+E(str1,str2);}  &the two C strings have different contents   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+S\+T\+R\+C\+A\+S\+E\+E\+Q(str1,str2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+S\+T\+R\+C\+A\+S\+E\+E\+Q(str1,str2);}  &the two C strings have the same content, ignoring case   \\\cline{1-3}
{\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+S\+T\+R\+C\+A\+S\+E\+N\+E(str1,str2);}  &{\ttfamily E\+X\+P\+E\+C\+T\+\_\+\+S\+T\+R\+C\+A\+S\+E\+N\+E(str1,str2);}  &the two C strings have different contents, ignoring case   \\\cline{1-3}
\end{longtabu}
}

{\itshape Note that \char`\"{}\+C\+A\+S\+E\char`\"{} in an assertion name means that case is ignored. A {\ttfamily N\+U\+LL} pointer and an empty string are considered {\itshape different}.}

{\itshape {\ttfamily $\ast$\+S\+T\+R\+E\+Q$\ast$} and {\ttfamily $\ast$\+S\+T\+R\+N\+E$\ast$} also accept wide C strings ({\ttfamily wchar\+\_\+t$\ast$}). If a comparison of two wide strings fails, their values will be printed as U\+T\+F-\/8 narrow strings.}

{\itshape {\bfseries{Availability}}\+: Linux, Windows, Mac.}

{\itshape {\bfseries{See also}}\+: For more string comparison tricks (substring, prefix, suffix, and regular expression matching, for example), see this in the Advanced googletest Guide.}

{\itshape }\hypertarget{md__c_autotoc_md245}{}\doxysection{Simple Tests}\label{md__c_autotoc_md245}
{\itshape  To create a test\+:}

{\itshape 
\begin{DoxyEnumerate}
\item Use the {\ttfamily T\+E\+S\+T()} macro to define and name a test function, These are ordinary C++ functions that don\textquotesingle{}t return a value.
\item In this function, along with any valid C++ statements you want to include, use the various googletest assertions to check values.
\item The test\textquotesingle{}s result is determined by the assertions; if any assertion in the test fails (either fatally or non-\/fatally), or if the test crashes, the entire test fails. Otherwise, it succeeds.
\end{DoxyEnumerate}}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST(TestSuiteName, TestName) \{}
\DoxyCodeLine{  ... test body ...}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape {\ttfamily T\+E\+S\+T()} arguments go from general to specific. The {\itshape first} argument is the name of the test suite, and the {\itshape second} argument is the test\textquotesingle{}s name within the test case. Both names must be valid C++ identifiers, and they should not contain underscore ({\ttfamily \+\_\+}). A test\textquotesingle{}s {\itshape full name} consists of its containing test suite and its individual name. Tests from different test suites can have the same individual name.}

{\itshape For example, let\textquotesingle{}s take a simple integer function\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{int Factorial(int n);  // Returns the factorial of n}
\end{DoxyCode}
}

{\itshape A test suite for this function might look like\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{// Tests factorial of 0.}
\DoxyCodeLine{TEST(FactorialTest, HandlesZeroInput) \{}
\DoxyCodeLine{  EXPECT\_EQ(Factorial(0), 1);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{// Tests factorial of positive numbers.}
\DoxyCodeLine{TEST(FactorialTest, HandlesPositiveInput) \{}
\DoxyCodeLine{  EXPECT\_EQ(Factorial(1), 1);}
\DoxyCodeLine{  EXPECT\_EQ(Factorial(2), 2);}
\DoxyCodeLine{  EXPECT\_EQ(Factorial(3), 6);}
\DoxyCodeLine{  EXPECT\_EQ(Factorial(8), 40320);}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape googletest groups the test results by test suites, so logically-\/related tests should be in the same test suite; in other words, the first argument to their {\ttfamily T\+E\+S\+T()} should be the same. In the above example, we have two tests, {\ttfamily Handles\+Zero\+Input} and {\ttfamily Handles\+Positive\+Input}, that belong to the same test suite {\ttfamily Factorial\+Test}.}

{\itshape When naming your test suites and tests, you should follow the same convention as for \href{https://google.github.io/styleguide/cppguide.html\#Function_Names}{\texttt{ naming functions and classes}}.}

{\itshape {\bfseries{Availability}}\+: Linux, Windows, Mac.}

{\itshape }\hypertarget{md__c_autotoc_md246}{}\doxysection{Test Fixtures\+: Using the Same Data Configuration for Multiple Tests}\label{md__c_autotoc_md246}
{\itshape  If you find yourself writing two or more tests that operate on similar data, you can use a {\itshape test fixture}. It allows you to reuse the same configuration of objects for several different tests.}

{\itshape To create a fixture\+:}

{\itshape 
\begin{DoxyEnumerate}
\item Derive a class from {\ttfamily \mbox{\hyperlink{classtesting_1_1_test}{testing\+::\+Test}}} . Start its body with {\ttfamily protected\+:} as we\textquotesingle{}ll want to access fixture members from sub-\/classes.
\item Inside the class, declare any objects you plan to use.
\item If necessary, write a default constructor or {\ttfamily Set\+Up()} function to prepare the objects for each test. A common mistake is to spell {\ttfamily Set\+Up()} as $\ast$$\ast${\ttfamily Setup()}$\ast$$\ast$ with a small {\ttfamily u} -\/ Use {\ttfamily override} in C++11 to make sure you spelled it correctly
\item If necessary, write a destructor or {\ttfamily Tear\+Down()} function to release any resources you allocated in {\ttfamily Set\+Up()} . To learn when you should use the constructor/destructor and when you should use {\ttfamily Set\+Up()/\+Tear\+Down()}, read the F\+AQ.
\item If needed, define subroutines for your tests to share.
\end{DoxyEnumerate}}

{\itshape When using a fixture, use {\ttfamily T\+E\+S\+T\+\_\+\+F()} instead of {\ttfamily T\+E\+S\+T()} as it allows you to access objects and subroutines in the test fixture\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST\_F(TestFixtureName, TestName) \{}
\DoxyCodeLine{  ... test body ...}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape Like {\ttfamily T\+E\+S\+T()}, the first argument is the test suite name, but for {\ttfamily T\+E\+S\+T\+\_\+\+F()} this must be the name of the test fixture class. You\textquotesingle{}ve probably guessed\+: {\ttfamily \+\_\+F} is for fixture.}

{\itshape Unfortunately, the C++ macro system does not allow us to create a single macro that can handle both types of tests. Using the wrong macro causes a compiler error.}

{\itshape Also, you must first define a test fixture class before using it in a {\ttfamily T\+E\+S\+T\+\_\+\+F()}, or you\textquotesingle{}ll get the compiler error \char`\"{}\`{}virtual outside class
declaration\`{}\char`\"{}.}

{\itshape For each test defined with {\ttfamily T\+E\+S\+T\+\_\+\+F()} , googletest will create a {\itshape fresh} test fixture at runtime, immediately initialize it via {\ttfamily Set\+Up()} , run the test, clean up by calling {\ttfamily Tear\+Down()} , and then delete the test fixture. Note that different tests in the same test suite have different test fixture objects, and googletest always deletes a test fixture before it creates the next one. googletest does {\bfseries{not}} reuse the same test fixture for multiple tests. Any changes one test makes to the fixture do not affect other tests.}

{\itshape As an example, let\textquotesingle{}s write tests for a F\+I\+FO queue class named {\ttfamily \mbox{\hyperlink{class_queue}{Queue}}}, which has the following interface\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{template <typename E>  // E is the element type.}
\DoxyCodeLine{class Queue \{}
\DoxyCodeLine{ public:}
\DoxyCodeLine{  Queue();}
\DoxyCodeLine{  void Enqueue(const E\& element);}
\DoxyCodeLine{  E* Dequeue();  // Returns NULL if the queue is empty.}
\DoxyCodeLine{  size\_t size() const;}
\DoxyCodeLine{  ...}
\DoxyCodeLine{\};}
\end{DoxyCode}
}

{\itshape First, define a fixture class. By convention, you should give it the name {\ttfamily \mbox{\hyperlink{class_foo_test}{Foo\+Test}}} where {\ttfamily Foo} is the class being tested.}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{class QueueTest : public ::testing::Test \{}
\DoxyCodeLine{ protected:}
\DoxyCodeLine{  void SetUp() override \{}
\DoxyCodeLine{     q1\_.Enqueue(1);}
\DoxyCodeLine{     q2\_.Enqueue(2);}
\DoxyCodeLine{     q2\_.Enqueue(3);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // void TearDown() override \{\}}
\DoxyCodeLine{}
\DoxyCodeLine{  Queue<int> q0\_;}
\DoxyCodeLine{  Queue<int> q1\_;}
\DoxyCodeLine{  Queue<int> q2\_;}
\DoxyCodeLine{\};}
\end{DoxyCode}
}

{\itshape In this case, {\ttfamily Tear\+Down()} is not needed since we don\textquotesingle{}t have to clean up after each test, other than what\textquotesingle{}s already done by the destructor.}

{\itshape Now we\textquotesingle{}ll write tests using {\ttfamily T\+E\+S\+T\+\_\+\+F()} and this fixture.}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{TEST\_F(QueueTest, IsEmptyInitially) \{}
\DoxyCodeLine{  EXPECT\_EQ(q0\_.size(), 0);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_F(QueueTest, DequeueWorks) \{}
\DoxyCodeLine{  int* n = q0\_.Dequeue();}
\DoxyCodeLine{  EXPECT\_EQ(n, nullptr);}
\DoxyCodeLine{}
\DoxyCodeLine{  n = q1\_.Dequeue();}
\DoxyCodeLine{  ASSERT\_NE(n, nullptr);}
\DoxyCodeLine{  EXPECT\_EQ(*n, 1);}
\DoxyCodeLine{  EXPECT\_EQ(q1\_.size(), 0);}
\DoxyCodeLine{  delete n;}
\DoxyCodeLine{}
\DoxyCodeLine{  n = q2\_.Dequeue();}
\DoxyCodeLine{  ASSERT\_NE(n, nullptr);}
\DoxyCodeLine{  EXPECT\_EQ(*n, 2);}
\DoxyCodeLine{  EXPECT\_EQ(q2\_.size(), 1);}
\DoxyCodeLine{  delete n;}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape The above uses both {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} and {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$} assertions. The rule of thumb is to use {\ttfamily E\+X\+P\+E\+C\+T\+\_\+$\ast$} when you want the test to continue to reveal more errors after the assertion failure, and use {\ttfamily A\+S\+S\+E\+R\+T\+\_\+$\ast$} when continuing after failure doesn\textquotesingle{}t make sense. For example, the second assertion in the {\ttfamily Dequeue} test is {\ttfamily A\+S\+S\+E\+R\+T\+\_\+\+N\+E(nullptr, n)}, as we need to dereference the pointer {\ttfamily n} later, which would lead to a segfault when {\ttfamily n} is {\ttfamily N\+U\+LL}.}

{\itshape When these tests run, the following happens\+:}

{\itshape 
\begin{DoxyEnumerate}
\item googletest constructs a {\ttfamily Queue\+Test} object (let\textquotesingle{}s call it {\ttfamily t1} ).
\item {\ttfamily t1.\+Set\+Up()} initializes {\ttfamily t1} .
\item The first test ( {\ttfamily Is\+Empty\+Initially} ) runs on {\ttfamily t1} .
\item {\ttfamily t1.\+Tear\+Down()} cleans up after the test finishes.
\item {\ttfamily t1} is destructed.
\item The above steps are repeated on another {\ttfamily Queue\+Test} object, this time running the {\ttfamily Dequeue\+Works} test.
\end{DoxyEnumerate}}

{\itshape {\bfseries{Availability}}\+: Linux, Windows, Mac.}

{\itshape }\hypertarget{md__c_autotoc_md247}{}\doxysection{Invoking the Tests}\label{md__c_autotoc_md247}
{\itshape  {\ttfamily T\+E\+S\+T()} and {\ttfamily T\+E\+S\+T\+\_\+\+F()} implicitly register their tests with googletest. So, unlike with many other C++ testing frameworks, you don\textquotesingle{}t have to re-\/list all your defined tests in order to run them.}

{\itshape After defining your tests, you can run them with {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} , which returns {\ttfamily 0} if all the tests are successful, or {\ttfamily 1} otherwise. Note that {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} runs {\itshape all tests} in your link unit -- they can be from different test suites, or even different source files.}

{\itshape When invoked, the {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} macro\+:}

{\itshape 
\begin{DoxyItemize}
\item Saves the state of all googletest flags
\item Creates a test fixture object for the first test.
\item Initializes it via {\ttfamily Set\+Up()}.
\item Runs the test on the fixture object.
\item Cleans up the fixture via {\ttfamily Tear\+Down()}.
\item Deletes the fixture.
\item Restores the state of all googletest flags
\item Repeats the above steps for the next test, until all tests have run.
\end{DoxyItemize}}

{\itshape If a fatal failure happens the subsequent steps will be skipped.}

{\itshape \begin{quote}
I\+M\+P\+O\+R\+T\+A\+NT\+: You must {\bfseries{not}} ignore the return value of {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}, or you will get a compiler error. The rationale for this design is that the automated testing service determines whether a test has passed based on its exit code, not on its stdout/stderr output; thus your {\ttfamily main()} function must return the value of {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}.

Also, you should call {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()} only {\bfseries{once}}. Calling it more than once conflicts with some advanced googletest features (e.\+g. thread-\/safe \href{advanced.md\#death-tests}{\texttt{ death tests}}) and thus is not supported. \end{quote}
}

{\itshape {\bfseries{Availability}}\+: Linux, Windows, Mac.}

{\itshape }\hypertarget{md__c_autotoc_md248}{}\doxysection{Writing the main() Function}\label{md__c_autotoc_md248}
{\itshape  Write your own main() function, which should return the value of {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}}

{\itshape You can start from this boilerplate\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{ \{c++\}}
\DoxyCodeLine{\#include "this/package/foo.h"}
\DoxyCodeLine{\#include "gtest/gtest.h"}
\DoxyCodeLine{}
\DoxyCodeLine{namespace \{}
\DoxyCodeLine{}
\DoxyCodeLine{// The fixture for testing class Foo.}
\DoxyCodeLine{class FooTest : public ::testing::Test \{}
\DoxyCodeLine{ protected:}
\DoxyCodeLine{  // You can remove any or all of the following functions if its body}
\DoxyCodeLine{  // is empty.}
\DoxyCodeLine{}
\DoxyCodeLine{  FooTest() \{}
\DoxyCodeLine{     // You can do set-\/up work for each test here.}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  ~FooTest() override \{}
\DoxyCodeLine{     // You can do clean-\/up work that doesn't throw exceptions here.}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // If the constructor and destructor are not enough for setting up}
\DoxyCodeLine{  // and cleaning up each test, you can define the following methods:}
\DoxyCodeLine{}
\DoxyCodeLine{  void SetUp() override \{}
\DoxyCodeLine{     // Code here will be called immediately after the constructor (right}
\DoxyCodeLine{     // before each test).}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  void TearDown() override \{}
\DoxyCodeLine{     // Code here will be called immediately after each test (right}
\DoxyCodeLine{     // before the destructor).}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  // Objects declared here can be used by all tests in the test suite for Foo.}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{// Tests that the Foo::Bar() method does Abc.}
\DoxyCodeLine{TEST\_F(FooTest, MethodBarDoesAbc) \{}
\DoxyCodeLine{  const std::string input\_filepath = "this/package/testdata/myinputfile.dat";}
\DoxyCodeLine{  const std::string output\_filepath = "this/package/testdata/myoutputfile.dat";}
\DoxyCodeLine{  Foo f;}
\DoxyCodeLine{  EXPECT\_EQ(f.Bar(input\_filepath, output\_filepath), 0);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{// Tests that Foo does Xyz.}
\DoxyCodeLine{TEST\_F(FooTest, DoesXyz) \{}
\DoxyCodeLine{  // Exercises the Xyz feature of Foo.}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\}  // namespace}
\DoxyCodeLine{}
\DoxyCodeLine{int main(int argc, char **argv) \{}
\DoxyCodeLine{  ::testing::InitGoogleTest(\&argc, argv);}
\DoxyCodeLine{  return RUN\_ALL\_TESTS();}
\DoxyCodeLine{\}}
\end{DoxyCode}
}

{\itshape The {\ttfamily \+::testing\+::\+Init\+Google\+Test()} function parses the command line for googletest flags, and removes all recognized flags. This allows the user to control a test program\textquotesingle{}s behavior via various flags, which we\textquotesingle{}ll cover in Advanced\+Guide. You {\bfseries{must}} call this function before calling {\ttfamily R\+U\+N\+\_\+\+A\+L\+L\+\_\+\+T\+E\+S\+T\+S()}, or the flags won\textquotesingle{}t be properly initialized.}

{\itshape On Windows, {\ttfamily Init\+Google\+Test()} also works with wide strings, so it can be used in programs compiled in {\ttfamily U\+N\+I\+C\+O\+DE} mode as well.}

{\itshape But maybe you think that writing all those main() functions is too much work? We agree with you completely and that\textquotesingle{}s why Google Test provides a basic implementation of main(). If it fits your needs, then just link your test with gtest\+\_\+main library and you are good to go.}

{\itshape N\+O\+TE\+: {\ttfamily Parse\+G\+Unit\+Flags()} is deprecated in favor of {\ttfamily Init\+Google\+Test()}.}

{\itshape }\hypertarget{md__c_autotoc_md249}{}\doxysection{Known Limitations}\label{md__c_autotoc_md249}
{\itshape 
\begin{DoxyItemize}
\item Google Test is designed to be thread-\/safe. The implementation is thread-\/safe on systems where the {\ttfamily pthreads} library is available. It is currently {\itshape unsafe} to use Google Test assertions from two threads concurrently on other systems (e.\+g. Windows). In most tests this is not an issue as usually the assertions are done in the main thread. If you want to help, you can volunteer to implement the necessary synchronization primitives in {\ttfamily gtest-\/port.\+h} for your platform.
\end{DoxyItemize}}

{\itshape {\bfseries{P}}ump is {\bfseries{U}}seful for {\bfseries{M}}eta {\bfseries{P}}rogramming.}

{\itshape }\hypertarget{md__c_autotoc_md250}{}\doxysection{The Problem}\label{md__c_autotoc_md250}
{\itshape  Template and macro libraries often need to define many classes, functions, or macros that vary only (or almost only) in the number of arguments they take. It\textquotesingle{}s a lot of repetitive, mechanical, and error-\/prone work.}

{\itshape Variadic templates and variadic macros can alleviate the problem. However, while both are being considered by the C++ committee, neither is in the standard yet or widely supported by compilers. Thus they are often not a good choice, especially when your code needs to be portable. And their capabilities are still limited.}

{\itshape As a result, authors of such libraries often have to write scripts to generate their implementation. However, our experience is that it\textquotesingle{}s tedious to write such scripts, which tend to reflect the structure of the generated code poorly and are often hard to read and edit. For example, a small change needed in the generated code may require some non-\/intuitive, non-\/trivial changes in the script. This is especially painful when experimenting with the code.}

{\itshape }\hypertarget{md__c_autotoc_md251}{}\doxysection{Our Solution}\label{md__c_autotoc_md251}
{\itshape  Pump (for Pump is Useful for Meta Programming, Pretty Useful for Meta Programming, or Practical Utility for Meta Programming, whichever you prefer) is a simple meta-\/programming tool for C++. The idea is that a programmer writes a {\ttfamily foo.\+pump} file which contains C++ code plus meta code that manipulates the C++ code. The meta code can handle iterations over a range, nested iterations, local meta variable definitions, simple arithmetic, and conditional expressions. You can view it as a small Domain-\/\+Specific Language. The meta language is designed to be non-\/intrusive (s.\+t. it won\textquotesingle{}t confuse Emacs\textquotesingle{} C++ mode, for example) and concise, making Pump code intuitive and easy to maintain.}

{\itshape }\hypertarget{md__c_autotoc_md252}{}\doxysubsection{Highlights}\label{md__c_autotoc_md252}
{\itshape 
\begin{DoxyItemize}
\item The implementation is in a single Python script and thus ultra portable\+: no build or installation is needed and it works cross platforms.
\item Pump tries to be smart with respect to \href{https://github.com/google/styleguide}{\texttt{ Google\textquotesingle{}s style guide}}\+: it breaks long lines (easy to have when they are generated) at acceptable places to fit within 80 columns and indent the continuation lines correctly.
\item The format is human-\/readable and more concise than X\+ML.
\item The format works relatively well with Emacs\textquotesingle{} C++ mode.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md253}{}\doxysubsection{Examples}\label{md__c_autotoc_md253}
{\itshape  The following Pump code (where meta keywords start with {\ttfamily \$}, {\ttfamily \mbox{[}\mbox{[}} and {\ttfamily \mbox{]}\mbox{]}} are meta brackets, and {\ttfamily \$\$} starts a meta comment that ends with the line)\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$var n = 3     \$\$ Defines a meta variable n.}
\DoxyCodeLine{\$range i 0..n  \$\$ Declares the range of meta iterator i (inclusive).}
\DoxyCodeLine{\$for i [[}
\DoxyCodeLine{               \$\$ Meta loop.}
\DoxyCodeLine{// Foo\$i does blah for \$i-\/ary predicates.}
\DoxyCodeLine{\$range j 1..i}
\DoxyCodeLine{template <size\_t N \$for j [[, typename A\$j]]>}
\DoxyCodeLine{class Foo\$i \{}
\DoxyCodeLine{\$if i == 0 [[}
\DoxyCodeLine{  blah a;}
\DoxyCodeLine{]] \$elif i <= 2 [[}
\DoxyCodeLine{  blah b;}
\DoxyCodeLine{]] \$else [[}
\DoxyCodeLine{  blah c;}
\DoxyCodeLine{]]}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{]]}
\end{DoxyCode}
}

{\itshape will be translated by the Pump compiler to\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Foo0 does blah for 0-\/ary predicates.}}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} N>}
\DoxyCodeLine{\textcolor{keyword}{class }Foo0 \{}
\DoxyCodeLine{  blah a;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Foo1 does blah for 1-\/ary predicates.}}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} N, \textcolor{keyword}{typename} A1>}
\DoxyCodeLine{\textcolor{keyword}{class }Foo1 \{}
\DoxyCodeLine{  blah b;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Foo2 does blah for 2-\/ary predicates.}}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} N, \textcolor{keyword}{typename} A1, \textcolor{keyword}{typename} A2>}
\DoxyCodeLine{\textcolor{keyword}{class }Foo2 \{}
\DoxyCodeLine{  blah b;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Foo3 does blah for 3-\/ary predicates.}}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keywordtype}{size\_t} N, \textcolor{keyword}{typename} A1, \textcolor{keyword}{typename} A2, \textcolor{keyword}{typename} A3>}
\DoxyCodeLine{\textcolor{keyword}{class }Foo3 \{}
\DoxyCodeLine{  blah c;}
\DoxyCodeLine{\};}
\end{DoxyCode}
}

{\itshape In another example,}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$range i 1..n}
\DoxyCodeLine{Func(\$for i + [[a\$i]]);}
\DoxyCodeLine{\$\$ The text between i and [[ is the separator between iterations.}
\end{DoxyCode}
}

{\itshape will generate one of the following lines (without the comments), depending on the value of {\ttfamily n}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{Func();              \textcolor{comment}{// If n is 0.}}
\DoxyCodeLine{Func(a1);            \textcolor{comment}{// If n is 1.}}
\DoxyCodeLine{Func(a1 + a2);       \textcolor{comment}{// If n is 2.}}
\DoxyCodeLine{Func(a1 + a2 + a3);  \textcolor{comment}{// If n is 3.}}
\DoxyCodeLine{\textcolor{comment}{// And so on...}}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md254}{}\doxysubsection{Constructs}\label{md__c_autotoc_md254}
{\itshape  We support the following meta programming constructs\+:}

{\itshape $\vert$ {\ttfamily \$var id = exp} $\vert$ Defines a named constant value. {\ttfamily \$id} is $\vert$ \+: \+: valid util the end of the current meta \+: \+: \+: lexical block. \+: $\vert$ \+:-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/--- $\vert$ \+:-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/--- $\vert$ $\vert$ {\ttfamily \$range id exp..exp} $\vert$ Sets the range of an iteration variable, $\vert$ \+: \+: which can be reused in multiple loops \+: \+: \+: later. \+: $\vert$ {\ttfamily \$for id sep \mbox{[}\mbox{[} code \mbox{]}\mbox{]}} $\vert$ Iteration. The range of {\ttfamily id} must have $\vert$ \+: \+: been defined earlier. {\ttfamily \$id} is valid in \+: \+: \+: {\ttfamily code}. \+: $\vert$ {\ttfamily \$(\$)} $\vert$ Generates a single {\ttfamily \$} character. $\vert$ $\vert$ {\ttfamily \$id} $\vert$ Value of the named constant or iteration $\vert$ \+: \+: variable. \+: $\vert$ {\ttfamily } $\vert$ Value of the expression. $\vert$ $\vert$ {\ttfamily \$if exp \mbox{[}\mbox{[} code \mbox{]}\mbox{]} else\+\_\+branch} $\vert$ Conditional. $\vert$ $\vert$ {\ttfamily \mbox{[}\mbox{[} code \mbox{]}\mbox{]}} $\vert$ Meta lexical block. $\vert$ $\vert$ {\ttfamily cpp\+\_\+code} $\vert$ Raw C++ code. $\vert$ $\vert$ {\ttfamily \$\$ comment} $\vert$ Meta comment. $\vert$}

{\itshape {\bfseries{Note\+:}} To give the user some freedom in formatting the Pump source code, Pump ignores a new-\/line character if it\textquotesingle{}s right after {\ttfamily \$for foo} or next to {\ttfamily \mbox{[}\mbox{[}} or {\ttfamily \mbox{]}\mbox{]}}. Without this rule you\textquotesingle{}ll often be forced to write very long lines to get the desired output. Therefore sometimes you may need to insert an extra new-\/line in such places for a new-\/line to show up in your output.}

{\itshape }\hypertarget{md__c_autotoc_md255}{}\doxysubsection{Grammar}\label{md__c_autotoc_md255}
{\itshape  
\begin{DoxyCode}{0}
\DoxyCodeLine{code ::= atomic\_code*}
\DoxyCodeLine{atomic\_code ::= \$var id = exp}
\DoxyCodeLine{    | \$var id = [[ code ]]}
\DoxyCodeLine{    | \$range id exp..exp}
\DoxyCodeLine{    | \$for id sep [[ code ]]}
\DoxyCodeLine{    | \$(\$)}
\DoxyCodeLine{    | \$id}
\DoxyCodeLine{    | \$(exp)}
\DoxyCodeLine{    | \$if exp [[ code ]] else\_branch}
\DoxyCodeLine{    | [[ code ]]}
\DoxyCodeLine{    | cpp\_code}
\DoxyCodeLine{sep ::= cpp\_code | empty\_string}
\DoxyCodeLine{else\_branch ::= \$else [[ code ]]}
\DoxyCodeLine{    | \$elif exp [[ code ]] else\_branch}
\DoxyCodeLine{    | empty\_string}
\DoxyCodeLine{exp ::= simple\_expression\_in\_Python\_syntax}
\end{DoxyCode}
}

{\itshape }\hypertarget{md__c_autotoc_md256}{}\doxysubsection{Code}\label{md__c_autotoc_md256}
{\itshape  You can find the source code of Pump in \href{../scripts/pump.py}{\texttt{ scripts/pump.\+py}}. It is still very unpolished and lacks automated tests, although it has been successfully used many times. If you find a chance to use it in your project, please let us know what you think! We also welcome help on improving Pump.}

{\itshape }\hypertarget{md__c_autotoc_md257}{}\doxysubsection{Real Examples}\label{md__c_autotoc_md257}
{\itshape  You can find real-\/world applications of Pump in \href{https://github.com/google/googletest/tree/master/googletest}{\texttt{ Google Test}} and \href{https://github.com/google/googletest/tree/master/googlemock}{\texttt{ Google Mock}}. The source file {\ttfamily foo.\+h.\+pump} generates {\ttfamily foo.\+h}.}

{\itshape }\hypertarget{md__c_autotoc_md258}{}\doxysubsection{Tips}\label{md__c_autotoc_md258}
{\itshape 
\begin{DoxyItemize}
\item If a meta variable is followed by a letter or digit, you can separate them using {\ttfamily \mbox{[}\mbox{[}\mbox{]}\mbox{]}}, which inserts an empty string. For example {\ttfamily Foo\$j\mbox{[}\mbox{[}\mbox{]}\mbox{]}Helper} generate {\ttfamily Foo1\+Helper} when {\ttfamily j} is 1.
\item To avoid extra-\/long Pump source lines, you can break a line anywhere you want by inserting {\ttfamily \mbox{[}\mbox{[}\mbox{]}\mbox{]}} followed by a new line. Since any new-\/line character next to {\ttfamily \mbox{[}\mbox{[}} or {\ttfamily \mbox{]}\mbox{]}} is ignored, the generated code won\textquotesingle{}t contain this new line.
\end{DoxyItemize}}

{\itshape The custom directory is an injection point for custom user configurations.}

{\itshape }\hypertarget{md__c_autotoc_md260}{}\doxysection{Header $<$tt$>$gtest.\+h$<$/tt$>$}\label{md__c_autotoc_md260}
{\itshape  }\hypertarget{md__c_autotoc_md261}{}\doxysubsection{The following macros can be defined\+:}\label{md__c_autotoc_md261}
{\itshape 
\begin{DoxyItemize}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+O\+S\+\_\+\+S\+T\+A\+C\+K\+\_\+\+T\+R\+A\+C\+E\+\_\+\+G\+E\+T\+T\+E\+R\+\_\+} -\/ The name of an implementation of {\ttfamily Os\+Stack\+Trace\+Getter\+Interface}.
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+C\+U\+S\+T\+O\+M\+\_\+\+T\+E\+M\+P\+D\+I\+R\+\_\+\+F\+U\+N\+C\+T\+I\+O\+N\+\_\+} -\/ An override for {\ttfamily testing\+::\+Temp\+Dir()}. See {\ttfamily testing\+::\+Temp\+Dir} for semantics and signature.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md262}{}\doxysection{Header $<$tt$>$gtest-\/port.\+h$<$/tt$>$}\label{md__c_autotoc_md262}
{\itshape  The following macros can be defined\+:}

{\itshape }\hypertarget{md__c_autotoc_md263}{}\doxysubsection{Flag related macros\+:}\label{md__c_autotoc_md263}
{\itshape 
\begin{DoxyItemize}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+F\+L\+A\+G(flag\+\_\+name)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+U\+S\+E\+\_\+\+O\+W\+N\+\_\+\+F\+L\+A\+G\+F\+I\+L\+E\+\_\+\+F\+L\+A\+G\+\_\+} -\/ Define to 0 when the system provides its own flagfile flag parsing.
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+bool\+\_\+(name)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+int32\+\_\+(name)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+string\+\_\+(name)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+bool\+\_\+(name, default\+\_\+val, doc)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+int32\+\_\+(name, default\+\_\+val, doc)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+string\+\_\+(name, default\+\_\+val, doc)}
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md264}{}\doxysubsection{Logging\+:}\label{md__c_autotoc_md264}
{\itshape 
\begin{DoxyItemize}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+L\+O\+G\+\_\+(severity)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+C\+H\+E\+C\+K\+\_\+(condition)}
\item Functions {\ttfamily Log\+To\+Stderr()} and {\ttfamily Flush\+Info\+Log()} have to be provided too.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md265}{}\doxysubsection{Threading\+:}\label{md__c_autotoc_md265}
{\itshape 
\begin{DoxyItemize}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+H\+A\+S\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N\+\_\+} -\/ Enabled if Notification is already provided.
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+H\+A\+S\+\_\+\+M\+U\+T\+E\+X\+\_\+\+A\+N\+D\+\_\+\+T\+H\+R\+E\+A\+D\+\_\+\+L\+O\+C\+A\+L\+\_\+} -\/ Enabled if {\ttfamily Mutex} and {\ttfamily Thread\+Local} are already provided. Must also provide {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+\+S\+T\+A\+T\+I\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+(mutex)} and {\ttfamily G\+T\+E\+S\+T\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+\+S\+T\+A\+T\+I\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+(mutex)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+E\+X\+C\+L\+U\+S\+I\+V\+E\+\_\+\+L\+O\+C\+K\+\_\+\+R\+E\+Q\+U\+I\+R\+E\+D\+\_\+(locks)}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+L\+O\+C\+K\+\_\+\+E\+X\+C\+L\+U\+D\+E\+D\+\_\+(locks)}
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md266}{}\doxysubsection{Underlying library support features}\label{md__c_autotoc_md266}
{\itshape 
\begin{DoxyItemize}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+H\+A\+S\+\_\+\+C\+X\+X\+A\+B\+I\+\_\+\+H\+\_\+}
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md267}{}\doxysubsection{Exporting A\+P\+I symbols\+:}\label{md__c_autotoc_md267}
{\itshape 
\begin{DoxyItemize}
\item {\ttfamily G\+T\+E\+S\+T\+\_\+\+A\+P\+I\+\_\+} -\/ Specifier for exported symbols.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md268}{}\doxysection{Header $<$tt$>$gtest-\/printers.\+h$<$/tt$>$}\label{md__c_autotoc_md268}
{\itshape 
\begin{DoxyItemize}
\item See documentation at {\ttfamily \mbox{\hyperlink{gtest-printers_8h_source}{gtest/gtest-\/printers.\+h}}} for details on how to define a custom printer.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md270}{}\doxysubsubsection{Setup}\label{md__c_autotoc_md270}
{\itshape  To build Google Test and your tests that use it, you need to tell your build system where to find its headers and source files. The exact way to do it depends on which build system you use, and is usually straightforward.}

{\itshape }\hypertarget{md__c_autotoc_md271}{}\doxysubsection{Build with C\+Make}\label{md__c_autotoc_md271}
{\itshape  Google Test comes with a C\+Make build script ( \href{https://github.com/google/googletest/blob/master/CMakeLists.txt}{\texttt{ C\+Make\+Lists.\+txt}}) that can be used on a wide range of platforms (\char`\"{}\+C\char`\"{} stands for cross-\/platform.). If you don\textquotesingle{}t have C\+Make installed already, you can download it for free from \href{http://www.cmake.org/}{\texttt{ http\+://www.\+cmake.\+org/}}.}

{\itshape C\+Make works by generating native makefiles or build projects that can be used in the compiler environment of your choice. You can either build Google Test as a standalone project or it can be incorporated into an existing C\+Make build for another project.}

{\itshape }\hypertarget{md__c_autotoc_md272}{}\doxysubsubsection{Standalone C\+Make Project}\label{md__c_autotoc_md272}
{\itshape  When building Google Test as a standalone project, the typical workflow starts with\+: \begin{DoxyVerb}mkdir mybuild       # Create a directory to hold the build output.
cd mybuild
cmake ${GTEST_DIR}  # Generate native build scripts.
\end{DoxyVerb}
}

{\itshape If you want to build Google Test\textquotesingle{}s samples, you should replace the last command with \begin{DoxyVerb}cmake -Dgtest_build_samples=ON ${GTEST_DIR}
\end{DoxyVerb}
}

{\itshape If you are on a $\ast$nix system, you should now see a Makefile in the current directory. Just type \textquotesingle{}make\textquotesingle{} to build gtest.}

{\itshape If you use Windows and have Visual Studio installed, a {\ttfamily gtest.\+sln} file and several {\ttfamily .vcproj} files will be created. You can then build them using Visual Studio.}

{\itshape On Mac OS X with Xcode installed, a {\ttfamily .xcodeproj} file will be generated.}

{\itshape }\hypertarget{md__c_autotoc_md273}{}\doxysubsubsection{Incorporating Into An Existing C\+Make Project}\label{md__c_autotoc_md273}
{\itshape  If you want to use gtest in a project which already uses C\+Make, then a more robust and flexible approach is to build gtest as part of that project directly. This is done by making the Google\+Test source code available to the main build and adding it using C\+Make\textquotesingle{}s {\ttfamily add\+\_\+subdirectory()} command. This has the significant advantage that the same compiler and linker settings are used between gtest and the rest of your project, so issues associated with using incompatible libraries (eg debug/release), etc. are avoided. This is particularly useful on Windows. Making Google\+Test\textquotesingle{}s source code available to the main build can be done a few different ways\+:}

{\itshape 
\begin{DoxyItemize}
\item Download the Google\+Test source code manually and place it at a known location. This is the least flexible approach and can make it more difficult to use with continuous integration systems, etc.
\item Embed the Google\+Test source code as a direct copy in the main project\textquotesingle{}s source tree. This is often the simplest approach, but is also the hardest to keep up to date. Some organizations may not permit this method.
\item Add Google\+Test as a git submodule or equivalent. This may not always be possible or appropriate. Git submodules, for example, have their own set of advantages and drawbacks.
\item Use C\+Make to download Google\+Test as part of the build\textquotesingle{}s configure step. This is just a little more complex, but doesn\textquotesingle{}t have the limitations of the other methods.
\end{DoxyItemize}}

{\itshape The last of the above methods is implemented with a small piece of C\+Make code in a separate file (e.\+g. {\ttfamily C\+Make\+Lists.\+txt.\+in}) which is copied to the build area and then invoked as a sub-\/build {\itshape during the C\+Make stage}. That directory is then pulled into the main build with {\ttfamily add\+\_\+subdirectory()}. For example\+:}

{\itshape New file {\ttfamily C\+Make\+Lists.\+txt.\+in}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{cmake\_minimum\_required(VERSION 2.8.2)}
\DoxyCodeLine{}
\DoxyCodeLine{project(googletest-\/download NONE)}
\DoxyCodeLine{}
\DoxyCodeLine{include(ExternalProject)}
\DoxyCodeLine{ExternalProject\_Add(googletest}
\DoxyCodeLine{  GIT\_REPOSITORY    https://github.com/google/googletest.git}
\DoxyCodeLine{  GIT\_TAG           master}
\DoxyCodeLine{  SOURCE\_DIR        "\$\{CMAKE\_CURRENT\_BINARY\_DIR\}/googletest-\/src"}
\DoxyCodeLine{  BINARY\_DIR        "\$\{CMAKE\_CURRENT\_BINARY\_DIR\}/googletest-\/build"}
\DoxyCodeLine{  CONFIGURE\_COMMAND ""}
\DoxyCodeLine{  BUILD\_COMMAND     ""}
\DoxyCodeLine{  INSTALL\_COMMAND   ""}
\DoxyCodeLine{  TEST\_COMMAND      ""}
\DoxyCodeLine{)}
\end{DoxyCode}
}

{\itshape Existing build\textquotesingle{}s {\ttfamily C\+Make\+Lists.\+txt}\+:}

{\itshape 
\begin{DoxyCode}{0}
\DoxyCodeLine{\# Download and unpack googletest at configure time}
\DoxyCodeLine{configure\_file(CMakeLists.txt.in googletest-\/download/CMakeLists.txt)}
\DoxyCodeLine{execute\_process(COMMAND \$\{CMAKE\_COMMAND\} -\/G "\$\{CMAKE\_GENERATOR\}" .}
\DoxyCodeLine{  RESULT\_VARIABLE result}
\DoxyCodeLine{  WORKING\_DIRECTORY \$\{CMAKE\_CURRENT\_BINARY\_DIR\}/googletest-\/download )}
\DoxyCodeLine{if(result)}
\DoxyCodeLine{  message(FATAL\_ERROR "CMake step for googletest failed: \$\{result\}")}
\DoxyCodeLine{endif()}
\DoxyCodeLine{execute\_process(COMMAND \$\{CMAKE\_COMMAND\} -\/-\/build .}
\DoxyCodeLine{  RESULT\_VARIABLE result}
\DoxyCodeLine{  WORKING\_DIRECTORY \$\{CMAKE\_CURRENT\_BINARY\_DIR\}/googletest-\/download )}
\DoxyCodeLine{if(result)}
\DoxyCodeLine{  message(FATAL\_ERROR "Build step for googletest failed: \$\{result\}")}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{\# Prevent overriding the parent project's compiler/linker}
\DoxyCodeLine{\# settings on Windows}
\DoxyCodeLine{set(gtest\_force\_shared\_crt ON CACHE BOOL "" FORCE)}
\DoxyCodeLine{}
\DoxyCodeLine{\# Add googletest directly to our build. This defines}
\DoxyCodeLine{\# the gtest and gtest\_main targets.}
\DoxyCodeLine{add\_subdirectory(\$\{CMAKE\_CURRENT\_BINARY\_DIR\}/googletest-\/src}
\DoxyCodeLine{                 \$\{CMAKE\_CURRENT\_BINARY\_DIR\}/googletest-\/build}
\DoxyCodeLine{                 EXCLUDE\_FROM\_ALL)}
\DoxyCodeLine{}
\DoxyCodeLine{\# The gtest/gtest\_main targets carry header search path}
\DoxyCodeLine{\# dependencies automatically when using CMake 2.8.11 or}
\DoxyCodeLine{\# later. Otherwise we have to add them here ourselves.}
\DoxyCodeLine{if (CMAKE\_VERSION VERSION\_LESS 2.8.11)}
\DoxyCodeLine{  include\_directories("\$\{gtest\_SOURCE\_DIR\}/include")}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{\# Now simply link against gtest or gtest\_main as needed. Eg}
\DoxyCodeLine{add\_executable(example example.cpp)}
\DoxyCodeLine{target\_link\_libraries(example gtest\_main)}
\DoxyCodeLine{add\_test(NAME example\_test COMMAND example)}
\end{DoxyCode}
}

{\itshape Note that this approach requires C\+Make 2.\+8.\+2 or later due to its use of the {\ttfamily External\+Project\+\_\+\+Add()} command. The above technique is discussed in more detail in \href{http://crascit.com/2015/07/25/cmake-gtest/}{\texttt{ this separate article}} which also contains a link to a fully generalized implementation of the technique.}

{\itshape }\hypertarget{md__c_autotoc_md274}{}\doxyparagraph{Visual Studio Dynamic vs Static Runtimes}\label{md__c_autotoc_md274}
{\itshape  By default, new Visual Studio projects link the C runtimes dynamically but Google Test links them statically. This will generate an error that looks something like the following\+: gtest.\+lib(gtest-\/all.\+obj) \+: error L\+N\+K2038\+: mismatch detected for \textquotesingle{}Runtime\+Library\textquotesingle{}\+: value \textquotesingle{}M\+Td\+\_\+\+Static\+Debug\textquotesingle{} doesn\textquotesingle{}t match value \textquotesingle{}M\+Dd\+\_\+\+Dynamic\+Debug\textquotesingle{} in main.\+obj}

{\itshape Google Test already has a C\+Make option for this\+: {\ttfamily gtest\+\_\+force\+\_\+shared\+\_\+crt}}

{\itshape Enabling this option will make gtest link the runtimes dynamically too, and match the project in which it is included.}

{\itshape }\hypertarget{md__c_autotoc_md275}{}\doxysubsubsection{C++ Standard Version}\label{md__c_autotoc_md275}
{\itshape  An environment that supports C++11 is required in order to successfully build Google Test. One way to ensure this is to specify the standard in the top-\/level project, for example by using the {\ttfamily set(\+C\+M\+A\+K\+E\+\_\+\+C\+X\+X\+\_\+\+S\+T\+A\+N\+D\+A\+R\+D 11)} command. If this is not feasible, for example in a C project using Google Test for validation, then it can be specified by adding it to the options for cmake via the {\ttfamily D\+C\+M\+A\+K\+E\+\_\+\+C\+X\+X\+\_\+\+F\+L\+A\+GS} option.}

{\itshape }\hypertarget{md__c_autotoc_md276}{}\doxysubsection{Tweaking Google Test}\label{md__c_autotoc_md276}
{\itshape  Google Test can be used in diverse environments. The default configuration may not work (or may not work well) out of the box in some environments. However, you can easily tweak Google Test by defining control macros on the compiler command line. Generally, these macros are named like {\ttfamily G\+T\+E\+S\+T\+\_\+\+X\+YZ} and you define them to either 1 or 0 to enable or disable a certain feature.}

{\itshape We list the most frequently used macros below. For a complete list, see file \href{https://github.com/google/googletest/blob/master/googletest/include/gtest/internal/gtest-port.h}{\texttt{ include/gtest/internal/gtest-\/port.\+h}}.}

{\itshape }\hypertarget{md__c_autotoc_md277}{}\doxysubsection{Multi-\/threaded Tests}\label{md__c_autotoc_md277}
{\itshape  Google Test is thread-\/safe where the pthread library is available. After {\ttfamily \#include \char`\"{}gtest/gtest.\+h\char`\"{}}, you can check the {\ttfamily G\+T\+E\+S\+T\+\_\+\+I\+S\+\_\+\+T\+H\+R\+E\+A\+D\+S\+A\+FE} macro to see whether this is the case (yes if the macro is {\ttfamily \#defined} to 1, no if it\textquotesingle{}s undefined.).}

{\itshape If Google Test doesn\textquotesingle{}t correctly detect whether pthread is available in your environment, you can force it with \begin{DoxyVerb}-DGTEST_HAS_PTHREAD=1
\end{DoxyVerb}
}

{\itshape or \begin{DoxyVerb}-DGTEST_HAS_PTHREAD=0
\end{DoxyVerb}
}

{\itshape When Google Test uses pthread, you may need to add flags to your compiler and/or linker to select the pthread library, or you\textquotesingle{}ll get link errors. If you use the C\+Make script or the deprecated Autotools script, this is taken care of for you. If you use your own build script, you\textquotesingle{}ll need to read your compiler and linker\textquotesingle{}s manual to figure out what flags to add.}

{\itshape }\hypertarget{md__c_autotoc_md278}{}\doxysubsection{As a Shared Library (\+D\+L\+L)}\label{md__c_autotoc_md278}
{\itshape  Google Test is compact, so most users can build and link it as a static library for the simplicity. You can choose to use Google Test as a shared library (known as a D\+LL on Windows) if you prefer.}

{\itshape To compile {\itshape gtest} as a shared library, add \begin{DoxyVerb}-DGTEST_CREATE_SHARED_LIBRARY=1
\end{DoxyVerb}
}

{\itshape to the compiler flags. You\textquotesingle{}ll also need to tell the linker to produce a shared library instead -\/ consult your linker\textquotesingle{}s manual for how to do it.}

{\itshape To compile your {\itshape tests} that use the gtest shared library, add \begin{DoxyVerb}-DGTEST_LINKED_AS_SHARED_LIBRARY=1
\end{DoxyVerb}
}

{\itshape to the compiler flags.}

{\itshape Note\+: while the above steps aren\textquotesingle{}t technically necessary today when using some compilers (e.\+g. G\+CC), they may become necessary in the future, if we decide to improve the speed of loading the library (see \href{http://gcc.gnu.org/wiki/Visibility}{\texttt{ http\+://gcc.\+gnu.\+org/wiki/\+Visibility}} for details). Therefore you are recommended to always add the above flags when using Google Test as a shared library. Otherwise a future release of Google Test may break your build script.}

{\itshape }\hypertarget{md__c_autotoc_md279}{}\doxysubsection{Avoiding Macro Name Clashes}\label{md__c_autotoc_md279}
{\itshape  In C++, macros don\textquotesingle{}t obey namespaces. Therefore two libraries that both define a macro of the same name will clash if you {\ttfamily \#include} both definitions. In case a Google Test macro clashes with another library, you can force Google Test to rename its macro to avoid the conflict.}

{\itshape Specifically, if both Google Test and some other code define macro F\+OO, you can add \begin{DoxyVerb}-DGTEST_DONT_DEFINE_FOO=1
\end{DoxyVerb}
}

{\itshape to the compiler flags to tell Google Test to change the macro\textquotesingle{}s name from {\ttfamily F\+OO} to {\ttfamily G\+T\+E\+S\+T\+\_\+\+F\+OO}. Currently {\ttfamily F\+OO} can be {\ttfamily F\+A\+IL}, {\ttfamily S\+U\+C\+C\+E\+ED}, or {\ttfamily T\+E\+ST}. For example, with {\ttfamily -\/D\+G\+T\+E\+S\+T\+\_\+\+D\+O\+N\+T\+\_\+\+D\+E\+F\+I\+N\+E\+\_\+\+T\+E\+ST=1}, you\textquotesingle{}ll need to write \begin{DoxyVerb}GTEST_TEST(SomeTest, DoesThis) { ... }
\end{DoxyVerb}
}

{\itshape instead of \begin{DoxyVerb}TEST(SomeTest, DoesThis) { ... }
\end{DoxyVerb}
}

{\itshape in order to define a test.}

{\itshape }\hypertarget{md__c_autotoc_md282}{}\doxysubsubsection{O\+S\+S Builds Status\+:}\label{md__c_autotoc_md282}
{\itshape  \href{https://travis-ci.org/google/googletest}{\texttt{ }} \href{https://ci.appveyor.com/project/GoogleTestAppVeyor/googletest/branch/master}{\texttt{ }}}

{\itshape }\hypertarget{md__c_autotoc_md283}{}\doxysubsection{Future Plans}\label{md__c_autotoc_md283}
{\itshape  }\hypertarget{md__c_autotoc_md284}{}\doxysubsubsection{1.\+8.\+x Release\+:}\label{md__c_autotoc_md284}
{\itshape  \href{https://github.com/google/googletest/releases/tag/release-1.8.1}{\texttt{ the 1.\+8.\+x}} is the last release that works with pre-\/\+C++11 compilers. The 1.\+8.\+x will not accept any requests for any new features and any bugfix requests will only be accepted if proven \char`\"{}critical\char`\"{}}

{\itshape }\hypertarget{md__c_autotoc_md285}{}\doxysubsubsection{Post 1.\+8.\+x\+:}\label{md__c_autotoc_md285}
{\itshape  On-\/going work to improve/cleanup/pay technical debt. When this work is completed there will be a 1.\+9.\+x tagged release}

{\itshape }\hypertarget{md__c_autotoc_md286}{}\doxysubsubsection{Post 1.\+9.\+x}\label{md__c_autotoc_md286}
{\itshape  Post 1.\+9.\+x googletest will follow \href{https://abseil.io/about/philosophy}{\texttt{ Abseil Live at Head philosophy}}}

{\itshape }\hypertarget{md__c_autotoc_md287}{}\doxysection{Welcome to $<$strong$>$\+Google Test$<$/strong$>$, Google\textquotesingle{}s C++ test framework!}\label{md__c_autotoc_md287}
{\itshape  This repository is a merger of the formerly separate Google\+Test and Google\+Mock projects. These were so closely related that it makes sense to maintain and release them together.}

{\itshape Please subscribe to the mailing list at \href{mailto:googletestframework@googlegroups.com}{\texttt{ googletestframework@googlegroups.\+com}} for questions, discussions, and development.}

{\itshape }\hypertarget{md__c_autotoc_md288}{}\doxysubsection{Getting started\+:}\label{md__c_autotoc_md288}
{\itshape  The information for {\bfseries{Google Test}} is available in the Google Test Primer documentation.}

{\itshape {\bfseries{Google \mbox{\hyperlink{class_mock}{Mock}}}} is an extension to Google Test for writing and using C++ mock classes. See the separate Google Mock documentation.}

{\itshape More detailed documentation for googletest is in its interior googletest/\+R\+E\+A\+D\+ME.md file.}

{\itshape }\hypertarget{md__c_autotoc_md289}{}\doxysection{Features}\label{md__c_autotoc_md289}
{\itshape 
\begin{DoxyItemize}
\item An \href{https://en.wikipedia.org/wiki/XUnit}{\texttt{ x\+Unit}} test framework.
\item Test discovery.
\item A rich set of assertions.
\item User-\/defined assertions.
\item Death tests.
\item Fatal and non-\/fatal failures.
\item Value-\/parameterized tests.
\item Type-\/parameterized tests.
\item Various options for running the tests.
\item X\+ML test report generation.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md290}{}\doxysection{Platforms}\label{md__c_autotoc_md290}
{\itshape  Google test has been used on a variety of platforms\+:}

{\itshape 
\begin{DoxyItemize}
\item Linux
\item Mac OS X
\item Windows
\item Cygwin
\item Min\+GW
\item Windows Mobile
\item Symbian
\item Platform\+IO
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md291}{}\doxysection{Who Is Using Google Test?}\label{md__c_autotoc_md291}
{\itshape  In addition to many internal projects at Google, Google Test is also used by the following notable projects\+:}

{\itshape 
\begin{DoxyItemize}
\item The \href{http://www.chromium.org/}{\texttt{ Chromium projects}} (behind the Chrome browser and Chrome OS).
\item The \href{http://llvm.org/}{\texttt{ L\+L\+VM}} compiler.
\item \href{https://github.com/google/protobuf}{\texttt{ Protocol Buffers}}, Google\textquotesingle{}s data interchange format.
\item The \href{http://opencv.org/}{\texttt{ Open\+CV}} computer vision library.
\item \href{https://github.com/tiny-dnn/tiny-dnn}{\texttt{ tiny-\/dnn}}\+: header only, dependency-\/free deep learning framework in C++11.
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md292}{}\doxysection{Related Open Source Projects}\label{md__c_autotoc_md292}
{\itshape  \href{https://github.com/nholthaus/gtest-runner}{\texttt{ G\+Test Runner}} is a Qt5 based automated test-\/runner and Graphical User \mbox{\hyperlink{class_interface}{Interface}} with powerful features for Windows and Linux platforms.}

{\itshape \href{https://github.com/ospector/gtest-gbar}{\texttt{ Google Test UI}} is test runner that runs your test binary, allows you to track its progress via a progress bar, and displays a list of test failures. Clicking on one shows failure text. Google Test UI is written in C\#.}

{\itshape \href{https://github.com/kinow/gtest-tap-listener}{\texttt{ G\+Test T\+AP Listener}} is an event listener for Google Test that implements the \href{https://en.wikipedia.org/wiki/Test_Anything_Protocol}{\texttt{ T\+AP protocol}} for test result output. If your test runner understands T\+AP, you may find it useful.}

{\itshape \href{https://github.com/google/gtest-parallel}{\texttt{ gtest-\/parallel}} is a test runner that runs tests from your binary in parallel to provide significant speed-\/up.}

{\itshape \href{https://marketplace.visualstudio.com/items?itemName=DavidSchuldenfrei.gtest-adapter}{\texttt{ Google\+Test Adapter}} is a VS Code extension allowing to view Google Tests in a tree view, and run/debug your tests.}

{\itshape }\hypertarget{md__c_autotoc_md293}{}\doxysection{Requirements}\label{md__c_autotoc_md293}
{\itshape  Google Test is designed to have fairly minimal requirements to build and use with your projects, but there are some. If you notice any problems on your platform, please notify \href{https://groups.google.com/forum/\#!forum/googletestframework}{\texttt{ googletestframework@googlegroups.\+com}}. Patches for fixing them are welcome!}

{\itshape }\hypertarget{md__c_autotoc_md294}{}\doxysubsection{Build Requirements}\label{md__c_autotoc_md294}
{\itshape  These are the base requirements to build and use Google Test from a source package\+:}

{\itshape 
\begin{DoxyItemize}
\item \href{https://bazel.build/}{\texttt{ Bazel}} or \href{https://cmake.org/}{\texttt{ C\+Make}}. N\+O\+TE\+: Bazel is the build system that googletest is using internally and tests against. C\+Make is community-\/supported.
\item a C++11-\/standard-\/compliant compiler
\end{DoxyItemize}}

{\itshape }\hypertarget{md__c_autotoc_md295}{}\doxysection{Contributing change}\label{md__c_autotoc_md295}
{\itshape  Please read the \`{}\+C\+O\+N\+T\+R\+I\+B\+U\+T\+I\+NG.md\`{} for details on how to contribute to this project.}

{\itshape Happy testing! }